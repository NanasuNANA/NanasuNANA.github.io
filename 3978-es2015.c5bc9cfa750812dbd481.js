(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[3978],{33978:function(t,e,n){n(93683),Opal.modules["bcdice/game_system/EarthDawn"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t<e:t["$<"](e)}function $(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:t["$>="](e)}var s,l,a,u,o,c,d,p,f,g,m,_,y,h=[],x=t.nil,b=t.$$,S=t.module,T=t.klass,E=t.send2,R=t.truthy,v=t.send;return s=h,l=y=[S(h[0],"BCDice")].concat(s),a=_=[S(y[0],"GameSystem")].concat(l),g=T(_[0],b(_,"Base"),"EarthDawn"),m=[g].concat(a),g.$$prototype.string=g.$$prototype.isFailed=x,t.const_set(m[0],"ID","EarthDawn"),t.const_set(m[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f3"),t.const_set(m[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u3093"),t.const_set(m[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEn+k)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9k(D2-D20)\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u632f\u308a\u8db3\u3057\u3082\u81ea\u52d5\u3002\n\u4f8b\uff099E\u300010E8\u300010E+D12\n"),g.$register_prefix("\\d+e"),t.def(g,"$initialize",u=function(e){var n=this;return u.$$p&&(u.$$p=null),E(n,t.find_super_dispatcher(n,"initialize",u,!1,!0),"initialize",[e],null),n.sort_add_dice=!0},u.$$arity=1),t.def(g,"$eval_game_system_specific_command",o=function(t){return this.$ed_step(t)},o.$$arity=1),t.def(g,"$ed_step",c=function(t){return this.$getStepResult(t)},c.$$arity=1),t.def(g,"$getStepResult",d=function(t){var s=this,l=x,a=x,u=x,o=x,c=x,d=x,p=x,f=x,g=x,_=x,y=x,h=x,S=x,T=x,E=x,v=x,z=x,D=x,k=x,w=x;return!R(/(\d+)E(\d+)?(\+)?(\d+)?(d\d+)?/i["$=~"](t))||(l=0,s.isFailed=!0,a=b(m,"Regexp").$last_match(1).$to_i(),u=0,o=!1,c=0,d=0,R(e(a,40))&&(a=40),R(b(m,"Regexp").$last_match(2))&&(u=b(m,"Regexp").$last_match(2).$to_i(),R(e(u,43))&&(u=42)),R(b(m,"Regexp").$last_match(3))&&(o=b(m,"Regexp").$last_match(3).$to_i()),R(b(m,"Regexp").$last_match(4))&&(c=b(m,"Regexp").$last_match(4).$to_i()),R(b(m,"Regexp").$last_match(5))&&(d=b(m,"Regexp").$last_match(5)),R(n(u,0)))?x:(f=(p=s.$getStepTable())["$[]"](0)["$[]"]($(a,1)),g=p["$[]"](1)["$[]"]($(a,1)),_=p["$[]"](2)["$[]"]($(a,1)),y=p["$[]"](3)["$[]"]($(a,1)),h=p["$[]"](4)["$[]"]($(a,1)),S=p["$[]"](5)["$[]"]($(a,1)),T=p["$[]"](6)["$[]"]($(a,1)),R(o)&&(/d20/i["$==="](E=d)?g=r(g,c):/d12/i["$==="](E)?_=r(_,c):/d10/i["$==="](E)?y=r(y,c):/d8/i["$==="](E)?h=r(h,c):/d6/i["$==="](E)?S=r(S,c):/d4/i["$==="](E)?T=r(T,c):f=r(f,c)),s.string="",s.$debug("d20step, d12step, d10step, d8step, d6step, d4step",g,_,y,h,S,T),l=r(l,s.$rollStep(20,g)),l=r(l,s.$rollStep(12,_)),l=r(l,s.$rollStep(10,y)),l=r(l,s.$rollStep(8,h)),l=r(l,s.$rollStep(6,S)),l=r(l,s.$rollStep(4,T)),R(e(f,0))&&(s.string=r(s.string,"+")),R(f["$!="](0))&&(s.string=r(s.string,f.$to_s()),l=r(l,f)),s.string=r(s.string," \uff1e "+l),v="\u30b9\u30c6\u30c3\u30d7"+a+" \uff1e "+s.string,u["$=="](0)||(s.string=r(s.string," \uff1e "),z=p["$[]"](7)["$[]"]($(u,1)),D=p["$[]"](8)["$[]"]($(u,1)),k=p["$[]"](9)["$[]"]($(u,1)),w=p["$[]"](11)["$[]"]($(u,1)),s.string=R(s.isFailed)?r(s.string,"\u81ea\u52d5\u5931\u6557"):R(i(l,z))?r(s.string,"\u6700\u826f\u6210\u529f"):R(i(l,D))?r(s.string,"\u512a\u6210\u529f"):R(i(l,k))?r(s.string,"\u826f\u6210\u529f"):R(i(l,u))?r(s.string,"\u6210\u529f"):R(n(l,w))?r(s.string,"\u5927\u5931\u6557"):r(s.string,"\u5931\u6557"),v="\u30b9\u30c6\u30c3\u30d7"+a+">="+u+" \uff1e "+s.string),v)},d.$$arity=1),t.def(g,"$getStepTable",p=function(){return[[-2,-1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,0,0,2,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[0,0,0,0,0,1,0,0,0,1,1,2,1,0,0,0,1,0,0,0,1,1,2,1,1,1,1,2,1,1,1,2,3,2,1,1,1,2,1,1,0,0,1,0,0,0,1,0,0,0,1,1,2,1],[0,0,0,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,1,0,1,0,0,1,1,2,1,1,1,2,2,1,1,1,1,2,1,1,1,0,0,1,0,0,1,0,0,0,1,0,1,0,0],[0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,1,0,0,0,0,1,0,0,0,2,1,0,0,0,0,1,0,0,0,2,0,0,0,0,1,0,0,0,2,1,1,0,0,0],[1,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0],[6,8,10,12,14,17,19,20,22,24,25,27,29,32,33,35,37,38,39,41,42,44,45,47,48,49,51,52,54,55,56,58,59,60,62,64,65,67,68,70,71,72],[4,6,8,10,11,13,15,16,18,19,21,22,24,26,27,29,30,32,33,34,35,37,38,40,41,42,43,45,46,47,48,49,51,52,53,55,56,58,59,60,61,62],[2,4,6,7,9,10,12,13,14,15,17,18,20,21,22,24,25,26,27,28,29,31,32,33,34,35,36,38,39,40,41,42,43,45,46,47,48,50,51,52,53,54],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],[0,1,1,1,1,2,2,3,4,5,5,6,6,7,8,8,9,10,11,12,13,13,14,15,16,17,18,18,18,20,21,22,23,23,24,25,26,26,27,28,29,30]]},p.$$arity=0),void t.def(g,"$rollStep",f=function(t,n){var $,i=this,s=x;return i.$debug("rollStep diceType, diceCount, @string",t,n,i.string),s=0,R(e(n,0))&&(R(i.string["$empty?"]())||(i.string=r(i.string,"+")),i.string=r(i.string,n+"d"+t+"["),i.$debug("rollStep @string",i.string),v(n,"times",[],(($=function(e){var n=null==$.$$s?this:$.$$s,i=x,l=x;for(null==n.randomizer&&(n.randomizer=x),null==n.string&&(n.string=x),null==e&&(e=x),i=n.randomizer.$roll_once(t),R(i["$!="](1))&&(n.isFailed=!1),l=i;i["$=="](t);)l=r(l,i=n.randomizer.$roll_once(t));return s=r(s,l),R(e["$!="](0))&&(n.string=r(n.string,",")),n.string=r(n.string,l.$to_s())}).$$s=i,$.$$arity=1,$)),i.string=r(i.string,"]")),s},f.$$arity=2)},function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}function $(t,e){return"number"==typeof t&&"number"==typeof e?t<e:t["$<"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t/e:t["$/"](e)}var s,l,a,u,o,c,d,p,f,g,m,_,y,h,x,b,S,T,E,R=[],v=t.nil,z=t.$$,D=t.module,k=t.klass,w=t.send2,I=t.truthy,F=t.send;t.top.$require("bcdice/game_system/EarthDawn"),s=R,l=E=[D(R[0],"BCDice")].concat(s),a=T=[D(E[0],"GameSystem")].concat(l),b=k(T[0],z(T,"EarthDawn"),"EarthDawn4"),S=[b].concat(a),b.$$prototype.calcText=b.$$prototype.isFailed=v,t.const_set(S[0],"ID","EarthDawn4"),t.const_set(S[0],"NAME","\u30a2\u30fc\u30b9\u30c9\u30fc\u30f34\u7248"),t.const_set(S[0],"SORT_KEY","\u3042\u3042\u3059\u3068\u304a\u30934"),t.const_set(S[0],"HELP_MESSAGE","\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3000(xEnK)\n\u30b9\u30c6\u30c3\u30d7x\u3001\u76ee\u6a19\u5024n(\u7701\u7565\u53ef\u80fd\uff09\u3067\u30b9\u30c6\u30c3\u30d7\u30c0\u30a4\u30b9\u3092\u30ed\u30fc\u30eb\u3002\n\u30ab\u30eb\u30de\u30c0\u30a4\u30b9\u4f7f\u7528\u6642\u306f\u672b\u5c3e\u306bK\u3092\u8ffd\u52a0\uff08\u7701\u7565\u53ef\u80fd\uff09\n\u4f8b\uff09\u30b9\u30c6\u30c3\u30d710\uff1a10E\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\uff1a10E8\n\u3000\u3000\u30b9\u30c6\u30c3\u30d710\u3001\u76ee\u6a19\u50248\u3001\u30ab\u30eb\u30de\u30c0\u30a4\u30b9\uff1a10E8K\n"),b.$register_prefix("\\d+e"),t.def(b,"$initialize",u=function(e){var n=this;return u.$$p&&(u.$$p=null),w(n,t.find_super_dispatcher(n,"initialize",u,!1,!0),"initialize",[e],null),n.sort_add_dice=!0,n.calcText=""},u.$$arity=1),t.def(b,"$eval_game_system_specific_command",o=function(t){return this.$ed_step(t)},o.$$arity=1),t.def(b,"$ed_step",c=function(t){return this.$getStepResult(t)},c.$$arity=1),t.def(b,"$getStepResult",d=function(e){var n,$,r,i,s=v,l=v;return $=this.$getStepResultInfos(e),r=null==(n=t.to_ary($))[1]?v:n[1],i=null==n[2]?v:n[2],l=null==n[3]?v:n[3],I((s=null==n[0]?v:n[0])["$nil?"]())?v:l["$=="](0)?s+" \uff1e "+r+" \uff1e "+i:s+">="+l+" \uff1e "+r+" \uff1e "+i+" \uff1e "+this.$getSuccess(l,i)},d.$$arity=1),t.def(b,"$getStepResultInfos",p=function($){var r,i,s,l,a,u=this,o=v,c=v,d=v,p=v,f=v,g=v,m=v,_=v,y=v,h=v,x=v;for(o=[],c=[],d=[],p=0;I(I(f=$["$nil?"]()["$!"]())?$["$empty?"]()["$!"]():f);){if(u.$debug("=====>!! str",$),i=u.$getStepResultInfo($),m=null==(r=t.to_ary(i))[1]?v:r[1],_=null==r[2]?v:r[2],y=null==r[3]?v:r[3],h=null==r[4]?v:r[4],u.$debug("=====> step",g=null==r[0]?v:r[0]),I(g["$nil?"]()))return v;if(o["$<<"](g),c["$<<"](m),d["$<<"](_),y["$=="](0)||(p=y),u.$debug("=====> nextText",h),h["$=="]($))break;$=h}return l=o.$join("+"),x=c.$join(")+("),a=F(d,"inject",[],((s=function(t,n){return null==t&&(t=v),null==n&&(n=v),e(t,n)}).$$s=u,s.$$arity=2,s)),I(n(c.$size(),1))&&(x=e(e("(",x),")")),I(n(d.$size(),1))&&(x=e(x," \uff1e ("+d.$join("+")+")")),[l,x,a,p]},p.$$arity=1),t.def(b,"$getStepResultInfo",f=function(t){var n,r=this,i=v,s=v,l=v,a=v,u=v,o=v,c=v,d=v;return!I(/^(\d+)E(\d+)?(K)?(\+\d+$)?(\+(.*))?/i["$=~"](t))||(i=0,r.isFailed=!0,s=z(S,"Regexp").$last_match(1).$to_i(),l=z(S,"Regexp").$last_match(2).$to_i(),I($(l,0)))?v:(a=z(S,"Regexp").$last_match(3)["$nil?"]()["$!"](),u=z(S,"Regexp").$last_match(4).$to_i(),o=z(S,"Regexp").$last_match(6),c=r.$getStepInfo(s),r.$debug("stepInfo",c),r.calcText="",F([20,12,10,8,6,4],"each",[],((n=function(t){return null==t&&(t=v),i=e(i,(null==n.$$s?this:n.$$s).$rollStep(t,c.$shift()))}).$$s=r,n.$$arity=1,n)),d=c.$shift(),I(a)&&(i=e(i,r.$rollStep(6,1))),r.calcText=e(r.calcText,e(r.$getModifyText(d),r.$getModifyText(u))),i=e(i,e(d,u)),["\u30b9\u30c6\u30c3\u30d7"+s,r.calcText,i,l,o])},f.$$arity=1),t.def(b,"$getModifyText",g=function(t){var $=v;return $="",t["$=="](0)||(I(n(t,0))&&($=e($,"+")),$=e($,t.$to_s())),$},g.$$arity=1),t.def(b,"$getBaseStepTable",m=function(){return[[1,[0,0,0,0,0,1,-2]],[2,[0,0,0,0,0,1,-1]],[3,[0,0,0,0,0,1,0]],[4,[0,0,0,0,1,0,0]],[5,[0,0,0,1,0,0,0]],[6,[0,0,1,0,0,0,0]],[7,[0,1,0,0,0,0,0]]]},m.$$arity=0),t.def(b,"$getStepInfo",_=function(t){var e,n,$=this,s=v,l=v,a=v,u=v,o=v,c=v,d=v,p=v;return n=(s=$.$getBaseStepTable()).$last().$first(),I(function(t,e){return"number"==typeof t&&"number"==typeof e?t<=e:t["$<="](e)}(t,n))?$.$get_table_by_number(t,s):(l=[1,0,0,0,0,0,0],a=r(r(t,n),1),o=[0,0,0,0,0,0,0],c=i(a,(u=[[0,0,0,0,2,0,0],[0,0,0,1,1,0,0],[0,0,0,2,0,0,0],[0,0,1,1,0,0,0],[0,0,2,0,0,0,0],[0,1,1,0,0,0,0],[0,2,0,0,0,0,0],[0,1,0,0,2,0,0],[0,1,0,1,1,0,0],[0,1,0,2,0,0,0],[0,1,1,1,0,0,0]]).$size()).$to_i(),F(c,"times",[],((e=function(){return(null==e.$$s?this:e.$$s).$addStepToResult(o,l)}).$$s=$,e.$$arity=0,e)),d=a["$%"](u.$size()),p=u["$[]"](d),$.$addStepToResult(o,p),o)},_.$$arity=1),t.def(b,"$addStepToResult",y=function(n,$){var i;return F(n.$size(),"times",[],((i=function(i){var s;return null==i&&(i=v),s=[i,e(n["$[]"](i),$["$[]"](i))],F(n,"[]=",t.to_a(s)),s[r(s.length,1)]}).$$s=this,i.$$arity=1,i)),n},y.$$arity=2),t.def(b,"$getSuccess",h=function(t,n){var s=v;return I(this.isFailed)?"\u81ea\u52d5\u5931\u6557":(s=r(n,t),this.$debug("diff",s),I($(s,0))?"\u5931\u6557":"\u6210\u529f \u30ec\u30d9\u30eb\uff1a"+e(i(s,5).$to_i(),1))},h.$$arity=2),t.def(b,"$rollStep",x=function(t,$){var r,i=this,s=v;return i.$debug("rollStep diceType, diceCount, @calcText",t,$,i.calcText),s=0,I(n($,0))&&(I(i.calcText["$empty?"]())||(i.calcText=e(i.calcText,"+")),i.calcText=e(i.calcText,$+"d"+t+"["),i.$debug("rollStep string",i.calcText),F($,"times",[],((r=function(n){var $=null==r.$$s?this:r.$$s,i=v,l=v;for(null==$.randomizer&&($.randomizer=v),null==$.calcText&&($.calcText=v),null==n&&(n=v),i=$.randomizer.$roll_once(t),I(i["$!="](1))&&($.isFailed=!1),l=i;i["$=="](t);)l=e(l,i=$.randomizer.$roll_once(t));return s=e(s,l),I(n["$!="](0))&&($.calcText=e($.calcText,",")),$.calcText=e($.calcText,l.$to_s())}).$$s=i,r.$$arity=1,r)),i.calcText=e(i.calcText,"]")),s},x.$$arity=2)}(Opal)}}]);