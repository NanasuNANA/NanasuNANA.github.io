(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9948],{1119:(ge,ye,he)=>{he(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var G,i,t,c,u,m,j=e.module,L=e.class_variable_set,l=e.truthy,N=e.class_variable_get,S=e.def,q=e.send,U=e.send2,k=e.find_super,E=e.hash2,B=e.find_block_super,F=e.neqeq,H=e.thrower,P=e.return_val,M=[],D=e.nil,R=e.$$$;return G=M,m=[u=j(M[0],"I18n")].concat(G),L(m[0],"@@fallbacks",D),i=e.get_singleton_class(u),t=[i].concat(m),c=e.$r(t),S(i,"$fallbacks",function(){var w=D;return L(t[1],"@@fallbacks",l(null!=t[1].$$cvars["@@fallbacks"]?"class variable":D)&&l(w=N(t[1],"@@fallbacks",!1))?w:R(R(c("I18n"),"Locale"),"Fallbacks").$new()),l(w=c("Thread").$current()["$[]"]("i18n_fallbacks"))?w:N(t[1],"@@fallbacks",!1)}),S(i,"$fallbacks=",function(I){var w;return L(t[1],"@@fallbacks",l(I["$is_a?"](c("Array")))?R(R(c("I18n"),"Locale"),"Fallbacks").$new(I):I),w=["i18n_fallbacks",N(t[1],"@@fallbacks",!1)],q(c("Thread").$current(),"[]=",w),w[w.length-1]}),function(i,T){var I,w,C,y,c=[j(i,"Backend")].concat(T);return I=c,C=[w=j(c[0],"Fallbacks")].concat(I),y=e.$r(C),S(w,"$translate",function h(_,b,s){try{var d=H("return"),$=h.$$p||D,p=this,A=D,o=D;return h.$$p=null,null==s&&(s=y("EMPTY_HASH")),l(s.$fetch("fallback",!0))?l(s["$[]"]("fallback_in_progress"))?U(p,k(p,"translate",h,!1,!0),"translate",[_,b,s],$):(l(s["$[]"]("default"))&&(A=p["$extract_non_symbol_default!"](s)),o=s.$merge(E(["fallback_in_progress"],{fallback_in_progress:!0})),q(y("I18n").$fallbacks()["$[]"](_),"each",[],function r(x){var n=null==r.$$s?this:r.$$s;null==x&&(x=D);try{return q(n,"catch",["exception"],function f(){var a=null==f.$$s?this:f.$$s,Y=D;if(Y=U(a,B(a,"translate",f.$$def||r.$$def||h,!1,!1),"translate",[x,b,o],null),l(Y["$nil?"]()))return D;F(_.$to_s(),x.$to_s())&&a.$on_fallback(_,x,b,s),d.$throw(Y)},{$$s:n,$$ret:d})}catch(f){if(!e.rescue(f,[R(y("I18n"),"InvalidLocale")]))throw f;try{return D}finally{e.pop_exception()}}},{$$s:p}),l(s["$key?"]("default"))&&l(s["$[]"]("default")["$nil?"]())?D:l(A)?U(p,k(p,"translate",h,!1,!0),"translate",[_,D,s.$merge(E(["default"],{default:A}))],null):p.$throw("exception",R(y("I18n"),"MissingTranslation").$new(_,b,s))):U(p,k(p,"translate",h,!1,!0),"translate",[_,b,s],$)}catch(r){if(r===d)return r.$v;throw r}},-3),S(w,"$extract_non_symbol_default!",function(_){var s,b=D;return b=[_["$[]"]("default")].$flatten(),s=q(b,"detect",[],function($){return null==$&&($=D),$["$is_a?"](y("Symbol"))["$!"]()}),l(s)&&_["$[]="]("default",b["$[]"](0,b.$index(s))),s}),S(w,"$exists?",function h(_,b,s){try{var d=H("return"),$=h.$$p||D,p=this;return h.$$p=null,null==s&&(s=y("EMPTY_HASH")),l(s.$fetch("fallback",!0))?(q(y("I18n").$fallbacks()["$[]"](_),"each",[],function A(o){var r=null==A.$$s?this:A.$$s;null==o&&(o=D);try{if(!l(U(r,B(r,"exists?",A.$$def||h,!1,!1),"exists?",[o,b],null)))return D;d.$throw(!0)}catch(x){if(!e.rescue(x,[R(y("I18n"),"InvalidLocale")]))throw x;try{return D}finally{e.pop_exception()}}},{$$s:p,$$ret:d}),!1):U(p,k(p,"exists?",h,!1,!0),"exists?",[_,b,s],$)}catch(A){if(A===d)return A.$v;throw A}},-3),w.$private(),S(w,"$on_fallback",P(D))}(m[0],m)},Opal.modules["bcdice/randomizer"]=function(e){var u,v,I,w,C,y,i,T,L=e.klass,l=e.const_set,N=e.def,S=e.truthy,q=e.rb_gt,U=e.rb_plus,k=e.rb_le,E=e.send,B=e.rb_minus,F=e.eqeq,H=e.rb_times,P=e.eqeqeq,M=e.rb_ge,D=[],R=e.nil,W=e.$$$;return u=D,i=[(0,e.module)(D[0],"BCDice")].concat(u),T=e.$r(i),v=i,w=[I=L(i[0],null,"Randomizer")].concat(v),C=e.$r(w),(y=I.$$prototype).rand_results=y.detailed_rand_results=R,l(w[0],"UPPER_LIMIT_DICE_TIMES",200),l(w[0],"UPPER_LIMIT_DICE_SIDES",1e4),l(w[0],"UPPER_LIMIT_RANDS",1e4),N(I,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),l(w[0],"DetailedRandResult",C("Struct").$new("kind","sides","value")),N(I,"$roll_barabara",function(_,b){var s=this;return S(q(U(s.rand_results.$size(),_),C("UPPER_LIMIT_RANDS")))&&s.$raise(C("TooManyRandsError")),S(k(_,0))||S(q(_,C("UPPER_LIMIT_DICE_TIMES")))?[]:E(C("Array"),"new",[_],function d(){return(null==d.$$s?this:d.$$s).$roll_once(b)},{$$s:s})}),N(I,"$roll_sum",function(_,b){return this.$roll_barabara(_,b).$sum()}),N(I,"$roll_once",function(_){var s=R;return S(k(_,0))||S(q(_,C("UPPER_LIMIT_DICE_SIDES")))?0:(s=this.$rand_inner(_),this.$push_to_detail("normal",_,s),s)}),N(I,"$roll_index",function(_){return B(this.$roll_once(_),1)}),N(I,"$roll_tens_d10",function(){var s,b=R;return b=this.$rand_inner(10),F(b,10)&&(b=0),s=H(b,10),this.$push_to_detail("tens_d10",10,s),s}),N(I,"$roll_d9",function(){var b;return b=B(this.$rand_inner(10),1),this.$push_to_detail("d9",10,b),b}),N(I,"$roll_d66",function(_){var d,s=R;return s=E(C("Array"),"new",[2],function $(){return(null==$.$$s?this:$.$$s).$roll_once(6)},{$$s:this}),P(W(C("D66SortType"),"ASC"),d=_)?s["$sort!"]():P(W(C("D66SortType"),"DESC"),d)&&s["$sort!"]()["$reverse!"](),U(H(s["$[]"](0),10),s["$[]"](1))}),I.$private(),N(I,"$rand_inner",function(_){var s,b=this;return S(M(b.rand_results.$size(),C("UPPER_LIMIT_RANDS")))&&b.$raise(C("TooManyRandsError")),s=b.$random(_),b.rand_results["$<<"]([s,_]),s}),N(I,"$random",function(_){return U(C("Kernel").$rand(_),1)}),N(I,"$push_to_detail",function(_,b,s){var $;return $=C("DetailedRandResult").$new(_,b,s),this.detailed_rand_results.$push($)}),L(i[0],T("StandardError"),"TooManyRandsError"),R},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var E,P,G,u,m,i,T,D,F,j=e.module,L=e.klass,l=e.def,N=e.truthy,S=e.return_val,q=[],U=e.nil;return E=q,P=F=[j(q[0],"BCDice")].concat(E),G=D=[j(F[0],"DiceTable")].concat(P),m=[u=L(D[0],null,"RollResult")].concat(G),i=e.$r(m),(T=u.$$prototype).table_name=T.value=T.body=U,l(u,"$initialize",function(c,v,I){var w=this;return w.table_name=c,w.value=v,w.body=I}),u.$attr_reader("table_name"),u.$attr_reader("value"),u.$attr_reader("body"),l(u,"$to_s",function(){var c=this;return c.table_name+"("+c.value+") \uff1e "+c.body}),l(u,"$last_body",function(){var c=this;return N(c.body["$is_a?"](i("RollResult")))?c.body.$last_body():c.body}),l(u,"$empty?",S(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var E,P,G,u,m,i,T,D,F,j=e.module,L=e.klass,l=e.truthy,N=e.def,S=e.rb_minus,q=[],U=e.nil;return E=q,P=F=[j(q[0],"BCDice")].concat(E),G=D=[j(F[0],"DiceTable")].concat(P),m=[u=L(D[0],null,"ChainTable")].concat(G),i=e.$r(m),(T=u.$$prototype).times=T.sides=T.items=T.name=U,N(u,"$initialize",function(c,v,I){var w=this,C=U;return w.name=c,w.items=I.$freeze(),C=/(\d+)D(\d+)/i.$match(v),l(C)||w.$raise(i("ArgumentError"),"Unexpected table type: "+v),w.times=C["$[]"](1).$to_i(),w.sides=C["$[]"](2).$to_i()}),N(u,"$roll",function(c){var I,w,v=this,C=U;return I=c.$roll_sum(v.times,v.sides),w=S(I,v.times),C=v.items["$[]"](w),l(C["$respond_to?"]("roll"))&&(C=C.$roll(c)),i("RollResult").$new(v.name,I,C)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var H,R,i,T,t,c,v,G,M,j=e.module,L=e.klass,l=e.hash2,N=e.defs,S=e.def,q=e.rb_plus,U=e.rb_times,k=e.rb_minus,E=[],B=e.nil;return H=E,R=M=[j(E[0],"BCDice")].concat(H),i=G=[j(M[0],"DiceTable")].concat(R),t=[T=L(G[0],null,"D66GridTable")].concat(i),c=e.$r(t),(v=T.$$prototype).name=v.items=B,N(T,"$from_i18n",function(w,C){var h=B;return h=c("I18n").$t(w,l(["locale","raise"],{locale:C,raise:!0})),this.$new(h["$[]"]("name"),h["$[]"]("items"))}),S(T,"$initialize",function(w,C){return this.name=w,this.items=C.$freeze()}),S(T,"$roll",function(w){var y,h,_,b,s;return y=w.$roll_once(6),h=w.$roll_once(6),_=q(U(y,10),h),b=k(y,1),s=k(h,1),c("RollResult").$new(this.name,_,this.items["$[]"](b)["$[]"](s))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var B,M,m,i,T,t,R,W,H,j=e.module,L=e.klass,l=e.hash2,N=e.defs,S=e.def,U=[],k=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),B=U,M=H=[j(U[0],"BCDice")].concat(B),R=[j(H[0],"DiceTable")].concat(M),W=e.$r(R),m=R,T=[i=L(R[0],W("D66GridTable"),"D66HalfGridTable")].concat(m),t=e.$r(T),N(i,"$from_i18n",function(v,I){var C=k;return C=t("I18n").$t(v,l(["locale","raise"],{locale:I,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2_3"),C["$[]"]("items_4_5_6"))}),S(i,"$initialize",function(v,I,w){return this.name=v,this.items=[I,I,I,w,w,w].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var B,M,m,i,T,t,R,W,H,j=e.module,L=e.klass,l=e.hash2,N=e.defs,S=e.def,U=[],k=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),B=U,M=H=[j(U[0],"BCDice")].concat(B),R=[j(H[0],"DiceTable")].concat(M),W=e.$r(R),m=R,T=[i=L(R[0],W("D66GridTable"),"D66OneThirdTable")].concat(m),t=e.$r(T),N(i,"$from_i18n",function(v,I){var C=k;return C=t("I18n").$t(v,l(["locale","raise"],{locale:I,raise:!0})),this.$new(C["$[]"]("name"),C["$[]"]("items_1_2"),C["$[]"]("items_3_4"),C["$[]"]("items_5_6"))}),S(i,"$initialize",function(v,I,w,C){return this.name=v,this.items=[I,I,w,w,C,C].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,G,t,c,v,I,w,m,R,j=e.module,L=e.klass,l=e.hash2,N=e.defs,S=e.def,q=e.eqeqeq,U=e.rb_plus,k=e.rb_times,E=e.truthy,B=[],F=e.nil,H=e.$$$;return M=B,G=R=[j(B[0],"BCDice")].concat(M),t=m=[j(R[0],"DiceTable")].concat(G),v=[c=L(m[0],null,"D66Table")].concat(t),I=e.$r(v),(w=c.$$prototype).sort_type=w.items=w.name=F,N(c,"$from_i18n",function(y,h){var s,b=F;return b=I("I18n").$t(y,l(["locale"],{locale:h})),s=I("D66SortType").$const_get(b["$[]"]("d66_sort_type")),this.$new(b["$[]"]("name"),s,b["$[]"]("items"))}),S(c,"$initialize",function(y,h,_){var b=this;return b.name=y,b.sort_type=h,b.items=_.$freeze()}),S(c,"$roll",function(y){var h=this,_=F,b=F,s=F,d=F;return _=y.$roll_barabara(2,6),q(H(I("D66SortType"),"ASC"),b=h.sort_type)?_["$sort!"]():q(H(I("D66SortType"),"DESC"),b)&&_["$sort!"]()["$reverse!"](),s=U(k(_["$[]"](0),10),_["$[]"](1)),d=E(b=h.items["$[]"](s))?b:h.items["$[]"](s.$to_s()),E(d["$respond_to?"]("roll"))&&(d=d.$roll(y)),I("RollResult").$new(h.name,s,d)}),S(c,"$choice",function(y){return I("RollResult").$new(this.name,y,this.items["$[]"](y))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var D,u,i,T,W,j=e.module,L=e.klass,l=e.hash2,N=e.send,S=e.to_ary,q=e.rb_plus,U=e.rb_times,k=e.send2,E=e.find_super,B=e.def,H=[],P=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),D=H,u=W=[j(H[0],"BCDice")].concat(D),i=[j(W[0],"DiceTable")].concat(u),T=e.$r(i),B(L(i[0],T("D66Table"),"D66LeftRangeTable"),"$initialize",function I(w,C,y){var b;return I.$$p=null,b=l([],{}),N(y,"each",[],function(d){var $,o;return null==d&&(d=P),$=S(d),o=null==$[1]?P:$[1],N(null==$[0]?P:$[0],"each",[],function(x){return null==x&&(x=P),N(o,"each_with_index",[],function(f,a){var Y,Q;return null==f&&(f=P),null==a&&(a=P),Q=q(U(x,10),q(a,1)),N(b,"[]=",Y=[Q,f]),Y[Y.length-1]})})}),k(this,E(this,"initialize",I,!1,!0),"initialize",[w,C,b],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var P,W,T,t,c,v,I,u,D,j=e.module,L=e.klass,l=e.hash2,N=e.defs,S=e.def,q=e.truthy,U=e.rb_minus,k=e.rb_plus,E=e.rb_times,B=[],F=e.nil;return P=B,W=D=[j(B[0],"BCDice")].concat(P),T=u=[j(D[0],"DiceTable")].concat(W),c=[t=L(u[0],null,"D66ParityTable")].concat(T),v=e.$r(c),(I=t.$$prototype).odd=I.even=I.name=F,N(t,"$from_i18n",function(C,y){var _=F;return _=v("I18n").$t(C,l(["locale","raise"],{locale:y,raise:!0})),this.$new(_["$[]"]("name"),_["$[]"]("odd"),_["$[]"]("even"))}),S(t,"$initialize",function(C,y,h){var _=this;return _.name=C,_.odd=y.$freeze(),_.even=h.$freeze()}),S(t,"$roll",function(C){var _,s,d,y=this,h=F;return h=C.$roll_once(6),_=C.$roll_once(6),s=(q(h["$odd?"]())?y.odd:y.even)["$[]"](U(_,1)),d=k(E(h,10),_),v("RollResult").$new(y.name,d,s)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var B,M,u,m,i,T,t,R,H,j=e.module,L=e.klass,l=e.def,N=e.rb_plus,S=e.rb_times,q=e.send,U=[],k=e.nil;return B=U,M=H=[j(U[0],"BCDice")].concat(B),u=R=[j(H[0],"DiceTable")].concat(M),i=[m=L(R[0],null,"D66RangeTable")].concat(u),T=e.$r(i),(t=m.$$prototype).items=t.name=k,l(m,"$initialize",function(v,I){return this.name=v,this.items=I.$freeze()}),l(m,"$roll",function(v){var w,C,y,h=k;return w=v.$roll_once(6),C=v.$roll_once(6),y=N(S(w,10),C),h=q(this.items,"find",[],function(b){return null==b&&(b=k),b["$[]"](0)["$include?"](y)}),T("RollResult").$new(this.name,y,h["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var D,u,c,y,_,b,v,I,w,C,i,W,j=e.module,L=e.klass,l=e.const_set,N=e.send,S=e.hash2,q=e.def,U=e.eqeqeq,k=e.truthy,E=e.to_a,B=e.rb_times,F=e.rb_plus,H=[],P=e.nil;return D=H,u=W=[j(H[0],"BCDice")].concat(D),c=i=[j(W[0],"DiceTable")].concat(u),I=[v=L(i[0],null,"RangeTable")].concat(c),w=e.$r(I),(C=v.$$prototype).name=C.items=C.num_of_dice=C.num_of_sides=C.formatter=P,l(I[0],"RollResult",N(w("Struct"),"new",["sum","values","content","formatted"],function y(){return(null==y.$$s?this:y.$$s).$alias_method("to_s","formatted")},{$$s:v})),l(I[0],"Item",w("Struct").$new("range","content")),l(I[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),l(I[0],"DEFAULT_FORMATTER",N(v,"lambda",[],function(h,_){return null==h&&(h=P),null==_&&(_=P),h.$name()+"("+_.$sum()+") \uff1e "+_.$content()})),v.$attr_reader("name"),v.$attr_reader("num_of_dice"),v.$attr_reader("num_of_sides"),_=[y=e.get_singleton_class(v)].concat(I),b=e.$r(_),q(y,"$from_i18n",function(d,$){var o,A=P;return A=b("I18n").$t(d,S(["locale"],{locale:$})),o=N(A["$[]"]("items"),"map",[],function r(x){return null==x&&(x=P),[(null==r.$$s?this:r.$$s).$conv_string_range(x["$[]"](0)),x["$[]"](1)]},{$$s:this}),this.$new(A["$[]"]("name"),A["$[]"]("type"),o)}),q(y,"$conv_string_range",function(d){var p,$=this;return null==$.name&&($.name=P),U(b("Integer"),p=d)?d:U(b("String"),p)?k(d["$include?"](".."))?N(b("Range"),"new",E(N(d.$split("..",2),"map",[],function A(o){return null==o&&(o=P),(null==A.$$s?this:A.$$s).$Integer(o)},{$$s:$}))):$.$Integer(d):$.$raise(b("TypeError"),$.name+": "+d+" ("+d.$class()+") must be a String or an Integer")}),q(v,"$initialize",function y(h,_,b){var $,s=y.$$p||P,d=this,p=P;return y.$$p=null,d.name=h.$freeze(),d.formatter=k($=s)?$:w("DEFAULT_FORMATTER"),p=w("DICE_ROLL_METHOD_RE").$match(_),k(p)||d.$raise(w("ArgumentError"),d.name+": invalid dice roll method: "+_),d.num_of_dice=p["$[]"](1).$to_i(),d.num_of_sides=p["$[]"](2).$to_i(),d.$store(b)}),q(v,"$fetch",function(h){var b,_=this;return b=N(_.items,"find",[],function(d){return null==d&&(d=P),d.$range()["$include?"](h)}),k(b)||_.$raise(w("RangeError"),_.name+": value is out of range: "+h),b}),q(v,"$roll",function(h){var s,_=this,b=P,d=P;return s=(b=h.$roll_barabara(_.num_of_dice,_.num_of_sides)).$sum(),(d=w("RollResult").$new(s,b,_.$fetch(s).$content()))["$formatted="](_.formatter["$[]"](_,d)),d}),v.$private(),q(v,"$store",function(h){var b,s,_=this;return b=N(h,"map",[],function d($,p){return null==$&&($=P),null==p&&(p=P),[(null==d.$$s?this:d.$$s).$coerce_to_int_range($),p]},{$$s:_}),s=N(b,"sort_by",[],function($,p){return null==$&&($=P),null==p&&(p=P),$.$min()}),_.$assert_min_sum_is_covered(s),_.$assert_max_sum_is_covered(s),_.$assert_no_gap_or_overlap_in_ranges(s),_.items=N(s,"map",[],function($,p){return null==$&&($=P),null==p&&(p=P),w("Item").$new($,p.$freeze()).$freeze()}).$freeze(),_}),q(v,"$coerce_to_int_range",function(h){var b;return U(w("Integer"),b=h)?w("Range").$new(h,h):U(w("Range"),b)&&k(h.$begin()["$is_a?"](w("Integer")))&&k(h.$end()["$is_a?"](w("Integer")))?h:this.$raise(w("TypeError"),this.name+": "+h+" ("+h.$class()+") must be an Integer or a Range with Integers ")}),q(v,"$assert_min_sum_is_covered",function(h){var b,_=this,s=P;return b=_.num_of_dice,s=h.$first()["$[]"](0),k(s["$include?"](b))||_.$raise(w("RangeError"),_.name+": min value ("+b+") is not covered: "+s),_}),q(v,"$assert_max_sum_is_covered",function(h){var b,_=this,s=P;return b=B(_.num_of_dice,_.num_of_sides),s=h.$last()["$[]"](0),k(s["$include?"](b))||_.$raise(w("RangeError"),_.name+": max value ("+b+") is not covered: "+s),_}),q(v,"$assert_no_gap_or_overlap_in_ranges",function(h){return N(h,"each_cons",[2],function b(s,d){var o,r,$=null==b.$$s?this:b.$$s,p=P,A=P;return null==$.name&&($.name=P),null==s&&(s=P),null==d&&(d=P),p=s["$[]"](0),A=d["$[]"](0),o=p.$max(),r=F(o,1),k(A["$include?"](o))&&$.$raise(w("RangeError"),$.name+": Range overlap: "+p+" and "+A),k(A["$include?"](r))?P:$.$raise(w("RangeError"),$.name+": Range gap: "+p+" and "+A)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var F,D,m,v,I,w,C,T,W,P,j=e.module,L=e.klass,l=e.send,N=e.def,S=e.rb_minus,q=e.return_ivar,U=[],k=e.nil,E=e.$$$;return F=U,D=P=[j(U[0],"BCDice")].concat(F),m=W=[j(P[0],"DiceTable")].concat(D),v=T=[L(W[0],null,"SaiFicSkillTable")].concat(m),w=[I=L(T[0],null,"Category")].concat(v),C=e.$r(w),N(I,"$initialize",function(h,_,b,s){var d=this;return d.name=h,d.skills=l(_.$map(),"with_index",[2],function(p,A){return null==p&&(p=k),null==A&&(A=k),E(C("SaiFicSkillTable"),"Skill").$new(h,p,b,A,s)}),d.dice=b}),N(I,"$roll",function(h){return this.$skills()["$[]"](S(h.$roll_sum(2,6),2))}),N(I,"$to_s",q("name")),I.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var k,H,W,T,t,u,M,B,j=e.module,L=e.klass,l=e.def,N=e.hash2,S=[],q=e.nil;return k=S,H=B=[j(S[0],"BCDice")].concat(k),W=M=[j(B[0],"DiceTable")].concat(H),u=[L(M[0],null,"SaiFicSkillTable")].concat(W),(t=(T=L(u[0],null,"Skill")).$$prototype).s_format=t.category_dice=t.row_dice=t.category_name=t.name=q,l(T,"$initialize",function(v,I,w,C,y){var h=this;return h.category_name=v,h.name=I,h.category_dice=w,h.row_dice=C,h.s_format=y}),l(T,"$to_s",function(){var v=this;return v.$format(v.s_format,N(["category_dice","row_dice","category_name","skill_name"],{category_dice:v.category_dice,row_dice:v.row_dice,category_name:v.category_name,skill_name:v.name}))}),T.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var u,t,C,y,h,_,b,v,i,j=e.module,L=e.klass,l=e.ensure_kwargs,N=e.hash2,S=e.send,U=e.defs,k=e.const_set,E=e.to_ary,B=e.def,F=e.truthy,H=e.rb_minus,P=e.rb_plus,M=e.top,D=[],R=e.nil,W=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),u=D,t=i=[j(D[0],"BCDice")].concat(u),C=v=[j(i[0],"DiceTable")].concat(t),h=[y=L(v[0],null,"SaiFicSkillTable")].concat(C),_=e.$r(h),(b=y.$$prototype).rtt=b.rtt_format=b.rct=b.rct_format=b.rttn=b.rttn_format=b.categories=R,U(y,"$from_i18n",function(d,$,p){var A,o,r,a,f=R;return null==(A=(p=l(p)).$$smap.rtt)&&(A=R),null==(o=p.$$smap.rct)&&(o=R),null==(r=p.$$smap.rttn)&&(r=R),a=(f=_("I18n").$t("RTT",N(["locale","raise","default"],{locale:$,raise:!1,default:N([],{})})).$merge(_("I18n").$t(d,N(["locale","raise"],{locale:$,raise:!0}))))["$[]"]("items"),f=S(f,"select",[],function(Q,V){return null==Q&&(Q=R),null==V&&(V=R),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new(a,e.to_hash(f).$merge(N(["rtt","rct","rttn"],{rtt:A,rct:o,rttn:r})))},-3),k(h[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),k(h[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),k(h[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),k(h[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),B(y,"$initialize",function(d,$){var p,A,o,r,x,n,f,a=this;return null==(p=($=l($)).$$smap.rtt)&&(p=R),null==(A=$.$$smap.rct)&&(A=R),null==(o=$.$$smap.rttn)&&(o=R),null==(r=$.$$smap.rtt_format)&&(r=_("DEFAULT_RTT")),null==(x=$.$$smap.rct_format)&&(x=_("DEFAULT_RCT")),null==(n=$.$$smap.rttn_format)&&(n=_("DEFAULT_RTTN")),null==(f=$.$$smap.s_format)&&(f=_("DEFAULT_S")),a.categories=S(d.$map(),"with_index",[1],function(Q,V){var ie,_e,ne;return null==Q&&(Q=R),null==V&&(V=R),_e=null==(ie=E(Q))[0]?R:ie[0],ne=null==ie[1]?R:ie[1],W(_("SaiFicSkillTable"),"Category").$new(_e,ne,V,f)},{$$has_top_level_mlhs_arg:!0}),a.rtt=p,a.rct=A,a.rttn=o.$to_a(),a.rtt_format=r,a.rct_format=x,a.rttn_format=n},-2),k(h[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),B(y,"$roll_command",function(d,$){var A,p=this,o=R,r=R;return F(["RTT",p.rtt]["$include?"](A=$))?p.$format_skill(p.rtt_format,p.$roll_skill(d)):F(["RCT",p.rct]["$include?"](A))?(o=p.$roll_category(d),p.$format(p.rct_format,N(["category_dice","category_name"],{category_dice:o.$dice(),category_name:o.$name()}))):F(r=_("RTTN").$index(A))||F(r=p.rttn.$index(A))?p.$format_skill(p.rttn_format,p.categories["$[]"](r).$roll(d)):R}),B(y,"$roll_category",function(d){return this.categories["$[]"](H(d.$roll_once(6),1))}),B(y,"$roll_skill",function(d){return this.$roll_category(d).$roll(d)}),B(y,"$prefixes",function(){var d=this;return P(["RTT[1-6]?","RCT",d.rtt,d.rct],d.rttn).$compact()}),y.$private(),B(y,"$format_skill",function(d,$){return this.$format(d,N(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:$.$category_dice(),row_dice:$.$row_dice(),category_name:$.$category_name(),skill_name:$.$name(),text:$.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var F,D,m,i,T,t,c,W,P,j=e.module,L=e.klass,l=e.hash2,N=e.defs,S=e.truthy,q=e.def,U=e.rb_minus,k=[],E=e.nil;return F=k,D=P=[j(k[0],"BCDice")].concat(F),m=W=[j(P[0],"DiceTable")].concat(D),T=[i=L(W[0],null,"Table")].concat(m),t=e.$r(T),(c=i.$$prototype).times=c.sides=c.name=c.items=E,N(i,"$from_i18n",function(I,w){var y=E;return y=t("I18n").$t(I,l(["locale"],{locale:w})),this.$new(y["$[]"]("name"),y["$[]"]("type"),y["$[]"]("items"))}),q(i,"$initialize",function(I,w,C){var y=this,h=E;return y.name=I,y.items=C.$freeze(),h=/(\d+)D(\d+)/i.$match(w),S(h)||y.$raise(t("ArgumentError"),"Unexpected table type: "+w),y.times=h["$[]"](1).$to_i(),y.sides=h["$[]"](2).$to_i()}),q(i,"$roll",function(I){var C,w=this;return C=I.$roll_sum(w.times,w.sides),w.$choice(C)}),q(i,"$choice",function(I){var C,w=this;return C=U(I,w.times),t("RollResult").$new(w.name,I,w.items["$[]"](C))})},Opal.modules["bcdice/dice_table"]=function(e){var j=e.top;return j.$require("bcdice/dice_table/roll_result"),j.$require("bcdice/dice_table/chain_table"),j.$require("bcdice/dice_table/d66_grid_table"),j.$require("bcdice/dice_table/d66_half_grid_table"),j.$require("bcdice/dice_table/d66_one_third_table"),j.$require("bcdice/dice_table/d66_left_range_table"),j.$require("bcdice/dice_table/d66_parity_table"),j.$require("bcdice/dice_table/d66_range_table"),j.$require("bcdice/dice_table/d66_table"),j.$require("bcdice/dice_table/range_table"),j.$require("bcdice/dice_table/sai_fic_skill_table"),j.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var q,B,H,k,j=e.module,L=e.const_set,l=[];return q=l,B=k=[j(l[0],"BCDice")].concat(q),H=[j(k[0],"D66SortType")].concat(B),L(H[0],"NO_SORT","no_sort"),L(H[0],"ASC","asc"),L(H[0],"DESC","desc"),function(E,B){var H=[j(E,"RoundType")].concat(B);return L(H[0],"CEIL","ceil"),L(H[0],"FLOOR","floor"),L(H[0],"ROUND","round")}(k[0],k)},Opal.modules["bcdice/translate"]=function(e){var B,M,D,R,W,H,j=e.module,L=e.ensure_kwargs,l=e.kwrestargs,S=e.hash2,q=e.def,U=[],k=e.nil;return B=U,M=H=[j(U[0],"BCDice")].concat(B),R=[D=j(H[0],"Translate")].concat(M),W=e.$r(R),q(D,"$translate",function(u,m){var i,T=this;return null==T.locale&&(T.locale=k),m=L(m),i=l(m,{}),W("I18n").$translate(u,S(["locale","raise"],{locale:T.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var D,G,R,B,H,L=e.klass,l=e.send,N=e.def,S=e.return_val,q=e.return_ivar,U=[],k=e.nil;return B=U,D=H=[(0,e.module)(U[0],"BCDice")].concat(B),[R=L(H[0],null,"Result")].concat(D),N(G=e.get_singleton_class(R),"$success",function(i){return l(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),l(c,"success=",v=[!0]),v[v.length-1]})}),N(G,"$failure",function(i){return l(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),l(c,"failure=",v=[!0]),v[v.length-1]})}),N(G,"$critical",function(i){return l(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),c["$critical="](!0),l(c,"success=",v=[!0]),v[v.length-1]})}),N(G,"$fumble",function(i){return l(this.$new(),"tap",[],function(c){var v;return null==c&&(c=k),c["$text="](i),c["$fumble="](!0),l(c,"failure=",v=[!0]),v[v.length-1]})}),N(G,"$nothing",S("nothing")),N(R,"$initialize",function(u){var m=this;return null==u&&(u=k),m.text=u,m.rands=k,m.detailed_rands=k,m.secret=!1,m.success=!1,m.failure=!1,m.critical=!1,m.fumble=!1},-1),R.$attr_accessor("text","rands","detailed_rands"),R.$attr_writer("secret","success","failure","critical","fumble"),N(R,"$secret?",q("secret")),N(R,"$success?",q("success")),N(R,"$failure?",q("failure")),N(R,"$critical?",q("critical")),N(R,"$fumble?",q("fumble")),N(R,"$condition=",function(u){return this.success=u,this.failure=u["$!"]()})},Opal.modules["racc/parser"]=function(e){var I,C,y,j=e.module,L=e.klass,l=e.truthy,N=e.const_set,S=e.defs,q=e.gvars,U=e.rb_lt,k=e.def,E=e.to_ary,B=e.send,F=e.neqeq,H=e.rb_plus,P=e.eqeq,M=e.rb_ge,D=e.rb_gt,R=e.rb_minus,W=e.rb_le,G=e.rb_times,u=e.assign_ivar_val,i=[],T=e.$r(i),t=e.nil,c=e.$$$;return I=i,C=[j(i[0],"Racc")].concat(I),y=e.$r(C),L(C[0],y("StandardError"),"ParseError"),l(c("::","ParseError","skip_raise")?"constant":t)||N(i[0],"ParseError",c(T("Racc"),"ParseError")),function(v,I){var s,d,$,p,A,y=[j(v,"Racc")].concat(I),h=e.$r(y);return l(h("Racc_No_Extensions","skip_raise")?"constant":t)||N(y[0],"Racc_No_Extensions",!1),s=y,$=[d=L(y[0],null,"Parser")].concat(s),p=e.$r($),(A=d.$$prototype).yydebug=A.racc_debug_out=A.racc_error_status=A.racc_t=A.racc_vstack=A.racc_val=A.racc_state=A.racc_tstack=t,N($[0],"Racc_Runtime_Version","1.4.6"),N($[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),N($[0],"Racc_Runtime_Core_Version_R","1.4.6"),N($[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),N($[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),N($[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),N($[0],"Racc_Runtime_Core_Version",p("Racc_Runtime_Core_Version_R")),N($[0],"Racc_Runtime_Core_Revision",p("Racc_Runtime_Core_Revision_R")),N($[0],"Racc_Runtime_Type","ruby"),S(p("Parser"),"$racc_runtime_type",function(){return p("Racc_Runtime_Type")}),k(d,"$_racc_setup",function(){var r,x,n=this,f=t,a=t;return null==q.stderr&&(q.stderr=t),l(c(n.$class(),"Racc_debug_parser"))||(n.yydebug=!1),l(null!=(r=n.yydebug)&&r!==t?"instance-variable":t)||(n.yydebug=!1),l(n.yydebug)&&(l(null!=(x=n.racc_debug_out)&&x!==t?"instance-variable":t)||(n.racc_debug_out=q.stderr),n.racc_debug_out=l(f=n.racc_debug_out)?f:q.stderr),a=c(n.$class(),"Racc_arg"),l(U(a.$size(),14))&&a["$[]="](13,!0),a}),k(d,"$_racc_init_sysvars",function(){var r=this;return r.racc_state=[0],r.racc_tstack=[],r.racc_vstack=[],r.racc_t=t,r.racc_val=t,r.racc_read_next=!0,r.racc_user_yyerror=!1,r.racc_error_status=0}),k(d,"$do_parse",function(){return this.$__send__(p("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),k(d,"$next_token",function(){return this.$raise(p("NotImplementedError"),this.$class()+"#next_token is not defined")}),k(d,"$_racc_do_parse_rb",function(r,x){var n,a=this,Y=t,Q=t,V=t,ie=t,_e=t,ne=t,ue=t,ae=t;return n=E(r),Y=null==n[0]?t:n[0],Q=null==n[1]?t:n[1],V=null==n[2]?t:n[2],ie=null==n[3]?t:n[3],_e=null==n[10]?t:n[10],a.$_racc_init_sysvars(),ne=ue=ae=t,B(a,"catch",["racc_end_parse"],function re(){var se,K,g=null==re.$$s?this:re.$$s,Z=t;for(null==g.racc_state&&(g.racc_state=t),null==g.racc_read_next&&(g.racc_read_next=t),null==g.racc_t&&(g.racc_t=t),null==g.yydebug&&(g.yydebug=t),null==g.racc_val&&(g.racc_val=t);l(!0);)for(l(ae=ie["$[]"](g.racc_state["$[]"](-1)))?(l(g.racc_read_next)&&F(g.racc_t,0)&&(K=g.$next_token(),se=E(K),ne=null==se[0]?t:se[0],g.racc_val=null==se[1]?t:se[1],g.racc_t=l(ne)?l(Z=_e["$[]"](ne))?Z:1:0,l(g.yydebug)&&g.$racc_read_token(g.racc_t,ne,g.racc_val),g.racc_read_next=!1),ae=H(ae,g.racc_t),l(M(ae,0))&&l(ue=Y["$[]"](ae))&&P(Q["$[]"](ae),g.racc_state["$[]"](-1))||(ue=V["$[]"](g.racc_state["$[]"](-1)))):ue=V["$[]"](g.racc_state["$[]"](-1));l(ue=g.$_racc_evalact(ue,r)););},{$$s:a})}),k(d,"$yyparse",function(r,x){return this.$__send__(p("Racc_YY_Parse_Method"),r,x,this.$_racc_setup(),!0)}),k(d,"$_racc_yyparse_rb",function(r,x,n,f){var a,Q=this,V=t,ie=t,$e=t,_e=t,ue=t,ae=t,re=t;return a=E(n),V=null==a[0]?t:a[0],ie=null==a[1]?t:a[1],$e=null==a[2]?t:a[2],_e=null==a[3]?t:a[3],ue=null==a[10]?t:a[10],Q.$_racc_init_sysvars(),ae=t,re=t,B(Q,"catch",["racc_end_parse"],function se(){var K=null==se.$$s?this:se.$$s;for(null==K.racc_state&&(K.racc_state=t);!l(re=_e["$[]"](K.racc_state["$[]"](-1)));)for(;l(ae=K.$_racc_evalact($e["$[]"](K.racc_state["$[]"](-1)),n)););return B(r,"__send__",[x],function g(Z,X){var z=null==g.$$s?this:g.$$s,O=t,te=t;for(null==z.racc_t&&(z.racc_t=t),null==z.racc_state&&(z.racc_state=t),null==z.racc_read_next&&(z.racc_read_next=t),null==Z&&(Z=t),null==X&&(X=t),z.racc_t=l(Z)?l(O=ue["$[]"](Z))?O:1:0,z.racc_val=X,z.racc_read_next=!1,re=H(re,z.racc_t),l(M(re,0))&&l(ae=V["$[]"](re))&&P(ie["$[]"](re),z.racc_state["$[]"](-1))||(ae=$e["$[]"](z.racc_state["$[]"](-1)));l(ae=z.$_racc_evalact(ae,n)););for(;l(l(O=l(te=(re=_e["$[]"](z.racc_state["$[]"](-1)))["$!"]())?te:z.racc_read_next["$!"]())?O:z.racc_t["$=="](0));)for(l(re)&&l(re=H(re,z.racc_t))&&l(M(re,0))&&l(ae=V["$[]"](re))&&P(ie["$[]"](re),z.racc_state["$[]"](-1))||(ae=$e["$[]"](z.racc_state["$[]"](-1)));l(ae=z.$_racc_evalact(ae,n)););},{$$s:K})},{$$s:Q})}),k(d,"$_racc_evalact",function(r,x){var n,$e,a=this,Y=t,Q=t,ie=t,_e=t,ne=t,ue=t;if(Y=null==(n=E(x))[0]?t:n[0],Q=null==n[1]?t:n[1],ie=null==n[3]?t:n[3],$e=null==n[11]?t:n[11],_e=null==n[12]?t:n[12],l(D(r,0))&&l(U(r,$e)))l(D(a.racc_error_status,0))&&(P(a.racc_t,1)||(a.racc_error_status=R(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push(r),a.racc_read_next=!0,l(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(l(U(r,0))&&l(D(r,_e["$-@"]()))){if(ne=B(a,"catch",["racc_jump"],function ae(){var re=null==ae.$$s?this:ae.$$s;return null==re.racc_state&&(re.racc_state=t),re.racc_state.$push(re.$_racc_do_reduce(x,r)),!1},{$$s:a}),l(ne))switch(ne.valueOf()){case 1:return a.racc_user_yyerror=!0,_e["$-@"]();case 2:return $e;default:a.$raise("[Racc Bug] unknown jump code")}}else if(P(r,$e))l(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(P(r,_e["$-@"]())){switch(a.racc_error_status.valueOf()){case 0:l(x["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:P(a.racc_t,0)&&a.$throw("racc_end_parse",t),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;l(!0)&&!(l(ue=ie["$[]"](a.racc_state["$[]"](-1)))&&(ue=H(ue,1),l(M(ue,0))&&l(r=Y["$[]"](ue))&&P(Q["$[]"](ue),a.racc_state["$[]"](-1))));)l(W(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",t),a.racc_state.$pop(),a.racc_vstack.$pop(),l(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return r}a.$raise("[Racc Bug] unknown action "+r.$inspect())}return l(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),t}),k(d,"$_racc_do_reduce",function(r,x){var n,_e,ue,Z,X,z,ee,a=this,Q=t,V=t,ie=t,$e=t,ne=t,ae=t,re=t,se=t,K=t,g=t,O=t,te=t,J=t;return Q=null==(n=E(r))[4]?t:n[4],V=null==n[5]?t:n[5],ie=null==n[6]?t:n[6],$e=null==n[7]?t:n[7],_e=null==n[8]?t:n[8],ne=null==n[9]?t:n[9],ue=null==n[13]?t:n[13],ae=a.racc_state,re=a.racc_vstack,se=a.racc_tstack,K=G(x,-3),g=ne["$[]"](K),Z=ne["$[]"](H(K,1)),X=ne["$[]"](H(K,2)),z=[],l(a.yydebug)&&(O=se["$[]"](g["$-@"](),g)),te=re["$[]"](g["$-@"](),g),l(a.yydebug)&&se["$[]="](g["$-@"](),g,z),re["$[]="](g["$-@"](),g,z),ae["$[]="](g["$-@"](),g,z),l(ue)?re.$push(a.$__send__(X,te,re,te["$[]"](0))):re.$push(a.$__send__(X,te,re)),se.$push(Z),l(a.yydebug)&&a.$racc_reduce(O,Z,se,re),ee=R(Z,_e),l(K=$e["$[]"](ee))&&(K=H(K,ae["$[]"](-1)),l(M(K,0))&&l(J=Q["$[]"](K))&&P(V["$[]"](K),ee))?J:ie["$[]"](ee)}),k(d,"$on_error",function(r,x,n){var a,f=this;return f.$raise(p("ParseError"),f.$sprintf("\nparse error on value %s (%s)",x.$inspect(),l(a=f.$token_to_str(r))?a:"?"))}),k(d,"$yyerror",function(){return this.$throw("racc_jump",1)}),k(d,"$yyaccept",function(){return this.$throw("racc_jump",2)}),k(d,"$yyerrok",u("racc_error_status",0)),k(d,"$racc_read_token",function(r,x,n){var f=this;return f.racc_debug_out.$print("read    "),f.racc_debug_out.$print(x.$inspect(),"(",f.$racc_token2str(r),") "),f.racc_debug_out.$puts(n.$inspect()),f.racc_debug_out.$puts()}),k(d,"$racc_shift",function(r,x,n){var f=this;return f.racc_debug_out.$puts("shift   "+f.$racc_token2str(r)),f.$racc_print_stacks(x,n),f.racc_debug_out.$puts()}),k(d,"$racc_reduce",function(r,x,n,f){var a=this,Y=t;return(Y=a.racc_debug_out).$print("reduce "),l(r["$empty?"]())?Y.$print(" <none>"):B(r,"each",[],function Q(V){return null==V&&(V=t),Y.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(V))},{$$s:a}),Y.$puts(" --\x3e "+a.$racc_token2str(x)),a.$racc_print_stacks(n,f),a.racc_debug_out.$puts()}),k(d,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),k(d,"$racc_e_pop",function(r,x,n){var f=this;return f.racc_debug_out.$puts("error recovering mode: pop token"),f.$racc_print_states(r),f.$racc_print_stacks(x,n),f.racc_debug_out.$puts()}),k(d,"$racc_next_state",function(r,x){var n=this;return n.racc_debug_out.$puts("goto    "+r),n.$racc_print_states(x),n.racc_debug_out.$puts()}),k(d,"$racc_print_stacks",function(r,x){var f=t;return(f=this.racc_debug_out).$print("        ["),B(r,"each_index",[],function a(Y){return null==Y&&(Y=t),f.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str(r["$[]"](Y))," ",x["$[]"](Y).$inspect(),")")},{$$s:this}),f.$puts(" ]")}),k(d,"$racc_print_states",function(r){var n=t;return(n=this.racc_debug_out).$print("        ["),B(r,"each",[],function(a){return null==a&&(a=t),n.$print(" ",a)}),n.$puts(" ]")}),k(d,"$racc_token2str",function(r){var n;return l(n=c(this.$class(),"Racc_token_to_s_table")["$[]"](r))?n:this.$raise("[Racc Bug] can't convert token "+r+" to string")}),k(d,"$token_to_str",function(r){return c(this.$class(),"Racc_token_to_s_table")["$[]"](r)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var u,t,w,s,d,y,h,v,i,j=e.module,L=e.klass,l=e.def,N=e.thrower,S=e.return_ivar,q=e.send2,U=e.find_super,k=e.eqeq,E=e.const_set,B=e.eqeqeq,F=e.rb_divide,H=e.truthy,P=e.assign_ivar,M=e.alias,D=[],R=e.nil,W=e.$$$;return u=D,t=i=[j(D[0],"BCDice")].concat(u),w=v=[j(i[0],"Arithmetic")].concat(t),y=[j(v[0],"Node")].concat(w),h=e.$r(y),(d=(s=L(y[0],null,"BinaryOp")).$$prototype).lhs=d.rhs=d.op=R,l(s,"$initialize",function(p,A,o){var r=this;return r.lhs=p,r.op=A,r.rhs=o}),l(s,"$eval",function(p){try{N("eval_return");var x,o=this,r=R;return r=o.lhs.$eval(p),x=o.rhs.$eval(p),r.$send(o.op,x)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),l(s,"$output",function(){var p=this;return""+p.lhs.$output()+p.op+p.rhs.$output()}),l(s,"$s_exp",function(){var p=this;return"("+p.$op_for_s_exp()+" "+p.lhs.$s_exp()+" "+p.rhs.$s_exp()+")"}),l(s,"$op_for_s_exp",S("op")),function(_,b,s){var d=L(_,b,"DivideBase"),$=[d].concat(s),p=e.$r($),A=d.$$prototype;A.lhs=A.rhs=A.op=R,l(d,"$initialize",function o(r,x){return o.$$p=null,q(this,U(this,"initialize",o,!1,!0),"initialize",[r,"/",x],null)}),l(d,"$eval",function(r){try{N("eval_return");var f,a,n=this;return f=n.lhs.$eval(r),a=n.rhs.$eval(r),k(a,0)&&n.$raise(p("ZeroDivisionError")),n.$divide_and_round(f,a,r)}catch(Y){if(Y===e.t_eval_return)return Y.$v;throw Y}}),l(d,"$output",function o(){var r=o.$$p||R,x=this;return o.$$p=null,""+q(x,U(x,"output",o,!1,!0),"output",[],r)+x.$rounding_method()}),d.$private(),l(d,"$rounding_method",function(){return W(this.$class(),"ROUNDING_METHOD")}),l(d,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),l(d,"$divide_and_round",function(r,x,n){return this.$raise(p("NotImplementedError"))})}(y[0],h("BinaryOp"),y),function(_,b,s){var d=L(_,b,"DivideWithGameSystemDefault"),$=[d].concat(s),p=e.$r($);E($[0],"ROUNDING_METHOD",""),d.$private(),l(d,"$divide_and_round",function(o,r,x){var n,f=R;return B(W(p("RoundType"),"CEIL"),n=x)?F(o.$to_f(),r).$ceil():B(W(p("RoundType"),"ROUND"),n)?(f=F(o.$to_f(),r),H(f["$negative?"]())?f.$abs().$round()["$-@"]():f.$round()):F(o,r).$floor()})}(y[0],h("DivideBase"),y),function(_,b,s){var d=L(_,b,"DivideWithCeil"),$=[d].concat(s);E($[0],"ROUNDING_METHOD","C"),d.$private(),l(d,"$divide_and_round",function(A,o,r){return F(A.$to_f(),o).$ceil()})}(y[0],h("DivideBase"),y),function(_,b,s){var d=L(_,b,"DivideWithRound"),$=[d].concat(s);E($[0],"ROUNDING_METHOD","R"),d.$private(),l(d,"$divide_and_round",function(A,o,r){var x=R;return x=F(A.$to_f(),o),H(x["$negative?"]())?x.$abs().$round()["$-@"]():x.$round()})}(y[0],h("DivideBase"),y),function(_,b,s){var d=L(_,b,"DivideWithFloor"),$=[d].concat(s);E($[0],"ROUNDING_METHOD","F"),d.$private(),l(d,"$divide_and_round",function(A,o,r){return F(A,o).$floor()})}(y[0],h("DivideBase"),y),function(_,b){var s=L(_,null,"Negative");s.$$prototype.body=R,l(s,"$initialize",P("body")),l(s,"$eval",function(p){try{return N("eval_return"),this.body.$eval(p)["$-@"]()}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),l(s,"$output",function(){return"-"+this.body.$output()}),l(s,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(y[0]),function(_,b){var s=L(_,null,"Parenthesis");s.$$prototype.expr=R,l(s,"$initialize",P("expr")),l(s,"$eval",function(p){try{return N("eval_return"),this.expr.$eval(p)}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),l(s,"$output",function(){return"("+this.expr.$output()+")"}),l(s,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(y[0]),function(_,b){var s=L(_,null,"Number");return s.$$prototype.value=R,l(s,"$initialize",P("value")),l(s,"$eval",S("value")),l(s,"$output",function(){return this.value.$to_s()}),M(s,"s_exp","output")}(y[0])},Opal.modules.strscan=function(e){var P,M,D,R,W,L=e.def,l=e.truthy,N=e.eqeqeq,S=e.Opal,q=e.return_ivar,U=e.send,k=e.alias,E=[],B=e.nil;return P=E,D=[M=(0,e.klass)(E[0],null,"StringScanner")].concat(P),R=e.$r(D),(W=M.$$prototype).pos=W.string=W.working=W.matched=W.prev_pos=W.match=B,M.$attr_reader("pos","matched"),L(M,"$initialize",function(u){var m=this;return m.string=u,m.pos=0,m.matched=B,m.working=u,m.match=[]}),M.$attr_reader("string"),L(M,"$beginning_of_line?",function(){var u=this;return 0===u.pos||"\n"===u.string.charAt(u.pos-1)}),L(M,"$scan",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);return null==i?m.matched=B:(m.prev_pos=m.pos,m.pos+=i[0].length,m.working=m.working.substring(i[0].length),m.matched=i[0],m.match=i,i[0])}),L(M,"$scan_until",function(u){var m=this;u=m.$anchor(u);for(var i=m.working,T=0;i.length!=T;++T){var t=u.exec(i.substr(T));if(null!==t){var c=T+t[0].length,v=i.substr(0,c);return m.matched=t[0],m.match=t,m.prev_pos=m.pos+T,m.pos+=c,m.working=i.substr(c),v}}return m.matched=B}),L(M,"$[]",function(u){var i;if(l(this.match["$empty?"]()))return B;N(R("Symbol"),i=u)?u=u.$to_s():N(R("String"),i)||(u=S["$coerce_to!"](u,R("Integer"),"to_int"));var T=this.match;return u<0&&(u+=T.length),u<0||u>=T.length||null==T[u]?B:T[u]}),L(M,"$check",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);return m.matched=null==i?B:i[0]}),L(M,"$check_until",function(u){var m=this,i=m.prev_pos,T=m.pos,t=m.working,c=m.$scan_until(u);return m.prev_pos=i,m.pos=T,m.working=t,c}),L(M,"$peek",function(u){return this.working.substring(0,u)}),L(M,"$eos?",function(){return 0===this.working.length}),L(M,"$exist?",function(u){var i=u.exec(this.working);return null==i?B:0==i.index?0:i.index+1}),L(M,"$skip",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);if(null==i)return m.match=[],m.matched=B;var T=i[0],t=T.length;return m.matched=T,m.match=i,m.prev_pos=m.pos,m.pos+=t,m.working=m.working.substring(t),t}),L(M,"$skip_until",function(u){var i=this.$scan_until(u);return i===B?B:(this.matched=i.substr(-1),i.length)}),L(M,"$get_byte",function(){var u=this,m=B;return u.pos<u.string.length?(u.prev_pos=u.pos,u.pos+=1,m=u.matched=u.working.substring(0,1),u.working=u.working.substring(1)):u.matched=B,m}),L(M,"$match?",function(u){var m=this,i=(u=m.$anchor(u)).exec(m.working);return null==i?B:(m.prev_pos=m.pos,i[0].length)}),L(M,"$pos=",function(u){var m=this;return u<0&&(u+=m.string.$length()),m.pos=u,m.working=m.string.slice(u)}),L(M,"$matched_size",function(){return this.matched===B?B:this.matched.length}),L(M,"$post_match",function(){var u=this;return u.matched===B?B:u.string.substr(u.pos)}),L(M,"$pre_match",function(){var u=this;return u.matched===B?B:u.string.substr(0,u.prev_pos)}),L(M,"$reset",function(){var u=this;return u.working=u.string,u.matched=B,u.pos=0}),L(M,"$rest",q("working")),L(M,"$rest?",function(){return 0!==this.working.length}),L(M,"$rest_size",function(){return this.$rest().$size()}),L(M,"$terminate",function(){var u,m=this;return m.match=B,u=[m.string.$length()],U(m,"pos=",u),u[u.length-1]}),L(M,"$unscan",function(){var u=this;return u.pos=u.prev_pos,u.prev_pos=B,u.match=B,u}),k(M,"bol?","beginning_of_line?"),k(M,"getch","get_byte"),M.$private(),L(M,"$anchor",function(u){var m=u.toString().match(/\/([^\/]+)$/);return m=m?m[1]:void 0,new RegExp("^(?:"+u.source+")",m)})},Opal.modules["bcdice/normalize"]=function(e){var k,H,B,j=e.module,L=e.eqeqeq,l=e.def,N=e.eqeq,S=[],q=e.nil;return k=S,B=[j(S[0],"BCDice")].concat(k),(H=j(B[0],"Normalize")).$module_function(),l(H,"$comparison_operator",function(M){var D;return L(/<=|=</,D=M)?"<=":L(/>=|=>/,D)?">=":L(/<>|!=|=!/,D)?"!=":L(/</,D)?"<":L(/>/,D)?">":L(/=/,D)?"==":q}),l(H,"$target_number",function(M){return N(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var P,W,T,t,c,v,I,u,D,j=e.module,L=e.klass,l=e.const_set,N=e.hash2,S=e.truthy,q=e.send,U=e.def,k=e.thrower,E=e.top,B=[],F=e.nil;return E.$require("strscan"),E.$require("bcdice/normalize"),P=B,W=D=[j(B[0],"BCDice")].concat(P),T=u=[j(D[0],"Command")].concat(W),c=[t=L(u[0],null,"Lexer")].concat(T),v=e.$r(c),(I=t.$$prototype).scanner=I.notations=F,l(c[0],"SYMBOLS",N(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(t,"$initialize",function(C,y){var h,_,s;return C=S(s=(h=(_=C)===F||null==_?F:_.$split(" ",2))===F||null==h?F:h.$first())?s:"",this.scanner=v("StringScanner").$new(C),this.notations=q(y,"map",[],function($){return null==$&&($=F),S($["$is_a?"](v("String")))?v("Regexp").$new($):$})}),U(t,"$next_token",function(){try{var C=k("return"),y=this,h=F,_=F,s=F,d=F;return S(y.scanner["$eos?"]())?[!1,"$"]:(q(y.notations,"each",[],function $(p){var o,A=null==$.$$s?this:$.$$s;if(null==A.scanner&&(A.scanner=F),null==p&&(p=F),o=A.scanner.$scan(p),!S(o))return F;C.$throw(["NOTATION",o])},{$$s:y,$$ret:C}),S(h=y.scanner.$scan(/\d+/))?["NUMBER",h.$to_i()]:S(_=y.scanner.$scan(/[<>!=]+/))?(_=v("Normalize").$comparison_operator(_),[S(_)?"CMP_OP":"ILLEGAL",_]):(s=y.scanner.$getch().$upcase(),[S(d=v("SYMBOLS")["$[]"](s))?d:s.$to_sym(),s]))}catch($){if($===C)return $.$v;throw $}}),U(t,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var E,P,G,u,m,i,T,D,F,j=e.module,L=e.klass,l=e.def,N=e.return_ivar,S=e.truthy,q=[],U=e.nil;return E=q,P=F=[j(q[0],"BCDice")].concat(E),G=D=[j(F[0],"Command")].concat(P),m=[u=L(D[0],null,"Parsed")].concat(G),i=e.$r(m),(T=u.$$prototype).critical=T.fumble=T.dollar=T.modify_number=T.question_target=T.target_number=T.prefix_number=T.command=T.suffix_number=T.cmp_op=U,u.$attr_accessor("command"),u.$attr_accessor("prefix_number"),u.$attr_accessor("suffix_number"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),l(u,"$initialize",function(){var c=this;return c.prefix_number=U,c.suffix_number=U,c.critical=U,c.fumble=U,c.dollar=U,c.cmp_op=U,c.target_number=U,c.question_target=!1}),l(u,"$question_target?",N("question_target")),l(u,"$to_s",function(c){var v=this,I=U,w=U,C=U,y=U,h=U;switch(null==c&&(c="after_command"),I=S(v.critical)?"@"+v.critical:U,w=S(v.fumble)?"#"+v.fumble:U,C=S(v.dollar)?"$"+v.dollar:U,y=i("Format").$modifier(v.modify_number),h=S(v.question_target)?"?":v.target_number,c.valueOf()){case"after_command":return[v.prefix_number,v.command,v.suffix_number,I,w,C,y,v.cmp_op,h].$join();case"after_modify_number":return[v.prefix_number,v.command,v.suffix_number,y,I,w,C,v.cmp_op,h].$join();case"after_target_number":return[v.prefix_number,v.command,v.suffix_number,y,v.cmp_op,h,I,w,C].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var c,C,d,x,n,f,a,Y,Q,V,ie,$e,ue,$,o,r,se,h,_,I,j=e.klass,L=e.module,l=e.slice,N=e.extract_kwargs,S=e.ensure_kwargs,q=e.get_kwarg,U=e.send2,k=e.find_super,E=e.def,B=e.send,F=e.eqeq,H=e.thrower,P=e.hash,M=e.const_set,D=e.truthy,R=e.to_ary,W=e.hash2,G=e.top,u=[],m=e.$r(u),i=e.nil,T=e.$$$;return G.$require("racc/parser.rb"),G.$require("bcdice/arithmetic/node"),G.$require("bcdice/command/lexer"),G.$require("bcdice/command/parsed"),j(T(m("BCDice"),"Command"),T(m("Racc"),"Parser"),"Parser"),c=u,C=I=[L(u[0],"BCDice")].concat(c),h=[L(I[0],"Command")].concat(C),_=e.$r(h),d=h,o=[$=j(h[0],T(_("Racc"),"Parser"),"Parser")].concat(d),r=e.$r(o),(se=$.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=i,E($,"$initialize",function K(g,Z){var X,z,O,te,J=this;return K.$$p=null,X=l(arguments),z=N(X),z=S(z),O=X,te=q(z,"round_type"),U(J,k(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=O,J.round_type=te,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[i,">=",">","<=","<","==","!="],J.question_target=!1},-2),E($,"$disable_modifier",function(){return this.modifier=!1,this}),E($,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),E($,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),E($,"$has_prefix_number",function(){var g=this;return g.prefix_number=!0,g.need_prefix_number=!0,g}),E($,"$has_suffix_number",function(){var g=this;return g.suffix_number=!0,g.need_suffix_number=!0,g}),E($,"$enable_critical",function(){return this.critical=!0,this}),E($,"$enable_fumble",function(){return this.fumble=!0,this}),E($,"$enable_dollar",function(){return this.dollar=!0,this}),E($,"$restrict_cmp_op_to",function(g){var Z;return Z=l(arguments),this.allowed_cmp_op=Z,this},-1),E($,"$enable_question_target",function(){return this.question_target=!0,this}),E($,"$parse",function(g){var Z=this;try{return Z.lexer=r("Lexer").$new(g,Z.notations),Z.$do_parse()}catch(X){if(!e.rescue(X,[r("ParseError"),r("ZeroDivisionError")]))throw X;try{return i}finally{e.pop_exception()}}}),$.$private(),E($,"$parsed",function(g,Z,X,z){try{return H("eval_return"),B(r("Parsed").$new(),"tap",[],function ee(J){var ce,le,de,me,ve,fe,be,oe=null==ee.$$s?this:ee.$$s;return null==oe.round_type&&(oe.round_type=i),null==J&&(J=i),J["$command="](g["$[]"]("command")),J["$prefix_number="]((ce=g["$[]"]("prefix"))===i||null==ce?i:ce.$eval(oe.round_type)),J["$suffix_number="]((le=g["$[]"]("suffix"))===i||null==le?i:le.$eval(oe.round_type)),J["$critical="]((de=Z["$[]"]("critical"))===i||null==de?i:de.$eval(oe.round_type)),J["$fumble="]((me=Z["$[]"]("fumble"))===i||null==me?i:me.$eval(oe.round_type)),J["$dollar="]((ve=Z["$[]"]("dollar"))===i||null==ve?i:ve.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](z["$[]"]("cmp_op")),F(z["$[]"]("target"),"?")?(J["$question_target="](!0),B(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(be=z["$[]"]("target"),be===i||null==be?i:be.$eval(oe.round_type))],B(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),E($,"$next_token",function(){return this.lexer.$next_token()}),x=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),f=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),a=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),Y=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),V=[i,6,13,3,9,-1,27,-15,-10,-1,-38],ie=[i,i,i,i,i,i,19,16,15,i,i],$e=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ue=P(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(o[0],"Racc_arg",[x,n,a,f,Y,Q,ie,V,19,$e,ue,58,35,!0]),D(r("Ractor","skip_raise")?"constant":i)&&r("Ractor").$make_shareable(r("Racc_arg")),M(o[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),D(r("Ractor","skip_raise")?"constant":i)&&r("Ractor").$make_shareable(r("Racc_token_to_s_table")),M(o[0],"Racc_debug_parser",!1),E($,"$_reduce_1",function(g,Z,X){var z;return D(this.modifier)||this.$raise(r("ParseError")),z=R(g),this.$parsed(null==z[0]?i:z[0],null==z[1]?i:z[1],null==z[2]?i:z[2],null==z[3]?i:z[3])}),E($,"$_reduce_2",function(g,Z,X){var z;return D(this.modifier)||this.$raise(r("ParseError")),z=R(g),this.$parsed(null==z[0]?i:z[0],null==z[2]?i:z[2],null==z[1]?i:z[1],null==z[3]?i:z[3])}),E($,"$_reduce_3",function(g,Z,X){var z,ce;return ce=null==(z=R(g))[2]?i:z[2],this.$parsed(null==z[0]?i:z[0],null==z[1]?i:z[1],T(T(r("Arithmetic"),"Node"),"Number").$new(0),ce)}),E($,"$_reduce_4",function(g,Z,X){var z=this;return D(z.prefix_number)&&D(z.suffix_number)||z.$raise(r("ParseError")),W(["command","prefix","suffix"],{command:g["$[]"](1),prefix:g["$[]"](0),suffix:g["$[]"](2)})}),E($,"$_reduce_5",function(g,Z,X){var z=this;return D(z.prefix_number)||z.$raise(r("ParseError")),D(z.need_suffix_number)&&z.$raise(r("ParseError")),W(["command","prefix"],{command:g["$[]"](1),prefix:g["$[]"](0)})}),E($,"$_reduce_6",function(g,Z,X){var z=this;return D(z.suffix_number)||z.$raise(r("ParseError")),D(z.need_prefix_number)&&z.$raise(r("ParseError")),W(["command","suffix"],{command:g["$[]"](0),suffix:g["$[]"](1)})}),E($,"$_reduce_7",function(g,Z,X){var z=this;return(D(z.need_prefix_number)||D(z.need_suffix_number))&&z.$raise(r("ParseError")),W(["command"],{command:g["$[]"](0)})}),E($,"$_reduce_8",function(g,Z,X){return W([],{})}),E($,"$_reduce_9",function(g,Z,X){var z,ce,ee=i;return ee=null==(z=R(g))[0]?i:z[0],ce=null==z[2]?i:z[2],D(this.critical)&&D(ee["$[]"]("critical")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("critical",ce),ee}),E($,"$_reduce_10",function(g,Z,X){var z,ce,ee=i;return ee=null==(z=R(g))[0]?i:z[0],ce=null==z[2]?i:z[2],D(this.fumble)&&D(ee["$[]"]("fumble")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("fumble",ce),ee}),E($,"$_reduce_11",function(g,Z,X){var z,ce,ee=i;return ee=null==(z=R(g))[0]?i:z[0],ce=null==z[2]?i:z[2],D(this.dollar)&&D(ee["$[]"]("dollar")["$nil?"]())||this.$raise(r("ParseError")),ee["$[]="]("dollar",ce),ee}),E($,"$_reduce_12",function(g,Z,X){return g["$[]"](1)}),E($,"$_reduce_13",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),E($,"$_reduce_14",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),E($,"$_reduce_15",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),E($,"$_reduce_16",function(g,Z,X){return D(this.allowed_cmp_op["$include?"](i))||this.$raise(r("ParseError")),W([],{})}),E($,"$_reduce_17",function(g,Z,X){var z,ee,J;return J=null==(z=R(g))[1]?i:z[1],D(this.allowed_cmp_op["$include?"](ee=null==z[0]?i:z[0]))||this.$raise(r("ParseError")),W(["cmp_op","target"],{cmp_op:ee,target:J})}),E($,"$_reduce_18",function(g,Z,X){var O,z=this;return O=g["$[]"](0),D(z.question_target)||z.$raise(r("ParseError")),D(z.allowed_cmp_op["$include?"](O))||z.$raise(r("ParseError")),W(["cmp_op","target"],{cmp_op:O,target:"?"})}),E($,"$_reduce_19",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),E($,"$_reduce_20",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),E($,"$_reduce_22",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"*",g["$[]"](2))}),E($,"$_reduce_23",function(g,Z,X){return g["$[]"](3).$new(g["$[]"](0),g["$[]"](2))}),E($,"$_reduce_25",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),E($,"$_reduce_26",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"DivideWithCeil")}),E($,"$_reduce_27",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"DivideWithCeil")}),E($,"$_reduce_28",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"DivideWithRound")}),E($,"$_reduce_29",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"DivideWithFloor")}),E($,"$_reduce_30",function(g,Z,X){return g["$[]"](1)}),E($,"$_reduce_31",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),E($,"$_reduce_33",function(g,Z,X){return g["$[]"](1)}),E($,"$_reduce_34",function(g,Z,X){return T(T(r("Arithmetic"),"Node"),"Number").$new(g["$[]"](0))}),E($,"$_reduce_none",function(g,Z,X){return g["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var B,M,G,u,m,i,R,H,j=e.module,L=e.send,l=e.eqeqeq,N=e.truthy,S=e.def,q=e.return_val,U=[],k=e.nil;return B=U,M=H=[j(U[0],"BCDice")].concat(B),G=R=[j(H[0],"Deprecated")].concat(M),m=[u=j(R[0],"Checker")].concat(G),i=e.$r(m),u.$private(),S(u,"$check_result_legacy",function(t,c,v,I){var h,w=this,C=k,y=k,_=k,b=k;return C=L(c,"map",[],"sides".$to_proc()),h=(y=L(c,"map",[],"value".$to_proc())).$sum(),_=l([100],b=C)?w.$check_1D100(t,h,v,I):l([20],b)?w.$check_1D20(t,h,v,I):l([6,6],b)?w.$check_2D6(t,h,y,v,I):k,(N(_["$nil?"]())||N(_["$empty?"]()))&&(_=l([10],b=C.$uniq())?w.$check_nD10(t,h,y,v,I):l([6],b)?w.$check_nD6(t,h,y,v,I):k,N(_["$nil?"]())||N(_["$empty?"]()))?k:i("Result").$new(_.$delete_prefix(" \uff1e "))}),S(u,"$check_1D100",q(k)),S(u,"$check_1D20",q(k)),S(u,"$check_nD10",q(k)),S(u,"$check_2D6",q(k)),S(u,"$check_nD6",q(k))},Opal.modules["bcdice/base"]=function(e){var m,w,b,A,r,x,s,d,$,p,y,j=e.module,L=e.klass,l=e.slice,N=e.rb_plus,S=e.truthy,q=e.def,U=e.regexp,k=e.send,E=e.thrower,B=e.return_ivar,F=e.assign_ivar_val,H=e.eqeqeq,P=e.eqeq,M=e.return_val,D=e.range,R=e.rb_minus,W=e.rb_divide,G=e.rb_times,u=e.rb_ge,i=e.top,T=[],t=e.$r(T),c=e.nil,v=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),w=T,b=y=[j(T[0],"BCDice")].concat(w),d=[s=L(y[0],null,"Base")].concat(b),$=e.$r(d),(p=s.$$prototype).raw_input=p.randomizer=p.enabled_upcase_input=p.debug=c,r=[A=e.get_singleton_class(s)].concat(d),x=e.$r(r),A.$attr_reader("prefixes"),q(A,"$register_prefix",function(f){var Y,V,Q=this;return null==Q.prefixes&&(Q.prefixes=c),Y=l(arguments),Q.prefixes=N(S(V=Q.prefixes)?V:[],Y.$flatten())},-1),q(A,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),q(A,"$prefixes_pattern",function(){var f=this,a=c;return null==f.prefixes_pattern&&(f.prefixes_pattern=c),null==f.prefixes&&(f.prefixes=c),f.prefixes_pattern=S(a=f.prefixes_pattern)?a:c,S(f.prefixes_pattern)?f.prefixes_pattern:(f.prefixes=S(a=f.prefixes)?a:[],f.prefixes.$freeze(),f.prefixes_pattern=(S(f.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",f.prefixes.$join("|"),")"],"i")).$freeze())}),q(A,"$command_pattern",function(){var f=this,a=c,Y=c;return null==f.command_pattern&&(f.command_pattern=c),null==f.prefixes&&(f.prefixes=c),f.command_pattern=S(a=f.command_pattern)?a:c,S(f.command_pattern)?f.command_pattern:(f.prefixes=S(a=f.prefixes)?a:[],f.prefixes.$freeze(),Y=N(k(v(x("CommonCommand"),"COMMANDS"),"map",[],function(V){return null==V&&(V=c),v(V,"PREFIX_PATTERN").$source()}),f.prefixes),f.command_pattern=U(["^S?(",Y.$join("|"),")"],"i").$freeze())}),q(A,"$eval",function(f){try{return E("eval_return"),this.$new(f).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),s.$include($("Translate")),s.$include(v($("Deprecated"),"Checker")),q(s,"$initialize",function(o){var r=this;return r.raw_input=o,r.sort_add_dice=!1,r.sort_barabara_dice=!1,r.d66_sort_type=v($("D66SortType"),"NO_SORT"),r.enabled_d9=!1,r.round_type=v($("RoundType"),"FLOOR"),r.sides_implicit_d=6,r.upper_dice_reroll_threshold=c,r.reroll_dice_reroll_threshold=c,r.default_cmp_op=c,r.default_target_number=c,r.enabled_upcase_input=!0,r.locale="ja_jp",r.randomizer=v($("BCDice"),"Randomizer").$new(),r.debug=!1}),s.$attr_accessor("randomizer"),s.$attr_reader("d66_sort_type"),s.$attr_reader("round_type"),s.$attr_reader("sides_implicit_d"),s.$attr_reader("upper_dice_reroll_threshold"),s.$attr_reader("reroll_dice_reroll_threshold"),s.$attr_reader("default_cmp_op"),s.$attr_reader("default_target_number"),q(s,"$sort_add_dice?",B("sort_add_dice")),q(s,"$sort_barabara_dice?",B("sort_barabara_dice")),q(s,"$enabled_d9?",B("enabled_d9")),q(s,"$enable_debug",F("debug",!0)),q(s,"$eval",function(){var r,n,o=this,x=c;return r=v($("BCDice"),"Preprocessor").$process(o.raw_input,o),x=S(n=o.$dice_command(r))?n:o.$eval_common_command(o.raw_input),S(x)?(x["$rands="](o.randomizer.$rand_results()),x["$detailed_rands="](o.randomizer.$detailed_rand_results()),x):c}),q(s,"$change_text",function(o){return o}),q(s,"$check_result",function(o,r,x,n){var f=this,a=c,Y=c,Q=c,V=c,ie=c;return a=f.$check_result_legacy(o,r,x,n),S(a)?a:(Y=k(r,"map",[],"sides".$to_proc()),V=(Q=k(r,"map",[],"value".$to_proc())).$sum(),a=H([100],ie=Y)?f.$result_1d100(o,V,x,n):H([20],ie)?f.$result_1d20(o,V,x,n):H([6,6],ie)?f.$result_2d6(o,V,Q,x,n):c,P(a,$("Result").$nothing())?c:S(a)?a:(a=H([10],ie=Y.$uniq())?f.$result_nd10(o,V,Q,x,n):H([6],ie)?f.$result_nd6(o,V,Q,x,n):c,P(a,$("Result").$nothing())?c:S(a)?a:f.$result_ndx(o,x,n)))}),q(s,"$grich_text",M(c)),s.$private(),q(s,"$eval_common_command",function(o){try{E("eval_return");var x=E("return");return o=this.$change_text(o),k(v($("CommonCommand"),"COMMANDS"),"each",[],function f(a){var Q,Y=null==f.$$s?this:f.$$s;if(null==Y.randomizer&&(Y.randomizer=c),null==a&&(a=c),Q=a.$eval(o,Y,Y.randomizer),!S(Q))return c;x.$throw(Q)},{$$s:this,$$ret:x}),c}catch(f){if(f===e.t_eval_return||f===x)return f.$v;throw f}}),q(s,"$dice_command",function(o){var r=this,x=c,n=c,f=c,a=c;return S(r.enabled_upcase_input)&&(o=o.$upcase()),x=r.$class().$prefixes_pattern().$match(o),S(x)?(n=x["$[]"](1)["$nil?"]()["$!"](),S(n)&&(o=o["$[]"](D(1,-1,!1))),f=r.$eval_game_system_specific_command(o),S(f["$is_a?"]($("Result")))?(f["$secret="](S(a=f["$secret?"]())?a:n),f):S(f["$nil?"]())||S(f["$empty?"]())||P(f,"1")?c:k($("Result").$new(),"tap",[],function(Q){var V;return null==Q&&(Q=c),Q["$text="](f.$to_s()),k(Q,"secret=",V=[n]),V[V.length-1]})):c}),q(s,"$eval_game_system_specific_command",M(c)),q(s,"$result_ndx",function(o,r,x){return S(x["$is_a?"]($("String")))?c:S(o.$send(r,x))?$("Result").$success(this.$translate("success")):$("Result").$failure(this.$translate("failure"))}),q(s,"$result_1d100",M(c)),q(s,"$result_1d20",M(c)),q(s,"$result_nd10",M(c)),q(s,"$result_2d6",M(c)),q(s,"$result_nd6",M(c)),q(s,"$get_table_by_2d6",function(o){return this.$get_table_by_nD6(o,2)}),q(s,"$get_table_by_1d6",function(o){return this.$get_table_by_nD6(o,1)}),q(s,"$get_table_by_nD6",function(o,r){return this.$get_table_by_nDx(o,r,6)}),q(s,"$get_table_by_nDx",function(o,r,x){var f,a=c;return f=this.randomizer.$roll_sum(r,x),a=this.$get_table_value(o["$[]"](R(f,r))),S(a["$nil?"]())?["1",0]:[a,f]}),q(s,"$get_table_by_1d3",function(o){var n,f,r=this,a=c;return r.$debug("get_table_by_1d3"),n=r.randomizer.$roll_sum(1,6),r.$debug("num",n),f=W(R(n,1),2).$to_i(),r.$debug("index",f),a=o["$[]"](f),S(a["$nil?"]())?["1",0]:[a,n]}),q(s,"$get_table_by_d66_swap",function(o){var x;return x=this.randomizer.$roll_d66(v($("D66SortType"),"ASC")),[this.$get_table_by_number(x,o),x]}),q(s,"$get_table_by_d66",function(o){var x,n,f,Y,a=c;return x=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),f=N(G(R(x,1),6),R(n,1)),a=o["$[]"](f),Y=""+x+n,S(a["$nil?"]())?["1",Y]:[a,Y]}),q(s,"$get_table_by_number",function(o,r,x){try{var n=E("return");return null==x&&(x="1"),k(r,"each",[],function a(Y){var V,Q=null==a.$$s?this:a.$$s;if(null==Y&&(Y=c),V=Y["$[]"](0),!S(u(V,o)))return c;n.$throw(Q.$get_table_value(Y["$[]"](1)))},{$$s:this,$$ret:n}),this.$get_table_value(x)}catch(a){if(a===n)return a.$v;throw a}},-3),q(s,"$get_table_value",function(o){return S(o["$is_a?"]($("Proc")))?o.$call():o}),q(s,"$roll_tables",function(o,r){var n=c;return n=r["$[]"](o),S(n)?n.$roll(this.randomizer).$to_s():c}),q(s,"$debug",function(o,r){var n,f=this,a=c,Y=c;return n=l(arguments,1),S(f.debug)?(a=S(o["$is_a?"]($("String")))?o:o.$inspect(),S(n["$empty?"]())?f.$warn(a):(Y=k(n,"map",[],function(V){return null==V&&(V=c),S(V["$is_a?"]($("String")))?'"'+V+'"':V.$inspect()}),f.$warn(a+": "+Y.$join(", ")))):c},-2),v(v(t("I18n"),"Backend"),"Simple").$include(v(v(t("I18n"),"Backend"),"Fallbacks")),t("I18n").$load_path()["$<<"](t("Dir")["$[]"](t("File").$join("bcdice","../../i18n/**/*.yml"))),t("I18n")["$default_locale="]("ja_jp"),m=[["ja_jp"]],k(t("I18n").$fallbacks(),"defaults=",m),m[m.length-1]},Opal.queue(function(e){var G,T,C,y,h,_,c,v,m,j=e.module,L=e.klass,l=e.const_set,N=e.hash2,S=e.truthy,q=e.def,U=e.to_ary,k=e.eqeq,E=e.rb_plus,B=e.rb_ge,F=e.send,H=e.rb_times,M=[],D=e.nil,R=e.$$$;return e.top.$require("bcdice/base"),G=M,T=m=[j(M[0],"BCDice")].concat(G),c=[j(m[0],"GameSystem")].concat(T),v=e.$r(c),C=c,h=[y=L(c[0],v("Base"),"YuMyoKishi")].concat(C),_=e.$r(h),y.$$prototype.randomizer=D,l(h[0],"ID","YuMyoKishi"),l(h[0],"NAME","\u5e7d\u51a5\u9b3c\u4f7f"),l(h[0],"SORT_KEY","\u3086\u3046\u307f\u3088\u3046\u304d\u3057"),l(h[0],"HELP_MESSAGE","\u25a0\u5224\u5b9a\u3000YM+a>=b\u3000a:\u6280\u80fd\u5024\uff08\u7701\u7565\u53ef\uff09\u3000b:\u76ee\u6a19\u5024\uff08\u7701\u7565\u53ef\uff09\n\u3000\u4f8b\uff1aYM+4>=8: \u6280\u80fd\u5024\u306b\u3088\u308b\u4fee\u6b63\u304c+4\u3067\u3001\u76ee\u6a19\u50248\u306e\u514b\u670d\u5224\u5b9a\u3092\u884c\u3046\n\u3000\u3000\u3000YM>=8  : \u6280\u80fd\u5024\u306b\u3088\u308b\u4fee\u6b63\u306a\u3057\u3067\u3001\u76ee\u6a19\u50248\u306e\u514b\u670d\u5224\u5b9a\u3092\u884c\u3046\n\u3000\u3000\u3000YM+6   : \u6280\u80fd\u5024\u306b\u3088\u308b\u4fee\u6b63\u304c+6\u3067\u3001\u9054\u6210\u5024\u3092\u78ba\u8a8d\u3059\u308b\n\n\u25a0\u4ee3\u511f\u8868\u3000COT\n\u25a0\u8ee2\u798d\u8868\u3000TRT\n"),l(h[0],"TABLES",N(["COT","TRT"],{COT:R(_("DiceTable"),"Table").$new("\u4ee3\u511f\u8868","2D6",["\u4e0d\u616e\u306e\u51fa\u9022\u3044","\u6df1\u6df5\u3092\u8997\u304f\u3068\u304d","\u6642\u9593\u306e\u6d88\u8cbb","\u5947\u5999\u306a\u60c5\u5831","\u512a\u67d4\u4e0d\u65ad","\u6ce8\u610f\u6563\u6f2b","\u5fc3\u8eab\u8017\u5f31","\u4e0d\u7a4f\u306a\u60c5\u5831","\u907a\u7559\u54c1","\u8feb\u308a\u304f\u308b\u5371\u6a5f","\u6b63\u4f53\u306e\u9732\u898b"]),TRT:R(_("DiceTable"),"Table").$new("\u8ee2\u798d\u8868","2D6",["\u25cb\u25cb\u3068\u74dc\u4e8c\u3064","\u7d76\u5bfe\u7d76\u547d","\u60aa\u7656\u707d\u3046","\u51b7\u9177\u306a\u6307\u4ee4","\u304a\u3073\u3048\u308b\u8996\u7dda","\u7d61\u307f\u3064\u304f\u5996\u6c17","\u5bb9\u8d66\u306a\u3044\u8a55\u5b9a","\u7121\u529b\u306a\u5e02\u6c11","\u672a\u7df4\u963b\u3080","\u7e01\u306e\u67b7","\u90aa\u60aa\u306a\u523b\u5370"])}).$freeze()),y.$register_prefix("YM",_("TABLES").$keys()),q(y,"$eval_game_system_specific_command",function(d){var p,$=this;return $.$debug("eval_game_system_specific_command Begin"),S(p=$.$roll_command(d))?p:$.$roll_tables(d,_("TABLES"))}),q(y,"$roll_command",function(d){var $,p,A=this,r=D,x=D,n=D,f=D,a=D,Y=D;return r=R(_("Command"),"Parser").$new("YM",N(["round_type"],{round_type:A.$round_type()})).$restrict_cmp_op_to(">=",D).$parse(d),S(r)?(x=A.randomizer.$roll_barabara(4,6),p=A.$sip_pat_a(x),n=null==($=U(p))[0]?D:$[0],a=k(f=null==$[1]?D:$[1],"wumian")?0:E(n,r.$modify_number()),Y=[r.$to_s(),x.$join(","),n,k(n,a)?D:a].$compact().$join(" \uff1e "),S(r.$target_number()["$nil?"]())?k(f,"wumian")?_("Result").$failure(Y):k(f,"yise")?_("Result").$critical(Y):_("Result").$new(Y):k(f,"wumian")?_("Result").$failure([Y,"\u53ef"].$join(" \uff1e ")):k(f,"yise")?_("Result").$critical([Y,"\u512a"].$join(" \uff1e ")):S(B(a,r.$target_number()))?_("Result").$success([Y,"\u826f"].$join(" \uff1e ")):_("Result").$failure([Y,"\u53ef"].$join(" \uff1e "))):D}),q(y,"$sip_pat_a",function(d){var $=D;switch(($=F(d,"each_with_object",[_("Hash").$new(0)],function(A,o){var r;return null==A&&(A=D),null==o&&(o=D),r=[A,E(o["$[]"](A),1)],F(o,"[]=",r),r[r.length-1]})).$count().valueOf()){case 1:return[20,"yise"];case 2:return k($.$values(),[2,2])?[H($.$keys().$max(),2),"normal"]:[$.$keys().$sum(),"normal"];case 3:return[F($,"select",[],function(A,o){return null==A&&(A=D),null==o&&(o=D),o["$=="](1)}).$keys().$sum(),"normal"];default:return[0,"wumian"]}})})}}]);