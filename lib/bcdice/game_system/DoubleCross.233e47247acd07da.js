(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[288],{4627:(re,ne,te)=>{te(5151),Opal.modules["bcdice/arithmetic_evaluator"]=function(n){var V,s,B,r,y,F,o,k,S=n.module,M=n.ensure_kwargs,A=n.truthy,L=n.thrower,Y=n.def,d=[],p=n.nil,z=n.$$$;return V=d,s=k=[S(d[0],"BCDice")].concat(V),o=[F=S(k[0],"ArithmeticEvaluator")].concat(s),r=[B=n.get_singleton_class(F)].concat(o),y=n.$r(r),Y(B,"$eval",function(W,N){try{L("eval_return");var E,X=p;return null==(E=(N=M(N)).$$smap.round_type)&&(E=z(y("RoundType"),"FLOOR")),A(W)&&A(X=y("Arithmetic").$eval(W,E))?X:0}catch(D){if(D===n.t_eval_return)return D.$v;throw D}},-2)},Opal.modules["bcdice/dice_table/range_table"]=function(n){var F,r,Q,x,l,f,E,X,D,q,J,B,S=n.module,M=n.klass,A=n.const_set,L=n.send,Y=n.hash2,d=n.def,p=n.eqeqeq,z=n.truthy,H=n.to_a,V=n.rb_times,j=n.rb_plus,k=[],$=n.nil;return F=k,r=B=[S(k[0],"BCDice")].concat(F),Q=J=[S(B[0],"DiceTable")].concat(r),X=[E=M(J[0],null,"RangeTable")].concat(Q),D=n.$r(X),(q=E.$$prototype).name=q.items=q.num_of_dice=q.num_of_sides=q.formatter=$,A(X[0],"RollResult",L(D("Struct"),"new",["sum","values","content","formatted"],function x(){return(null==x.$$s?this:x.$$s).$alias_method("to_s","formatted")},{$$s:E})),A(X[0],"Item",D("Struct").$new("range","content")),A(X[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),A(X[0],"DEFAULT_FORMATTER",L(E,"lambda",[],function(v,l){return null==v&&(v=$),null==l&&(l=$),v.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),E.$attr_reader("name"),E.$attr_reader("num_of_dice"),E.$attr_reader("num_of_sides"),l=[x=n.get_singleton_class(E)].concat(X),f=n.$r(l),d(x,"$from_i18n",function(a,c){var _,m=$;return m=f("I18n").$t(a,Y(["locale"],{locale:c})),_=L(m["$[]"]("items"),"map",[],function i(e){return null==e&&(e=$),[(null==i.$$s?this:i.$$s).$conv_string_range(e["$[]"](0)),e["$[]"](1)]},{$$s:this}),this.$new(m["$[]"]("name"),m["$[]"]("type"),_)}),d(x,"$conv_string_range",function(a){var b,c=this;return null==c.name&&(c.name=$),p(f("Integer"),b=a)?a:p(f("String"),b)?z(a["$include?"](".."))?L(f("Range"),"new",H(L(a.$split("..",2),"map",[],function m(_){return null==_&&(_=$),(null==m.$$s?this:m.$$s).$Integer(_)},{$$s:c}))):c.$Integer(a):c.$raise(f("TypeError"),c.name+": "+a+" ("+a.$class()+") must be a String or an Integer")}),d(E,"$initialize",function x(v,l,f){var c,u=x.$$p||$,a=this,b=$;return x.$$p=null,a.name=v.$freeze(),a.formatter=z(c=u)?c:D("DEFAULT_FORMATTER"),b=D("DICE_ROLL_METHOD_RE").$match(l),z(b)||a.$raise(D("ArgumentError"),a.name+": invalid dice roll method: "+l),a.num_of_dice=b["$[]"](1).$to_i(),a.num_of_sides=b["$[]"](2).$to_i(),a.$store(f)}),d(E,"$fetch",function(v){var f,l=this;return f=L(l.items,"find",[],function(a){return null==a&&(a=$),a.$range()["$include?"](v)}),z(f)||l.$raise(D("RangeError"),l.name+": value is out of range: "+v),f}),d(E,"$roll",function(v){var u,l=this,f=$,a=$;return u=(f=v.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(a=D("RollResult").$new(u,f,l.$fetch(u).$content()))["$formatted="](l.formatter["$[]"](l,a)),a}),E.$private(),d(E,"$store",function(v){var f,u,l=this;return f=L(v,"map",[],function a(c,b){return null==c&&(c=$),null==b&&(b=$),[(null==a.$$s?this:a.$$s).$coerce_to_int_range(c),b]},{$$s:l}),u=L(f,"sort_by",[],function(c,b){return null==c&&(c=$),null==b&&(b=$),c.$min()}),l.$assert_min_sum_is_covered(u),l.$assert_max_sum_is_covered(u),l.$assert_no_gap_or_overlap_in_ranges(u),l.items=L(u,"map",[],function(c,b){return null==c&&(c=$),null==b&&(b=$),D("Item").$new(c,b.$freeze()).$freeze()}).$freeze(),l}),d(E,"$coerce_to_int_range",function(v){var f;return p(D("Integer"),f=v)?D("Range").$new(v,v):p(D("Range"),f)&&z(v.$begin()["$is_a?"](D("Integer")))&&z(v.$end()["$is_a?"](D("Integer")))?v:this.$raise(D("TypeError"),this.name+": "+v+" ("+v.$class()+") must be an Integer or a Range with Integers ")}),d(E,"$assert_min_sum_is_covered",function(v){var f,l=this,u=$;return f=l.num_of_dice,u=v.$first()["$[]"](0),z(u["$include?"](f))||l.$raise(D("RangeError"),l.name+": min value ("+f+") is not covered: "+u),l}),d(E,"$assert_max_sum_is_covered",function(v){var f,l=this,u=$;return f=V(l.num_of_dice,l.num_of_sides),u=v.$last()["$[]"](0),z(u["$include?"](f))||l.$raise(D("RangeError"),l.name+": max value ("+f+") is not covered: "+u),l}),d(E,"$assert_no_gap_or_overlap_in_ranges",function(v){return L(v,"each_cons",[2],function f(u,a){var _,i,c=null==f.$$s?this:f.$$s,b=$,m=$;return null==c.name&&(c.name=$),null==u&&(u=$),null==a&&(a=$),b=u["$[]"](0),m=a["$[]"](0),_=b.$max(),i=j(_,1),z(m["$include?"](_))&&c.$raise(D("RangeError"),c.name+": Range overlap: "+b+" and "+m),z(m["$include?"](i))?$:c.$raise(D("RangeError"),c.name+": Range gap: "+b+" and "+m)},{$$s:this}),this})},Opal.queue(function(n){var W,X,v,l,f,i,e,h,t,g,u,a,c,q,x,Q,S=n.module,M=n.klass,A=n.const_set,L=n.send2,Y=n.find_super,d=n.def,p=n.truthy,z=n.rb_lt,H=n.rb_gt,V=n.rb_plus,j=n.send,k=n.rb_ge,$=n.eqeq,s=n.hash2,F=n.to_ary,o=n.range,B=n.top,U=[],r=n.nil,y=n.$$$;return B.$require("bcdice/arithmetic_evaluator"),B.$require("bcdice/dice_table/range_table"),W=U,X=Q=[S(U[0],"BCDice")].concat(W),q=[S(Q[0],"GameSystem")].concat(X),x=n.$r(q),v=q[0],l=x("Base"),f=q,a=[u=M(v,l,"DoubleCross")].concat(f),c=n.$r(a),u.$$prototype.randomizer=r,A(a[0],"ID","DoubleCross"),A(a[0],"NAME","\u30c0\u30d6\u30eb\u30af\u30ed\u30b92nd,3rd"),A(a[0],"SORT_KEY","\u305f\u3075\u308b\u304f\u308d\u30592"),A(a[0],"HELP_MESSAGE",'\u30fb\u5224\u5b9a\u30b3\u30de\u30f3\u30c9\uff08xDX+y@c or xDXc+y\uff09\n\u3000"(\u500b\u6570)DX(\u4fee\u6b63)@(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)" \u3082\u3057\u304f\u306f "(\u500b\u6570)DX(\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024)(\u4fee\u6b63)" \u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u4fee\u6b63\u5024\u3082\u4ed8\u3051\u3089\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff0910dx\u3000\u300010dx+5@8\uff08OD tool\u5f0f)\u3000\u30005DX7+7-3\uff08\u75be\u98a8\u6012\u6fe4\u5f0f\uff09\n\n\u30fb\u5404\u7a2e\u8868\n\u3000\u30fb\u611f\u60c5\u8868\uff08ET\uff09\n\u3000\u3000\u30dd\u30b8\u30c6\u30a3\u30d6\u3068\u30cd\u30ac\u30c6\u30a3\u30d6\u306e\u4e21\u65b9\u3092\u632f\u3063\u3066\u3001\u8868\u306b\u306a\u3063\u3066\u3044\u308b\u5074\u306b\u25cb\u3092\u4ed8\u3051\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n\u3000\u3000\u3082\u3061\u308d\u3093\u4efb\u610f\u3067\u9078\u3076\u90e8\u5206\u306f\u5909\u66f4\u3057\u3066\u69cb\u3044\u307e\u305b\u3093\u3002\n\n\u30fb\u30cf\u30d7\u30cb\u30f3\u30b0\u30c1\u30e3\u30fc\u30c8\uff08HC\uff09\n\u30fbRW\u30d7\u30ed\u30ed\u30fc\u30b0\u30c1\u30e3\u30fc\u30c8 \u30dd\u30b8\u30c6\u30a3\u30d6 (PCP)\n\u30fbRW\u30d7\u30ed\u30ed\u30fc\u30b0\u30c1\u30e3\u30fc\u30c8 \u30cd\u30ac\u30c6\u30a3\u30d6 (PCN)\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n'),d(u,"$initialize",function m(_){var e=this;return m.$$p=null,L(e,Y(e,"initialize",m,!1,!0),"initialize",[_],null),e.sides_implicit_d=10}),u.$register_prefix("\\d+DX","ET"),i=a,h=[e=M(a[0],null,"DX")].concat(i),t=n.$r(h),(g=e.$$prototype).modifier=g.critical_value=g.expression=g.num=g.modifier_str=g.target_value=r,e.$include(t("Translate")),d(e,"$initialize",function(R,T,w,P){var C=this;return C.num=R,C.critical_value=T,C.modifier=w,C.target_value=P,C.modifier_str=t("Format").$modifier(C.modifier),C.expression=C.$node_expression(),C.locale="ja_jp"}),d(e,"$execute",function(R){var T=this,w=r,P=r,C=r,Z=r,K=r,G=r;if(p(z(T.critical_value,2)))return t("Result").$new("("+T.expression+") \uff1e "+T.$translate("DoubleCross.DX.invalid_critical"));if(p(z(T.num,1)))return t("Result").$failure("("+T.expression+") \uff1e "+T.$translate("DoubleCross.DX.auto_failure"));for(w=[],P=T.num,C=0;p(p(Z=H(P,0))?z(C,y(y(t("CommonCommand"),"RerollDice"),"REROLL_LIMIT")):Z);)K=R.$roll_barabara(P,10),G=t("ValueGroup").$new(K,T.critical_value),w.$push(G),P=G.$num_of_critical_occurrences(),C=V(C,1);return T.$result(w)}),e.$private(),d(e,"$node_expression",function(){var T,R=this;return T=R.num+"DX"+R.critical_value+R.modifier_str,p(R.target_value)?T+">="+R.target_value:T}),d(e,"$result",function(R){var P,Z,T=this,w=r,C=r,K=r,G=r,O=r,ee=r;return(w=t("Result").$new())["$fumble="](R["$[]"](0).$values()["$all?"](1)),P=j(R,"map",[],"max".$to_proc()).$sum(),C=p(w["$fumble?"]())?0:V(P,T.modifier),Z=p(w["$fumble?"]())?C+" ("+T.$translate("fumble")+")":C.$to_s(),w["$critical="](H(R.$length(),1)),K=["("+T.expression+")",""+R.$join("+")+T.modifier_str,Z],p(T.target_value)&&(G=p(O=w["$fumble?"]()["$!"]())?k(C,T.target_value):O,p(G)?w["$success="](!0):w["$failure="](!0),ee=T.$translate(p(G)?"success":"failure"),K.$push(ee)),w["$text="](K.$join(" \uff1e ")),w}),function(m,_){var i=M(m,null,"ValueGroup"),e=i.$$prototype;e.values=e.critical_value=r,i.$attr_reader("values"),i.$attr_reader("critical_value"),d(i,"$initialize",function(t,g){return this.values=t.$sort(),this.critical_value=g}),d(i,"$to_s",function(){return this.$max()+"["+this.values.$join(",")+"]"}),d(i,"$max",function(){var t=this;return p(j(t.values,"any?",[],function g(I){return null==I&&(I=r),(null==g.$$s?this:g.$$s)["$critical?"](I)},{$$s:t}))?10:t.values.$max()}),d(i,"$num_of_critical_occurrences",function(){return j(this.values,"count",[],function g(I){return null==I&&(I=r),(null==g.$$s?this:g.$$s)["$critical?"](I)},{$$s:this})}),i.$private(),d(i,"$critical?",function(t){return k(t,this.critical_value)})}(a[0]),d(u,"$eval_game_system_specific_command",function(_){var i=this,e=r;return p(e=i.$parse_dx(_))?e.$execute(i.randomizer):p(y(i.$class(),"TABLES")["$key?"](_))?i.$roll_tables(_,y(i.$class(),"TABLES")):$(_,"ET")?i.$roll_emotion_table():r}),u.$private(),d(u,"$parse_dx",function(_){var e;return p(e=this.$parse_dx_od(_))?e:this.$parse_dx_shippu_doto(_)}),d(u,"$parse_dx_od",function(_){var h=r,t=r,g=r,I=r;return h=y(c("Command"),"Parser").$new(/\d+DX/,s(["round_type"],{round_type:this.$round_type()})).$enable_critical().$restrict_cmp_op_to(r,">=").$parse(_),p(h)?(t=h.$command().$to_i(),g=p(I=h.$critical())?I:10,y(this.$class(),"DX").$new(t,g,h.$modify_number(),h.$target_number())):r}),d(u,"$parse_dx_shippu_doto",function(_){var i,e,g=r,I=r,R=r,T=r;return g=y(c("Command"),"Parser").$new(/\d+DX\d*/,s(["round_type"],{round_type:this.$round_type()})).$restrict_cmp_op_to(r,">=").$parse(_),p(g)?(e=j(g.$command().$split("DX",2),"map",[],function(P){var C;return null==P&&(P=r),(C=P)===r||null==C?r:C.$to_i()}),I=null==(i=F(e))[0]?r:i[0],R=p(T=R=null==i[1]?r:i[1])?T:10,y(this.$class(),"DX").$new(I,R,g.$modify_number(),g.$target_number())):r}),d(u,"$roll_emotion_table",function(){var h,_=this,i=r,e=r,t=r,I=r;return i=y(_.$class(),"POSITIVE_EMOTION_TABLE").$roll(_.randomizer),e=y(_.$class(),"NEGATIVE_EMOTION_TABLE").$roll(_.randomizer),h=_.randomizer.$roll_once(2)["$=="](1),t=p(h)?["\u25cb"+i.$content(),e.$content()]:[i.$content(),"\u25cb"+e.$content()],I=[_.$translate("DoubleCross.ET.name")+"("+i.$sum()+"-"+e.$sum()+")",t.$join(" - ")],c("Result").$new(I.$join(" \uff1e "))}),function(m,_){var i=[m].concat(_),e=n.$r(i);m.$private(),d(m,"$positive_emotion_table",function(t){return y(e("DiceTable"),"RangeTable").$new(e("I18n").$translate("DoubleCross.ET.positive.name",s(["locale"],{locale:t})),"1D100",[[o(1,5,!1),e("I18n").$translate("DoubleCross.ET.positive.items.1_5",s(["locale"],{locale:t}))],[o(6,10,!1),e("I18n").$translate("DoubleCross.ET.positive.items.6_10",s(["locale"],{locale:t}))],[o(11,15,!1),e("I18n").$translate("DoubleCross.ET.positive.items.11_15",s(["locale"],{locale:t}))],[o(16,20,!1),e("I18n").$translate("DoubleCross.ET.positive.items.16_20",s(["locale"],{locale:t}))],[o(21,25,!1),e("I18n").$translate("DoubleCross.ET.positive.items.21_25",s(["locale"],{locale:t}))],[o(26,30,!1),e("I18n").$translate("DoubleCross.ET.positive.items.26_30",s(["locale"],{locale:t}))],[o(31,35,!1),e("I18n").$translate("DoubleCross.ET.positive.items.31_35",s(["locale"],{locale:t}))],[o(36,40,!1),e("I18n").$translate("DoubleCross.ET.positive.items.36_40",s(["locale"],{locale:t}))],[o(41,45,!1),e("I18n").$translate("DoubleCross.ET.positive.items.41_45",s(["locale"],{locale:t}))],[o(46,50,!1),e("I18n").$translate("DoubleCross.ET.positive.items.46_50",s(["locale"],{locale:t}))],[o(51,55,!1),e("I18n").$translate("DoubleCross.ET.positive.items.51_55",s(["locale"],{locale:t}))],[o(56,60,!1),e("I18n").$translate("DoubleCross.ET.positive.items.56_60",s(["locale"],{locale:t}))],[o(61,65,!1),e("I18n").$translate("DoubleCross.ET.positive.items.61_65",s(["locale"],{locale:t}))],[o(66,70,!1),e("I18n").$translate("DoubleCross.ET.positive.items.66_70",s(["locale"],{locale:t}))],[o(71,75,!1),e("I18n").$translate("DoubleCross.ET.positive.items.71_75",s(["locale"],{locale:t}))],[o(76,80,!1),e("I18n").$translate("DoubleCross.ET.positive.items.76_80",s(["locale"],{locale:t}))],[o(81,85,!1),e("I18n").$translate("DoubleCross.ET.positive.items.81_85",s(["locale"],{locale:t}))],[o(86,90,!1),e("I18n").$translate("DoubleCross.ET.positive.items.86_90",s(["locale"],{locale:t}))],[o(91,95,!1),e("I18n").$translate("DoubleCross.ET.positive.items.91_95",s(["locale"],{locale:t}))],[o(96,100,!1),e("I18n").$translate("DoubleCross.ET.positive.items.96_100",s(["locale"],{locale:t}))]])}),d(m,"$negative_emotion_table",function(t){return y(e("DiceTable"),"RangeTable").$new(e("I18n").$translate("DoubleCross.ET.negative.name",s(["locale"],{locale:t})),"1D100",[[o(1,5,!1),e("I18n").$translate("DoubleCross.ET.negative.items.1_5",s(["locale"],{locale:t}))],[o(6,10,!1),e("I18n").$translate("DoubleCross.ET.negative.items.6_10",s(["locale"],{locale:t}))],[o(11,15,!1),e("I18n").$translate("DoubleCross.ET.negative.items.11_15",s(["locale"],{locale:t}))],[o(16,20,!1),e("I18n").$translate("DoubleCross.ET.negative.items.16_20",s(["locale"],{locale:t}))],[o(21,25,!1),e("I18n").$translate("DoubleCross.ET.negative.items.21_25",s(["locale"],{locale:t}))],[o(26,30,!1),e("I18n").$translate("DoubleCross.ET.negative.items.26_30",s(["locale"],{locale:t}))],[o(31,35,!1),e("I18n").$translate("DoubleCross.ET.negative.items.31_35",s(["locale"],{locale:t}))],[o(36,40,!1),e("I18n").$translate("DoubleCross.ET.negative.items.36_40",s(["locale"],{locale:t}))],[o(41,45,!1),e("I18n").$translate("DoubleCross.ET.negative.items.41_45",s(["locale"],{locale:t}))],[o(46,50,!1),e("I18n").$translate("DoubleCross.ET.negative.items.46_50",s(["locale"],{locale:t}))],[o(51,55,!1),e("I18n").$translate("DoubleCross.ET.negative.items.51_55",s(["locale"],{locale:t}))],[o(56,60,!1),e("I18n").$translate("DoubleCross.ET.negative.items.56_60",s(["locale"],{locale:t}))],[o(61,65,!1),e("I18n").$translate("DoubleCross.ET.negative.items.61_65",s(["locale"],{locale:t}))],[o(66,70,!1),e("I18n").$translate("DoubleCross.ET.negative.items.66_70",s(["locale"],{locale:t}))],[o(71,75,!1),e("I18n").$translate("DoubleCross.ET.negative.items.71_75",s(["locale"],{locale:t}))],[o(76,80,!1),e("I18n").$translate("DoubleCross.ET.negative.items.76_80",s(["locale"],{locale:t}))],[o(81,85,!1),e("I18n").$translate("DoubleCross.ET.negative.items.81_85",s(["locale"],{locale:t}))],[o(86,90,!1),e("I18n").$translate("DoubleCross.ET.negative.items.86_90",s(["locale"],{locale:t}))],[o(91,95,!1),e("I18n").$translate("DoubleCross.ET.negative.items.91_95",s(["locale"],{locale:t}))],[o(96,100,!1),e("I18n").$translate("DoubleCross.ET.negative.items.96_100",s(["locale"],{locale:t}))]]).$freeze()}),d(m,"$translate_tables",function(t){return s(["HC","PCP","PCN"],{HC:y(e("DiceTable"),"RangeTable").$from_i18n("DoubleCross.HC",t),PCP:y(e("DiceTable"),"Table").$from_i18n("DoubleCross.PCP",t),PCN:y(e("DiceTable"),"Table").$from_i18n("DoubleCross.PCN",t)})})}(n.get_singleton_class(u),a),A(a[0],"POSITIVE_EMOTION_TABLE",u.$positive_emotion_table("ja_jp").$freeze()),A(a[0],"NEGATIVE_EMOTION_TABLE",u.$negative_emotion_table("ja_jp").$freeze()),A(a[0],"TABLES",u.$translate_tables("ja_jp").$freeze()),u.$register_prefix("\\d+DX",c("TABLES").$keys())})}}]);