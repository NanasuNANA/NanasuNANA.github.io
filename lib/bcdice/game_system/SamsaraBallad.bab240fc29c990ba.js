(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[2250],{3393:(ge,pe,he)=>{he(3986),Opal.modules["i18n/backend/fallbacks"]=function(e){var j,i,r,a,s,d,F=e.module,A=e.class_variable_set,c=e.truthy,B=e.class_variable_get,R=e.def,S=e.send,U=e.send2,E=e.find_super,C=e.hash2,P=e.find_block_super,w=e.neqeq,H=e.thrower,W=e.return_val,M=[],N=e.nil,m=e.$$$;return j=M,d=[s=F(M[0],"I18n")].concat(j),A(d[0],"@@fallbacks",N),i=e.get_singleton_class(s),r=[i].concat(d),a=e.$r(r),R(i,"$fallbacks",function(){var T=N;return A(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":N)&&c(T=B(r[1],"@@fallbacks",!1))?T:m(m(a("I18n"),"Locale"),"Fallbacks").$new()),c(T=a("Thread").$current()["$[]"]("i18n_fallbacks"))?T:B(r[1],"@@fallbacks",!1)}),R(i,"$fallbacks=",function(I){var T;return A(r[1],"@@fallbacks",c(I["$is_a?"](a("Array")))?m(m(a("I18n"),"Locale"),"Fallbacks").$new(I):I),T=["i18n_fallbacks",B(r[1],"@@fallbacks",!1)],S(a("Thread").$current(),"[]=",T),T[T.length-1]}),function(i,D){var I,T,x,l,a=[F(i,"Backend")].concat(D);return I=a,x=[T=F(a[0],"Fallbacks")].concat(I),l=e.$r(x),R(T,"$translate",function y(f,h,u){try{var k=H("return"),_=y.$$p||N,q=this,L=N,b=N;return y.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?c(u["$[]"]("fallback_in_progress"))?U(q,E(q,"translate",y,!1,!0),"translate",[f,h,u],_):(c(u["$[]"]("default"))&&(L=q["$extract_non_symbol_default!"](u)),b=u.$merge(C(["fallback_in_progress"],{fallback_in_progress:!0})),S(l("I18n").$fallbacks()["$[]"](f),"each",[],function t(g){var n=null==t.$$s?this:t.$$s;null==g&&(g=N);try{return S(n,"catch",["exception"],function o(){var $=null==o.$$s?this:o.$$s,G=N;if(G=U($,P($,"translate",o.$$def||t.$$def||y,!1,!1),"translate",[g,h,b],null),c(G["$nil?"]()))return N;w(f.$to_s(),g.$to_s())&&$.$on_fallback(f,g,h,u),k.$throw(G)},{$$s:n,$$ret:k})}catch(o){if(!e.rescue(o,[m(l("I18n"),"InvalidLocale")]))throw o;try{return N}finally{e.pop_exception()}}},{$$s:q}),c(u["$key?"]("default"))&&c(u["$[]"]("default")["$nil?"]())?N:c(L)?U(q,E(q,"translate",y,!1,!0),"translate",[f,N,u.$merge(C(["default"],{default:L}))],null):q.$throw("exception",m(l("I18n"),"MissingTranslation").$new(f,h,u))):U(q,E(q,"translate",y,!1,!0),"translate",[f,h,u],_)}catch(t){if(t===k)return t.$v;throw t}},-3),R(T,"$extract_non_symbol_default!",function(f){var u,h=N;return h=[f["$[]"]("default")].$flatten(),u=S(h,"detect",[],function(_){return null==_&&(_=N),_["$is_a?"](l("Symbol"))["$!"]()}),c(u)&&f["$[]="]("default",h["$[]"](0,h.$index(u))),u}),R(T,"$exists?",function y(f,h,u){try{var k=H("return"),_=y.$$p||N,q=this;return y.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?(S(l("I18n").$fallbacks()["$[]"](f),"each",[],function L(b){var t=null==L.$$s?this:L.$$s;null==b&&(b=N);try{if(!c(U(t,P(t,"exists?",L.$$def||y,!1,!1),"exists?",[b,h],null)))return N;k.$throw(!0)}catch(g){if(!e.rescue(g,[m(l("I18n"),"InvalidLocale")]))throw g;try{return N}finally{e.pop_exception()}}},{$$s:q,$$ret:k}),!1):U(q,E(q,"exists?",y,!1,!0),"exists?",[f,h,u],_)}catch(L){if(L===k)return L.$v;throw L}},-3),T.$private(),R(T,"$on_fallback",W(N))}(d[0],d)},Opal.modules["bcdice/randomizer"]=function(e){var s,v,I,T,x,l,i,D,A=e.klass,c=e.const_set,B=e.def,R=e.truthy,S=e.rb_gt,U=e.rb_plus,E=e.rb_le,C=e.send,P=e.rb_minus,w=e.eqeq,H=e.rb_times,W=e.eqeqeq,M=e.rb_ge,N=[],m=e.nil,Y=e.$$$;return s=N,i=[(0,e.module)(N[0],"BCDice")].concat(s),D=e.$r(i),v=i,T=[I=A(i[0],null,"Randomizer")].concat(v),x=e.$r(T),(l=I.$$prototype).rand_results=l.detailed_rand_results=m,c(T[0],"UPPER_LIMIT_DICE_TIMES",200),c(T[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(T[0],"UPPER_LIMIT_RANDS",1e4),B(I,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),c(T[0],"DetailedRandResult",x("Struct").$new("kind","sides","value")),B(I,"$roll_barabara",function(f,h){var u=this;return R(S(U(u.rand_results.$size(),f),x("UPPER_LIMIT_RANDS")))&&u.$raise(x("TooManyRandsError")),R(E(f,0))||R(S(f,x("UPPER_LIMIT_DICE_TIMES")))?[]:C(x("Array"),"new",[f],function k(){return(null==k.$$s?this:k.$$s).$roll_once(h)},{$$s:u})}),B(I,"$roll_sum",function(f,h){return this.$roll_barabara(f,h).$sum()}),B(I,"$roll_once",function(f){var u=m;return R(E(f,0))||R(S(f,x("UPPER_LIMIT_DICE_SIDES")))?0:(u=this.$rand_inner(f),this.$push_to_detail("normal",f,u),u)}),B(I,"$roll_index",function(f){return P(this.$roll_once(f),1)}),B(I,"$roll_tens_d10",function(){var u,h=m;return h=this.$rand_inner(10),w(h,10)&&(h=0),u=H(h,10),this.$push_to_detail("tens_d10",10,u),u}),B(I,"$roll_d9",function(){var h;return h=P(this.$rand_inner(10),1),this.$push_to_detail("d9",10,h),h}),B(I,"$roll_d66",function(f){var k,u=m;return u=C(x("Array"),"new",[2],function _(){return(null==_.$$s?this:_.$$s).$roll_once(6)},{$$s:this}),W(Y(x("D66SortType"),"ASC"),k=f)?u["$sort!"]():W(Y(x("D66SortType"),"DESC"),k)&&u["$sort!"]()["$reverse!"](),U(H(u["$[]"](0),10),u["$[]"](1))}),I.$private(),B(I,"$rand_inner",function(f){var u,h=this;return R(M(h.rand_results.$size(),x("UPPER_LIMIT_RANDS")))&&h.$raise(x("TooManyRandsError")),u=h.$random(f),h.rand_results["$<<"]([u,f]),u}),B(I,"$random",function(f){return U(x("Kernel").$rand(f),1)}),B(I,"$push_to_detail",function(f,h,u){var _;return _=x("DetailedRandResult").$new(f,h,u),this.detailed_rand_results.$push(_)}),A(i[0],D("StandardError"),"TooManyRandsError"),m},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var C,W,j,s,d,i,D,N,w,F=e.module,A=e.klass,c=e.def,B=e.truthy,R=e.return_val,S=[],U=e.nil;return C=S,W=w=[F(S[0],"BCDice")].concat(C),j=N=[F(w[0],"DiceTable")].concat(W),d=[s=A(N[0],null,"RollResult")].concat(j),i=e.$r(d),(D=s.$$prototype).table_name=D.value=D.body=U,c(s,"$initialize",function(a,v,I){var T=this;return T.table_name=a,T.value=v,T.body=I}),s.$attr_reader("table_name"),s.$attr_reader("value"),s.$attr_reader("body"),c(s,"$to_s",function(){var a=this;return a.table_name+"("+a.value+") \uff1e "+a.body}),c(s,"$last_body",function(){var a=this;return B(a.body["$is_a?"](i("RollResult")))?a.body.$last_body():a.body}),c(s,"$empty?",R(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var C,W,j,s,d,i,D,N,w,F=e.module,A=e.klass,c=e.truthy,B=e.def,R=e.rb_minus,S=[],U=e.nil;return C=S,W=w=[F(S[0],"BCDice")].concat(C),j=N=[F(w[0],"DiceTable")].concat(W),d=[s=A(N[0],null,"ChainTable")].concat(j),i=e.$r(d),(D=s.$$prototype).times=D.sides=D.items=D.name=U,B(s,"$initialize",function(a,v,I){var T=this,x=U;return T.name=a,T.items=I.$freeze(),x=/(\d+)D(\d+)/i.$match(v),c(x)||T.$raise(i("ArgumentError"),"Unexpected table type: "+v),T.times=x["$[]"](1).$to_i(),T.sides=x["$[]"](2).$to_i()}),B(s,"$roll",function(a){var I,T,v=this,x=U;return I=a.$roll_sum(v.times,v.sides),T=R(I,v.times),x=v.items["$[]"](T),c(x["$respond_to?"]("roll"))&&(x=x.$roll(a)),i("RollResult").$new(v.name,I,x)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var H,m,i,D,r,a,v,j,M,F=e.module,A=e.klass,c=e.hash2,B=e.defs,R=e.def,S=e.rb_plus,U=e.rb_times,E=e.rb_minus,C=[],P=e.nil;return H=C,m=M=[F(C[0],"BCDice")].concat(H),i=j=[F(M[0],"DiceTable")].concat(m),r=[D=A(j[0],null,"D66GridTable")].concat(i),a=e.$r(r),(v=D.$$prototype).name=v.items=P,B(D,"$from_i18n",function(T,x){var y=P;return y=a("I18n").$t(T,c(["locale","raise"],{locale:x,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items"))}),R(D,"$initialize",function(T,x){return this.name=T,this.items=x.$freeze()}),R(D,"$roll",function(T){var l,y,f,h,u;return l=T.$roll_once(6),y=T.$roll_once(6),f=S(U(l,10),y),h=E(l,1),u=E(y,1),a("RollResult").$new(this.name,f,this.items["$[]"](h)["$[]"](u))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var P,M,d,i,D,r,m,Y,H,F=e.module,A=e.klass,c=e.hash2,B=e.defs,R=e.def,U=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=U,M=H=[F(U[0],"BCDice")].concat(P),m=[F(H[0],"DiceTable")].concat(M),Y=e.$r(m),d=m,D=[i=A(m[0],Y("D66GridTable"),"D66HalfGridTable")].concat(d),r=e.$r(D),B(i,"$from_i18n",function(v,I){var x=E;return x=r("I18n").$t(v,c(["locale","raise"],{locale:I,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2_3"),x["$[]"]("items_4_5_6"))}),R(i,"$initialize",function(v,I,T){return this.name=v,this.items=[I,I,I,T,T,T].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var P,M,d,i,D,r,m,Y,H,F=e.module,A=e.klass,c=e.hash2,B=e.defs,R=e.def,U=[],E=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),P=U,M=H=[F(U[0],"BCDice")].concat(P),m=[F(H[0],"DiceTable")].concat(M),Y=e.$r(m),d=m,D=[i=A(m[0],Y("D66GridTable"),"D66OneThirdTable")].concat(d),r=e.$r(D),B(i,"$from_i18n",function(v,I){var x=E;return x=r("I18n").$t(v,c(["locale","raise"],{locale:I,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2"),x["$[]"]("items_3_4"),x["$[]"]("items_5_6"))}),R(i,"$initialize",function(v,I,T,x){return this.name=v,this.items=[I,I,T,T,x,x].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,j,r,a,v,I,T,d,m,F=e.module,A=e.klass,c=e.hash2,B=e.defs,R=e.def,S=e.eqeqeq,U=e.rb_plus,E=e.rb_times,C=e.truthy,P=[],w=e.nil,H=e.$$$;return M=P,j=m=[F(P[0],"BCDice")].concat(M),r=d=[F(m[0],"DiceTable")].concat(j),v=[a=A(d[0],null,"D66Table")].concat(r),I=e.$r(v),(T=a.$$prototype).sort_type=T.items=T.name=w,B(a,"$from_i18n",function(l,y){var u,h=w;return h=I("I18n").$t(l,c(["locale"],{locale:y})),u=I("D66SortType").$const_get(h["$[]"]("d66_sort_type")),this.$new(h["$[]"]("name"),u,h["$[]"]("items"))}),R(a,"$initialize",function(l,y,f){var h=this;return h.name=l,h.sort_type=y,h.items=f.$freeze()}),R(a,"$roll",function(l){var y=this,f=w,h=w,u=w,k=w;return f=l.$roll_barabara(2,6),S(H(I("D66SortType"),"ASC"),h=y.sort_type)?f["$sort!"]():S(H(I("D66SortType"),"DESC"),h)&&f["$sort!"]()["$reverse!"](),u=U(E(f["$[]"](0),10),f["$[]"](1)),k=C(h=y.items["$[]"](u))?h:y.items["$[]"](u.$to_s()),C(k["$respond_to?"]("roll"))&&(k=k.$roll(l)),I("RollResult").$new(y.name,u,k)}),R(a,"$choice",function(l){return I("RollResult").$new(this.name,l,this.items["$[]"](l))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var N,s,i,D,Y,F=e.module,A=e.klass,c=e.hash2,B=e.send,R=e.to_ary,S=e.rb_plus,U=e.rb_times,E=e.send2,C=e.find_super,P=e.def,H=[],W=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),N=H,s=Y=[F(H[0],"BCDice")].concat(N),i=[F(Y[0],"DiceTable")].concat(s),D=e.$r(i),P(A(i[0],D("D66Table"),"D66LeftRangeTable"),"$initialize",function I(T,x,l){var h;return I.$$p=null,h=c([],{}),B(l,"each",[],function(k){var _,b;return null==k&&(k=W),_=R(k),b=null==_[1]?W:_[1],B(null==_[0]?W:_[0],"each",[],function(g){return null==g&&(g=W),B(b,"each_with_index",[],function(o,$){var G,Q;return null==o&&(o=W),null==$&&($=W),Q=S(U(g,10),S($,1)),B(h,"[]=",G=[Q,o]),G[G.length-1]})})}),E(this,C(this,"initialize",I,!1,!0),"initialize",[T,x,h],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var W,Y,D,r,a,v,I,s,N,F=e.module,A=e.klass,c=e.hash2,B=e.defs,R=e.def,S=e.truthy,U=e.rb_minus,E=e.rb_plus,C=e.rb_times,P=[],w=e.nil;return W=P,Y=N=[F(P[0],"BCDice")].concat(W),D=s=[F(N[0],"DiceTable")].concat(Y),a=[r=A(s[0],null,"D66ParityTable")].concat(D),v=e.$r(a),(I=r.$$prototype).odd=I.even=I.name=w,B(r,"$from_i18n",function(x,l){var f=w;return f=v("I18n").$t(x,c(["locale","raise"],{locale:l,raise:!0})),this.$new(f["$[]"]("name"),f["$[]"]("odd"),f["$[]"]("even"))}),R(r,"$initialize",function(x,l,y){var f=this;return f.name=x,f.odd=l.$freeze(),f.even=y.$freeze()}),R(r,"$roll",function(x){var f,u,k,l=this,y=w;return y=x.$roll_once(6),f=x.$roll_once(6),u=(S(y["$odd?"]())?l.odd:l.even)["$[]"](U(f,1)),k=E(C(y,10),f),v("RollResult").$new(l.name,k,u)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var P,M,s,d,i,D,r,m,H,F=e.module,A=e.klass,c=e.def,B=e.rb_plus,R=e.rb_times,S=e.send,U=[],E=e.nil;return P=U,M=H=[F(U[0],"BCDice")].concat(P),s=m=[F(H[0],"DiceTable")].concat(M),i=[d=A(m[0],null,"D66RangeTable")].concat(s),D=e.$r(i),(r=d.$$prototype).items=r.name=E,c(d,"$initialize",function(v,I){return this.name=v,this.items=I.$freeze()}),c(d,"$roll",function(v){var T,x,l,y=E;return T=v.$roll_once(6),x=v.$roll_once(6),l=B(R(T,10),x),y=S(this.items,"find",[],function(h){return null==h&&(h=E),h["$[]"](0)["$include?"](l)}),D("RollResult").$new(this.name,l,y["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var W,Y,D,r,a,v,I,s,N,F=e.module,A=e.klass,c=e.const_set,B=e.send,R=e.truthy,S=e.def,U=e.eqeqeq,E=e.rb_times,C=e.rb_plus,P=[],w=e.nil;return W=P,Y=N=[F(P[0],"BCDice")].concat(W),D=s=[F(N[0],"DiceTable")].concat(Y),a=[r=A(s[0],null,"RangeTable")].concat(D),v=e.$r(a),(I=r.$$prototype).name=I.items=I.num_of_dice=I.num_of_sides=I.formatter=w,c(a[0],"RollResult",B(v("Struct"),"new",["sum","values","content","formatted"],function T(){return(null==T.$$s?this:T.$$s).$alias_method("to_s","formatted")},{$$s:r})),c(a[0],"Item",v("Struct").$new("range","content")),c(a[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(a[0],"DEFAULT_FORMATTER",B(r,"lambda",[],function(x,l){return null==x&&(x=w),null==l&&(l=w),x.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),S(r,"$initialize",function T(x,l,y){var u,f=T.$$p||w,h=this,k=w;return T.$$p=null,h.name=x.$freeze(),h.formatter=R(u=f)?u:v("DEFAULT_FORMATTER"),k=v("DICE_ROLL_METHOD_RE").$match(l),R(k)||h.$raise(v("ArgumentError"),h.name+": invalid dice roll method: "+l),h.num_of_dice=k["$[]"](1).$to_i(),h.num_of_sides=k["$[]"](2).$to_i(),h.$store(y)}),S(r,"$fetch",function(x){var y,l=this;return y=B(l.items,"find",[],function(h){return null==h&&(h=w),h.$range()["$include?"](x)}),R(y)||l.$raise(v("RangeError"),l.name+": value is out of range: "+x),y}),S(r,"$roll",function(x){var f,l=this,y=w,h=w;return f=(y=x.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(h=v("RollResult").$new(f,y,l.$fetch(f).$content()))["$formatted="](l.formatter["$[]"](l,h)),h}),r.$private(),S(r,"$store",function(x){var y,f,l=this;return y=B(x,"map",[],function h(u,k){return null==u&&(u=w),null==k&&(k=w),[(null==h.$$s?this:h.$$s).$coerce_to_int_range(u),k]},{$$s:l}),f=B(y,"sort_by",[],function(u,k){return null==u&&(u=w),null==k&&(k=w),u.$min()}),l.$assert_min_sum_is_covered(f),l.$assert_max_sum_is_covered(f),l.$assert_no_gap_or_overlap_in_ranges(f),l.items=B(f,"map",[],function(u,k){return null==u&&(u=w),null==k&&(k=w),v("Item").$new(u,k.$freeze()).$freeze()}).$freeze(),l}),S(r,"$coerce_to_int_range",function(x){var y;return U(v("Integer"),y=x)?v("Range").$new(x,x):U(v("Range"),y)&&R(x.$begin()["$is_a?"](v("Integer")))&&R(x.$end()["$is_a?"](v("Integer")))?x:this.$raise(v("TypeError"),this.name+": "+x+" ("+x.$class()+") must be an Integer or a Range with Integers ")}),S(r,"$assert_min_sum_is_covered",function(x){var y,l=this,f=w;return y=l.num_of_dice,f=x.$first()["$[]"](0),R(f["$include?"](y))||l.$raise(v("RangeError"),l.name+": min value ("+y+") is not covered: "+f),l}),S(r,"$assert_max_sum_is_covered",function(x){var y,l=this,f=w;return y=E(l.num_of_dice,l.num_of_sides),f=x.$last()["$[]"](0),R(f["$include?"](y))||l.$raise(v("RangeError"),l.name+": max value ("+y+") is not covered: "+f),l}),S(r,"$assert_no_gap_or_overlap_in_ranges",function(x){return B(x,"each_cons",[2],function y(f,h){var q,L,u=null==y.$$s?this:y.$$s,k=w,_=w;return null==u.name&&(u.name=w),null==f&&(f=w),null==h&&(h=w),k=f["$[]"](0),_=h["$[]"](0),q=k.$max(),L=C(q,1),R(_["$include?"](q))&&u.$raise(v("RangeError"),u.name+": Range overlap: "+k+" and "+_),R(_["$include?"](L))?w:u.$raise(v("RangeError"),u.name+": Range gap: "+k+" and "+_)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var w,N,d,v,I,T,x,D,Y,W,F=e.module,A=e.klass,c=e.send,B=e.def,R=e.rb_minus,S=e.return_ivar,U=[],E=e.nil,C=e.$$$;return w=U,N=W=[F(U[0],"BCDice")].concat(w),d=Y=[F(W[0],"DiceTable")].concat(N),v=D=[A(Y[0],null,"SaiFicSkillTable")].concat(d),T=[I=A(D[0],null,"Category")].concat(v),x=e.$r(T),B(I,"$initialize",function(y,f,h,u){var k=this;return k.name=y,k.skills=c(f.$map(),"with_index",[2],function(q,L){return null==q&&(q=E),null==L&&(L=E),C(x("SaiFicSkillTable"),"Skill").$new(y,q,h,L,u)}),k.dice=h}),B(I,"$roll",function(y){return this.$skills()["$[]"](R(y.$roll_sum(2,6),2))}),B(I,"$to_s",S("name")),I.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var E,H,Y,D,r,s,M,P,F=e.module,A=e.klass,c=e.def,B=e.hash2,R=[],S=e.nil;return E=R,H=P=[F(R[0],"BCDice")].concat(E),Y=M=[F(P[0],"DiceTable")].concat(H),s=[A(M[0],null,"SaiFicSkillTable")].concat(Y),(r=(D=A(s[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=S,c(D,"$initialize",function(v,I,T,x,l){var y=this;return y.category_name=v,y.name=I,y.category_dice=T,y.row_dice=x,y.s_format=l}),c(D,"$to_s",function(){var v=this;return v.$format(v.s_format,B(["category_dice","row_dice","category_name","skill_name"],{category_dice:v.category_dice,row_dice:v.row_dice,category_name:v.category_name,skill_name:v.name}))}),D.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var s,r,x,l,y,f,h,v,i,F=e.module,A=e.klass,c=e.ensure_kwargs,B=e.hash2,R=e.send,U=e.defs,E=e.const_set,C=e.to_ary,P=e.def,w=e.truthy,H=e.rb_minus,W=e.rb_plus,M=e.top,N=[],m=e.nil,Y=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),s=N,r=i=[F(N[0],"BCDice")].concat(s),x=v=[F(i[0],"DiceTable")].concat(r),y=[l=A(v[0],null,"SaiFicSkillTable")].concat(x),f=e.$r(y),(h=l.$$prototype).rtt=h.rtt_format=h.rct=h.rct_format=h.rttn=h.rttn_format=h.categories=m,U(l,"$from_i18n",function(k,_,q){var L,b,t,$,o=m;return null==(L=(q=c(q)).$$smap.rtt)&&(L=m),null==(b=q.$$smap.rct)&&(b=m),null==(t=q.$$smap.rttn)&&(t=m),$=(o=f("I18n").$t("RTT",B(["locale","raise","default"],{locale:_,raise:!1,default:B([],{})})).$merge(f("I18n").$t(k,B(["locale","raise"],{locale:_,raise:!0}))))["$[]"]("items"),o=R(o,"select",[],function(Q,V){return null==Q&&(Q=m),null==V&&(V=m),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new($,e.to_hash(o).$merge(B(["rtt","rct","rttn"],{rtt:L,rct:b,rttn:t})))},-3),E(y[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),E(y[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),E(y[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),E(y[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),P(l,"$initialize",function(k,_){var q,L,b,t,g,n,o,$=this;return null==(q=(_=c(_)).$$smap.rtt)&&(q=m),null==(L=_.$$smap.rct)&&(L=m),null==(b=_.$$smap.rttn)&&(b=m),null==(t=_.$$smap.rtt_format)&&(t=f("DEFAULT_RTT")),null==(g=_.$$smap.rct_format)&&(g=f("DEFAULT_RCT")),null==(n=_.$$smap.rttn_format)&&(n=f("DEFAULT_RTTN")),null==(o=_.$$smap.s_format)&&(o=f("DEFAULT_S")),$.categories=R(k.$map(),"with_index",[1],function(Q,V){var ne,ue,$e;return null==Q&&(Q=m),null==V&&(V=m),ue=null==(ne=C(Q))[0]?m:ne[0],$e=null==ne[1]?m:ne[1],Y(f("SaiFicSkillTable"),"Category").$new(ue,$e,V,o)},{$$has_top_level_mlhs_arg:!0}),$.rtt=q,$.rct=L,$.rttn=b.$to_a(),$.rtt_format=t,$.rct_format=g,$.rttn_format=n},-2),E(y[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),l.$attr_reader("categories"),P(l,"$roll_command",function(k,_){var L,q=this,b=m,t=m;return w(["RTT",q.rtt]["$include?"](L=_))?q.$format_skill(q.rtt_format,q.$roll_skill(k)):w(["RCT",q.rct]["$include?"](L))?(b=q.$roll_category(k),q.$format(q.rct_format,B(["category_dice","category_name"],{category_dice:b.$dice(),category_name:b.$name()}))):w(t=f("RTTN").$index(L))||w(t=q.rttn.$index(L))?q.$format_skill(q.rttn_format,q.categories["$[]"](t).$roll(k)):m}),P(l,"$roll_category",function(k){return this.categories["$[]"](H(k.$roll_once(6),1))}),P(l,"$roll_skill",function(k){return this.$roll_category(k).$roll(k)}),P(l,"$prefixes",function(){var k=this;return W(["RTT[1-6]?","RCT",k.rtt,k.rct],k.rttn).$compact()}),l.$private(),P(l,"$format_skill",function(k,_){return this.$format(k,B(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:_.$category_dice(),row_dice:_.$row_dice(),category_name:_.$category_name(),skill_name:_.$name(),text:_.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var w,N,d,i,D,r,a,Y,W,F=e.module,A=e.klass,c=e.hash2,B=e.defs,R=e.truthy,S=e.def,U=e.rb_minus,E=[],C=e.nil;return w=E,N=W=[F(E[0],"BCDice")].concat(w),d=Y=[F(W[0],"DiceTable")].concat(N),D=[i=A(Y[0],null,"Table")].concat(d),r=e.$r(D),(a=i.$$prototype).times=a.sides=a.name=a.items=C,B(i,"$from_i18n",function(I,T){var l=C;return l=r("I18n").$t(I,c(["locale"],{locale:T})),this.$new(l["$[]"]("name"),l["$[]"]("type"),l["$[]"]("items"))}),S(i,"$initialize",function(I,T,x){var l=this,y=C;return l.name=I,l.items=x.$freeze(),y=/(\d+)D(\d+)/i.$match(T),R(y)||l.$raise(r("ArgumentError"),"Unexpected table type: "+T),l.times=y["$[]"](1).$to_i(),l.sides=y["$[]"](2).$to_i()}),S(i,"$roll",function(I){var x,T=this;return x=I.$roll_sum(T.times,T.sides),T.$choice(x)}),S(i,"$choice",function(I){var x,T=this;return x=U(I,T.times),r("RollResult").$new(T.name,I,T.items["$[]"](x))})},Opal.modules["bcdice/dice_table"]=function(e){var F=e.top;return F.$require("bcdice/dice_table/roll_result"),F.$require("bcdice/dice_table/chain_table"),F.$require("bcdice/dice_table/d66_grid_table"),F.$require("bcdice/dice_table/d66_half_grid_table"),F.$require("bcdice/dice_table/d66_one_third_table"),F.$require("bcdice/dice_table/d66_left_range_table"),F.$require("bcdice/dice_table/d66_parity_table"),F.$require("bcdice/dice_table/d66_range_table"),F.$require("bcdice/dice_table/d66_table"),F.$require("bcdice/dice_table/range_table"),F.$require("bcdice/dice_table/sai_fic_skill_table"),F.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var S,P,H,E,F=e.module,A=e.const_set,c=[];return S=c,P=E=[F(c[0],"BCDice")].concat(S),H=[F(E[0],"D66SortType")].concat(P),A(H[0],"NO_SORT","no_sort"),A(H[0],"ASC","asc"),A(H[0],"DESC","desc"),function(C,P){var H=[F(C,"RoundType")].concat(P);return A(H[0],"CEIL","ceil"),A(H[0],"FLOOR","floor"),A(H[0],"ROUND","round")}(E[0],E)},Opal.modules["bcdice/translate"]=function(e){var P,M,N,m,Y,H,F=e.module,A=e.ensure_kwargs,c=e.kwrestargs,R=e.hash2,S=e.def,U=[],E=e.nil;return P=U,M=H=[F(U[0],"BCDice")].concat(P),m=[N=F(H[0],"Translate")].concat(M),Y=e.$r(m),S(N,"$translate",function(s,d){var i,D=this;return null==D.locale&&(D.locale=E),d=A(d),i=c(d,{}),Y("I18n").$translate(s,R(["locale","raise"],{locale:D.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var N,j,m,P,H,A=e.klass,c=e.send,B=e.def,R=e.return_val,S=e.return_ivar,U=[],E=e.nil;return P=U,N=H=[(0,e.module)(U[0],"BCDice")].concat(P),[m=A(H[0],null,"Result")].concat(N),B(j=e.get_singleton_class(m),"$success",function(i){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](i),c(a,"success=",v=[!0]),v[v.length-1]})}),B(j,"$failure",function(i){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](i),c(a,"failure=",v=[!0]),v[v.length-1]})}),B(j,"$critical",function(i){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](i),a["$critical="](!0),c(a,"success=",v=[!0]),v[v.length-1]})}),B(j,"$fumble",function(i){return c(this.$new(),"tap",[],function(a){var v;return null==a&&(a=E),a["$text="](i),a["$fumble="](!0),c(a,"failure=",v=[!0]),v[v.length-1]})}),B(j,"$nothing",R("nothing")),B(m,"$initialize",function(s){var d=this;return null==s&&(s=E),d.text=s,d.rands=E,d.detailed_rands=E,d.secret=!1,d.success=!1,d.failure=!1,d.critical=!1,d.fumble=!1},-1),m.$attr_accessor("text","rands","detailed_rands"),m.$attr_writer("secret","success","failure","critical","fumble"),B(m,"$secret?",S("secret")),B(m,"$success?",S("success")),B(m,"$failure?",S("failure")),B(m,"$critical?",S("critical")),B(m,"$fumble?",S("fumble")),B(m,"$condition=",function(s){return this.success=s,this.failure=s["$!"]()})},Opal.modules["racc/parser"]=function(e){var I,x,l,F=e.module,A=e.klass,c=e.truthy,B=e.const_set,R=e.defs,S=e.gvars,U=e.rb_lt,E=e.def,C=e.to_ary,P=e.send,w=e.neqeq,H=e.rb_plus,W=e.eqeq,M=e.rb_ge,N=e.rb_gt,m=e.rb_minus,Y=e.rb_le,j=e.rb_times,s=e.assign_ivar_val,i=[],D=e.$r(i),r=e.nil,a=e.$$$;return I=i,x=[F(i[0],"Racc")].concat(I),l=e.$r(x),A(x[0],l("StandardError"),"ParseError"),c(a("::","ParseError","skip_raise")?"constant":r)||B(i[0],"ParseError",a(D("Racc"),"ParseError")),function(v,I){var u,k,_,q,L,l=[F(v,"Racc")].concat(I),y=e.$r(l);return c(y("Racc_No_Extensions","skip_raise")?"constant":r)||B(l[0],"Racc_No_Extensions",!1),u=l,_=[k=A(l[0],null,"Parser")].concat(u),q=e.$r(_),(L=k.$$prototype).yydebug=L.racc_debug_out=L.racc_error_status=L.racc_t=L.racc_vstack=L.racc_val=L.racc_state=L.racc_tstack=r,B(_[0],"Racc_Runtime_Version","1.4.6"),B(_[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),B(_[0],"Racc_Runtime_Core_Version_R","1.4.6"),B(_[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),B(_[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),B(_[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),B(_[0],"Racc_Runtime_Core_Version",q("Racc_Runtime_Core_Version_R")),B(_[0],"Racc_Runtime_Core_Revision",q("Racc_Runtime_Core_Revision_R")),B(_[0],"Racc_Runtime_Type","ruby"),R(q("Parser"),"$racc_runtime_type",function(){return q("Racc_Runtime_Type")}),E(k,"$_racc_setup",function(){var t,g,n=this,o=r,$=r;return null==S.stderr&&(S.stderr=r),c(a(n.$class(),"Racc_debug_parser"))||(n.yydebug=!1),c(null!=(t=n.yydebug)&&t!==r?"instance-variable":r)||(n.yydebug=!1),c(n.yydebug)&&(c(null!=(g=n.racc_debug_out)&&g!==r?"instance-variable":r)||(n.racc_debug_out=S.stderr),n.racc_debug_out=c(o=n.racc_debug_out)?o:S.stderr),$=a(n.$class(),"Racc_arg"),c(U($.$size(),14))&&$["$[]="](13,!0),$}),E(k,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),E(k,"$do_parse",function(){return this.$__send__(q("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),E(k,"$next_token",function(){return this.$raise(q("NotImplementedError"),this.$class()+"#next_token is not defined")}),E(k,"$_racc_do_parse_rb",function(t,g){var n,$=this,G=r,Q=r,V=r,ne=r,ue=r,$e=r,ce=r,ae=r;return n=C(t),G=null==n[0]?r:n[0],Q=null==n[1]?r:n[1],V=null==n[2]?r:n[2],ne=null==n[3]?r:n[3],ue=null==n[10]?r:n[10],$.$_racc_init_sysvars(),$e=ce=ae=r,P($,"catch",["racc_end_parse"],function re(){var se,K,p=null==re.$$s?this:re.$$s,Z=r;for(null==p.racc_state&&(p.racc_state=r),null==p.racc_read_next&&(p.racc_read_next=r),null==p.racc_t&&(p.racc_t=r),null==p.yydebug&&(p.yydebug=r),null==p.racc_val&&(p.racc_val=r);c(!0);)for(c(ae=ne["$[]"](p.racc_state["$[]"](-1)))?(c(p.racc_read_next)&&w(p.racc_t,0)&&(K=p.$next_token(),se=C(K),$e=null==se[0]?r:se[0],p.racc_val=null==se[1]?r:se[1],p.racc_t=c($e)?c(Z=ue["$[]"]($e))?Z:1:0,c(p.yydebug)&&p.$racc_read_token(p.racc_t,$e,p.racc_val),p.racc_read_next=!1),ae=H(ae,p.racc_t),c(M(ae,0))&&c(ce=G["$[]"](ae))&&W(Q["$[]"](ae),p.racc_state["$[]"](-1))||(ce=V["$[]"](p.racc_state["$[]"](-1)))):ce=V["$[]"](p.racc_state["$[]"](-1));c(ce=p.$_racc_evalact(ce,t)););},{$$s:$})}),E(k,"$yyparse",function(t,g){return this.$__send__(q("Racc_YY_Parse_Method"),t,g,this.$_racc_setup(),!0)}),E(k,"$_racc_yyparse_rb",function(t,g,n,o){var $,Q=this,V=r,ne=r,ie=r,ue=r,ce=r,ae=r,re=r;return $=C(n),V=null==$[0]?r:$[0],ne=null==$[1]?r:$[1],ie=null==$[2]?r:$[2],ue=null==$[3]?r:$[3],ce=null==$[10]?r:$[10],Q.$_racc_init_sysvars(),ae=r,re=r,P(Q,"catch",["racc_end_parse"],function se(){var K=null==se.$$s?this:se.$$s;for(null==K.racc_state&&(K.racc_state=r);!c(re=ue["$[]"](K.racc_state["$[]"](-1)));)for(;c(ae=K.$_racc_evalact(ie["$[]"](K.racc_state["$[]"](-1)),n)););return P(t,"__send__",[g],function p(Z,X){var z=null==p.$$s?this:p.$$s,O=r,te=r;for(null==z.racc_t&&(z.racc_t=r),null==z.racc_state&&(z.racc_state=r),null==z.racc_read_next&&(z.racc_read_next=r),null==Z&&(Z=r),null==X&&(X=r),z.racc_t=c(Z)?c(O=ce["$[]"](Z))?O:1:0,z.racc_val=X,z.racc_read_next=!1,re=H(re,z.racc_t),c(M(re,0))&&c(ae=V["$[]"](re))&&W(ne["$[]"](re),z.racc_state["$[]"](-1))||(ae=ie["$[]"](z.racc_state["$[]"](-1)));c(ae=z.$_racc_evalact(ae,n)););for(;c(c(O=c(te=(re=ue["$[]"](z.racc_state["$[]"](-1)))["$!"]())?te:z.racc_read_next["$!"]())?O:z.racc_t["$=="](0));)for(c(re)&&c(re=H(re,z.racc_t))&&c(M(re,0))&&c(ae=V["$[]"](re))&&W(ne["$[]"](re),z.racc_state["$[]"](-1))||(ae=ie["$[]"](z.racc_state["$[]"](-1)));c(ae=z.$_racc_evalact(ae,n)););},{$$s:K})},{$$s:Q})}),E(k,"$_racc_evalact",function(t,g){var n,ie,$=this,G=r,Q=r,ne=r,ue=r,$e=r,ce=r;if(G=null==(n=C(g))[0]?r:n[0],Q=null==n[1]?r:n[1],ne=null==n[3]?r:n[3],ie=null==n[11]?r:n[11],ue=null==n[12]?r:n[12],c(N(t,0))&&c(U(t,ie)))c(N($.racc_error_status,0))&&(W($.racc_t,1)||($.racc_error_status=m($.racc_error_status,1))),$.racc_vstack.$push($.racc_val),$.racc_state.$push(t),$.racc_read_next=!0,c($.yydebug)&&($.racc_tstack.$push($.racc_t),$.$racc_shift($.racc_t,$.racc_tstack,$.racc_vstack));else if(c(U(t,0))&&c(N(t,ue["$-@"]()))){if($e=P($,"catch",["racc_jump"],function ae(){var re=null==ae.$$s?this:ae.$$s;return null==re.racc_state&&(re.racc_state=r),re.racc_state.$push(re.$_racc_do_reduce(g,t)),!1},{$$s:$}),c($e))switch($e.valueOf()){case 1:return $.racc_user_yyerror=!0,ue["$-@"]();case 2:return ie;default:$.$raise("[Racc Bug] unknown jump code")}}else if(W(t,ie))c($.yydebug)&&$.$racc_accept(),$.$throw("racc_end_parse",$.racc_vstack["$[]"](0));else{if(W(t,ue["$-@"]())){switch($.racc_error_status.valueOf()){case 0:c(g["$[]"](21))||$.$on_error($.racc_t,$.racc_val,$.racc_vstack);break;case 3:W($.racc_t,0)&&$.$throw("racc_end_parse",r),$.racc_read_next=!0}for($.racc_user_yyerror=!1,$.racc_error_status=3;c(!0)&&!(c(ce=ne["$[]"]($.racc_state["$[]"](-1)))&&(ce=H(ce,1),c(M(ce,0))&&c(t=G["$[]"](ce))&&W(Q["$[]"](ce),$.racc_state["$[]"](-1))));)c(Y($.racc_state.$size(),1))&&$.$throw("racc_end_parse",r),$.racc_state.$pop(),$.racc_vstack.$pop(),c($.yydebug)&&($.racc_tstack.$pop(),$.$racc_e_pop($.racc_state,$.racc_tstack,$.racc_vstack));return t}$.$raise("[Racc Bug] unknown action "+t.$inspect())}return c($.yydebug)&&$.$racc_next_state($.racc_state["$[]"](-1),$.racc_state),r}),E(k,"$_racc_do_reduce",function(t,g){var n,ue,ce,Z,X,z,ee,$=this,Q=r,V=r,ne=r,ie=r,$e=r,ae=r,re=r,se=r,K=r,p=r,O=r,te=r,J=r;return Q=null==(n=C(t))[4]?r:n[4],V=null==n[5]?r:n[5],ne=null==n[6]?r:n[6],ie=null==n[7]?r:n[7],ue=null==n[8]?r:n[8],$e=null==n[9]?r:n[9],ce=null==n[13]?r:n[13],ae=$.racc_state,re=$.racc_vstack,se=$.racc_tstack,K=j(g,-3),p=$e["$[]"](K),Z=$e["$[]"](H(K,1)),X=$e["$[]"](H(K,2)),z=[],c($.yydebug)&&(O=se["$[]"](p["$-@"](),p)),te=re["$[]"](p["$-@"](),p),c($.yydebug)&&se["$[]="](p["$-@"](),p,z),re["$[]="](p["$-@"](),p,z),ae["$[]="](p["$-@"](),p,z),c(ce)?re.$push($.$__send__(X,te,re,te["$[]"](0))):re.$push($.$__send__(X,te,re)),se.$push(Z),c($.yydebug)&&$.$racc_reduce(O,Z,se,re),ee=m(Z,ue),c(K=ie["$[]"](ee))&&(K=H(K,ae["$[]"](-1)),c(M(K,0))&&c(J=Q["$[]"](K))&&W(V["$[]"](K),ee))?J:ne["$[]"](ee)}),E(k,"$on_error",function(t,g,n){var $,o=this;return o.$raise(q("ParseError"),o.$sprintf("\nparse error on value %s (%s)",g.$inspect(),c($=o.$token_to_str(t))?$:"?"))}),E(k,"$yyerror",function(){return this.$throw("racc_jump",1)}),E(k,"$yyaccept",function(){return this.$throw("racc_jump",2)}),E(k,"$yyerrok",s("racc_error_status",0)),E(k,"$racc_read_token",function(t,g,n){var o=this;return o.racc_debug_out.$print("read    "),o.racc_debug_out.$print(g.$inspect(),"(",o.$racc_token2str(t),") "),o.racc_debug_out.$puts(n.$inspect()),o.racc_debug_out.$puts()}),E(k,"$racc_shift",function(t,g,n){var o=this;return o.racc_debug_out.$puts("shift   "+o.$racc_token2str(t)),o.$racc_print_stacks(g,n),o.racc_debug_out.$puts()}),E(k,"$racc_reduce",function(t,g,n,o){var $=this,G=r;return(G=$.racc_debug_out).$print("reduce "),c(t["$empty?"]())?G.$print(" <none>"):P(t,"each",[],function Q(V){return null==V&&(V=r),G.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(V))},{$$s:$}),G.$puts(" --\x3e "+$.$racc_token2str(g)),$.$racc_print_stacks(n,o),$.racc_debug_out.$puts()}),E(k,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),E(k,"$racc_e_pop",function(t,g,n){var o=this;return o.racc_debug_out.$puts("error recovering mode: pop token"),o.$racc_print_states(t),o.$racc_print_stacks(g,n),o.racc_debug_out.$puts()}),E(k,"$racc_next_state",function(t,g){var n=this;return n.racc_debug_out.$puts("goto    "+t),n.$racc_print_states(g),n.racc_debug_out.$puts()}),E(k,"$racc_print_stacks",function(t,g){var o=r;return(o=this.racc_debug_out).$print("        ["),P(t,"each_index",[],function $(G){return null==G&&(G=r),o.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(t["$[]"](G))," ",g["$[]"](G).$inspect(),")")},{$$s:this}),o.$puts(" ]")}),E(k,"$racc_print_states",function(t){var n=r;return(n=this.racc_debug_out).$print("        ["),P(t,"each",[],function($){return null==$&&($=r),n.$print(" ",$)}),n.$puts(" ]")}),E(k,"$racc_token2str",function(t){var n;return c(n=a(this.$class(),"Racc_token_to_s_table")["$[]"](t))?n:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),E(k,"$token_to_str",function(t){return a(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var s,r,T,u,k,l,y,v,i,F=e.module,A=e.klass,c=e.def,B=e.thrower,R=e.return_ivar,S=e.send2,U=e.find_super,E=e.eqeq,C=e.const_set,P=e.eqeqeq,w=e.rb_divide,H=e.truthy,W=e.assign_ivar,M=e.alias,N=[],m=e.nil,Y=e.$$$;return s=N,r=i=[F(N[0],"BCDice")].concat(s),T=v=[F(i[0],"Arithmetic")].concat(r),l=[F(v[0],"Node")].concat(T),y=e.$r(l),(k=(u=A(l[0],null,"BinaryOp")).$$prototype).lhs=k.rhs=k.op=m,c(u,"$initialize",function(q,L,b){var t=this;return t.lhs=q,t.op=L,t.rhs=b}),c(u,"$eval",function(q){try{B("eval_return");var g,b=this,t=m;return t=b.lhs.$eval(q),g=b.rhs.$eval(q),t.$send(b.op,g)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),c(u,"$output",function(){var q=this;return""+q.lhs.$output()+q.op+q.rhs.$output()}),c(u,"$s_exp",function(){var q=this;return"("+q.$op_for_s_exp()+" "+q.lhs.$s_exp()+" "+q.rhs.$s_exp()+")"}),c(u,"$op_for_s_exp",R("op")),function(f,h,u){var k=A(f,h,"DivideBase"),_=[k].concat(u),q=e.$r(_),L=k.$$prototype;L.lhs=L.rhs=L.op=m,c(k,"$initialize",function b(t,g){return b.$$p=null,S(this,U(this,"initialize",b,!1,!0),"initialize",[t,"/",g],null)}),c(k,"$eval",function(t){try{B("eval_return");var o,$,n=this;return o=n.lhs.$eval(t),$=n.rhs.$eval(t),E($,0)&&n.$raise(q("ZeroDivisionError")),n.$divide_and_round(o,$,t)}catch(G){if(G===e.t_eval_return)return G.$v;throw G}}),c(k,"$output",function b(){var t=b.$$p||m,g=this;return b.$$p=null,""+S(g,U(g,"output",b,!1,!0),"output",[],t)+g.$rounding_method()}),k.$private(),c(k,"$rounding_method",function(){return Y(this.$class(),"ROUNDING_METHOD")}),c(k,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(k,"$divide_and_round",function(t,g,n){return this.$raise(q("NotImplementedError"))})}(l[0],y("BinaryOp"),l),function(f,h,u){var k=A(f,h,"DivideWithGameSystemDefault"),_=[k].concat(u),q=e.$r(_);C(_[0],"ROUNDING_METHOD",""),k.$private(),c(k,"$divide_and_round",function(b,t,g){var n,o=m;return P(Y(q("RoundType"),"CEIL"),n=g)?w(b.$to_f(),t).$ceil():P(Y(q("RoundType"),"ROUND"),n)?(o=w(b.$to_f(),t),H(o["$negative?"]())?o.$abs().$round()["$-@"]():o.$round()):w(b,t).$floor()})}(l[0],y("DivideBase"),l),function(f,h,u){var k=A(f,h,"DivideWithCeil"),_=[k].concat(u);C(_[0],"ROUNDING_METHOD","C"),k.$private(),c(k,"$divide_and_round",function(L,b,t){return w(L.$to_f(),b).$ceil()})}(l[0],y("DivideBase"),l),function(f,h,u){var k=A(f,h,"DivideWithRound"),_=[k].concat(u);C(_[0],"ROUNDING_METHOD","R"),k.$private(),c(k,"$divide_and_round",function(L,b,t){var g=m;return g=w(L.$to_f(),b),H(g["$negative?"]())?g.$abs().$round()["$-@"]():g.$round()})}(l[0],y("DivideBase"),l),function(f,h,u){var k=A(f,h,"DivideWithFloor"),_=[k].concat(u);C(_[0],"ROUNDING_METHOD","F"),k.$private(),c(k,"$divide_and_round",function(L,b,t){return w(L,b).$floor()})}(l[0],y("DivideBase"),l),function(f,h){var u=A(f,null,"Negative");u.$$prototype.body=m,c(u,"$initialize",W("body")),c(u,"$eval",function(q){try{return B("eval_return"),this.body.$eval(q)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(u,"$output",function(){return"-"+this.body.$output()}),c(u,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(l[0]),function(f,h){var u=A(f,null,"Parenthesis");u.$$prototype.expr=m,c(u,"$initialize",W("expr")),c(u,"$eval",function(q){try{return B("eval_return"),this.expr.$eval(q)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(u,"$output",function(){return"("+this.expr.$output()+")"}),c(u,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(l[0]),function(f,h){var u=A(f,null,"Number");return u.$$prototype.value=m,c(u,"$initialize",W("value")),c(u,"$eval",R("value")),c(u,"$output",function(){return this.value.$to_s()}),M(u,"s_exp","output")}(l[0])},Opal.modules.strscan=function(e){var W,M,N,m,Y,A=e.def,c=e.truthy,B=e.eqeqeq,R=e.Opal,S=e.return_ivar,U=e.send,E=e.alias,C=[],P=e.nil;return W=C,N=[M=(0,e.klass)(C[0],null,"StringScanner")].concat(W),m=e.$r(N),(Y=M.$$prototype).pos=Y.string=Y.working=Y.matched=Y.prev_pos=Y.match=P,M.$attr_reader("pos","matched"),A(M,"$initialize",function(s){var d=this;return d.string=s,d.pos=0,d.matched=P,d.working=s,d.match=[]}),M.$attr_reader("string"),A(M,"$beginning_of_line?",function(){var s=this;return 0===s.pos||"\n"===s.string.charAt(s.pos-1)}),A(M,"$scan",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);return null==i?d.matched=P:(d.prev_pos=d.pos,d.pos+=i[0].length,d.working=d.working.substring(i[0].length),d.matched=i[0],d.match=i,i[0])}),A(M,"$scan_until",function(s){var d=this;s=d.$anchor(s);for(var i=d.working,D=0;i.length!=D;++D){var r=s.exec(i.substr(D));if(null!==r){var a=D+r[0].length,v=i.substr(0,a);return d.matched=r[0],d.match=r,d.prev_pos=d.pos+D,d.pos+=a,d.working=i.substr(a),v}}return d.matched=P}),A(M,"$[]",function(s){var i;if(c(this.match["$empty?"]()))return P;B(m("Symbol"),i=s)?s=s.$to_s():B(m("String"),i)||(s=R["$coerce_to!"](s,m("Integer"),"to_int"));var D=this.match;return s<0&&(s+=D.length),s<0||s>=D.length||null==D[s]?P:D[s]}),A(M,"$check",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);return d.matched=null==i?P:i[0]}),A(M,"$check_until",function(s){var d=this,i=d.prev_pos,D=d.pos,r=d.working,a=d.$scan_until(s);return d.prev_pos=i,d.pos=D,d.working=r,a}),A(M,"$peek",function(s){return this.working.substring(0,s)}),A(M,"$eos?",function(){return 0===this.working.length}),A(M,"$exist?",function(s){var i=s.exec(this.working);return null==i?P:0==i.index?0:i.index+1}),A(M,"$skip",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);if(null==i)return d.match=[],d.matched=P;var D=i[0],r=D.length;return d.matched=D,d.match=i,d.prev_pos=d.pos,d.pos+=r,d.working=d.working.substring(r),r}),A(M,"$skip_until",function(s){var i=this.$scan_until(s);return i===P?P:(this.matched=i.substr(-1),i.length)}),A(M,"$get_byte",function(){var s=this,d=P;return s.pos<s.string.length?(s.prev_pos=s.pos,s.pos+=1,d=s.matched=s.working.substring(0,1),s.working=s.working.substring(1)):s.matched=P,d}),A(M,"$match?",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);return null==i?P:(d.prev_pos=d.pos,i[0].length)}),A(M,"$pos=",function(s){var d=this;return s<0&&(s+=d.string.$length()),d.pos=s,d.working=d.string.slice(s)}),A(M,"$matched_size",function(){return this.matched===P?P:this.matched.length}),A(M,"$post_match",function(){var s=this;return s.matched===P?P:s.string.substr(s.pos)}),A(M,"$pre_match",function(){var s=this;return s.matched===P?P:s.string.substr(0,s.prev_pos)}),A(M,"$reset",function(){var s=this;return s.working=s.string,s.matched=P,s.pos=0}),A(M,"$rest",S("working")),A(M,"$rest?",function(){return 0!==this.working.length}),A(M,"$rest_size",function(){return this.$rest().$size()}),A(M,"$terminate",function(){var s,d=this;return d.match=P,s=[d.string.$length()],U(d,"pos=",s),s[s.length-1]}),A(M,"$unscan",function(){var s=this;return s.pos=s.prev_pos,s.prev_pos=P,s.match=P,s}),E(M,"bol?","beginning_of_line?"),E(M,"getch","get_byte"),M.$private(),A(M,"$anchor",function(s){var d=s.toString().match(/\/([^\/]+)$/);return d=d?d[1]:void 0,new RegExp("^(?:"+s.source+")",d)})},Opal.modules["bcdice/normalize"]=function(e){var E,H,P,F=e.module,A=e.eqeqeq,c=e.def,B=e.eqeq,R=[],S=e.nil;return E=R,P=[F(R[0],"BCDice")].concat(E),(H=F(P[0],"Normalize")).$module_function(),c(H,"$comparison_operator",function(M){var N;return A(/<=|=</,N=M)?"<=":A(/>=|=>/,N)?">=":A(/<>|!=|=!/,N)?"!=":A(/</,N)?"<":A(/>/,N)?">":A(/=/,N)?"==":S}),c(H,"$target_number",function(M){return B(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var W,Y,D,r,a,v,I,s,N,F=e.module,A=e.klass,c=e.const_set,B=e.hash2,R=e.truthy,S=e.send,U=e.def,E=e.thrower,C=e.top,P=[],w=e.nil;return C.$require("strscan"),C.$require("bcdice/normalize"),W=P,Y=N=[F(P[0],"BCDice")].concat(W),D=s=[F(N[0],"Command")].concat(Y),a=[r=A(s[0],null,"Lexer")].concat(D),v=e.$r(a),(I=r.$$prototype).scanner=I.notations=w,c(a[0],"SYMBOLS",B(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(r,"$initialize",function(x,l){var y,f,u;return x=R(u=(y=(f=x)===w||null==f?w:f.$split(" ",2))===w||null==y?w:y.$first())?u:"",this.scanner=v("StringScanner").$new(x),this.notations=S(l,"map",[],function(_){return null==_&&(_=w),R(_["$is_a?"](v("String")))?v("Regexp").$new(_):_})}),U(r,"$next_token",function(){try{var x=E("return"),l=this,y=w,f=w,u=w,k=w;return R(l.scanner["$eos?"]())?[!1,"$"]:(S(l.notations,"each",[],function _(q){var b,L=null==_.$$s?this:_.$$s;if(null==L.scanner&&(L.scanner=w),null==q&&(q=w),b=L.scanner.$scan(q),!R(b))return w;x.$throw(["NOTATION",b])},{$$s:l,$$ret:x}),R(y=l.scanner.$scan(/\d+/))?["NUMBER",y.$to_i()]:R(f=l.scanner.$scan(/[<>!=]+/))?(f=v("Normalize").$comparison_operator(f),[R(f)?"CMP_OP":"ILLEGAL",f]):(u=l.scanner.$getch().$upcase(),[R(k=v("SYMBOLS")["$[]"](u))?k:u.$to_sym(),u]))}catch(_){if(_===x)return _.$v;throw _}}),U(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var C,W,j,s,d,i,D,N,w,F=e.module,A=e.klass,c=e.def,B=e.return_ivar,R=e.truthy,S=[],U=e.nil;return C=S,W=w=[F(S[0],"BCDice")].concat(C),j=N=[F(w[0],"Command")].concat(W),d=[s=A(N[0],null,"Parsed")].concat(j),i=e.$r(d),(D=s.$$prototype).critical=D.fumble=D.dollar=D.modify_number=D.question_target=D.target_number=D.prefix_number=D.command=D.suffix_number=D.cmp_op=U,s.$attr_accessor("command"),s.$attr_accessor("prefix_number"),s.$attr_accessor("suffix_number"),s.$attr_accessor("critical"),s.$attr_accessor("fumble"),s.$attr_accessor("dollar"),s.$attr_accessor("modify_number"),s.$attr_accessor("cmp_op"),s.$attr_accessor("target_number"),s.$attr_writer("question_target"),c(s,"$initialize",function(){var a=this;return a.prefix_number=U,a.suffix_number=U,a.critical=U,a.fumble=U,a.dollar=U,a.cmp_op=U,a.target_number=U,a.question_target=!1}),c(s,"$question_target?",B("question_target")),c(s,"$to_s",function(a){var v=this,I=U,T=U,x=U,l=U,y=U;switch(null==a&&(a="after_command"),I=R(v.critical)?"@"+v.critical:U,T=R(v.fumble)?"#"+v.fumble:U,x=R(v.dollar)?"$"+v.dollar:U,l=i("Format").$modifier(v.modify_number),y=R(v.question_target)?"?":v.target_number,a.valueOf()){case"after_command":return[v.prefix_number,v.command,v.suffix_number,I,T,x,l,v.cmp_op,y].$join();case"after_modify_number":return[v.prefix_number,v.command,v.suffix_number,l,I,T,x,v.cmp_op,y].$join();case"after_target_number":return[v.prefix_number,v.command,v.suffix_number,l,v.cmp_op,y,I,T,x].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var a,x,k,g,n,o,$,G,Q,V,ne,ie,ce,_,b,t,se,y,f,I,F=e.klass,A=e.module,c=e.slice,B=e.extract_kwargs,R=e.ensure_kwargs,S=e.get_kwarg,U=e.send2,E=e.find_super,C=e.def,P=e.send,w=e.eqeq,H=e.thrower,W=e.hash,M=e.const_set,N=e.truthy,m=e.to_ary,Y=e.hash2,j=e.top,s=[],d=e.$r(s),i=e.nil,D=e.$$$;return j.$require("racc/parser.rb"),j.$require("bcdice/arithmetic/node"),j.$require("bcdice/command/lexer"),j.$require("bcdice/command/parsed"),F(D(d("BCDice"),"Command"),D(d("Racc"),"Parser"),"Parser"),a=s,x=I=[A(s[0],"BCDice")].concat(a),y=[A(I[0],"Command")].concat(x),f=e.$r(y),k=y,b=[_=F(y[0],D(f("Racc"),"Parser"),"Parser")].concat(k),t=e.$r(b),(se=_.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=i,C(_,"$initialize",function K(p,Z){var X,z,O,te,J=this;return K.$$p=null,X=c(arguments),z=B(X),z=R(z),O=X,te=S(z,"round_type"),U(J,E(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=O,J.round_type=te,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[i,">=",">","<=","<","==","!="],J.question_target=!1},-2),C(_,"$disable_modifier",function(){return this.modifier=!1,this}),C(_,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),C(_,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),C(_,"$has_prefix_number",function(){var p=this;return p.prefix_number=!0,p.need_prefix_number=!0,p}),C(_,"$has_suffix_number",function(){var p=this;return p.suffix_number=!0,p.need_suffix_number=!0,p}),C(_,"$enable_critical",function(){return this.critical=!0,this}),C(_,"$enable_fumble",function(){return this.fumble=!0,this}),C(_,"$enable_dollar",function(){return this.dollar=!0,this}),C(_,"$restrict_cmp_op_to",function(p){var Z;return Z=c(arguments),this.allowed_cmp_op=Z,this},-1),C(_,"$enable_question_target",function(){return this.question_target=!0,this}),C(_,"$parse",function(p){var Z=this;try{return Z.lexer=t("Lexer").$new(p,Z.notations),Z.$do_parse()}catch(X){if(!e.rescue(X,[t("ParseError"),t("ZeroDivisionError")]))throw X;try{return i}finally{e.pop_exception()}}}),_.$private(),C(_,"$parsed",function(p,Z,X,z){try{return H("eval_return"),P(t("Parsed").$new(),"tap",[],function ee(J){var _e,le,de,me,ve,fe,be,oe=null==ee.$$s?this:ee.$$s;return null==oe.round_type&&(oe.round_type=i),null==J&&(J=i),J["$command="](p["$[]"]("command")),J["$prefix_number="]((_e=p["$[]"]("prefix"))===i||null==_e?i:_e.$eval(oe.round_type)),J["$suffix_number="]((le=p["$[]"]("suffix"))===i||null==le?i:le.$eval(oe.round_type)),J["$critical="]((de=Z["$[]"]("critical"))===i||null==de?i:de.$eval(oe.round_type)),J["$fumble="]((me=Z["$[]"]("fumble"))===i||null==me?i:me.$eval(oe.round_type)),J["$dollar="]((ve=Z["$[]"]("dollar"))===i||null==ve?i:ve.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](z["$[]"]("cmp_op")),w(z["$[]"]("target"),"?")?(J["$question_target="](!0),P(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(be=z["$[]"]("target"),be===i||null==be?i:be.$eval(oe.round_type))],P(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),C(_,"$next_token",function(){return this.lexer.$next_token()}),g=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),o=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),$=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),G=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),V=[i,6,13,3,9,-1,27,-15,-10,-1,-38],ne=[i,i,i,i,i,i,19,16,15,i,i],ie=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=W(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(b[0],"Racc_arg",[g,n,$,o,G,Q,ne,V,19,ie,ce,58,35,!0]),N(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_arg")),M(b[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),N(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),M(b[0],"Racc_debug_parser",!1),C(_,"$_reduce_1",function(p,Z,X){var z;return N(this.modifier)||this.$raise(t("ParseError")),z=m(p),this.$parsed(null==z[0]?i:z[0],null==z[1]?i:z[1],null==z[2]?i:z[2],null==z[3]?i:z[3])}),C(_,"$_reduce_2",function(p,Z,X){var z;return N(this.modifier)||this.$raise(t("ParseError")),z=m(p),this.$parsed(null==z[0]?i:z[0],null==z[2]?i:z[2],null==z[1]?i:z[1],null==z[3]?i:z[3])}),C(_,"$_reduce_3",function(p,Z,X){var z,_e;return _e=null==(z=m(p))[2]?i:z[2],this.$parsed(null==z[0]?i:z[0],null==z[1]?i:z[1],D(D(t("Arithmetic"),"Node"),"Number").$new(0),_e)}),C(_,"$_reduce_4",function(p,Z,X){var z=this;return N(z.prefix_number)&&N(z.suffix_number)||z.$raise(t("ParseError")),Y(["command","prefix","suffix"],{command:p["$[]"](1),prefix:p["$[]"](0),suffix:p["$[]"](2)})}),C(_,"$_reduce_5",function(p,Z,X){var z=this;return N(z.prefix_number)||z.$raise(t("ParseError")),N(z.need_suffix_number)&&z.$raise(t("ParseError")),Y(["command","prefix"],{command:p["$[]"](1),prefix:p["$[]"](0)})}),C(_,"$_reduce_6",function(p,Z,X){var z=this;return N(z.suffix_number)||z.$raise(t("ParseError")),N(z.need_prefix_number)&&z.$raise(t("ParseError")),Y(["command","suffix"],{command:p["$[]"](0),suffix:p["$[]"](1)})}),C(_,"$_reduce_7",function(p,Z,X){var z=this;return(N(z.need_prefix_number)||N(z.need_suffix_number))&&z.$raise(t("ParseError")),Y(["command"],{command:p["$[]"](0)})}),C(_,"$_reduce_8",function(p,Z,X){return Y([],{})}),C(_,"$_reduce_9",function(p,Z,X){var z,_e,ee=i;return ee=null==(z=m(p))[0]?i:z[0],_e=null==z[2]?i:z[2],N(this.critical)&&N(ee["$[]"]("critical")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("critical",_e),ee}),C(_,"$_reduce_10",function(p,Z,X){var z,_e,ee=i;return ee=null==(z=m(p))[0]?i:z[0],_e=null==z[2]?i:z[2],N(this.fumble)&&N(ee["$[]"]("fumble")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("fumble",_e),ee}),C(_,"$_reduce_11",function(p,Z,X){var z,_e,ee=i;return ee=null==(z=m(p))[0]?i:z[0],_e=null==z[2]?i:z[2],N(this.dollar)&&N(ee["$[]"]("dollar")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("dollar",_e),ee}),C(_,"$_reduce_12",function(p,Z,X){return p["$[]"](1)}),C(_,"$_reduce_13",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"Negative").$new(p["$[]"](1))}),C(_,"$_reduce_14",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"+",p["$[]"](2))}),C(_,"$_reduce_15",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"-",p["$[]"](2))}),C(_,"$_reduce_16",function(p,Z,X){return N(this.allowed_cmp_op["$include?"](i))||this.$raise(t("ParseError")),Y([],{})}),C(_,"$_reduce_17",function(p,Z,X){var z,ee,J;return J=null==(z=m(p))[1]?i:z[1],N(this.allowed_cmp_op["$include?"](ee=null==z[0]?i:z[0]))||this.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:ee,target:J})}),C(_,"$_reduce_18",function(p,Z,X){var O,z=this;return O=p["$[]"](0),N(z.question_target)||z.$raise(t("ParseError")),N(z.allowed_cmp_op["$include?"](O))||z.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:O,target:"?"})}),C(_,"$_reduce_19",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"+",p["$[]"](2))}),C(_,"$_reduce_20",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"-",p["$[]"](2))}),C(_,"$_reduce_22",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"BinaryOp").$new(p["$[]"](0),"*",p["$[]"](2))}),C(_,"$_reduce_23",function(p,Z,X){return p["$[]"](3).$new(p["$[]"](0),p["$[]"](2))}),C(_,"$_reduce_25",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),C(_,"$_reduce_26",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"DivideWithCeil")}),C(_,"$_reduce_27",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"DivideWithCeil")}),C(_,"$_reduce_28",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"DivideWithRound")}),C(_,"$_reduce_29",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"DivideWithFloor")}),C(_,"$_reduce_30",function(p,Z,X){return p["$[]"](1)}),C(_,"$_reduce_31",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"Negative").$new(p["$[]"](1))}),C(_,"$_reduce_33",function(p,Z,X){return p["$[]"](1)}),C(_,"$_reduce_34",function(p,Z,X){return D(D(t("Arithmetic"),"Node"),"Number").$new(p["$[]"](0))}),C(_,"$_reduce_none",function(p,Z,X){return p["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var P,M,j,s,d,i,m,H,F=e.module,A=e.send,c=e.eqeqeq,B=e.truthy,R=e.def,S=e.return_val,U=[],E=e.nil;return P=U,M=H=[F(U[0],"BCDice")].concat(P),j=m=[F(H[0],"Deprecated")].concat(M),d=[s=F(m[0],"Checker")].concat(j),i=e.$r(d),s.$private(),R(s,"$check_result_legacy",function(r,a,v,I){var y,T=this,x=E,l=E,f=E,h=E;return x=A(a,"map",[],"sides".$to_proc()),y=(l=A(a,"map",[],"value".$to_proc())).$sum(),f=c([100],h=x)?T.$check_1D100(r,y,v,I):c([20],h)?T.$check_1D20(r,y,v,I):c([6,6],h)?T.$check_2D6(r,y,l,v,I):E,(B(f["$nil?"]())||B(f["$empty?"]()))&&(f=c([10],h=x.$uniq())?T.$check_nD10(r,y,l,v,I):c([6],h)?T.$check_nD6(r,y,l,v,I):E,B(f["$nil?"]())||B(f["$empty?"]()))?E:i("Result").$new(f.$delete_prefix(" \uff1e "))}),R(s,"$check_1D100",S(E)),R(s,"$check_1D20",S(E)),R(s,"$check_nD10",S(E)),R(s,"$check_2D6",S(E)),R(s,"$check_nD6",S(E))},Opal.modules["bcdice/base"]=function(e){var d,T,h,L,t,g,u,k,_,q,l,F=e.module,A=e.klass,c=e.slice,B=e.rb_plus,R=e.truthy,S=e.def,U=e.regexp,E=e.send,C=e.thrower,P=e.return_ivar,w=e.assign_ivar_val,H=e.eqeqeq,W=e.eqeq,M=e.return_val,N=e.range,m=e.rb_minus,Y=e.rb_divide,j=e.rb_times,s=e.rb_ge,i=e.top,D=[],r=e.$r(D),a=e.nil,v=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),T=D,h=l=[F(D[0],"BCDice")].concat(T),k=[u=A(l[0],null,"Base")].concat(h),_=e.$r(k),(q=u.$$prototype).raw_input=q.randomizer=q.enabled_upcase_input=q.debug=a,t=[L=e.get_singleton_class(u)].concat(k),g=e.$r(t),L.$attr_reader("prefixes"),S(L,"$register_prefix",function(o){var G,V,Q=this;return null==Q.prefixes&&(Q.prefixes=a),G=c(arguments),Q.prefixes=B(R(V=Q.prefixes)?V:[],G.$flatten())},-1),S(L,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),S(L,"$prefixes_pattern",function(){var o=this,$=a;return null==o.prefixes_pattern&&(o.prefixes_pattern=a),null==o.prefixes&&(o.prefixes=a),o.prefixes_pattern=R($=o.prefixes_pattern)?$:a,R(o.prefixes_pattern)?o.prefixes_pattern:(o.prefixes=R($=o.prefixes)?$:[],o.prefixes.$freeze(),o.prefixes_pattern=(R(o.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",o.prefixes.$join("|"),")"],"i")).$freeze())}),S(L,"$command_pattern",function(){var o=this,$=a,G=a;return null==o.command_pattern&&(o.command_pattern=a),null==o.prefixes&&(o.prefixes=a),o.command_pattern=R($=o.command_pattern)?$:a,R(o.command_pattern)?o.command_pattern:(o.prefixes=R($=o.prefixes)?$:[],o.prefixes.$freeze(),G=B(E(v(g("CommonCommand"),"COMMANDS"),"map",[],function(V){return null==V&&(V=a),v(V,"PREFIX_PATTERN").$source()}),o.prefixes),o.command_pattern=U(["^S?(",G.$join("|"),")"],"i").$freeze())}),S(L,"$eval",function(o){try{return C("eval_return"),this.$new(o).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),u.$include(_("Translate")),u.$include(v(_("Deprecated"),"Checker")),S(u,"$initialize",function(b){var t=this;return t.raw_input=b,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=v(_("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=v(_("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=a,t.reroll_dice_reroll_threshold=a,t.default_cmp_op=a,t.default_target_number=a,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=v(_("BCDice"),"Randomizer").$new(),t.debug=!1}),u.$attr_accessor("randomizer"),u.$attr_reader("d66_sort_type"),u.$attr_reader("round_type"),u.$attr_reader("sides_implicit_d"),u.$attr_reader("upper_dice_reroll_threshold"),u.$attr_reader("reroll_dice_reroll_threshold"),u.$attr_reader("default_cmp_op"),u.$attr_reader("default_target_number"),S(u,"$sort_add_dice?",P("sort_add_dice")),S(u,"$sort_barabara_dice?",P("sort_barabara_dice")),S(u,"$enabled_d9?",P("enabled_d9")),S(u,"$enable_debug",w("debug",!0)),S(u,"$eval",function(){var t,n,b=this,g=a;return t=v(_("BCDice"),"Preprocessor").$process(b.raw_input,b),g=R(n=b.$dice_command(t))?n:b.$eval_common_command(b.raw_input),R(g)?(g["$rands="](b.randomizer.$rand_results()),g["$detailed_rands="](b.randomizer.$detailed_rand_results()),g):a}),S(u,"$change_text",function(b){return b}),S(u,"$check_result",function(b,t,g,n){var o=this,$=a,G=a,Q=a,V=a,ne=a;return $=o.$check_result_legacy(b,t,g,n),R($)?$:(G=E(t,"map",[],"sides".$to_proc()),V=(Q=E(t,"map",[],"value".$to_proc())).$sum(),$=H([100],ne=G)?o.$result_1d100(b,V,g,n):H([20],ne)?o.$result_1d20(b,V,g,n):H([6,6],ne)?o.$result_2d6(b,V,Q,g,n):a,W($,_("Result").$nothing())?a:R($)?$:($=H([10],ne=G.$uniq())?o.$result_nd10(b,V,Q,g,n):H([6],ne)?o.$result_nd6(b,V,Q,g,n):a,W($,_("Result").$nothing())?a:R($)?$:o.$result_ndx(b,g,n)))}),S(u,"$grich_text",M(a)),u.$private(),S(u,"$eval_common_command",function(b){try{C("eval_return");var g=C("return");return b=this.$change_text(b),E(v(_("CommonCommand"),"COMMANDS"),"each",[],function o($){var Q,G=null==o.$$s?this:o.$$s;if(null==G.randomizer&&(G.randomizer=a),null==$&&($=a),Q=$.$eval(b,G,G.randomizer),!R(Q))return a;g.$throw(Q)},{$$s:this,$$ret:g}),a}catch(o){if(o===e.t_eval_return||o===g)return o.$v;throw o}}),S(u,"$dice_command",function(b){var t=this,g=a,n=a,o=a,$=a;return R(t.enabled_upcase_input)&&(b=b.$upcase()),g=t.$class().$prefixes_pattern().$match(b),R(g)?(n=g["$[]"](1)["$nil?"]()["$!"](),R(n)&&(b=b["$[]"](N(1,-1,!1))),o=t.$eval_game_system_specific_command(b),R(o["$is_a?"](_("Result")))?(o["$secret="](R($=o["$secret?"]())?$:n),o):R(o["$nil?"]())||R(o["$empty?"]())||W(o,"1")?a:E(_("Result").$new(),"tap",[],function(Q){var V;return null==Q&&(Q=a),Q["$text="](o.$to_s()),E(Q,"secret=",V=[n]),V[V.length-1]})):a}),S(u,"$eval_game_system_specific_command",M(a)),S(u,"$result_ndx",function(b,t,g){return R(g["$is_a?"](_("String")))?a:R(b.$send(t,g))?_("Result").$success(this.$translate("success")):_("Result").$failure(this.$translate("failure"))}),S(u,"$result_1d100",M(a)),S(u,"$result_1d20",M(a)),S(u,"$result_nd10",M(a)),S(u,"$result_2d6",M(a)),S(u,"$result_nd6",M(a)),S(u,"$get_table_by_2d6",function(b){return this.$get_table_by_nD6(b,2)}),S(u,"$get_table_by_1d6",function(b){return this.$get_table_by_nD6(b,1)}),S(u,"$get_table_by_nD6",function(b,t){return this.$get_table_by_nDx(b,t,6)}),S(u,"$get_table_by_nDx",function(b,t,g){var o,$=a;return o=this.randomizer.$roll_sum(t,g),$=this.$get_table_value(b["$[]"](m(o,t))),R($["$nil?"]())?["1",0]:[$,o]}),S(u,"$get_table_by_1d3",function(b){var n,o,t=this,$=a;return t.$debug("get_table_by_1d3"),n=t.randomizer.$roll_sum(1,6),t.$debug("num",n),o=Y(m(n,1),2).$to_i(),t.$debug("index",o),$=b["$[]"](o),R($["$nil?"]())?["1",0]:[$,n]}),S(u,"$get_table_by_d66_swap",function(b){var g;return g=this.randomizer.$roll_d66(v(_("D66SortType"),"ASC")),[this.$get_table_by_number(g,b),g]}),S(u,"$get_table_by_d66",function(b){var g,n,o,G,$=a;return g=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),o=B(j(m(g,1),6),m(n,1)),$=b["$[]"](o),G=""+g+n,R($["$nil?"]())?["1",G]:[$,G]}),S(u,"$get_table_by_number",function(b,t,g){try{var n=C("return");return null==g&&(g="1"),E(t,"each",[],function $(G){var V,Q=null==$.$$s?this:$.$$s;if(null==G&&(G=a),V=G["$[]"](0),!R(s(V,b)))return a;n.$throw(Q.$get_table_value(G["$[]"](1)))},{$$s:this,$$ret:n}),this.$get_table_value(g)}catch($){if($===n)return $.$v;throw $}},-3),S(u,"$get_table_value",function(b){return R(b["$is_a?"](_("Proc")))?b.$call():b}),S(u,"$roll_tables",function(b,t){var n=a;return n=t["$[]"](b),R(n)?n.$roll(this.randomizer).$to_s():a}),S(u,"$debug",function(b,t){var n,o=this,$=a,G=a;return n=c(arguments,1),R(o.debug)?($=R(b["$is_a?"](_("String")))?b:b.$inspect(),R(n["$empty?"]())?o.$warn($):(G=E(n,"map",[],function(V){return null==V&&(V=a),R(V["$is_a?"](_("String")))?'"'+V+'"':V.$inspect()}),o.$warn($+": "+G.$join(", ")))):a},-2),v(v(r("I18n"),"Backend"),"Simple").$include(v(v(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),d=[["ja_jp"]],E(r("I18n").$fallbacks(),"defaults=",d),d[d.length-1]},Opal.queue(function(e){var s,r,l,y,f,h,v,I,i,F=e.module,A=e.klass,c=e.const_set,B=e.hash2,R=e.truthy,S=e.eqeq,U=e.send,E=e.rb_plus,C=e.rb_times,P=e.def,w=e.not,H=e.rb_le,W=e.rb_ge,N=[],m=e.nil,Y=e.$$$;return e.top.$require("bcdice/base"),s=N,r=i=[F(N[0],"BCDice")].concat(s),v=[F(i[0],"GameSystem")].concat(r),I=e.$r(v),l=v,f=[y=A(v[0],I("Base"),"SamsaraBallad")].concat(l),h=e.$r(f),y.$$prototype.randomizer=m,c(f[0],"ID","SamsaraBallad"),c(f[0],"NAME","\u30b5\u30f3\u30b5\u30fc\u30e9\u30fb\u30d0\u30e9\u30c3\u30c9"),c(f[0],"SORT_KEY","\u3055\u3093\u3055\u3042\u3089\u306f\u3089\u3064\u3068"),c(f[0],"HELP_MESSAGE","SB\t \u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS\t \u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSB#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u901a\u5e38\u306eD100\u30ed\u30fc\u30eb\u3092\u884c\u3046\nSBS#x@y\t F\u5024\u3092x\u3001C\u5024\u3092y\u3068\u3057\u3066\u30b9\u30ef\u30c3\u30d7\u30ed\u30fc\u30eb\u3067D100\u30ed\u30fc\u30eb\u3092\u884c\u3046\n\n\u4f8b\uff1a\nSB<=85 \u901a\u5e38\u306e\u6280\u80fd\u3067\u6210\u529f\u738785%\u306e\u5224\u5b9a\nSBS<=70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u6210\u529f\u738770%\u306e\u5224\u5b9a\nSBS#3@7<=80 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001F\u50243\u3001C\u50247\u3067\u6210\u529f\u738780%\u306e\u653b\u6483\u5224\u5b9a\nSB<57 \u901a\u5e38\u306e\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c57\u306e\u53d7\u52d5\u5224\u5b9a\nSBS<70 \u7fd2\u719f\u3092\u5f97\u305f\u6280\u80fd\u3067\u3001\u80fd\u52d5\u5074\u306e\u9054\u6210\u5024\u304c70\u306e\u53d7\u52d5\u5224\u5b9a\n"),y.$register_prefix("SBS?"),P(y,"$eval_game_system_specific_command",function(_){var q=this,b=m,t=m,g=m,n=m,o=m,$=m,G=m,Q=m,V=m,ne=m;return q.$debug("eval_game_system_specific_command Begin"),b=Y(h("Command"),"Parser").$new("SBS","SB",B(["round_type"],{round_type:q.$round_type()})).$enable_critical().$enable_fumble().$restrict_cmp_op_to(m,"<=","<").$parse(_),R(b)?(S(b.$command(),"SB")?(t=m,g=q.randomizer.$roll_once(100)):(t=(n=q.randomizer.$roll_once(10))+","+(o=q.randomizer.$roll_once(10)),$=U([n,o],"map",[],function(ue){return null==ue&&(ue=m),S(ue,10)?0:ue}).$sort(),g=E(C($["$[]"](0),10),$["$[]"](1)),S(g,0)&&(g=100)),G=q.$compare(g,b),Q=R(G["$failure?"]())?"\u5931\u6557":R(G["$success?"]())?"\u6210\u529f":m,V=R(G["$fumble?"]())?"\u30d5\u30a1\u30f3\u30d6\u30eb":R(G["$critical?"]())?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb":m,ne=["(D100"+b.$cmp_op()+b.$target_number()+")",t,g.$to_s(),Q,V].$compact(),G["$text="](ne.$join(" \uff1e ")),G):m}),y.$private(),P(y,"$compare",function(_,q){var L=this;return R(["<=","<"]["$include?"](q.$cmp_op()))?w(_.$send(q.$cmp_op(),q.$target_number()))?h("Result").$failure(m):R(L["$fumble_?"](_,q.$fumble()))?U(h("Result").$new(),"tap",[],function(t){var g;return null==t&&(t=m),t["$success="](!0),U(t,"fumble=",g=[!0]),g[g.length-1]}):R(L["$critical_?"](_,q.$critical()))?h("Result").$critical(m):h("Result").$success(m):R(L["$fumble_?"](_,q.$fumble()))?U(h("Result").$new(),"tap",[],function(t){var g;return null==t&&(t=m),U(t,"fumble=",g=[!0]),g[g.length-1]}):R(L["$critical_?"](_,q.$critical()))?U(h("Result").$new(),"tap",[],function(t){var g;return null==t&&(t=m),U(t,"critical=",g=[!0]),g[g.length-1]}):h("Result").$new()}),P(y,"$fumble_?",function(_,q){var L;return R(L=q)?H(_["$%"](10),q):L}),P(y,"$critical_?",function(_,q){var L;return R(L=q)?W(_["$%"](10),q):L})})}}]);