(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[6379],{36379:function(e,t,r){r(93683),Opal.modules["bcdice/format"]=function(e){var t,r,n,$,a,i,c,o=[],u=e.nil,s=e.$$,_=e.module,l=e.truthy;return t=o,r=c=[_(o[0],"BCDice")].concat(t),a=_(c[0],"Format"),i=[a].concat(r),a.$module_function(),e.def(a,"$comparison_operator",n=function(e){var t;return"=="["$==="](t=e)?"=":"!="["$==="](t)?"<>":s(i,"Symbol")["$==="](t)?e.$to_s():u},n.$$arity=1),void e.def(a,"$modifier",$=function(e){return l(e["$nil?"]())?u:e["$=="](0)?"":l("number"==typeof(t=e)?t>0:t["$>"](0))?"+"+e:e.$to_s();var t},$.$$arity=1)},Opal.modules["racc/parser"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e<t:e["$<"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function $(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function i(e,t){return"number"==typeof e&&"number"==typeof t?e<=t:e["$<="](t)}var c,o,u,s,_,l=[],d=e.nil,f=e.$$$,p=e.$$,m=e.module,y=e.klass,h=e.truthy,g=e.gvars,b=e.send;return s=l,c=(_=[m(l[0],"Racc")].concat(s))[0],o=p(_,"StandardError"),u=_,[y(c,o,"ParseError")].concat(u),h(f("::","ParseError","skip_raise")?"constant":d)||e.const_set(l[0],"ParseError",f(p(l,"Racc"),"ParseError")),function(c,o){var u,s,_,l,R,v,T,w,E,x,L,D,O,S,k,A,M,C,I,N,P,H,B,G,z,U,F,q=[m(c,"Racc")].concat(o);h(p(q,"Racc_No_Extensions","skip_raise")?"constant":d)||e.const_set(q[0],"Racc_No_Extensions",!1),u=q,U=y(q[0],null,"Parser"),F=[U].concat(u),U.$$prototype.yydebug=U.$$prototype.racc_debug_out=U.$$prototype.racc_error_status=U.$$prototype.racc_t=U.$$prototype.racc_vstack=U.$$prototype.racc_val=U.$$prototype.racc_state=U.$$prototype.racc_tstack=d,e.const_set(F[0],"Racc_Runtime_Version","1.4.6"),e.const_set(F[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),e.const_set(F[0],"Racc_Runtime_Core_Version_R","1.4.6"),e.const_set(F[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),e.const_set(F[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),e.const_set(F[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),e.const_set(F[0],"Racc_Runtime_Core_Version",p(F,"Racc_Runtime_Core_Version_R")),e.const_set(F[0],"Racc_Runtime_Core_Revision",p(F,"Racc_Runtime_Core_Revision_R")),e.const_set(F[0],"Racc_Runtime_Type","ruby"),e.defs(p(F,"Parser"),"$racc_runtime_type",s=function(){return p(F,"Racc_Runtime_Type")},s.$$arity=0),e.def(U,"$_racc_setup",_=function(){var n,$,a=this,i=d,c=d,o=d;return null==g.stderr&&(g.stderr=d),h(f(a.$class(),"Racc_debug_parser"))||(a.yydebug=!1),h(null!=(n=a.yydebug)&&n!==d?"instance-variable":d)||(a.yydebug=!1),h(a.yydebug)&&(h(null!=($=a.racc_debug_out)&&$!==d?"instance-variable":d)||(a.racc_debug_out=g.stderr),a.racc_debug_out=h(i=a.racc_debug_out)?i:g.stderr),c=f(a.$class(),"Racc_arg"),h(t(c.$size(),14))&&(b(c,"[]=",e.to_a(o=[13,!0])),r(o.length,1)),c},_.$$arity=0),e.def(U,"$_racc_init_sysvars",l=function(){var e=this;return e.racc_state=[0],e.racc_tstack=[],e.racc_vstack=[],e.racc_t=d,e.racc_val=d,e.racc_read_next=!0,e.racc_user_yyerror=!1,e.racc_error_status=0},l.$$arity=0),e.def(U,"$do_parse",R=function(){return this.$__send__(p(F,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},R.$$arity=0),e.def(U,"$next_token",v=function(){return this.$raise(p(F,"NotImplementedError"),this.$class()+"#next_token is not defined")},v.$$arity=0),e.def(U,"$_racc_do_parse_rb",T=function(t,r){var a,i,c=this,o=d,u=d,s=d,_=d,l=d,f=d,p=d,m=d;return a=e.to_ary(t),o=null==a[0]?d:a[0],u=null==a[1]?d:a[1],s=null==a[2]?d:a[2],_=null==a[3]?d:a[3],l=null==a[10]?d:a[10],c.$_racc_init_sysvars(),f=p=m=d,b(c,"catch",["racc_end_parse"],((i=function(){var r,a,c=null==i.$$s?this:i.$$s,y=d,g=d,b=d;for(null==c.racc_state&&(c.racc_state=d),null==c.racc_read_next&&(c.racc_read_next=d),null==c.racc_t&&(c.racc_t=d),null==c.yydebug&&(c.yydebug=d),null==c.racc_val&&(c.racc_val=d);h(!0);)for(h(m=_["$[]"](c.racc_state["$[]"](-1)))?(h(c.racc_read_next)&&h(c.racc_t["$!="](0))&&(a=c.$next_token(),r=e.to_ary(a),f=null==r[0]?d:r[0],c.racc_val=null==r[1]?d:r[1],c.racc_t=h(f)?h(y=l["$[]"](f))?y:1:0,h(c.yydebug)&&c.$racc_read_token(c.racc_t,f,c.racc_val),c.racc_read_next=!1),m=n(m,c.racc_t),h(h(g=h(b=$(m,0))?p=o["$[]"](m):b)?u["$[]"](m)["$=="](c.racc_state["$[]"](-1)):g)||(p=s["$[]"](c.racc_state["$[]"](-1)))):p=s["$[]"](c.racc_state["$[]"](-1));h(p=c.$_racc_evalact(p,t)););}).$$s=c,i.$$arity=0,i))},T.$$arity=2),e.def(U,"$yyparse",w=function(e,t){return this.$__send__(p(F,"Racc_YY_Parse_Method"),e,t,this.$_racc_setup(),!0)},w.$$arity=2),e.def(U,"$_racc_yyparse_rb",E=function(t,r,a,i){var c,o,u=d,s=d,_=d,l=d,f=d,p=d,m=d;return c=e.to_ary(a),u=null==c[0]?d:c[0],s=null==c[1]?d:c[1],_=null==c[2]?d:c[2],l=null==c[3]?d:c[3],f=null==c[10]?d:c[10],this.$_racc_init_sysvars(),p=d,m=d,b(this,"catch",["racc_end_parse"],((o=function(){var e,i=null==o.$$s?this:o.$$s;for(null==i.racc_state&&(i.racc_state=d);!h(m=l["$[]"](i.racc_state["$[]"](-1)));)for(;h(p=i.$_racc_evalact(_["$[]"](i.racc_state["$[]"](-1)),a)););return b(t,"__send__",[r],((e=function(t,r){var i,c,o=null==e.$$s?this:e.$$s,y=d,g=d,b=d,R=d,v=d,T=d,w=d;for(null==o.racc_t&&(o.racc_t=d),null==o.racc_state&&(o.racc_state=d),null==o.racc_read_next&&(o.racc_read_next=d),null==t&&(t=d),null==r&&(r=d),o.racc_t=h(t)?h(y=f["$[]"](t))?y:1:0,o.racc_val=r,o.racc_read_next=!1,m=n(m,o.racc_t),h(h(i=h(c=$(m,0))?p=u["$[]"](m):c)?s["$[]"](m)["$=="](o.racc_state["$[]"](-1)):i)||(p=_["$[]"](o.racc_state["$[]"](-1)));h(p=o.$_racc_evalact(p,a)););for(;h(h(g=h(b=(m=l["$[]"](o.racc_state["$[]"](-1)))["$!"]())?b:o.racc_read_next["$!"]())?g:o.racc_t["$=="](0));)for(h(h(R=h(v=h(T=h(w=m)?m=n(m,o.racc_t):w)?$(m,0):T)?p=u["$[]"](m):v)?s["$[]"](m)["$=="](o.racc_state["$[]"](-1)):R)||(p=_["$[]"](o.racc_state["$[]"](-1)));h(p=o.$_racc_evalact(p,a)););}).$$s=i,e.$$arity=2,e))}).$$s=this,o.$$arity=0,o))},E.$$arity=4),e.def(U,"$_racc_evalact",x=function(c,o){var u,s,_,l,f=this,p=d,m=d,y=d,g=d,R=d,v=d,T=d,w=d,E=d,x=d;if(p=null==(u=e.to_ary(o))[0]?d:u[0],m=null==u[1]?d:u[1],y=null==u[3]?d:u[3],_=null==u[11]?d:u[11],g=null==u[12]?d:u[12],h(h(l=a(c,0))?t(c,_):l))h(a(f.racc_error_status,0))&&(f.racc_t["$=="](1)||(f.racc_error_status=r(f.racc_error_status,1))),f.racc_vstack.$push(f.racc_val),f.racc_state.$push(c),f.racc_read_next=!0,h(f.yydebug)&&(f.racc_tstack.$push(f.racc_t),f.$racc_shift(f.racc_t,f.racc_tstack,f.racc_vstack));else if(h(h(R=t(c,0))?a(c,g["$-@"]()):R)){if(v=b(f,"catch",["racc_jump"],((s=function(){var e=null==s.$$s?this:s.$$s;return null==e.racc_state&&(e.racc_state=d),e.racc_state.$push(e.$_racc_do_reduce(o,c)),!1}).$$s=f,s.$$arity=0,s)),h(v)){if(1["$==="](T=v))return f.racc_user_yyerror=!0,g["$-@"]();if(2["$==="](T))return _;f.$raise("[Racc Bug] unknown jump code")}}else if(c["$=="](_))h(f.yydebug)&&f.$racc_accept(),f.$throw("racc_end_parse",f.racc_vstack["$[]"](0));else{if(c["$=="](g["$-@"]())){for((0)["$==="](T=f.racc_error_status)?h(o["$[]"](21))||f.$on_error(f.racc_t,f.racc_val,f.racc_vstack):3["$==="](T)&&(f.racc_t["$=="](0)&&f.$throw("racc_end_parse",d),f.racc_read_next=!0),f.racc_user_yyerror=!1,f.racc_error_status=3;h(!0)&&(!h(w=y["$[]"](f.racc_state["$[]"](-1)))||(w=n(w,1),!h(h(E=h(x=$(w,0))?c=p["$[]"](w):x)?m["$[]"](w)["$=="](f.racc_state["$[]"](-1)):E)));)h(i(f.racc_state.$size(),1))&&f.$throw("racc_end_parse",d),f.racc_state.$pop(),f.racc_vstack.$pop(),h(f.yydebug)&&(f.racc_tstack.$pop(),f.$racc_e_pop(f.racc_state,f.racc_tstack,f.racc_vstack));return c}f.$raise("[Racc Bug] unknown action "+c.$inspect())}return h(f.yydebug)&&f.$racc_next_state(f.racc_state["$[]"](-1),f.racc_state),d},x.$$arity=2),e.def(U,"$_racc_do_reduce",L=function(t,a){var i,c,o,u,s,_,l,f=this,p=d,m=d,y=d,g=d,R=d,v=d,T=d,w=d,E=d,x=d,L=d,D=d,O=d,S=d,k=d,A=d;return p=null==(i=e.to_ary(t))[4]?d:i[4],m=null==i[5]?d:i[5],y=null==i[6]?d:i[6],g=null==i[7]?d:i[7],c=null==i[8]?d:i[8],R=null==i[9]?d:i[9],o=null==i[13]?d:i[13],v=f.racc_state,T=f.racc_vstack,w=f.racc_tstack,E=function(e,t){return"number"==typeof e?-3*e:e["$*"](-3)}(a),x=R["$[]"](E),u=R["$[]"](n(E,1)),s=R["$[]"](n(E,2)),_=[],h(f.yydebug)&&(L=w["$[]"](x["$-@"](),x)),D=T["$[]"](x["$-@"](),x),h(f.yydebug)&&(O=[x["$-@"](),x,_],b(w,"[]=",e.to_a(O)),r(O.length,1)),O=[x["$-@"](),x,_],b(T,"[]=",e.to_a(O)),r(O.length,1),O=[x["$-@"](),x,_],b(v,"[]=",e.to_a(O)),r(O.length,1),h(o)?T.$push(f.$__send__(s,D,T,D["$[]"](0))):T.$push(f.$__send__(s,D,T)),w.$push(u),h(f.yydebug)&&f.$racc_reduce(L,u,w,T),l=r(u,c),h(E=g["$[]"](l))&&(E=n(E,v["$[]"](-1)),h(h(S=h(k=$(E,0))?A=p["$[]"](E):k)?m["$[]"](E)["$=="](l):S))?A:y["$[]"](l)},L.$$arity=2),e.def(U,"$on_error",D=function(e,t,r){var n,$=this;return $.$raise(p(F,"ParseError"),$.$sprintf("\nparse error on value %s (%s)",t.$inspect(),h(n=$.$token_to_str(e))?n:"?"))},D.$$arity=3),e.def(U,"$yyerror",O=function(){return this.$throw("racc_jump",1)},O.$$arity=0),e.def(U,"$yyaccept",S=function(){return this.$throw("racc_jump",2)},S.$$arity=0),e.def(U,"$yyerrok",k=function(){return this.racc_error_status=0},k.$$arity=0),e.def(U,"$racc_read_token",A=function(e,t,r){var n=this;return n.racc_debug_out.$print("read    "),n.racc_debug_out.$print(t.$inspect(),"(",n.$racc_token2str(e),") "),n.racc_debug_out.$puts(r.$inspect()),n.racc_debug_out.$puts()},A.$$arity=3),e.def(U,"$racc_shift",M=function(e,t,r){var n=this;return n.racc_debug_out.$puts("shift   "+n.$racc_token2str(e)),n.$racc_print_stacks(t,r),n.racc_debug_out.$puts()},M.$$arity=3),e.def(U,"$racc_reduce",C=function(e,t,r,n){var $,a=this,i=d;return(i=a.racc_debug_out).$print("reduce "),h(e["$empty?"]())?i.$print(" <none>"):b(e,"each",[],(($=function(e){return null==e&&(e=d),i.$print(" ",(null==$.$$s?this:$.$$s).$racc_token2str(e))}).$$s=a,$.$$arity=1,$)),i.$puts(" --\x3e "+a.$racc_token2str(t)),a.$racc_print_stacks(r,n),a.racc_debug_out.$puts()},C.$$arity=4),e.def(U,"$racc_accept",I=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},I.$$arity=0),e.def(U,"$racc_e_pop",N=function(e,t,r){var n=this;return n.racc_debug_out.$puts("error recovering mode: pop token"),n.$racc_print_states(e),n.$racc_print_stacks(t,r),n.racc_debug_out.$puts()},N.$$arity=3),e.def(U,"$racc_next_state",P=function(e,t){var r=this;return r.racc_debug_out.$puts("goto    "+e),r.$racc_print_states(t),r.racc_debug_out.$puts()},P.$$arity=2),e.def(U,"$racc_print_stacks",H=function(e,t){var r,n=d;return(n=this.racc_debug_out).$print("        ["),b(e,"each_index",[],((r=function($){return null==$&&($=d),n.$print(" (",(null==r.$$s?this:r.$$s).$racc_token2str(e["$[]"]($))," ",t["$[]"]($).$inspect(),")")}).$$s=this,r.$$arity=1,r)),n.$puts(" ]")},H.$$arity=2),e.def(U,"$racc_print_states",B=function(e){var t,r=d;return(r=this.racc_debug_out).$print("        ["),b(e,"each",[],((t=function(e){return null==e&&(e=d),r.$print(" ",e)}).$$s=this,t.$$arity=1,t)),r.$puts(" ]")},B.$$arity=1),e.def(U,"$racc_token2str",G=function(e){var t;return h(t=f(this.$class(),"Racc_token_to_s_table")["$[]"](e))?t:this.$raise("[Racc Bug] can't convert token "+e+" to string")},G.$$arity=1),e.def(U,"$token_to_str",z=function(e){return f(this.$class(),"Racc_token_to_s_table")["$[]"](e)},z.$$arity=1)}(l[0],l)},Opal.modules["bcdice/arithmetic/node"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}var r,n,$,a,i,c,o,u,s,_,l,d,f,p,m,y,h,g=[],b=e.nil,R=e.$$$,v=e.$$,T=e.module,w=e.klass,E=e.send2;return r=g,n=h=[T(g[0],"BCDice")].concat(r),$=y=[T(h[0],"Arithmetic")].concat(n),function(t,r,n){var $,a,i,c,o,u=w(t,null,"BinaryOp");[u].concat(n),u.$$prototype.lhs=u.$$prototype.rhs=u.$$prototype.op=b,e.def(u,"$initialize",$=function(e,t,r){var n=this;return n.lhs=e,n.op=t,n.rhs=r},$.$$arity=3),e.def(u,"$eval",a=function(e){var t,r=this,n=b;return n=r.lhs.$eval(e),t=r.rhs.$eval(e),n.$send(r.op,t)},a.$$arity=1),e.def(u,"$output",i=function(){var e=this;return""+e.lhs.$output()+e.op+e.rhs.$output()},i.$$arity=0),e.def(u,"$s_exp",c=function(){var e=this;return"("+e.$op_for_s_exp()+" "+e.lhs.$s_exp()+" "+e.rhs.$s_exp()+")"},c.$$arity=0),e.def(u,"$op_for_s_exp",o=function(){return this.op},o.$$arity=0)}((m=[T(y[0],"Node")].concat($))[0],0,m),a=m[0],i=v(m,"BinaryOp"),c=m,f=w(a,i,"DivideBase"),p=[f].concat(c),f.$$prototype.lhs=f.$$prototype.rhs=f.$$prototype.op=b,e.def(f,"$initialize",o=function(t,r){return o.$$p&&(o.$$p=null),E(this,e.find_super_dispatcher(this,"initialize",o,!1,!0),"initialize",[t,"/",r],null)},o.$$arity=2),e.def(f,"$eval",u=function(e){var t,r=b;return t=this.lhs.$eval(e),(r=this.rhs.$eval(e))["$=="](0)&&this.$raise(v(p,"ZeroDivisionError")),this.$divide_and_round(t,r,e)},u.$$arity=1),e.def(f,"$output",s=function(){var t=s.$$p,r=this,n=b,$=b,a=b;for(t&&(s.$$p=null),$=0,a=arguments.length,n=new Array(a);$<a;$++)n[$]=arguments[$];return""+E(r,e.find_super_dispatcher(r,"output",s,!1,!0),"output",n,t)+r.$rounding_method()},s.$$arity=0),f.$private(),e.def(f,"$rounding_method",_=function(){return R(this.$class(),"ROUNDING_METHOD")},_.$$arity=0),e.def(f,"$op_for_s_exp",l=function(){return""+this.op+this.$rounding_method()},l.$$arity=0),e.def(f,"$divide_and_round",d=function(e,t,r){return this.$raise(v(p,"NotImplementedError"))},d.$$arity=3),function(r,n,$){var a,i=w(r,n,"DivideWithGameSystemDefault"),c=[i].concat($);e.const_set(c[0],"ROUNDING_METHOD",""),i.$private(),e.def(i,"$divide_and_round",a=function(e,r,n){var $;return $=n,R(v(c,"RoundType"),"CEIL")["$==="]($)?t(e.$to_f(),r).$ceil():R(v(c,"RoundType"),"ROUND")["$==="]($)?t(e.$to_f(),r).$round():t(e,r).$to_i()},a.$$arity=3)}(m[0],v(m,"DivideBase"),m),function(r,n,$){var a,i=w(r,n,"DivideWithCeil"),c=[i].concat($);e.const_set(c[0],"ROUNDING_METHOD","C"),i.$private(),e.def(i,"$divide_and_round",a=function(e,r,n){return t(e.$to_f(),r).$ceil()},a.$$arity=3)}(m[0],v(m,"DivideBase"),m),function(r,n,$){var a,i=w(r,n,"DivideWithRound"),c=[i].concat($);e.const_set(c[0],"ROUNDING_METHOD","R"),i.$private(),e.def(i,"$divide_and_round",a=function(e,r,n){return t(e.$to_f(),r).$round()},a.$$arity=3)}(m[0],v(m,"DivideBase"),m),function(r,n,$){var a,i=w(r,n,"DivideWithFloor"),c=[i].concat($);e.const_set(c[0],"ROUNDING_METHOD","F"),i.$private(),e.def(i,"$divide_and_round",a=function(e,r,n){return t(e,r).$to_i()},a.$$arity=3)}(m[0],v(m,"DivideBase"),m),function(t,r,n){var $,a,i,c,o=w(t,null,"Negative");[o].concat(n),o.$$prototype.body=b,e.def(o,"$initialize",$=function(e){return this.body=e},$.$$arity=1),e.def(o,"$eval",a=function(e){return this.body.$eval(e)["$-@"]()},a.$$arity=1),e.def(o,"$output",i=function(){return"-"+this.body.$output()},i.$$arity=0),e.def(o,"$s_exp",c=function(){return"(- "+this.body.$s_exp()+")"},c.$$arity=0)}(m[0],0,m),function(t,r,n){var $,a,i,c,o=w(t,null,"Parenthesis");[o].concat(n),o.$$prototype.expr=b,e.def(o,"$initialize",$=function(e){return this.expr=e},$.$$arity=1),e.def(o,"$eval",a=function(e){return this.expr.$eval(e)},a.$$arity=1),e.def(o,"$output",i=function(){return"("+this.expr.$output()+")"},i.$$arity=0),e.def(o,"$s_exp",c=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},c.$$arity=0)}(m[0],0,m),void function(t,r,n){var $,a,i,c=w(t,null,"Number");[c].concat(n),c.$$prototype.value=b,e.def(c,"$initialize",$=function(e){return this.value=e},$.$$arity=1),e.def(c,"$eval",a=function(e){return this.value},a.$$arity=1),e.def(c,"$output",i=function(){return this.value.$to_s()},i.$$arity=0),e.alias(c,"s_exp","output")}(m[0],0,m)},Opal.modules.strscan=function(e){var t,r,n,$,a,i,c,o,u,s,_,l,d,f,p,m,y,h,g,b,R,v,T,w,E,x,L,D,O=[],S=e.nil,k=e.$$,A=e.truthy,M=e.send;return t=O,L=(0,e.klass)(O[0],null,"StringScanner"),D=[L].concat(t),L.$$prototype.pos=L.$$prototype.string=L.$$prototype.working=L.$$prototype.matched=L.$$prototype.prev_pos=L.$$prototype.match=S,L.$attr_reader("pos"),L.$attr_reader("matched"),e.def(L,"$initialize",r=function(e){var t=this;return t.string=e,t.pos=0,t.matched=S,t.working=e,t.match=[]},r.$$arity=1),L.$attr_reader("string"),e.def(L,"$beginning_of_line?",n=function(){var e=this;return 0===e.pos||"\n"===e.string.charAt(e.pos-1)},n.$$arity=0),e.alias(L,"bol?","beginning_of_line?"),e.def(L,"$scan",$=function(e){var t=this,r=(e=t.$anchor(e)).exec(t.working);return null==r?t.matched=S:"object"==typeof r?(t.prev_pos=t.pos,t.pos+=r[0].length,t.working=t.working.substring(r[0].length),t.matched=r[0],t.match=r,r[0]):"string"==typeof r?(t.pos+=r.length,t.working=t.working.substring(r.length),r):S},$.$$arity=1),e.def(L,"$scan_until",a=function(e){var t=this;e=t.$anchor(e);for(var r,n=t.pos,$=t.working;;){if(r=e.exec($),n+=1,$=$.substr(1),null!=r)return t.matched=t.string.substr(t.pos,n-t.pos-1+r[0].length),t.match=r,t.prev_pos=n-1,t.pos=n,t.working=$.substr(r[0].length),t.matched;if(0===$.length)return t.match=[],t.matched=S}},a.$$arity=1),e.def(L,"$[]",i=function(e){var t;if(A(this.match["$empty?"]()))return S;t=e,k(D,"Symbol")["$==="](t)?e=e.$to_s():k(D,"String")["$==="](t)||(e=k(D,"Opal")["$coerce_to!"](e,k(D,"Integer"),"to_int"));var r=this.match;return e<0&&(e+=r.length),e<0||e>=r.length||null==r[e]?S:r[e]},i.$$arity=1),e.def(L,"$check",c=function(e){var t=this,r=(e=t.$anchor(e)).exec(t.working);return t.matched=null==r?S:r[0]},c.$$arity=1),e.def(L,"$check_until",o=function(e){var t=this,r=t.prev_pos,n=t.pos,$=t.$scan_until(e);return $!==S&&(t.matched=$.substr(-1),t.working=t.string.substr(n)),t.prev_pos=r,t.pos=n,$},o.$$arity=1),e.def(L,"$peek",u=function(e){return this.working.substring(0,e)},u.$$arity=1),e.def(L,"$eos?",s=function(){return 0===this.working.length},s.$$arity=0),e.def(L,"$exist?",_=function(e){var t=e.exec(this.working);return null==t?S:0==t.index?0:t.index+1},_.$$arity=1),e.def(L,"$skip",l=function(e){var t=this,r=(e=t.$anchor(e)).exec(t.working);if(null==r)return t.match=[],t.matched=S;var n=r[0],$=n.length;return t.matched=n,t.match=r,t.prev_pos=t.pos,t.pos+=$,t.working=t.working.substring($),$},l.$$arity=1),e.def(L,"$skip_until",d=function(e){var t=this.$scan_until(e);return t===S?S:(this.matched=t.substr(-1),t.length)},d.$$arity=1),e.def(L,"$get_byte",f=function(){var e=this,t=S;return e.pos<e.string.length?(e.prev_pos=e.pos,e.pos+=1,t=e.matched=e.working.substring(0,1),e.working=e.working.substring(1)):e.matched=S,t},f.$$arity=0),e.alias(L,"getch","get_byte"),e.def(L,"$match?",p=function(e){var t=this,r=(e=t.$anchor(e)).exec(t.working);return null==r?S:(t.prev_pos=t.pos,r[0].length)},p.$$arity=1),e.def(L,"$pos=",m=function(e){var t=this;return e<0&&(e+=t.string.$length()),t.pos=e,t.working=t.string.slice(e)},m.$$arity=1),e.def(L,"$matched_size",y=function(){return this.matched===S?S:this.matched.length},y.$$arity=0),e.def(L,"$post_match",h=function(){var e=this;return e.matched===S?S:e.string.substr(e.pos)},h.$$arity=0),e.def(L,"$pre_match",g=function(){var e=this;return e.matched===S?S:e.string.substr(0,e.prev_pos)},g.$$arity=0),e.def(L,"$reset",b=function(){var e=this;return e.working=e.string,e.matched=S,e.pos=0},b.$$arity=0),e.def(L,"$rest",R=function(){return this.working},R.$$arity=0),e.def(L,"$rest?",v=function(){return 0!==this.working.length},v.$$arity=0),e.def(L,"$rest_size",T=function(){return this.$rest().$size()},T.$$arity=0),e.def(L,"$terminate",w=function(){var t,r,n=this;return n.match=S,t=[n.string.$length()],M(n,"pos=",e.to_a(t)),t[(r=t.length,"number"==typeof r?r-1:r["$-"](1))]},w.$$arity=0),e.def(L,"$unscan",E=function(){var e=this;return e.pos=e.prev_pos,e.prev_pos=S,e.match=S,e},E.$$arity=0),L.$private(),e.def(L,"$anchor",x=function(e){var t=e.toString().match(/\/([^\/]+)$/);return t=t?t[1]:void 0,new RegExp("^(?:"+e.source+")",t)},x.$$arity=1),S&&"anchor"},Opal.modules["bcdice/normalize"]=function(e){var t,r,n,$,a,i,c=[],o=e.nil,u=e.module;return a=c,t=i=[u(c[0],"BCDice")].concat(a),[$=u(i[0],"Normalize")].concat(t),$.$module_function(),e.def($,"$comparison_operator",r=function(e){var t;return/<=|=</["$==="](t=e)?"<=":/>=|=>/["$==="](t)?">=":/<>|!=|=!/["$==="](t)?"!=":/</["$==="](t)?"<":/>/["$==="](t)?">":/=/["$==="](t)?"==":o},r.$$arity=1),void e.def($,"$target_number",n=function(e){return e["$=="]("?")?e:e.$to_i()},n.$$arity=1)},Opal.modules["bcdice/command/lexer"]=function(e){var t,r,n,$,a,i,c,o,u,s,_=e.top,l=[],d=e.nil,f=e.$$,p=e.module,m=e.klass,y=e.hash2,h=e.truthy,g=e.send;return _.$require("strscan"),_.$require("bcdice/normalize"),t=l,r=s=[p(l[0],"BCDice")].concat(t),n=u=[p(s[0],"Command")].concat(r),c=m(u[0],null,"Lexer"),o=[c].concat(n),c.$$prototype.scanner=c.$$prototype.notations=d,e.const_set(o[0],"SYMBOLS",y(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),e.def(c,"$initialize",$=function(e,t){var r,n,$,a,i=this;return e=h(a=(n=(r=e)===d||null==r?d:g(r,"split",[" ",2]))===d||null==n?d:g(n,"first",[]))?a:"",i.scanner=f(o,"StringScanner").$new(e),i.notations=g(t,"map",[],(($=function(e){return null==e&&(e=d),h(e["$is_a?"](f(o,"String")))?f(o,"Regexp").$new(e):e}).$$s=i,$.$$arity=1,$))},$.$$arity=2),e.def(c,"$next_token",a=function(){try{var t,r=this,n=d,$=d,a=d,i=d;return h(r.scanner["$eos?"]())?[!1,"$"]:(g(r.notations,"each",[],((t=function(r){var n,$=null==t.$$s?this:t.$$s;if(null==$.scanner&&($.scanner=d),null==r&&(r=d),n=$.scanner.$scan(r),!h(n))return d;e.ret(["NOTATION",n])}).$$s=r,t.$$arity=1,t)),h(n=r.scanner.$scan(/\d+/))?["NUMBER",n.$to_i()]:h($=r.scanner.$scan(/[<>!=]+/))?($=f(o,"Normalize").$comparison_operator($),[h($)?"CMP_OP":"ILLEGAL",$]):(a=r.scanner.$getch().$upcase(),[h(i=f(o,"SYMBOLS")["$[]"](a))?i:a.$to_sym(),a]))}catch(c){if(c===e.returner)return c.$v;throw c}},a.$$arity=0),void e.def(c,"$source",i=function(){return this.scanner.$string()},i.$$arity=0)},Opal.modules["bcdice/command/parsed"]=function(e){var t,r,n,$,a,i,c,o,u,s,_=[],l=e.nil,d=e.$$,f=e.module,p=e.klass,m=e.truthy;return t=_,r=s=[f(_[0],"BCDice")].concat(t),n=u=[f(s[0],"Command")].concat(r),c=p(u[0],null,"Parsed"),o=[c].concat(n),c.$$prototype.question_target=c.$$prototype.critical=c.$$prototype.fumble=c.$$prototype.dollar=c.$$prototype.modify_number=c.$$prototype.target_number=c.$$prototype.prefix_number=c.$$prototype.command=c.$$prototype.suffix_number=c.$$prototype.cmp_op=l,c.$attr_accessor("command"),c.$attr_accessor("prefix_number"),c.$attr_accessor("suffix_number"),c.$attr_accessor("critical"),c.$attr_accessor("fumble"),c.$attr_accessor("dollar"),c.$attr_accessor("modify_number"),c.$attr_accessor("cmp_op"),c.$attr_accessor("target_number"),c.$attr_writer("question_target"),e.def(c,"$initialize",$=function(){var e=this;return e.prefix_number=l,e.suffix_number=l,e.critical=l,e.fumble=l,e.dollar=l,e.cmp_op=l,e.target_number=l,e.question_target=!1},$.$$arity=0),e.def(c,"$question_target?",a=function(){return this.question_target},a.$$arity=0),void e.def(c,"$to_s",i=function(e){var t,r=this,n=l,$=l,a=l,i=l,c=l;return null==e&&(e="after_command"),n=m(r.critical)?"@"+r.critical:l,$=m(r.fumble)?"#"+r.fumble:l,a=m(r.dollar)?"$"+r.dollar:l,i=d(o,"Format").$modifier(r.modify_number),c=m(r.question_target)?"?":r.target_number,"after_command"["$==="](t=e)?[r.prefix_number,r.command,r.suffix_number,n,$,a,i,r.cmp_op,c].$join():"after_modify_number"["$==="](t)?[r.prefix_number,r.command,r.suffix_number,i,n,$,a,r.cmp_op,c].$join():"after_target_number"["$==="](t)?[r.prefix_number,r.command,r.suffix_number,i,r.cmp_op,c,n,$,a].$join():l},i.$$arity=-1)},Opal.modules["bcdice/command/parser"]=function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}var r,n,$,a,i,c,o,u,s,_,l,d,f,p,m,y,h,g,b,R,v,T,w,E,x,L,D,O,S,k,A,M,C,I,N,P,H,B,G,z,U,F,q,j,W,X,Y,V,K,Q,Z,J,ee,te,re,ne,$e,ae,ie,ce,oe,ue,se,_e,le,de=e.top,fe=[],pe=e.nil,me=e.$$$,ye=e.$$,he=e.klass,ge=e.module,be=e.hash2,Re=e.send2,ve=e.send,Te=e.hash,we=e.truthy;return de.$require("racc/parser.rb"),de.$require("bcdice/arithmetic/node"),de.$require("bcdice/command/lexer"),de.$require("bcdice/command/parsed"),function(e,t,r){[he(e,t,"Parser")].concat(r)}(me(ye(fe,"BCDice"),"Command"),me(ye(fe,"Racc"),"Parser"),fe),r=fe,n=le=[ge(fe[0],"BCDice")].concat(r),$=(_e=[ge(le[0],"Command")].concat(n))[0],a=me(ye(_e,"Racc"),"Parser"),i=_e,ue=he($,a,"Parser"),se=[ue].concat(i),ue.$$prototype.notations=ue.$$prototype.lexer=ue.$$prototype.modifier=ue.$$prototype.prefix_number=ue.$$prototype.suffix_number=ue.$$prototype.need_suffix_number=ue.$$prototype.need_prefix_number=ue.$$prototype.critical=ue.$$prototype.fumble=ue.$$prototype.dollar=ue.$$prototype.allowed_cmp_op=ue.$$prototype.question_target=pe,e.def(ue,"$initialize",c=function(t,r){var n,$,a,i,o=c.$$p,u=this;if(o&&(c.$$p=null),n=e.slice.call(arguments,0,arguments.length),null==($=e.extract_kwargs(n)))$=be([],{});else if(!$.$$is_hash)throw e.ArgumentError.$new("expected kwargs");if(a=n,!e.hasOwnProperty.call($.$$smap,"round_type"))throw e.ArgumentError.$new("missing keyword: round_type");return i=$.$$smap.round_type,Re(u,e.find_super_dispatcher(u,"initialize",c,!1,!0),"initialize",[],null),u.notations=a,u.round_type=i,u.prefix_number=!1,u.suffix_number=!1,u.need_prefix_number=!1,u.need_suffix_number=!1,u.modifier=!0,u.critical=!1,u.fumble=!1,u.dollar=!1,u.allowed_cmp_op=[pe,">=",">","<=","<","==","!="],u.question_target=!1},c.$$arity=-2),e.def(ue,"$disable_modifier",o=function(){return this.modifier=!1,this},o.$$arity=0),e.def(ue,"$enable_prefix_number",u=function(){return this.prefix_number=!0,this},u.$$arity=0),e.def(ue,"$enable_suffix_number",s=function(){return this.suffix_number=!0,this},s.$$arity=0),e.def(ue,"$has_prefix_number",_=function(){var e=this;return e.prefix_number=!0,e.need_prefix_number=!0,e},_.$$arity=0),e.def(ue,"$has_suffix_number",l=function(){var e=this;return e.suffix_number=!0,e.need_suffix_number=!0,e},l.$$arity=0),e.def(ue,"$enable_critical",d=function(){return this.critical=!0,this},d.$$arity=0),e.def(ue,"$enable_fumble",f=function(){return this.fumble=!0,this},f.$$arity=0),e.def(ue,"$enable_dollar",p=function(){return this.dollar=!0,this},p.$$arity=0),e.def(ue,"$restrict_cmp_op_to",m=function(t){var r,n=this;return r=e.slice.call(arguments,0,arguments.length),n.allowed_cmp_op=r,n},m.$$arity=-1),e.def(ue,"$enable_question_target",y=function(){return this.question_target=!0,this},y.$$arity=0),e.def(ue,"$parse",h=function(t){try{return this.lexer=ye(se,"Lexer").$new(t,this.notations),this.$do_parse()}catch(r){if(!e.rescue(r,[ye(se,"ParseError"),ye(se,"ZeroDivisionError")]))throw r;try{return pe}finally{e.pop_exception()}}},h.$$arity=1),ue.$private(),e.def(ue,"$parsed",g=function(r,n,$,a){var i;return ve(ye(se,"Parsed").$new(),"tap",[],((i=function(c){var o,u,s,_,l,d,f=null==i.$$s?this:i.$$s,p=pe;return null==f.round_type&&(f.round_type=pe),null==c&&(c=pe),p=[r["$[]"]("command")],ve(c,"command=",e.to_a(p)),t(p.length,1),p=[(o=r["$[]"]("prefix"),o===pe||null==o?pe:ve(o,"eval",[f.round_type]))],ve(c,"prefix_number=",e.to_a(p)),t(p.length,1),p=[(u=r["$[]"]("suffix"),u===pe||null==u?pe:ve(u,"eval",[f.round_type]))],ve(c,"suffix_number=",e.to_a(p)),t(p.length,1),p=[(s=n["$[]"]("critical"),s===pe||null==s?pe:ve(s,"eval",[f.round_type]))],ve(c,"critical=",e.to_a(p)),t(p.length,1),p=[(_=n["$[]"]("fumble"),_===pe||null==_?pe:ve(_,"eval",[f.round_type]))],ve(c,"fumble=",e.to_a(p)),t(p.length,1),p=[(l=n["$[]"]("dollar"),l===pe||null==l?pe:ve(l,"eval",[f.round_type]))],ve(c,"dollar=",e.to_a(p)),t(p.length,1),p=[$.$eval(f.round_type)],ve(c,"modify_number=",e.to_a(p)),t(p.length,1),p=[a["$[]"]("cmp_op")],ve(c,"cmp_op=",e.to_a(p)),t(p.length,1),a["$[]"]("target")["$=="]("?")?(ve(c,"question_target=",e.to_a(p=[!0])),t(p.length,1),ve(c,"target_number=",e.to_a(p=[0])),p[t(p.length,1)]):(ve(c,"question_target=",e.to_a(p=[!1])),t(p.length,1),p=[(d=a["$[]"]("target"),d===pe||null==d?pe:ve(d,"eval",[f.round_type]))],ve(c,"target_number=",e.to_a(p)),p[t(p.length,1)])}).$$s=this,i.$$arity=1,i))},g.$$arity=4),e.def(ue,"$next_token",b=function(){return this.lexer.$next_token()},b.$$arity=0),J=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,pe,5,36,37,17,18,6,pe,5,36,37,17,18,6,pe,5,36,37,17,18,6,pe,5,33,34,17,18,6,pe,5,36,37,17,18,6,pe,5,36,37,17,18,6,pe,5,36,37,17,18,6,pe,5,36,37,17,18,6,pe,5,pe,pe,17,18,6,pe,5,pe,pe,17,18,pe,pe,5,23,24,25,26,56,54,55,57],ee=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,pe,17,15,15,18,18,23,pe,18,30,30,23,23,24,pe,23,31,31,24,24,25,pe,24,44,44,25,25,28,pe,25,47,47,28,28,29,pe,28,48,48,29,29,33,pe,29,49,49,33,33,34,pe,33,50,50,34,34,36,pe,34,pe,pe,36,36,37,pe,36,pe,pe,37,37,pe,pe,37,27,27,27,27,52,52,52,52],te=[-2,4,16,-3,-1,11,pe,33,13,35,23,30,1,pe,28,40,pe,37,44,pe,pe,-2,pe,51,58,65,0,106,72,79,47,54,pe,86,93,pe,100,107,pe,pe,pe,pe,pe,pe,63,pe,pe,68,75,82,89,pe,120,pe,pe,pe,pe,pe],re=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],ne=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,pe,pe,21,47,48,40,51,52,49,50,44,46,3,pe,pe,pe,13,pe,pe,pe,pe,pe,pe,pe,32],$e=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,pe,pe,4,8,8,5,7,7,8,8,9,5,6,pe,pe,pe,6,pe,pe,pe,pe,pe,pe,pe,6],ae=[pe,6,13,3,9,-1,27,-15,-10,-1,-38],ie=[pe,pe,pe,pe,pe,pe,19,16,15,pe,pe],ce=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],oe=Te(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),e.const_set(se[0],"Racc_arg",[J,ee,re,te,ne,$e,ie,ae,19,ce,oe,58,35,!0]),e.const_set(se[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),e.const_set(se[0],"Racc_debug_parser",!1),e.def(ue,"$_reduce_1",R=function(t,r,n){var $;return we(this.modifier)||this.$raise(ye(se,"ParseError")),$=e.to_ary(t),this.$parsed(null==$[0]?pe:$[0],null==$[1]?pe:$[1],null==$[2]?pe:$[2],null==$[3]?pe:$[3])},R.$$arity=3),e.def(ue,"$_reduce_2",v=function(t,r,n){var $;return we(this.modifier)||this.$raise(ye(se,"ParseError")),$=e.to_ary(t),this.$parsed(null==$[0]?pe:$[0],null==$[2]?pe:$[2],null==$[1]?pe:$[1],null==$[3]?pe:$[3])},v.$$arity=3),e.def(ue,"$_reduce_3",T=function(t,r,n){var $,a;return a=null==($=e.to_ary(t))[2]?pe:$[2],this.$parsed(null==$[0]?pe:$[0],null==$[1]?pe:$[1],me(me(ye(se,"Arithmetic"),"Node"),"Number").$new(0),a)},T.$$arity=3),e.def(ue,"$_reduce_4",w=function(e,t,r){var n,$=this;return we(we(n=$.prefix_number)?$.suffix_number:n)||$.$raise(ye(se,"ParseError")),be(["command","prefix","suffix"],{command:e["$[]"](1),prefix:e["$[]"](0),suffix:e["$[]"](2)})},w.$$arity=3),e.def(ue,"$_reduce_5",E=function(e,t,r){var n=this;return we(n.prefix_number)||n.$raise(ye(se,"ParseError")),we(n.need_suffix_number)&&n.$raise(ye(se,"ParseError")),be(["command","prefix"],{command:e["$[]"](1),prefix:e["$[]"](0)})},E.$$arity=3),e.def(ue,"$_reduce_6",x=function(e,t,r){var n=this;return we(n.suffix_number)||n.$raise(ye(se,"ParseError")),we(n.need_prefix_number)&&n.$raise(ye(se,"ParseError")),be(["command","suffix"],{command:e["$[]"](0),suffix:e["$[]"](1)})},x.$$arity=3),e.def(ue,"$_reduce_7",L=function(e,t,r){var n,$=this;return we(we(n=$.need_prefix_number)?n:$.need_suffix_number)&&$.$raise(ye(se,"ParseError")),be(["command"],{command:e["$[]"](0)})},L.$$arity=3),e.def(ue,"$_reduce_8",D=function(e,t,r){return be([],{})},D.$$arity=3),e.def(ue,"$_reduce_9",O=function(r,n,$){var a,i,c,o,u=pe;return u=null==(a=e.to_ary(r))[0]?pe:a[0],i=null==a[2]?pe:a[2],we(we(o=this.critical)?u["$[]"]("critical")["$nil?"]():o)||this.$raise(ye(se,"ParseError")),ve(u,"[]=",e.to_a(c=["critical",i])),t(c.length,1),u},O.$$arity=3),e.def(ue,"$_reduce_10",S=function(r,n,$){var a,i,c,o,u=pe;return u=null==(a=e.to_ary(r))[0]?pe:a[0],i=null==a[2]?pe:a[2],we(we(o=this.fumble)?u["$[]"]("fumble")["$nil?"]():o)||this.$raise(ye(se,"ParseError")),ve(u,"[]=",e.to_a(c=["fumble",i])),t(c.length,1),u},S.$$arity=3),e.def(ue,"$_reduce_11",k=function(r,n,$){var a,i,c,o,u=pe;return u=null==(a=e.to_ary(r))[0]?pe:a[0],i=null==a[2]?pe:a[2],we(we(o=this.dollar)?u["$[]"]("dollar")["$nil?"]():o)||this.$raise(ye(se,"ParseError")),ve(u,"[]=",e.to_a(c=["dollar",i])),t(c.length,1),u},k.$$arity=3),e.def(ue,"$_reduce_12",A=function(e,t,r){return e["$[]"](1)},A.$$arity=3),e.def(ue,"$_reduce_13",M=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"Negative").$new(e["$[]"](1))},M.$$arity=3),e.def(ue,"$_reduce_14",C=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"BinaryOp").$new(e["$[]"](0),"+",e["$[]"](2))},C.$$arity=3),e.def(ue,"$_reduce_15",I=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"BinaryOp").$new(e["$[]"](0),"-",e["$[]"](2))},I.$$arity=3),e.def(ue,"$_reduce_16",N=function(e,t,r){return we(this.allowed_cmp_op["$include?"](pe))||this.$raise(ye(se,"ParseError")),be([],{})},N.$$arity=3),e.def(ue,"$_reduce_17",P=function(t,r,n){var $,a,i;return i=null==($=e.to_ary(t))[1]?pe:$[1],we(this.allowed_cmp_op["$include?"](a=null==$[0]?pe:$[0]))||this.$raise(ye(se,"ParseError")),be(["cmp_op","target"],{cmp_op:a,target:i})},P.$$arity=3),e.def(ue,"$_reduce_18",H=function(e,t,r){var n,$=this;return n=e["$[]"](0),we($.question_target)||$.$raise(ye(se,"ParseError")),we($.allowed_cmp_op["$include?"](n))||$.$raise(ye(se,"ParseError")),be(["cmp_op","target"],{cmp_op:n,target:"?"})},H.$$arity=3),e.def(ue,"$_reduce_19",B=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"BinaryOp").$new(e["$[]"](0),"+",e["$[]"](2))},B.$$arity=3),e.def(ue,"$_reduce_20",G=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"BinaryOp").$new(e["$[]"](0),"-",e["$[]"](2))},G.$$arity=3),e.def(ue,"$_reduce_22",z=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"BinaryOp").$new(e["$[]"](0),"*",e["$[]"](2))},z.$$arity=3),e.def(ue,"$_reduce_23",U=function(e,t,r){return e["$[]"](3).$new(e["$[]"](0),e["$[]"](2))},U.$$arity=3),e.def(ue,"$_reduce_25",F=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},F.$$arity=3),e.def(ue,"$_reduce_26",q=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"DivideWithCeil")},q.$$arity=3),e.def(ue,"$_reduce_27",j=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"DivideWithCeil")},j.$$arity=3),e.def(ue,"$_reduce_28",W=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"DivideWithRound")},W.$$arity=3),e.def(ue,"$_reduce_29",X=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"DivideWithFloor")},X.$$arity=3),e.def(ue,"$_reduce_30",Y=function(e,t,r){return e["$[]"](1)},Y.$$arity=3),e.def(ue,"$_reduce_31",V=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"Negative").$new(e["$[]"](1))},V.$$arity=3),e.def(ue,"$_reduce_33",K=function(e,t,r){return e["$[]"](1)},K.$$arity=3),e.def(ue,"$_reduce_34",Q=function(e,t,r){return me(me(ye(se,"Arithmetic"),"Node"),"Number").$new(e["$[]"](0))},Q.$$arity=3),void e.def(ue,"$_reduce_none",Z=function(e,t,r){return e["$[]"](0)},Z.$$arity=3)},Opal.modules["bcdice/dice_table/table"]=function(e){var t,r,n,$,a,i,c,o,u,s,_,l=[],d=e.nil,f=e.$$,p=e.module,m=e.klass,y=e.hash2,h=e.truthy;return t=l,r=_=[p(l[0],"BCDice")].concat(t),n=s=[p(_[0],"DiceTable")].concat(r),o=m(s[0],null,"Table"),u=[o].concat(n),o.$$prototype.times=o.$$prototype.sides=o.$$prototype.name=o.$$prototype.items=d,e.defs(o,"$from_i18n",$=function(e,t){var r=d;return r=f(u,"I18n").$t(e,y(["locale"],{locale:t})),this.$new(r["$[]"]("name"),r["$[]"]("type"),r["$[]"]("items"))},$.$$arity=2),e.def(o,"$initialize",a=function(e,t,r){var n=this,$=d;return n.name=e,n.items=r.$freeze(),$=/(\d+)D(\d+)/i.$match(t),h($)||n.$raise(f(u,"ArgumentError"),"Unexpected table type: "+t),n.times=$["$[]"](1).$to_i(),n.sides=$["$[]"](2).$to_i()},a.$$arity=3),e.def(o,"$roll",i=function(e){var t,r=this;return t=e.$roll_sum(r.times,r.sides),r.$choice(t)},i.$$arity=1),void e.def(o,"$choice",c=function(e){var t,r=this;return t=function(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}(e,r.times),f(u,"RollResult").$new(r.name,e,r.items["$[]"](t))},c.$$arity=1)},Opal.modules["bcdice/dice_table/range_table"]=function(e){var t,r,n,$,a,i,c,o,u,s,_,l,d,f,p,m,y=[],h=e.nil,g=e.$$,b=e.module,R=e.klass,v=e.send,T=e.truthy;return t=y,r=m=[b(y[0],"BCDice")].concat(t),n=p=[b(m[0],"DiceTable")].concat(r),d=R(p[0],null,"RangeTable"),f=[d].concat(n),d.$$prototype.name=d.$$prototype.items=d.$$prototype.num_of_dice=d.$$prototype.num_of_sides=d.$$prototype.formatter=h,e.const_set(f[0],"RollResult",v(g(f,"Struct"),"new",["sum","values","content","formatted"],(($=function(){return(null==$.$$s?this:$.$$s).$alias_method("to_s","formatted")}).$$s=d,$.$$arity=0,$))),e.const_set(f[0],"Item",g(f,"Struct").$new("range","content")),e.const_set(f[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),e.const_set(f[0],"DEFAULT_FORMATTER",v(d,"lambda",[],($$2=function(e){function t(t,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){return null==$$2.$$s||$$2,null==e&&(e=h),null==t&&(t=h),e.$name()+"("+t.$sum()+") \uff1e "+t.$content()}),$$2.$$s=d,$$2.$$arity=2,$$2))),d.$attr_reader("name"),d.$attr_reader("num_of_dice"),d.$attr_reader("num_of_sides"),e.def(d,"$initialize",a=function(e,t,r){var n,$=a.$$p,i=$||h,c=this,o=h;return $&&(a.$$p=null),$&&(a.$$p=null),c.name=e.$freeze(),c.formatter=T(n=i)?n:g(f,"DEFAULT_FORMATTER"),o=g(f,"DICE_ROLL_METHOD_RE").$match(t),T(o)||c.$raise(g(f,"ArgumentError"),c.name+": invalid dice roll method: "+t),c.num_of_dice=o["$[]"](1).$to_i(),c.num_of_sides=o["$[]"](2).$to_i(),c.$store(r)},a.$$arity=3),e.def(d,"$fetch",i=function(e){var t,r,n=this;return r=v(n.items,"find",[],((t=function(t){return null==t&&(t=h),t.$range()["$include?"](e)}).$$s=n,t.$$arity=1,t)),T(r)||n.$raise(g(f,"RangeError"),n.name+": value is out of range: "+e),r},i.$$arity=1),e.def(d,"$roll",c=function(t){var r,n,$,a,i=this,c=h;return r=(c=t.$roll_barabara(i.num_of_dice,i.num_of_sides)).$sum(),n=g(f,"RollResult").$new(r,c,i.$fetch(r).$content()),$=[i.formatter["$[]"](i,n)],v(n,"formatted=",e.to_a($)),"number"==typeof(a=$.length)||a["$-"](1),n},c.$$arity=1),d.$private(),e.def(d,"$store",o=function(e){var t,r,n,$,a,i=this;return $=v(e,"map",[],((t=function(e,r){return null==e&&(e=h),null==r&&(r=h),[(null==t.$$s?this:t.$$s).$coerce_to_int_range(e),r]}).$$s=i,t.$$arity=2,t)),a=v($,"sort_by",[],((r=function(e,t){return null==e&&(e=h),null==t&&(t=h),e.$min()}).$$s=i,r.$$arity=2,r)),i.$assert_min_sum_is_covered(a),i.$assert_max_sum_is_covered(a),i.$assert_no_gap_or_overlap_in_ranges(a),i.items=v(a,"map",[],(n=function(e,t){return null==e&&(e=h),null==t&&(t=h),g(f,"Item").$new(e,t.$freeze()).$freeze()},n.$$s=i,n.$$arity=2,n)).$freeze(),i},o.$$arity=1),e.def(d,"$coerce_to_int_range",u=function(e){var t,r=h;return t=e,g(f,"Integer")["$==="](t)?g(f,"Range").$new(e,e):g(f,"Range")["$==="](t)&&T(T(r=e.$begin()["$is_a?"](g(f,"Integer")))?e.$end()["$is_a?"](g(f,"Integer")):r)?e:this.$raise(g(f,"TypeError"),this.name+": "+e+" ("+e.$class()+") must be an Integer or a Range with Integers ")},u.$$arity=1),e.def(d,"$assert_min_sum_is_covered",s=function(e){var t,r=this,n=h;return t=r.num_of_dice,n=e.$first()["$[]"](0),T(n["$include?"](t))||r.$raise(g(f,"RangeError"),r.name+": min value ("+t+") is not covered: "+n),r},s.$$arity=1),e.def(d,"$assert_max_sum_is_covered",_=function(e){var t,r=this,n=h;return t=function(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}(r.num_of_dice,r.num_of_sides),n=e.$last()["$[]"](0),T(n["$include?"](t))||r.$raise(g(f,"RangeError"),r.name+": max value ("+t+") is not covered: "+n),r},_.$$arity=1),void e.def(d,"$assert_no_gap_or_overlap_in_ranges",l=function(e){var t;return v(e,"each_cons",[2],((t=function(e,r){var n,$,a,i=null==t.$$s?this:t.$$s,c=h,o=h;return null==i.name&&(i.name=h),null==e&&(e=h),null==r&&(r=h),c=e["$[]"](0),o=r["$[]"](0),$="number"==typeof(a=n=c.$max())?a+1:a["$+"](1),T(o["$include?"](n))&&i.$raise(g(f,"RangeError"),i.name+": Range overlap: "+c+" and "+o),T(o["$include?"]($))?h:i.$raise(g(f,"RangeError"),i.name+": Range gap: "+c+" and "+o)}).$$s=this,t.$$arity=2,t)),this},l.$$arity=1)},function(e){function t(e,t){return"number"==typeof e&&"number"==typeof t?e*t:e["$*"](t)}function r(e,t){return"number"==typeof e&&"number"==typeof t?e+t:e["$+"](t)}function n(e,t){return"number"==typeof e&&"number"==typeof t?e>t:e["$>"](t)}function $(e,t){return"number"==typeof e&&"number"==typeof t?e>=t:e["$>="](t)}function a(e,t){return"number"==typeof e&&"number"==typeof t?e-t:e["$-"](t)}var i,c,o,u,s,_,l,d,f,p,m,y,h,g,b,R,v,T,w,E,x,L,D,O,S,k=e.top,A=[],M=e.nil,C=e.$$$,I=e.$$,N=e.module,P=e.klass,H=e.truthy,B=e.hash2,G=e.send,z=e.range,U=e.hash;k.$require("bcdice/format"),k.$require("bcdice/command/parser"),k.$require("bcdice/dice_table/table"),k.$require("bcdice/dice_table/range_table"),i=A,c=S=[N(A[0],"BCDice")].concat(i),o=(O=[N(S[0],"GameSystem")].concat(c))[0],u=I(O,"Base"),s=O,L=P(o,u,"BattleTech"),D=[L].concat(s),L.$$prototype.randomizer=M,e.const_set(D[0],"ID","BattleTech"),e.const_set(D[0],"NAME","\u30d0\u30c8\u30eb\u30c6\u30c3\u30af"),e.const_set(D[0],"SORT_KEY","\u306f\u3068\u308b\u3066\u3064\u304f"),e.const_set(D[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\u65b9\u6cd5\n\u3000(\u56de\u6570)BT(\u30c0\u30e1\u30fc\u30b8)(\u90e8\u4f4d)+(\u57fa\u672c\u5024)>=(\u76ee\u6a19\u5024)\n\u3000\u56de\u6570\u306f\u7701\u7565\u6642 1\u56fa\u5b9a\u3002\n\u3000\u90e8\u4f4d\u306fC\uff08\u6b63\u9762\uff09R\uff08\u53f3\uff09\u3001L\uff08\u5de6\uff09\u3002\u7701\u7565\u6642\u306fC\uff08\u6b63\u9762\uff09\u56fa\u5b9a\n\u3000U\uff08\u4e0a\u534a\u8eab\uff09\u3001L\uff08\u4e0b\u534a\u8eab\uff09\u3092\u7d44\u307f\u5408\u308f\u305b CU/RU/LU/CL/RL/LL\u3082\u6307\u5b9a\u53ef\u80fd\n\u3000\u4f8b\uff09BT3+2>=4\n\u3000\u3000\u6b63\u9762\u304b\u3089\u30c0\u30e1\u30fc\u30b83\u306e\u653b\u6483\u3092\u6280\u80fd\u30d9\u30fc\u30b92\u76ee\u6a19\u50244\u30671\u56de\u5224\u5b9a\n\u3000\u4f8b\uff092BT3RL+5>=8\n\u3000\u3000\u53f3\u4e0b\u534a\u8eab\u306b\u30c0\u30e1\u30fc\u30b83\u306e\u653b\u6483\u3092\u6280\u80fd\u30d9\u30fc\u30b95\u76ee\u6a19\u50248\u30672\u56de\u5224\u5b9a\n\u3000\u30df\u30b5\u30a4\u30eb\u306b\u3088\u308b\u30c0\u30e1\u30fc\u30b8\u306f BT(\u30c0\u30e1\u30fc\u30b8) \u306e\u4ee3\u308f\u308a\u306b SRM2/4/6, LRM5/10/15/20 \u3092\u6307\u5b9a\n\u3000\u4f8b\uff093SRM6LU+5>=8\n\u3000\u3000\u5de6\u4e0a\u534a\u8eab\u306bSRM6\u9023\u3092\u6280\u80fd\u30d9\u30fc\u30b95\u76ee\u6a19\u50248\u30673\u56de\u5224\u5b9a\n  BT(\u30c0\u30e1\u30fc\u30b8) \u306e\u4ee3\u308f\u308a\u306b PPC \u3092\u6307\u5b9a\u3059\u308b\u3068\u30c0\u30e1\u30fc\u30b810\u3067\u5224\u5b9a\n  \u4f8b\uff092PPCR+3>=10\n  \u3000\u53f3\u5074\u304b\u3089PPC\uff08\u30c0\u30e1\u30fc\u30b810\uff09\u306b\u3088\u308b\u653b\u6483\u3092\u6280\u80fd\u30d9\u30fc\u30b93\u76ee\u6a19\u502410\u30672\u56de\u5224\u5b9a\n\u30fbCT\uff1a\u81f4\u547d\u7684\u547d\u4e2d\u8868\n\u30fbDW\uff1a\u8ee2\u5012\u5f8c\u306e\u5411\u304d\u8868\n\u30fbCDx\uff1a\u30e1\u30c3\u30af\u6226\u58eb\u610f\u8b58\u7dad\u6301\u30ed\u30fc\u30eb\u3002\u30c0\u30e1\u30fc\u30b8\u5024x\uff081\u301c6\uff09\u3067\u5224\u5b9a\u3000\u4f8b\uff09CD3\n"),L.$register_prefix("\\d*SRM","\\d*LRM","\\d*BT","\\d*PPC","CT","DW","CD"),e.const_set(D[0],"NO_CRITICAL_HIT_LIMIT",7),e.defs(L,"$ppc_parser",_=function(){var e=this;return null==e.ppc_parser&&(e.ppc_parser=M),H(e.ppc_parser)||(e.ppc_parser=C(I(D,"Command"),"Parser").$new(/PPC(?:[LCR][LU]?)?/,B(["round_type"],{round_type:C(I(D,"RoundType"),"FLOOR")})),e.ppc_parser.$enable_prefix_number(),e.ppc_parser.$restrict_cmp_op_to(">=")),e.ppc_parser},_.$$arity=0),e.def(L,"$ppc_parser",l=function(){return this.$class().$ppc_parser()},l.$$arity=0),e.def(L,"$eval_game_system_specific_command",d=function(t){var r=this,n=M,$=M,a=M,i=M,c=M,o=M,u=M,s=M,_=M;try{return n=r.$roll_tables(t,I(D,"TABLES")),H(n)?n:H($=r.$ppc_parser().$parse(t))?r.$execute_ppc($):(a=1,H(t["$=~"](/^(\d+)(.+)/))&&(a=I(D,"Regexp").$last_match(1).$to_i(),t=I(D,"Regexp").$last_match(2)),r.$debug("executeCommandCatched count",a),r.$debug("executeCommandCatched command",t),/^CD([1-6])$/["$==="](i=t)?(c=I(D,"Regexp").$last_match(1).$to_i(),r.$consciousness_roll(c)):/^((S|L)RM\d+)(.+)/["$==="](i)?(o=I(D,"Regexp").$last_match(3),u=I(D,"Regexp").$last_match(1),s=G(r,"lambda",[],($$4=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return(null==$$4.$$s?this:$$4.$$s).$getXrmDamage(u)}),$$4.$$s=r,$$4.$$arity=0,$$4)),r.$getHitResult(a,s,o)):/^BT(\d+)(.+)/["$==="](i)?(r.$debug("BT pattern"),o=I(D,"Regexp").$last_match(2),_=I(D,"Regexp").$last_match(1).$to_i(),s=G(r,"lambda",[],($$5=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return null==$$5.$$s||$$5,_}),$$5.$$s=r,$$5.$$arity=0,$$5)),r.$getHitResult(a,s,o)):M)}catch(l){if(!e.rescue(l,[I(D,"UnknownXRMError")]))throw l;try{return M}finally{e.pop_exception()}}},d.$$arity=1),function(e,t,r){[P(e,t,"UnknownXRMError")].concat(r)}(D[0],I(D,"StandardError"),D),e.def(L,"$getXrmDamage",f=function(e){var r,n,$=M;return H(I(D,"XRM_DAMAGE_TABLES")["$key?"](e))||this.$raise(I(D,"UnknownXRMError"),"unknown XRM: "+e),$=I(D,"XRM_DAMAGE_TABLES")["$[]"](e).$roll(this.randomizer),r=e["$start_with?"]("L"),n=$.$content(),[H(r)?n:t(2,n),$.$sum(),r]},f.$$arity=1),e.const_set(D[0],"LRM_LIMIT",5),e.def(L,"$getHitResult",p=function(t,$,a){var i,c=M,o=M,u=M,s=M,_=M,l=M,d=M,f=M,p=M,m=M,y=M,h=M,g=M,b=M;return c=/^([LCR][LU]?)?(\+\d+)?>=(\d+)/.$match(a),H(c)?(o=H(u=c["$[]"](1))?u:"C",s=c["$[]"](2),_=c["$[]"](3).$to_i(),l=this.$getBaseValue(s),this.$debug("side, base, target",o,l,_),d=C(I(D,"HitPart"),"TABLES")["$[]"](o),f=[],p=B([],{}),m=0,G(t,"times",[],((i=function(){var t,n,a=null==i.$$s?this:i.$$s,c=M;return n=a.$getHitText(l,_),c=null==(t=e.to_ary(n))[1]?M:t[1],H(null==t[0]?M:t[0])&&(m=r(m,1),n=a.$getDamages($,d,p),t=e.to_ary(n),p=null==t[0]?M:t[0],c=r(c,null==t[1]?M:t[1])),f["$<<"](c)}).$$s=this,i.$$arity=0,i)),y=n(m,0),h=" \uff1e "+m+"\u56de\u547d\u4e2d",g=H(y)?h+" \u547d\u4e2d\u7b87\u6240\uff1a"+this.$getTotalDamage(p):h,f.$push(g),b=f.$join("\n"),H(y)?I(D,"Result").$success(b):I(D,"Result").$failure(b)):M},p.$$arity=3),e.def(L,"$getBaseValue",m=function(e){var t=M;return t=0,H(e["$nil?"]())||(t=I(D,"ArithmeticEvaluator").$eval(e)),t},m.$$arity=1),e.def(L,"$getHitText",y=function(e,t){var a,i,c,o,u=M;return o=$(c=r(r(a=this.randomizer.$roll_once(6),i=this.randomizer.$roll_once(6)),e),t),u=c+"["+a+","+i+(H(n(e,0))?"+"+e:"")+"]>="+t+" \uff1e ",[o,u=H(o)?r(u,"\u547d\u4e2d \uff1e "):r(u,"\u5916\u308c")]},y.$$arity=2),e.def(L,"$getDamages",h=function(n,$,i){var c,o,u,s,_,l,d=M,f=M;return d="",o=n.$call(),c=e.to_ary(o),s=null==c[0]?M:c[0],_=null==c[1]?M:c[1],f=1,H(l=null==c[2]?M:c[2])&&(f=function(e,t){return"number"==typeof e&&"number"==typeof t?e/t:e["$/"](t)}(t(1,s),I(D,"LRM_LIMIT")).$ceil(),d=r(d,"["+_+"] "+s+"\u70b9")),G(f,"times",[],((u=function(t){var n,c,o,f,p,m=null==u.$$s?this:u.$$s,y=M,h=M;return null==t&&(t=M),c=m.$getDamageInfo(_,s,l,t),o=null==(n=e.to_ary(c))[0]?M:n[0],c=m.$getHitResultOne(null==n[1]?M:n[1],$),f=null==(n=e.to_ary(c))[0]?M:n[0],p=null==n[1]?M:n[1],y=null==n[2]?M:n[2],H(l)&&(d=r(d," ")),d=r(d,f),H(i["$[]"](p)["$nil?"]())&&(h=[p,B(["partDamages","criticals"],{partDamages:[],criticals:[]})],G(i,"[]=",e.to_a(h)),a(h.length,1)),i["$[]"](p)["$[]"]("partDamages")["$<<"](o),H(y["$empty?"]())?M:i["$[]"](p)["$[]"]("criticals")["$<<"](y)}).$$s=this,u.$$arity=1,u)),[i,d]},h.$$arity=3),e.def(L,"$getDamageInfo",g=function(e,r,$,i){var c=M;return H(e["$nil?"]())?[r,r.$to_s()]:H($)?(c=a(r,t(I(D,"LRM_LIMIT"),i)),H(n(c,I(D,"LRM_LIMIT")))&&(c=I(D,"LRM_LIMIT")),[c,c.$to_s()]):[r,"["+e+"] "+r]},g.$$arity=4),e.def(L,"$getTotalDamage",b=function(e){var t,n=M,$=M;return n=0,$=[],G(["\u982d","\u80f4\u4e2d\u592e","\u53f3\u80f4","\u5de6\u80f4","\u53f3\u811a","\u5de6\u811a","\u53f3\u8155","\u5de6\u8155"],"each",[],((t=function(a){var i,c=null==t.$$s?this:t.$$s,o=M,u=M,s=M,_=M,l=M;return null==a&&(a=M),o=e.$delete(a),H(o["$nil?"]())?M:(u=G(o["$[]"]("partDamages"),"inject",[0],((i=function(e,t){return null==e&&(e=M),null==t&&(t=M),r(e,t)}).$$s=c,i.$$arity=2,i)),n=r(n,u),s=o["$[]"]("partDamages").$size(),_=o["$[]"]("criticals"),l=r(l="",a+"("+s+"\u56de) "+u+"\u70b9"),H(_["$empty?"]())||(l=r(l," "+_.$join(" "))),$["$<<"](l))}).$$s=this,t.$$arity=1,t)),H(e["$empty?"]())||this.$raise("damages rest!! "+e.$inspect()),r($.$join(" \uff0f ")," \uff1e \u5408\u8a08\u30c0\u30e1\u30fc\u30b8 "+n+"\u70b9")},b.$$arity=1),e.def(L,"$getHitResultOne",R=function(e,t){var r,$=M,a=M,i=M,c=M,o=M;return a=($=t.$roll(this.randomizer)).$content(),r=H(a.$critical_hit_may_occur())?"\uff08\u81f4\u547d\u7684\u547d\u4e2d\uff09":"",i=[["["+$.$sum()+"]",""+a.$name()+r,e+"\u70b9"].$join(" ")],c="",H(a.$critical_hit_may_occur())&&(o=I(D,"TABLES")["$[]"]("CT").$roll(this.randomizer),H(n(o.$sum(),I(D,"NO_CRITICAL_HIT_LIMIT")))&&(c=o.$content()),i.$push("["+o.$sum()+"] "+o.$content())),[i.$join(" \uff1e "),a.$name(),c]},R.$$arity=2),e.def(L,"$consciousness_roll",v=function(e){var t=M,r=M,n=M,a=M,i=M,c=M,o=M,u=M;return H(z(1,6,!1)["$include?"](e))?(t="CD"+e,e["$=="](6)?I(D,"Result").$fumble(t+" \uff1e \u6b7b\u4ea1"):(n="(2D6>="+(r=U(1,3,2,5,3,7,4,10,5,11)["$[]"](e))+")",c=(i=(a=this.randomizer.$roll_barabara(2,6)).$sum())+"["+a.$join(",")+"]",o=$(i,r),u=[t,n,c,i,H(o)?"\u6210\u529f":"\u5931\u6557"].$join(" \uff1e "),H(o)?I(D,"Result").$success(u):I(D,"Result").$failure(u))):M},v.$$arity=1),e.def(L,"$execute_ppc",T=function(e){var t,r,n,$=this;return t=H(n=e.$prefix_number())?n:1,r=""+e.$command()["$[]"](z(3,-1,!1))+I(D,"Format").$modifier(e.$modify_number())+">="+e.$target_number(),$.$getHitResult(t,G($,"lambda",[],($$20=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){return null==$$20.$$s||$$20,10}),$$20.$$s=$,$$20.$$arity=0,$$20)),r)},T.$$arity=1),e.const_set(D[0],"TABLES",B(["CT","DW"],{CT:C(I(D,"DiceTable"),"RangeTable").$new("\u81f4\u547d\u7684\u547d\u4e2d\u8868","2D6",[[e.Range.$new(2,I(D,"NO_CRITICAL_HIT_LIMIT"),!1),"\u81f4\u547d\u7684\u547d\u4e2d\u306f\u306a\u304b\u3063\u305f"],[z(8,9,!1),"1\u7b87\u6240\u306e\u81f4\u547d\u7684\u547d\u4e2d"],[z(10,11,!1),"2\u7b87\u6240\u306e\u81f4\u547d\u7684\u547d\u4e2d"],[12,"\u305d\u306e\u90e8\u4f4d\u304c\u5439\u304d\u98db\u3076\uff08\u8155\u3001\u811a\u3001\u982d\uff09\u307e\u305f\u306f3\u7b87\u6240\u306e\u81f4\u547d\u7684\u547d\u4e2d\uff08\u80f4\uff09"]]),DW:C(I(D,"DiceTable"),"Table").$new("\u8ee2\u5012\u5f8c\u306e\u5411\u304d\u8868","1D6",["\u540c\u3058\uff08\u524d\u9762\u304b\u3089\u8ee2\u5012\uff09 \u6b63\u9762\uff0f\u80cc\u9762","1\u30d8\u30af\u30b9\u30b5\u30a4\u30c9\u53f3\uff08\u5074\u9762\u304b\u3089\u8ee2\u5012\uff09 \u53f3\u5074\u9762","2\u30d8\u30af\u30b9\u30b5\u30a4\u30c9\u53f3\uff08\u5074\u9762\u304b\u3089\u8ee2\u5012\uff09 \u53f3\u5074\u9762","180\u5ea6\u9006\uff08\u80cc\u9762\u304b\u3089\u8ee2\u5012\uff09 \u6b63\u9762\uff0f\u80cc\u9762","2\u30d8\u30af\u30b9\u30b5\u30a4\u30c9\u5de6\uff08\u5074\u9762\u304b\u3089\u8ee2\u5012\uff09 \u5de6\u5074\u9762","1\u30d8\u30af\u30b9\u30b5\u30a4\u30c9\u5de6\uff08\u5074\u9762\u304b\u3089\u8ee2\u5012\uff09 \u5de6\u5074\u9762"])}).$freeze()),e.const_set(D[0],"HitPart",I(D,"Struct").$new("name","critical_hit_may_occur")),w=D,x=[E=P(D[0],null,"HitPart")].concat(w),e.const_set(x[0],"LEFT_TORSO","\u5de6\u80f4"),e.const_set(x[0],"CENTER_TORSO","\u80f4\u4e2d\u592e"),e.const_set(x[0],"RIGHT_TORSO","\u53f3\u80f4"),e.const_set(x[0],"LEFT_ARM","\u5de6\u8155"),e.const_set(x[0],"RIGHT_ARM","\u53f3\u8155"),e.const_set(x[0],"LEFT_LEG","\u5de6\u811a"),e.const_set(x[0],"RIGHT_LEG","\u53f3\u811a"),e.const_set(x[0],"HEAD","\u982d"),e.const_set(x[0],"TABLES",B(["L","C","R","LU","CU","RU","LL","CL","RL"],{L:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u5de6\uff09","2D6",[[2,E.$new(I(x,"LEFT_TORSO"),!0)],[3,E.$new(I(x,"LEFT_LEG"),!1)],[z(4,5,!1),E.$new(I(x,"LEFT_ARM"),!1)],[6,E.$new(I(x,"LEFT_LEG"),!1)],[7,E.$new(I(x,"LEFT_TORSO"),!1)],[8,E.$new(I(x,"CENTER_TORSO"),!1)],[9,E.$new(I(x,"RIGHT_TORSO"),!1)],[10,E.$new(I(x,"RIGHT_ARM"),!1)],[11,E.$new(I(x,"RIGHT_LEG"),!1)],[12,E.$new(I(x,"HEAD"),!1)]]),C:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u6b63\u9762\uff09","2D6",[[2,E.$new(I(x,"CENTER_TORSO"),!0)],[z(3,4,!1),E.$new(I(x,"RIGHT_ARM"),!1)],[5,E.$new(I(x,"RIGHT_LEG"),!1)],[6,E.$new(I(x,"RIGHT_TORSO"),!1)],[7,E.$new(I(x,"CENTER_TORSO"),!1)],[8,E.$new(I(x,"LEFT_TORSO"),!1)],[9,E.$new(I(x,"LEFT_LEG"),!1)],[z(10,11,!1),E.$new(I(x,"LEFT_ARM"),!1)],[12,E.$new(I(x,"HEAD"),!1)]]),R:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u53f3\uff09","2D6",[[2,E.$new(I(x,"RIGHT_TORSO"),!0)],[3,E.$new(I(x,"RIGHT_LEG"),!1)],[z(4,5,!1),E.$new(I(x,"RIGHT_ARM"),!1)],[6,E.$new(I(x,"RIGHT_LEG"),!1)],[7,E.$new(I(x,"RIGHT_TORSO"),!1)],[8,E.$new(I(x,"CENTER_TORSO"),!1)],[9,E.$new(I(x,"LEFT_TORSO"),!1)],[10,E.$new(I(x,"LEFT_ARM"),!1)],[11,E.$new(I(x,"LEFT_LEG"),!1)],[12,E.$new(I(x,"HEAD"),!1)]]),LU:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u5de6\u4e0a\u534a\u8eab\uff09","1D6",[[z(1,2,!1),E.$new(I(x,"LEFT_TORSO"),!1)],[3,E.$new(I(x,"CENTER_TORSO"),!1)],[z(4,5,!1),E.$new(I(x,"LEFT_ARM"),!1)],[6,E.$new(I(x,"HEAD"),!1)]]),CU:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u6b63\u9762\u4e0a\u534a\u8eab\uff09","1D6",[[1,E.$new(I(x,"LEFT_ARM"),!1)],[2,E.$new(I(x,"LEFT_TORSO"),!1)],[3,E.$new(I(x,"CENTER_TORSO"),!1)],[4,E.$new(I(x,"RIGHT_TORSO"),!1)],[5,E.$new(I(x,"RIGHT_ARM"),!1)],[6,E.$new(I(x,"HEAD"),!1)]]),RU:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u53f3\u4e0a\u534a\u8eab\uff09","1D6",[[z(1,2,!1),E.$new(I(x,"RIGHT_TORSO"),!1)],[3,E.$new(I(x,"CENTER_TORSO"),!1)],[z(4,5,!1),E.$new(I(x,"RIGHT_ARM"),!1)],[6,E.$new(I(x,"HEAD"),!1)]]),LL:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u5de6\u4e0b\u534a\u8eab\uff09","1D6",[[z(1,6,!1),E.$new(I(x,"LEFT_LEG"),!1)]]),CL:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u53f3\u4e0b\u534a\u8eab\uff09","1D6",[[z(1,3,!1),E.$new(I(x,"RIGHT_LEG"),!1)],[z(4,6,!1),E.$new(I(x,"LEFT_LEG"),!1)]]),RL:C(I(x,"DiceTable"),"RangeTable").$new("\u547d\u4e2d\u90e8\u4f4d\u8868\uff08\u53f3\u4e0b\u534a\u8eab\uff09","1D6",[[z(1,6,!1),E.$new(I(x,"RIGHT_LEG"),!1)]])}).$freeze()),e.const_set(D[0],"XRM_DAMAGE_TABLES",B(["SRM2","SRM4","SRM6","LRM5","LRM10","LRM15","LRM20"],{SRM2:C(I(D,"DiceTable"),"RangeTable").$new("SRM2\u30c0\u30e1\u30fc\u30b8\u8868","2D6",[[z(2,7,!1),1],[z(8,12,!1),2]]),SRM4:C(I(D,"DiceTable"),"RangeTable").$new("SRM4\u30c0\u30e1\u30fc\u30b8\u8868","2D6",[[2,1],[z(3,6,!1),2],[z(7,10,!1),3],[z(11,12,!1),4]]),SRM6:C(I(D,"DiceTable"),"RangeTable").$new("SRM6\u30c0\u30e1\u30fc\u30b8\u8868","2D6",[[z(2,3,!1),2],[z(4,5,!1),3],[z(6,8,!1),4],[z(9,10,!1),5],[z(11,12,!1),6]]),LRM5:C(I(D,"DiceTable"),"RangeTable").$new("LRM5\u30c0\u30e1\u30fc\u30b8\u8868","2D6",[[2,1],[z(3,4,!1),2],[z(5,8,!1),3],[z(9,10,!1),4],[z(11,12,!1),5]]),LRM10:C(I(D,"DiceTable"),"RangeTable").$new("LRM10\u30c0\u30e1\u30fc\u30b8\u8868","2D6",[[z(2,3,!1),3],[4,4],[z(5,8,!1),6],[z(9,10,!1),8],[z(11,12,!1),10]]),LRM15:C(I(D,"DiceTable"),"RangeTable").$new("LRM15\u30c0\u30e1\u30fc\u30b8\u8868","2D6",[[z(2,3,!1),5],[4,6],[z(5,8,!1),9],[z(9,10,!1),12],[z(11,12,!1),15]]),LRM20:C(I(D,"DiceTable"),"RangeTable").$new("LRM20\u30c0\u30e1\u30fc\u30b8\u8868","2D6",[[z(2,3,!1),6],[4,9],[z(5,8,!1),12],[z(9,10,!1),16],[z(11,12,!1),20]])}).$freeze())}(Opal)}}]);