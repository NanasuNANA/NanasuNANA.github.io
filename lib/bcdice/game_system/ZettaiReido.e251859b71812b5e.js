(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4999],{4097:(ge,ye,be)=>{be(3986),Opal.modules["i18n/backend/fallbacks"]=function(e){var j,i,r,a,u,h,F=e.module,L=e.class_variable_set,_=e.truthy,C=e.class_variable_get,x=e.def,q=e.send,U=e.send2,z=e.find_super,I=e.hash2,A=e.find_block_super,w=e.neqeq,H=e.thrower,W=e.return_val,M=[],B=e.nil,l=e.$$$;return j=M,h=[u=F(M[0],"I18n")].concat(j),L(h[0],"@@fallbacks",B),i=e.get_singleton_class(u),r=[i].concat(h),a=e.$r(r),x(i,"$fallbacks",function(){var S=B;return L(r[1],"@@fallbacks",_(null!=r[1].$$cvars["@@fallbacks"]?"class variable":B)&&_(S=C(r[1],"@@fallbacks",!1))?S:l(l(a("I18n"),"Locale"),"Fallbacks").$new()),_(S=a("Thread").$current()["$[]"]("i18n_fallbacks"))?S:C(r[1],"@@fallbacks",!1)}),x(i,"$fallbacks=",function(N){var S;return L(r[1],"@@fallbacks",_(N["$is_a?"](a("Array")))?l(l(a("I18n"),"Locale"),"Fallbacks").$new(N):N),S=["i18n_fallbacks",C(r[1],"@@fallbacks",!1)],q(a("Thread").$current(),"[]=",S),S[S.length-1]}),function(i,T){var N,S,k,o,a=[F(i,"Backend")].concat(T);return N=a,k=[S=F(a[0],"Fallbacks")].concat(N),o=e.$r(k),x(S,"$translate",function p(v,y,c){try{var f=H("return"),s=p.$$p||B,D=this,E=B,d=B;return p.$$p=null,null==c&&(c=o("EMPTY_HASH")),_(c.$fetch("fallback",!0))?_(c["$[]"]("fallback_in_progress"))?U(D,z(D,"translate",p,!1,!0),"translate",[v,y,c],s):(_(c["$[]"]("default"))&&(E=D["$extract_non_symbol_default!"](c)),d=c.$merge(I(["fallback_in_progress"],{fallback_in_progress:!0})),q(o("I18n").$fallbacks()["$[]"](v),"each",[],function t(R){var n=null==t.$$s?this:t.$$s;null==R&&(R=B);try{return q(n,"catch",["exception"],function m(){var $=null==m.$$s?this:m.$$s,G=B;if(G=U($,A($,"translate",m.$$def||t.$$def||p,!1,!1),"translate",[R,y,d],null),_(G["$nil?"]()))return B;w(v.$to_s(),R.$to_s())&&$.$on_fallback(v,R,y,c),f.$throw(G)},{$$s:n,$$ret:f})}catch(m){if(!e.rescue(m,[l(o("I18n"),"InvalidLocale")]))throw m;try{return B}finally{e.pop_exception()}}},{$$s:D}),_(c["$key?"]("default"))&&_(c["$[]"]("default")["$nil?"]())?B:_(E)?U(D,z(D,"translate",p,!1,!0),"translate",[v,B,c.$merge(I(["default"],{default:E}))],null):D.$throw("exception",l(o("I18n"),"MissingTranslation").$new(v,y,c))):U(D,z(D,"translate",p,!1,!0),"translate",[v,y,c],s)}catch(t){if(t===f)return t.$v;throw t}},-3),x(S,"$extract_non_symbol_default!",function(v){var c,y=B;return y=[v["$[]"]("default")].$flatten(),c=q(y,"detect",[],function(s){return null==s&&(s=B),s["$is_a?"](o("Symbol"))["$!"]()}),_(c)&&v["$[]="]("default",y["$[]"](0,y.$index(c))),c}),x(S,"$exists?",function p(v,y,c){try{var f=H("return"),s=p.$$p||B,D=this;return p.$$p=null,null==c&&(c=o("EMPTY_HASH")),_(c.$fetch("fallback",!0))?(q(o("I18n").$fallbacks()["$[]"](v),"each",[],function E(d){var t=null==E.$$s?this:E.$$s;null==d&&(d=B);try{if(!_(U(t,A(t,"exists?",E.$$def||p,!1,!1),"exists?",[d,y],null)))return B;f.$throw(!0)}catch(R){if(!e.rescue(R,[l(o("I18n"),"InvalidLocale")]))throw R;try{return B}finally{e.pop_exception()}}},{$$s:D,$$ret:f}),!1):U(D,z(D,"exists?",p,!1,!0),"exists?",[v,y,c],s)}catch(E){if(E===f)return E.$v;throw E}},-3),S.$private(),x(S,"$on_fallback",W(B))}(h[0],h)},Opal.modules["bcdice/randomizer"]=function(e){var u,b,N,S,k,o,i,T,L=e.klass,_=e.const_set,C=e.def,x=e.truthy,q=e.rb_gt,U=e.rb_plus,z=e.rb_le,I=e.send,A=e.rb_minus,w=e.eqeq,H=e.rb_times,W=e.eqeqeq,M=e.rb_ge,B=[],l=e.nil,Y=e.$$$;return u=B,i=[(0,e.module)(B[0],"BCDice")].concat(u),T=e.$r(i),b=i,S=[N=L(i[0],null,"Randomizer")].concat(b),k=e.$r(S),(o=N.$$prototype).rand_results=o.detailed_rand_results=l,_(S[0],"UPPER_LIMIT_DICE_TIMES",200),_(S[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(S[0],"UPPER_LIMIT_RANDS",1e4),C(N,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),N.$attr_reader("rand_results"),N.$attr_reader("detailed_rand_results"),_(S[0],"DetailedRandResult",k("Struct").$new("kind","sides","value")),C(N,"$roll_barabara",function(v,y){var c=this;return x(q(U(c.rand_results.$size(),v),k("UPPER_LIMIT_RANDS")))&&c.$raise(k("TooManyRandsError")),x(z(v,0))||x(q(v,k("UPPER_LIMIT_DICE_TIMES")))?[]:I(k("Array"),"new",[v],function f(){return(null==f.$$s?this:f.$$s).$roll_once(y)},{$$s:c})}),C(N,"$roll_sum",function(v,y){return this.$roll_barabara(v,y).$sum()}),C(N,"$roll_once",function(v){var c=l;return x(z(v,0))||x(q(v,k("UPPER_LIMIT_DICE_SIDES")))?0:(c=this.$rand_inner(v),this.$push_to_detail("normal",v,c),c)}),C(N,"$roll_index",function(v){return A(this.$roll_once(v),1)}),C(N,"$roll_tens_d10",function(){var c,y=l;return y=this.$rand_inner(10),w(y,10)&&(y=0),c=H(y,10),this.$push_to_detail("tens_d10",10,c),c}),C(N,"$roll_d9",function(){var y;return y=A(this.$rand_inner(10),1),this.$push_to_detail("d9",10,y),y}),C(N,"$roll_d66",function(v){var f,c=l;return c=I(k("Array"),"new",[2],function s(){return(null==s.$$s?this:s.$$s).$roll_once(6)},{$$s:this}),W(Y(k("D66SortType"),"ASC"),f=v)?c["$sort!"]():W(Y(k("D66SortType"),"DESC"),f)&&c["$sort!"]()["$reverse!"](),U(H(c["$[]"](0),10),c["$[]"](1))}),N.$private(),C(N,"$rand_inner",function(v){var c,y=this;return x(M(y.rand_results.$size(),k("UPPER_LIMIT_RANDS")))&&y.$raise(k("TooManyRandsError")),c=y.$random(v),y.rand_results["$<<"]([c,v]),c}),C(N,"$random",function(v){return U(k("Kernel").$rand(v),1)}),C(N,"$push_to_detail",function(v,y,c){var s;return s=k("DetailedRandResult").$new(v,y,c),this.detailed_rand_results.$push(s)}),L(i[0],T("StandardError"),"TooManyRandsError"),l},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var I,W,j,u,h,i,T,B,w,F=e.module,L=e.klass,_=e.def,C=e.truthy,x=e.return_val,q=[],U=e.nil;return I=q,W=w=[F(q[0],"BCDice")].concat(I),j=B=[F(w[0],"DiceTable")].concat(W),h=[u=L(B[0],null,"RollResult")].concat(j),i=e.$r(h),(T=u.$$prototype).table_name=T.value=T.body=U,_(u,"$initialize",function(a,b,N){var S=this;return S.table_name=a,S.value=b,S.body=N}),u.$attr_reader("table_name"),u.$attr_reader("value"),u.$attr_reader("body"),_(u,"$to_s",function(){var a=this;return a.table_name+"("+a.value+") \uff1e "+a.body}),_(u,"$last_body",function(){var a=this;return C(a.body["$is_a?"](i("RollResult")))?a.body.$last_body():a.body}),_(u,"$empty?",x(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var I,W,j,u,h,i,T,B,w,F=e.module,L=e.klass,_=e.truthy,C=e.def,x=e.rb_minus,q=[],U=e.nil;return I=q,W=w=[F(q[0],"BCDice")].concat(I),j=B=[F(w[0],"DiceTable")].concat(W),h=[u=L(B[0],null,"ChainTable")].concat(j),i=e.$r(h),(T=u.$$prototype).times=T.sides=T.items=T.name=U,C(u,"$initialize",function(a,b,N){var S=this,k=U;return S.name=a,S.items=N.$freeze(),k=/(\d+)D(\d+)/i.$match(b),_(k)||S.$raise(i("ArgumentError"),"Unexpected table type: "+b),S.times=k["$[]"](1).$to_i(),S.sides=k["$[]"](2).$to_i()}),C(u,"$roll",function(a){var N,S,b=this,k=U;return N=a.$roll_sum(b.times,b.sides),S=x(N,b.times),k=b.items["$[]"](S),_(k["$respond_to?"]("roll"))&&(k=k.$roll(a)),i("RollResult").$new(b.name,N,k)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var H,l,i,T,r,a,b,j,M,F=e.module,L=e.klass,_=e.hash2,C=e.defs,x=e.def,q=e.rb_plus,U=e.rb_times,z=e.rb_minus,I=[],A=e.nil;return H=I,l=M=[F(I[0],"BCDice")].concat(H),i=j=[F(M[0],"DiceTable")].concat(l),r=[T=L(j[0],null,"D66GridTable")].concat(i),a=e.$r(r),(b=T.$$prototype).name=b.items=A,C(T,"$from_i18n",function(S,k){var p=A;return p=a("I18n").$t(S,_(["locale","raise"],{locale:k,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items"))}),x(T,"$initialize",function(S,k){return this.name=S,this.items=k.$freeze()}),x(T,"$roll",function(S){var o,p,v,y,c;return o=S.$roll_once(6),p=S.$roll_once(6),v=q(U(o,10),p),y=z(o,1),c=z(p,1),a("RollResult").$new(this.name,v,this.items["$[]"](y)["$[]"](c))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var A,M,h,i,T,r,l,Y,H,F=e.module,L=e.klass,_=e.hash2,C=e.defs,x=e.def,U=[],z=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),A=U,M=H=[F(U[0],"BCDice")].concat(A),l=[F(H[0],"DiceTable")].concat(M),Y=e.$r(l),h=l,T=[i=L(l[0],Y("D66GridTable"),"D66HalfGridTable")].concat(h),r=e.$r(T),C(i,"$from_i18n",function(b,N){var k=z;return k=r("I18n").$t(b,_(["locale","raise"],{locale:N,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2_3"),k["$[]"]("items_4_5_6"))}),x(i,"$initialize",function(b,N,S){return this.name=b,this.items=[N,N,N,S,S,S].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var A,M,h,i,T,r,l,Y,H,F=e.module,L=e.klass,_=e.hash2,C=e.defs,x=e.def,U=[],z=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),A=U,M=H=[F(U[0],"BCDice")].concat(A),l=[F(H[0],"DiceTable")].concat(M),Y=e.$r(l),h=l,T=[i=L(l[0],Y("D66GridTable"),"D66OneThirdTable")].concat(h),r=e.$r(T),C(i,"$from_i18n",function(b,N){var k=z;return k=r("I18n").$t(b,_(["locale","raise"],{locale:N,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2"),k["$[]"]("items_3_4"),k["$[]"]("items_5_6"))}),x(i,"$initialize",function(b,N,S,k){return this.name=b,this.items=[N,N,S,S,k,k].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var M,j,r,a,b,N,S,h,l,F=e.module,L=e.klass,_=e.hash2,C=e.defs,x=e.def,q=e.eqeqeq,U=e.rb_plus,z=e.rb_times,I=e.truthy,A=[],w=e.nil,H=e.$$$;return M=A,j=l=[F(A[0],"BCDice")].concat(M),r=h=[F(l[0],"DiceTable")].concat(j),b=[a=L(h[0],null,"D66Table")].concat(r),N=e.$r(b),(S=a.$$prototype).sort_type=S.items=S.name=w,C(a,"$from_i18n",function(o,p){var c,y=w;return y=N("I18n").$t(o,_(["locale"],{locale:p})),c=N("D66SortType").$const_get(y["$[]"]("d66_sort_type")),this.$new(y["$[]"]("name"),c,y["$[]"]("items"))}),x(a,"$initialize",function(o,p,v){var y=this;return y.name=o,y.sort_type=p,y.items=v.$freeze()}),x(a,"$roll",function(o){var p=this,v=w,y=w,c=w,f=w;return v=o.$roll_barabara(2,6),q(H(N("D66SortType"),"ASC"),y=p.sort_type)?v["$sort!"]():q(H(N("D66SortType"),"DESC"),y)&&v["$sort!"]()["$reverse!"](),c=U(z(v["$[]"](0),10),v["$[]"](1)),f=I(y=p.items["$[]"](c))?y:p.items["$[]"](c.$to_s()),I(f["$respond_to?"]("roll"))&&(f=f.$roll(o)),N("RollResult").$new(p.name,c,f)}),x(a,"$choice",function(o){return N("RollResult").$new(this.name,o,this.items["$[]"](o))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var B,u,i,T,Y,F=e.module,L=e.klass,_=e.hash2,C=e.send,x=e.to_ary,q=e.rb_plus,U=e.rb_times,z=e.send2,I=e.find_super,A=e.def,H=[],W=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),B=H,u=Y=[F(H[0],"BCDice")].concat(B),i=[F(Y[0],"DiceTable")].concat(u),T=e.$r(i),A(L(i[0],T("D66Table"),"D66LeftRangeTable"),"$initialize",function N(S,k,o){var y;return N.$$p=null,y=_([],{}),C(o,"each",[],function(f){var s,d;return null==f&&(f=W),s=x(f),d=null==s[1]?W:s[1],C(null==s[0]?W:s[0],"each",[],function(R){return null==R&&(R=W),C(d,"each_with_index",[],function(m,$){var G,Q;return null==m&&(m=W),null==$&&($=W),Q=q(U(R,10),q($,1)),C(y,"[]=",G=[Q,m]),G[G.length-1]})})}),z(this,I(this,"initialize",N,!1,!0),"initialize",[S,k,y],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var W,Y,T,r,a,b,N,u,B,F=e.module,L=e.klass,_=e.hash2,C=e.defs,x=e.def,q=e.truthy,U=e.rb_minus,z=e.rb_plus,I=e.rb_times,A=[],w=e.nil;return W=A,Y=B=[F(A[0],"BCDice")].concat(W),T=u=[F(B[0],"DiceTable")].concat(Y),a=[r=L(u[0],null,"D66ParityTable")].concat(T),b=e.$r(a),(N=r.$$prototype).odd=N.even=N.name=w,C(r,"$from_i18n",function(k,o){var v=w;return v=b("I18n").$t(k,_(["locale","raise"],{locale:o,raise:!0})),this.$new(v["$[]"]("name"),v["$[]"]("odd"),v["$[]"]("even"))}),x(r,"$initialize",function(k,o,p){var v=this;return v.name=k,v.odd=o.$freeze(),v.even=p.$freeze()}),x(r,"$roll",function(k){var v,c,f,o=this,p=w;return p=k.$roll_once(6),v=k.$roll_once(6),c=(q(p["$odd?"]())?o.odd:o.even)["$[]"](U(v,1)),f=z(I(p,10),v),b("RollResult").$new(o.name,f,c)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var A,M,u,h,i,T,r,l,H,F=e.module,L=e.klass,_=e.def,C=e.rb_plus,x=e.rb_times,q=e.send,U=[],z=e.nil;return A=U,M=H=[F(U[0],"BCDice")].concat(A),u=l=[F(H[0],"DiceTable")].concat(M),i=[h=L(l[0],null,"D66RangeTable")].concat(u),T=e.$r(i),(r=h.$$prototype).items=r.name=z,_(h,"$initialize",function(b,N){return this.name=b,this.items=N.$freeze()}),_(h,"$roll",function(b){var S,k,o,p=z;return S=b.$roll_once(6),k=b.$roll_once(6),o=C(x(S,10),k),p=q(this.items,"find",[],function(y){return null==y&&(y=z),y["$[]"](0)["$include?"](o)}),T("RollResult").$new(this.name,o,p["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var W,Y,T,r,a,b,N,u,B,F=e.module,L=e.klass,_=e.const_set,C=e.send,x=e.truthy,q=e.def,U=e.eqeqeq,z=e.rb_times,I=e.rb_plus,A=[],w=e.nil;return W=A,Y=B=[F(A[0],"BCDice")].concat(W),T=u=[F(B[0],"DiceTable")].concat(Y),a=[r=L(u[0],null,"RangeTable")].concat(T),b=e.$r(a),(N=r.$$prototype).name=N.items=N.num_of_dice=N.num_of_sides=N.formatter=w,_(a[0],"RollResult",C(b("Struct"),"new",["sum","values","content","formatted"],function S(){return(null==S.$$s?this:S.$$s).$alias_method("to_s","formatted")},{$$s:r})),_(a[0],"Item",b("Struct").$new("range","content")),_(a[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(a[0],"DEFAULT_FORMATTER",C(r,"lambda",[],function(k,o){return null==k&&(k=w),null==o&&(o=w),k.$name()+"("+o.$sum()+") \uff1e "+o.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),q(r,"$initialize",function S(k,o,p){var c,v=S.$$p||w,y=this,f=w;return S.$$p=null,y.name=k.$freeze(),y.formatter=x(c=v)?c:b("DEFAULT_FORMATTER"),f=b("DICE_ROLL_METHOD_RE").$match(o),x(f)||y.$raise(b("ArgumentError"),y.name+": invalid dice roll method: "+o),y.num_of_dice=f["$[]"](1).$to_i(),y.num_of_sides=f["$[]"](2).$to_i(),y.$store(p)}),q(r,"$fetch",function(k){var p,o=this;return p=C(o.items,"find",[],function(y){return null==y&&(y=w),y.$range()["$include?"](k)}),x(p)||o.$raise(b("RangeError"),o.name+": value is out of range: "+k),p}),q(r,"$roll",function(k){var v,o=this,p=w,y=w;return v=(p=k.$roll_barabara(o.num_of_dice,o.num_of_sides)).$sum(),(y=b("RollResult").$new(v,p,o.$fetch(v).$content()))["$formatted="](o.formatter["$[]"](o,y)),y}),r.$private(),q(r,"$store",function(k){var p,v,o=this;return p=C(k,"map",[],function y(c,f){return null==c&&(c=w),null==f&&(f=w),[(null==y.$$s?this:y.$$s).$coerce_to_int_range(c),f]},{$$s:o}),v=C(p,"sort_by",[],function(c,f){return null==c&&(c=w),null==f&&(f=w),c.$min()}),o.$assert_min_sum_is_covered(v),o.$assert_max_sum_is_covered(v),o.$assert_no_gap_or_overlap_in_ranges(v),o.items=C(v,"map",[],function(c,f){return null==c&&(c=w),null==f&&(f=w),b("Item").$new(c,f.$freeze()).$freeze()}).$freeze(),o}),q(r,"$coerce_to_int_range",function(k){var p;return U(b("Integer"),p=k)?b("Range").$new(k,k):U(b("Range"),p)&&x(k.$begin()["$is_a?"](b("Integer")))&&x(k.$end()["$is_a?"](b("Integer")))?k:this.$raise(b("TypeError"),this.name+": "+k+" ("+k.$class()+") must be an Integer or a Range with Integers ")}),q(r,"$assert_min_sum_is_covered",function(k){var p,o=this,v=w;return p=o.num_of_dice,v=k.$first()["$[]"](0),x(v["$include?"](p))||o.$raise(b("RangeError"),o.name+": min value ("+p+") is not covered: "+v),o}),q(r,"$assert_max_sum_is_covered",function(k){var p,o=this,v=w;return p=z(o.num_of_dice,o.num_of_sides),v=k.$last()["$[]"](0),x(v["$include?"](p))||o.$raise(b("RangeError"),o.name+": max value ("+p+") is not covered: "+v),o}),q(r,"$assert_no_gap_or_overlap_in_ranges",function(k){return C(k,"each_cons",[2],function p(v,y){var D,E,c=null==p.$$s?this:p.$$s,f=w,s=w;return null==c.name&&(c.name=w),null==v&&(v=w),null==y&&(y=w),f=v["$[]"](0),s=y["$[]"](0),D=f.$max(),E=I(D,1),x(s["$include?"](D))&&c.$raise(b("RangeError"),c.name+": Range overlap: "+f+" and "+s),x(s["$include?"](E))?w:c.$raise(b("RangeError"),c.name+": Range gap: "+f+" and "+s)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var w,B,h,b,N,S,k,T,Y,W,F=e.module,L=e.klass,_=e.send,C=e.def,x=e.rb_minus,q=e.return_ivar,U=[],z=e.nil,I=e.$$$;return w=U,B=W=[F(U[0],"BCDice")].concat(w),h=Y=[F(W[0],"DiceTable")].concat(B),b=T=[L(Y[0],null,"SaiFicSkillTable")].concat(h),S=[N=L(T[0],null,"Category")].concat(b),k=e.$r(S),C(N,"$initialize",function(p,v,y,c){var f=this;return f.name=p,f.skills=_(v.$map(),"with_index",[2],function(D,E){return null==D&&(D=z),null==E&&(E=z),I(k("SaiFicSkillTable"),"Skill").$new(p,D,y,E,c)}),f.dice=y}),C(N,"$roll",function(p){return this.$skills()["$[]"](x(p.$roll_sum(2,6),2))}),C(N,"$to_s",q("name")),N.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var z,H,Y,T,r,u,M,A,F=e.module,L=e.klass,_=e.def,C=e.hash2,x=[],q=e.nil;return z=x,H=A=[F(x[0],"BCDice")].concat(z),Y=M=[F(A[0],"DiceTable")].concat(H),u=[L(M[0],null,"SaiFicSkillTable")].concat(Y),(r=(T=L(u[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=q,_(T,"$initialize",function(b,N,S,k,o){var p=this;return p.category_name=b,p.name=N,p.category_dice=S,p.row_dice=k,p.s_format=o}),_(T,"$to_s",function(){var b=this;return b.$format(b.s_format,C(["category_dice","row_dice","category_name","skill_name"],{category_dice:b.category_dice,row_dice:b.row_dice,category_name:b.category_name,skill_name:b.name}))}),T.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var u,r,k,o,p,v,y,b,i,F=e.module,L=e.klass,_=e.ensure_kwargs,C=e.hash2,x=e.send,U=e.defs,z=e.const_set,I=e.to_ary,A=e.def,w=e.truthy,H=e.rb_minus,W=e.rb_plus,M=e.top,B=[],l=e.nil,Y=e.$$$;return M.$require("bcdice/dice_table/sai_fic_skill_table/category"),M.$require("bcdice/dice_table/sai_fic_skill_table/skill"),u=B,r=i=[F(B[0],"BCDice")].concat(u),k=b=[F(i[0],"DiceTable")].concat(r),p=[o=L(b[0],null,"SaiFicSkillTable")].concat(k),v=e.$r(p),(y=o.$$prototype).rtt=y.rtt_format=y.rct=y.rct_format=y.rttn=y.rttn_format=y.categories=l,U(o,"$from_i18n",function(f,s,D){var E,d,t,$,m=l;return null==(E=(D=_(D)).$$smap.rtt)&&(E=l),null==(d=D.$$smap.rct)&&(d=l),null==(t=D.$$smap.rttn)&&(t=l),$=(m=v("I18n").$t("RTT",C(["locale","raise","default"],{locale:s,raise:!1,default:C([],{})})).$merge(v("I18n").$t(f,C(["locale","raise"],{locale:s,raise:!0}))))["$[]"]("items"),m=x(m,"select",[],function(Q,Z){return null==Q&&(Q=l),null==Z&&(Z=l),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new($,e.to_hash(m).$merge(C(["rtt","rct","rttn"],{rtt:E,rct:d,rttn:t})))},-3),z(p[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),z(p[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),z(p[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),z(p[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),A(o,"$initialize",function(f,s){var D,E,d,t,R,n,m,$=this;return null==(D=(s=_(s)).$$smap.rtt)&&(D=l),null==(E=s.$$smap.rct)&&(E=l),null==(d=s.$$smap.rttn)&&(d=l),null==(t=s.$$smap.rtt_format)&&(t=v("DEFAULT_RTT")),null==(R=s.$$smap.rct_format)&&(R=v("DEFAULT_RCT")),null==(n=s.$$smap.rttn_format)&&(n=v("DEFAULT_RTTN")),null==(m=s.$$smap.s_format)&&(m=v("DEFAULT_S")),$.categories=x(f.$map(),"with_index",[1],function(Q,Z){var $e,ue,ie;return null==Q&&(Q=l),null==Z&&(Z=l),ue=null==($e=I(Q))[0]?l:$e[0],ie=null==$e[1]?l:$e[1],Y(v("SaiFicSkillTable"),"Category").$new(ue,ie,Z,m)},{$$has_top_level_mlhs_arg:!0}),$.rtt=D,$.rct=E,$.rttn=d.$to_a(),$.rtt_format=t,$.rct_format=R,$.rttn_format=n},-2),z(p[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),o.$attr_reader("categories"),A(o,"$roll_command",function(f,s){var E,D=this,d=l,t=l;return w(["RTT",D.rtt]["$include?"](E=s))?D.$format_skill(D.rtt_format,D.$roll_skill(f)):w(["RCT",D.rct]["$include?"](E))?(d=D.$roll_category(f),D.$format(D.rct_format,C(["category_dice","category_name"],{category_dice:d.$dice(),category_name:d.$name()}))):w(t=v("RTTN").$index(E))||w(t=D.rttn.$index(E))?D.$format_skill(D.rttn_format,D.categories["$[]"](t).$roll(f)):l}),A(o,"$roll_category",function(f){return this.categories["$[]"](H(f.$roll_once(6),1))}),A(o,"$roll_skill",function(f){return this.$roll_category(f).$roll(f)}),A(o,"$prefixes",function(){var f=this;return W(["RTT[1-6]?","RCT",f.rtt,f.rct],f.rttn).$compact()}),o.$private(),A(o,"$format_skill",function(f,s){return this.$format(f,C(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:s.$category_dice(),row_dice:s.$row_dice(),category_name:s.$category_name(),skill_name:s.$name(),text:s.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var w,B,h,i,T,r,a,Y,W,F=e.module,L=e.klass,_=e.hash2,C=e.defs,x=e.truthy,q=e.def,U=e.rb_minus,z=[],I=e.nil;return w=z,B=W=[F(z[0],"BCDice")].concat(w),h=Y=[F(W[0],"DiceTable")].concat(B),T=[i=L(Y[0],null,"Table")].concat(h),r=e.$r(T),(a=i.$$prototype).times=a.sides=a.name=a.items=I,C(i,"$from_i18n",function(N,S){var o=I;return o=r("I18n").$t(N,_(["locale"],{locale:S})),this.$new(o["$[]"]("name"),o["$[]"]("type"),o["$[]"]("items"))}),q(i,"$initialize",function(N,S,k){var o=this,p=I;return o.name=N,o.items=k.$freeze(),p=/(\d+)D(\d+)/i.$match(S),x(p)||o.$raise(r("ArgumentError"),"Unexpected table type: "+S),o.times=p["$[]"](1).$to_i(),o.sides=p["$[]"](2).$to_i()}),q(i,"$roll",function(N){var k,S=this;return k=N.$roll_sum(S.times,S.sides),S.$choice(k)}),q(i,"$choice",function(N){var k,S=this;return k=U(N,S.times),r("RollResult").$new(S.name,N,S.items["$[]"](k))})},Opal.modules["bcdice/dice_table"]=function(e){var F=e.top;return F.$require("bcdice/dice_table/roll_result"),F.$require("bcdice/dice_table/chain_table"),F.$require("bcdice/dice_table/d66_grid_table"),F.$require("bcdice/dice_table/d66_half_grid_table"),F.$require("bcdice/dice_table/d66_one_third_table"),F.$require("bcdice/dice_table/d66_left_range_table"),F.$require("bcdice/dice_table/d66_parity_table"),F.$require("bcdice/dice_table/d66_range_table"),F.$require("bcdice/dice_table/d66_table"),F.$require("bcdice/dice_table/range_table"),F.$require("bcdice/dice_table/sai_fic_skill_table"),F.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var q,A,H,z,F=e.module,L=e.const_set,_=[];return q=_,A=z=[F(_[0],"BCDice")].concat(q),H=[F(z[0],"D66SortType")].concat(A),L(H[0],"NO_SORT","no_sort"),L(H[0],"ASC","asc"),L(H[0],"DESC","desc"),function(I,A){var H=[F(I,"RoundType")].concat(A);return L(H[0],"CEIL","ceil"),L(H[0],"FLOOR","floor"),L(H[0],"ROUND","round")}(z[0],z)},Opal.modules["bcdice/translate"]=function(e){var A,M,B,l,Y,H,F=e.module,L=e.ensure_kwargs,_=e.kwrestargs,x=e.hash2,q=e.def,U=[],z=e.nil;return A=U,M=H=[F(U[0],"BCDice")].concat(A),l=[B=F(H[0],"Translate")].concat(M),Y=e.$r(l),q(B,"$translate",function(u,h){var i,T=this;return null==T.locale&&(T.locale=z),h=L(h),i=_(h,{}),Y("I18n").$translate(u,x(["locale","raise"],{locale:T.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var B,j,l,A,H,L=e.klass,_=e.send,C=e.def,x=e.return_val,q=e.return_ivar,U=[],z=e.nil;return A=U,B=H=[(0,e.module)(U[0],"BCDice")].concat(A),[l=L(H[0],null,"Result")].concat(B),C(j=e.get_singleton_class(l),"$success",function(i){return _(this.$new(),"tap",[],function(a){var b;return null==a&&(a=z),a["$text="](i),_(a,"success=",b=[!0]),b[b.length-1]})}),C(j,"$failure",function(i){return _(this.$new(),"tap",[],function(a){var b;return null==a&&(a=z),a["$text="](i),_(a,"failure=",b=[!0]),b[b.length-1]})}),C(j,"$critical",function(i){return _(this.$new(),"tap",[],function(a){var b;return null==a&&(a=z),a["$text="](i),a["$critical="](!0),_(a,"success=",b=[!0]),b[b.length-1]})}),C(j,"$fumble",function(i){return _(this.$new(),"tap",[],function(a){var b;return null==a&&(a=z),a["$text="](i),a["$fumble="](!0),_(a,"failure=",b=[!0]),b[b.length-1]})}),C(j,"$nothing",x("nothing")),C(l,"$initialize",function(u){var h=this;return null==u&&(u=z),h.text=u,h.rands=z,h.detailed_rands=z,h.secret=!1,h.success=!1,h.failure=!1,h.critical=!1,h.fumble=!1},-1),l.$attr_accessor("text","rands","detailed_rands"),l.$attr_writer("secret","success","failure","critical","fumble"),C(l,"$secret?",q("secret")),C(l,"$success?",q("success")),C(l,"$failure?",q("failure")),C(l,"$critical?",q("critical")),C(l,"$fumble?",q("fumble")),C(l,"$condition=",function(u){return this.success=u,this.failure=u["$!"]()})},Opal.modules["racc/parser"]=function(e){var N,k,o,F=e.module,L=e.klass,_=e.truthy,C=e.const_set,x=e.defs,q=e.gvars,U=e.rb_lt,z=e.def,I=e.to_ary,A=e.send,w=e.neqeq,H=e.rb_plus,W=e.eqeq,M=e.rb_ge,B=e.rb_gt,l=e.rb_minus,Y=e.rb_le,j=e.rb_times,u=e.assign_ivar_val,i=[],T=e.$r(i),r=e.nil,a=e.$$$;return N=i,k=[F(i[0],"Racc")].concat(N),o=e.$r(k),L(k[0],o("StandardError"),"ParseError"),_(a("::","ParseError","skip_raise")?"constant":r)||C(i[0],"ParseError",a(T("Racc"),"ParseError")),function(b,N){var c,f,s,D,E,o=[F(b,"Racc")].concat(N),p=e.$r(o);return _(p("Racc_No_Extensions","skip_raise")?"constant":r)||C(o[0],"Racc_No_Extensions",!1),c=o,s=[f=L(o[0],null,"Parser")].concat(c),D=e.$r(s),(E=f.$$prototype).yydebug=E.racc_debug_out=E.racc_error_status=E.racc_t=E.racc_vstack=E.racc_val=E.racc_state=E.racc_tstack=r,C(s[0],"Racc_Runtime_Version","1.4.6"),C(s[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),C(s[0],"Racc_Runtime_Core_Version_R","1.4.6"),C(s[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),C(s[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),C(s[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),C(s[0],"Racc_Runtime_Core_Version",D("Racc_Runtime_Core_Version_R")),C(s[0],"Racc_Runtime_Core_Revision",D("Racc_Runtime_Core_Revision_R")),C(s[0],"Racc_Runtime_Type","ruby"),x(D("Parser"),"$racc_runtime_type",function(){return D("Racc_Runtime_Type")}),z(f,"$_racc_setup",function(){var t,R,n=this,m=r,$=r;return null==q.stderr&&(q.stderr=r),_(a(n.$class(),"Racc_debug_parser"))||(n.yydebug=!1),_(null!=(t=n.yydebug)&&t!==r?"instance-variable":r)||(n.yydebug=!1),_(n.yydebug)&&(_(null!=(R=n.racc_debug_out)&&R!==r?"instance-variable":r)||(n.racc_debug_out=q.stderr),n.racc_debug_out=_(m=n.racc_debug_out)?m:q.stderr),$=a(n.$class(),"Racc_arg"),_(U($.$size(),14))&&$["$[]="](13,!0),$}),z(f,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),z(f,"$do_parse",function(){return this.$__send__(D("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),z(f,"$next_token",function(){return this.$raise(D("NotImplementedError"),this.$class()+"#next_token is not defined")}),z(f,"$_racc_do_parse_rb",function(t,R){var n,$=this,G=r,Q=r,Z=r,$e=r,ue=r,ie=r,ce=r,ae=r;return n=I(t),G=null==n[0]?r:n[0],Q=null==n[1]?r:n[1],Z=null==n[2]?r:n[2],$e=null==n[3]?r:n[3],ue=null==n[10]?r:n[10],$.$_racc_init_sysvars(),ie=ce=ae=r,A($,"catch",["racc_end_parse"],function re(){var se,K,g=null==re.$$s?this:re.$$s,V=r;for(null==g.racc_state&&(g.racc_state=r),null==g.racc_read_next&&(g.racc_read_next=r),null==g.racc_t&&(g.racc_t=r),null==g.yydebug&&(g.yydebug=r),null==g.racc_val&&(g.racc_val=r);_(!0);)for(_(ae=$e["$[]"](g.racc_state["$[]"](-1)))?(_(g.racc_read_next)&&w(g.racc_t,0)&&(K=g.$next_token(),se=I(K),ie=null==se[0]?r:se[0],g.racc_val=null==se[1]?r:se[1],g.racc_t=_(ie)?_(V=ue["$[]"](ie))?V:1:0,_(g.yydebug)&&g.$racc_read_token(g.racc_t,ie,g.racc_val),g.racc_read_next=!1),ae=H(ae,g.racc_t),_(M(ae,0))&&_(ce=G["$[]"](ae))&&W(Q["$[]"](ae),g.racc_state["$[]"](-1))||(ce=Z["$[]"](g.racc_state["$[]"](-1)))):ce=Z["$[]"](g.racc_state["$[]"](-1));_(ce=g.$_racc_evalact(ce,t)););},{$$s:$})}),z(f,"$yyparse",function(t,R){return this.$__send__(D("Racc_YY_Parse_Method"),t,R,this.$_racc_setup(),!0)}),z(f,"$_racc_yyparse_rb",function(t,R,n,m){var $,Q=this,Z=r,$e=r,ne=r,ue=r,ce=r,ae=r,re=r;return $=I(n),Z=null==$[0]?r:$[0],$e=null==$[1]?r:$[1],ne=null==$[2]?r:$[2],ue=null==$[3]?r:$[3],ce=null==$[10]?r:$[10],Q.$_racc_init_sysvars(),ae=r,re=r,A(Q,"catch",["racc_end_parse"],function se(){var K=null==se.$$s?this:se.$$s;for(null==K.racc_state&&(K.racc_state=r);!_(re=ue["$[]"](K.racc_state["$[]"](-1)));)for(;_(ae=K.$_racc_evalact(ne["$[]"](K.racc_state["$[]"](-1)),n)););return A(t,"__send__",[R],function g(V,X){var P=null==g.$$s?this:g.$$s,O=r,te=r;for(null==P.racc_t&&(P.racc_t=r),null==P.racc_state&&(P.racc_state=r),null==P.racc_read_next&&(P.racc_read_next=r),null==V&&(V=r),null==X&&(X=r),P.racc_t=_(V)?_(O=ce["$[]"](V))?O:1:0,P.racc_val=X,P.racc_read_next=!1,re=H(re,P.racc_t),_(M(re,0))&&_(ae=Z["$[]"](re))&&W($e["$[]"](re),P.racc_state["$[]"](-1))||(ae=ne["$[]"](P.racc_state["$[]"](-1)));_(ae=P.$_racc_evalact(ae,n)););for(;_(_(O=_(te=(re=ue["$[]"](P.racc_state["$[]"](-1)))["$!"]())?te:P.racc_read_next["$!"]())?O:P.racc_t["$=="](0));)for(_(re)&&_(re=H(re,P.racc_t))&&_(M(re,0))&&_(ae=Z["$[]"](re))&&W($e["$[]"](re),P.racc_state["$[]"](-1))||(ae=ne["$[]"](P.racc_state["$[]"](-1)));_(ae=P.$_racc_evalact(ae,n)););},{$$s:K})},{$$s:Q})}),z(f,"$_racc_evalact",function(t,R){var n,ne,$=this,G=r,Q=r,$e=r,ue=r,ie=r,ce=r;if(G=null==(n=I(R))[0]?r:n[0],Q=null==n[1]?r:n[1],$e=null==n[3]?r:n[3],ne=null==n[11]?r:n[11],ue=null==n[12]?r:n[12],_(B(t,0))&&_(U(t,ne)))_(B($.racc_error_status,0))&&(W($.racc_t,1)||($.racc_error_status=l($.racc_error_status,1))),$.racc_vstack.$push($.racc_val),$.racc_state.$push(t),$.racc_read_next=!0,_($.yydebug)&&($.racc_tstack.$push($.racc_t),$.$racc_shift($.racc_t,$.racc_tstack,$.racc_vstack));else if(_(U(t,0))&&_(B(t,ue["$-@"]()))){if(ie=A($,"catch",["racc_jump"],function ae(){var re=null==ae.$$s?this:ae.$$s;return null==re.racc_state&&(re.racc_state=r),re.racc_state.$push(re.$_racc_do_reduce(R,t)),!1},{$$s:$}),_(ie))switch(ie.valueOf()){case 1:return $.racc_user_yyerror=!0,ue["$-@"]();case 2:return ne;default:$.$raise("[Racc Bug] unknown jump code")}}else if(W(t,ne))_($.yydebug)&&$.$racc_accept(),$.$throw("racc_end_parse",$.racc_vstack["$[]"](0));else{if(W(t,ue["$-@"]())){switch($.racc_error_status.valueOf()){case 0:_(R["$[]"](21))||$.$on_error($.racc_t,$.racc_val,$.racc_vstack);break;case 3:W($.racc_t,0)&&$.$throw("racc_end_parse",r),$.racc_read_next=!0}for($.racc_user_yyerror=!1,$.racc_error_status=3;_(!0)&&!(_(ce=$e["$[]"]($.racc_state["$[]"](-1)))&&(ce=H(ce,1),_(M(ce,0))&&_(t=G["$[]"](ce))&&W(Q["$[]"](ce),$.racc_state["$[]"](-1))));)_(Y($.racc_state.$size(),1))&&$.$throw("racc_end_parse",r),$.racc_state.$pop(),$.racc_vstack.$pop(),_($.yydebug)&&($.racc_tstack.$pop(),$.$racc_e_pop($.racc_state,$.racc_tstack,$.racc_vstack));return t}$.$raise("[Racc Bug] unknown action "+t.$inspect())}return _($.yydebug)&&$.$racc_next_state($.racc_state["$[]"](-1),$.racc_state),r}),z(f,"$_racc_do_reduce",function(t,R){var n,ue,ce,V,X,P,ee,$=this,Q=r,Z=r,$e=r,ne=r,ie=r,ae=r,re=r,se=r,K=r,g=r,O=r,te=r,J=r;return Q=null==(n=I(t))[4]?r:n[4],Z=null==n[5]?r:n[5],$e=null==n[6]?r:n[6],ne=null==n[7]?r:n[7],ue=null==n[8]?r:n[8],ie=null==n[9]?r:n[9],ce=null==n[13]?r:n[13],ae=$.racc_state,re=$.racc_vstack,se=$.racc_tstack,K=j(R,-3),g=ie["$[]"](K),V=ie["$[]"](H(K,1)),X=ie["$[]"](H(K,2)),P=[],_($.yydebug)&&(O=se["$[]"](g["$-@"](),g)),te=re["$[]"](g["$-@"](),g),_($.yydebug)&&se["$[]="](g["$-@"](),g,P),re["$[]="](g["$-@"](),g,P),ae["$[]="](g["$-@"](),g,P),_(ce)?re.$push($.$__send__(X,te,re,te["$[]"](0))):re.$push($.$__send__(X,te,re)),se.$push(V),_($.yydebug)&&$.$racc_reduce(O,V,se,re),ee=l(V,ue),_(K=ne["$[]"](ee))&&(K=H(K,ae["$[]"](-1)),_(M(K,0))&&_(J=Q["$[]"](K))&&W(Z["$[]"](K),ee))?J:$e["$[]"](ee)}),z(f,"$on_error",function(t,R,n){var $,m=this;return m.$raise(D("ParseError"),m.$sprintf("\nparse error on value %s (%s)",R.$inspect(),_($=m.$token_to_str(t))?$:"?"))}),z(f,"$yyerror",function(){return this.$throw("racc_jump",1)}),z(f,"$yyaccept",function(){return this.$throw("racc_jump",2)}),z(f,"$yyerrok",u("racc_error_status",0)),z(f,"$racc_read_token",function(t,R,n){var m=this;return m.racc_debug_out.$print("read    "),m.racc_debug_out.$print(R.$inspect(),"(",m.$racc_token2str(t),") "),m.racc_debug_out.$puts(n.$inspect()),m.racc_debug_out.$puts()}),z(f,"$racc_shift",function(t,R,n){var m=this;return m.racc_debug_out.$puts("shift   "+m.$racc_token2str(t)),m.$racc_print_stacks(R,n),m.racc_debug_out.$puts()}),z(f,"$racc_reduce",function(t,R,n,m){var $=this,G=r;return(G=$.racc_debug_out).$print("reduce "),_(t["$empty?"]())?G.$print(" <none>"):A(t,"each",[],function Q(Z){return null==Z&&(Z=r),G.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(Z))},{$$s:$}),G.$puts(" --\x3e "+$.$racc_token2str(R)),$.$racc_print_stacks(n,m),$.racc_debug_out.$puts()}),z(f,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),z(f,"$racc_e_pop",function(t,R,n){var m=this;return m.racc_debug_out.$puts("error recovering mode: pop token"),m.$racc_print_states(t),m.$racc_print_stacks(R,n),m.racc_debug_out.$puts()}),z(f,"$racc_next_state",function(t,R){var n=this;return n.racc_debug_out.$puts("goto    "+t),n.$racc_print_states(R),n.racc_debug_out.$puts()}),z(f,"$racc_print_stacks",function(t,R){var m=r;return(m=this.racc_debug_out).$print("        ["),A(t,"each_index",[],function $(G){return null==G&&(G=r),m.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(t["$[]"](G))," ",R["$[]"](G).$inspect(),")")},{$$s:this}),m.$puts(" ]")}),z(f,"$racc_print_states",function(t){var n=r;return(n=this.racc_debug_out).$print("        ["),A(t,"each",[],function($){return null==$&&($=r),n.$print(" ",$)}),n.$puts(" ]")}),z(f,"$racc_token2str",function(t){var n;return _(n=a(this.$class(),"Racc_token_to_s_table")["$[]"](t))?n:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),z(f,"$token_to_str",function(t){return a(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var u,r,S,c,f,o,p,b,i,F=e.module,L=e.klass,_=e.def,C=e.thrower,x=e.return_ivar,q=e.send2,U=e.find_super,z=e.eqeq,I=e.const_set,A=e.eqeqeq,w=e.rb_divide,H=e.truthy,W=e.assign_ivar,M=e.alias,B=[],l=e.nil,Y=e.$$$;return u=B,r=i=[F(B[0],"BCDice")].concat(u),S=b=[F(i[0],"Arithmetic")].concat(r),o=[F(b[0],"Node")].concat(S),p=e.$r(o),(f=(c=L(o[0],null,"BinaryOp")).$$prototype).lhs=f.rhs=f.op=l,_(c,"$initialize",function(D,E,d){var t=this;return t.lhs=D,t.op=E,t.rhs=d}),_(c,"$eval",function(D){try{C("eval_return");var R,d=this,t=l;return t=d.lhs.$eval(D),R=d.rhs.$eval(D),t.$send(d.op,R)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),_(c,"$output",function(){var D=this;return""+D.lhs.$output()+D.op+D.rhs.$output()}),_(c,"$s_exp",function(){var D=this;return"("+D.$op_for_s_exp()+" "+D.lhs.$s_exp()+" "+D.rhs.$s_exp()+")"}),_(c,"$op_for_s_exp",x("op")),function(v,y,c){var f=L(v,y,"DivideBase"),s=[f].concat(c),D=e.$r(s),E=f.$$prototype;E.lhs=E.rhs=E.op=l,_(f,"$initialize",function d(t,R){return d.$$p=null,q(this,U(this,"initialize",d,!1,!0),"initialize",[t,"/",R],null)}),_(f,"$eval",function(t){try{C("eval_return");var m,$,n=this;return m=n.lhs.$eval(t),$=n.rhs.$eval(t),z($,0)&&n.$raise(D("ZeroDivisionError")),n.$divide_and_round(m,$,t)}catch(G){if(G===e.t_eval_return)return G.$v;throw G}}),_(f,"$output",function d(){var t=d.$$p||l,R=this;return d.$$p=null,""+q(R,U(R,"output",d,!1,!0),"output",[],t)+R.$rounding_method()}),f.$private(),_(f,"$rounding_method",function(){return Y(this.$class(),"ROUNDING_METHOD")}),_(f,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(f,"$divide_and_round",function(t,R,n){return this.$raise(D("NotImplementedError"))})}(o[0],p("BinaryOp"),o),function(v,y,c){var f=L(v,y,"DivideWithGameSystemDefault"),s=[f].concat(c),D=e.$r(s);I(s[0],"ROUNDING_METHOD",""),f.$private(),_(f,"$divide_and_round",function(d,t,R){var n,m=l;return A(Y(D("RoundType"),"CEIL"),n=R)?w(d.$to_f(),t).$ceil():A(Y(D("RoundType"),"ROUND"),n)?(m=w(d.$to_f(),t),H(m["$negative?"]())?m.$abs().$round()["$-@"]():m.$round()):w(d,t).$floor()})}(o[0],p("DivideBase"),o),function(v,y,c){var f=L(v,y,"DivideWithCeil"),s=[f].concat(c);I(s[0],"ROUNDING_METHOD","C"),f.$private(),_(f,"$divide_and_round",function(E,d,t){return w(E.$to_f(),d).$ceil()})}(o[0],p("DivideBase"),o),function(v,y,c){var f=L(v,y,"DivideWithRound"),s=[f].concat(c);I(s[0],"ROUNDING_METHOD","R"),f.$private(),_(f,"$divide_and_round",function(E,d,t){var R=l;return R=w(E.$to_f(),d),H(R["$negative?"]())?R.$abs().$round()["$-@"]():R.$round()})}(o[0],p("DivideBase"),o),function(v,y,c){var f=L(v,y,"DivideWithFloor"),s=[f].concat(c);I(s[0],"ROUNDING_METHOD","F"),f.$private(),_(f,"$divide_and_round",function(E,d,t){return w(E,d).$floor()})}(o[0],p("DivideBase"),o),function(v,y){var c=L(v,null,"Negative");c.$$prototype.body=l,_(c,"$initialize",W("body")),_(c,"$eval",function(D){try{return C("eval_return"),this.body.$eval(D)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),_(c,"$output",function(){return"-"+this.body.$output()}),_(c,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(o[0]),function(v,y){var c=L(v,null,"Parenthesis");c.$$prototype.expr=l,_(c,"$initialize",W("expr")),_(c,"$eval",function(D){try{return C("eval_return"),this.expr.$eval(D)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),_(c,"$output",function(){return"("+this.expr.$output()+")"}),_(c,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(o[0]),function(v,y){var c=L(v,null,"Number");return c.$$prototype.value=l,_(c,"$initialize",W("value")),_(c,"$eval",x("value")),_(c,"$output",function(){return this.value.$to_s()}),M(c,"s_exp","output")}(o[0])},Opal.modules.strscan=function(e){var W,M,B,l,Y,L=e.def,_=e.truthy,C=e.eqeqeq,x=e.Opal,q=e.return_ivar,U=e.send,z=e.alias,I=[],A=e.nil;return W=I,B=[M=(0,e.klass)(I[0],null,"StringScanner")].concat(W),l=e.$r(B),(Y=M.$$prototype).pos=Y.string=Y.working=Y.matched=Y.prev_pos=Y.match=A,M.$attr_reader("pos","matched"),L(M,"$initialize",function(u){var h=this;return h.string=u,h.pos=0,h.matched=A,h.working=u,h.match=[]}),M.$attr_reader("string"),L(M,"$beginning_of_line?",function(){var u=this;return 0===u.pos||"\n"===u.string.charAt(u.pos-1)}),L(M,"$scan",function(u){var h=this,i=(u=h.$anchor(u)).exec(h.working);return null==i?h.matched=A:(h.prev_pos=h.pos,h.pos+=i[0].length,h.working=h.working.substring(i[0].length),h.matched=i[0],h.match=i,i[0])}),L(M,"$scan_until",function(u){var h=this;u=h.$anchor(u);for(var i=h.working,T=0;i.length!=T;++T){var r=u.exec(i.substr(T));if(null!==r){var a=T+r[0].length,b=i.substr(0,a);return h.matched=r[0],h.match=r,h.prev_pos=h.pos+T,h.pos+=a,h.working=i.substr(a),b}}return h.matched=A}),L(M,"$[]",function(u){var i;if(_(this.match["$empty?"]()))return A;C(l("Symbol"),i=u)?u=u.$to_s():C(l("String"),i)||(u=x["$coerce_to!"](u,l("Integer"),"to_int"));var T=this.match;return u<0&&(u+=T.length),u<0||u>=T.length||null==T[u]?A:T[u]}),L(M,"$check",function(u){var h=this,i=(u=h.$anchor(u)).exec(h.working);return h.matched=null==i?A:i[0]}),L(M,"$check_until",function(u){var h=this,i=h.prev_pos,T=h.pos,r=h.working,a=h.$scan_until(u);return h.prev_pos=i,h.pos=T,h.working=r,a}),L(M,"$peek",function(u){return this.working.substring(0,u)}),L(M,"$eos?",function(){return 0===this.working.length}),L(M,"$exist?",function(u){var i=u.exec(this.working);return null==i?A:0==i.index?0:i.index+1}),L(M,"$skip",function(u){var h=this,i=(u=h.$anchor(u)).exec(h.working);if(null==i)return h.match=[],h.matched=A;var T=i[0],r=T.length;return h.matched=T,h.match=i,h.prev_pos=h.pos,h.pos+=r,h.working=h.working.substring(r),r}),L(M,"$skip_until",function(u){var i=this.$scan_until(u);return i===A?A:(this.matched=i.substr(-1),i.length)}),L(M,"$get_byte",function(){var u=this,h=A;return u.pos<u.string.length?(u.prev_pos=u.pos,u.pos+=1,h=u.matched=u.working.substring(0,1),u.working=u.working.substring(1)):u.matched=A,h}),L(M,"$match?",function(u){var h=this,i=(u=h.$anchor(u)).exec(h.working);return null==i?A:(h.prev_pos=h.pos,i[0].length)}),L(M,"$pos=",function(u){var h=this;return u<0&&(u+=h.string.$length()),h.pos=u,h.working=h.string.slice(u)}),L(M,"$matched_size",function(){return this.matched===A?A:this.matched.length}),L(M,"$post_match",function(){var u=this;return u.matched===A?A:u.string.substr(u.pos)}),L(M,"$pre_match",function(){var u=this;return u.matched===A?A:u.string.substr(0,u.prev_pos)}),L(M,"$reset",function(){var u=this;return u.working=u.string,u.matched=A,u.pos=0}),L(M,"$rest",q("working")),L(M,"$rest?",function(){return 0!==this.working.length}),L(M,"$rest_size",function(){return this.$rest().$size()}),L(M,"$terminate",function(){var u,h=this;return h.match=A,u=[h.string.$length()],U(h,"pos=",u),u[u.length-1]}),L(M,"$unscan",function(){var u=this;return u.pos=u.prev_pos,u.prev_pos=A,u.match=A,u}),z(M,"bol?","beginning_of_line?"),z(M,"getch","get_byte"),M.$private(),L(M,"$anchor",function(u){var h=u.toString().match(/\/([^\/]+)$/);return h=h?h[1]:void 0,new RegExp("^(?:"+u.source+")",h)})},Opal.modules["bcdice/normalize"]=function(e){var z,H,A,F=e.module,L=e.eqeqeq,_=e.def,C=e.eqeq,x=[],q=e.nil;return z=x,A=[F(x[0],"BCDice")].concat(z),(H=F(A[0],"Normalize")).$module_function(),_(H,"$comparison_operator",function(M){var B;return L(/<=|=</,B=M)?"<=":L(/>=|=>/,B)?">=":L(/<>|!=|=!/,B)?"!=":L(/</,B)?"<":L(/>/,B)?">":L(/=/,B)?"==":q}),_(H,"$target_number",function(M){return C(M,"?")?M:M.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var W,Y,T,r,a,b,N,u,B,F=e.module,L=e.klass,_=e.const_set,C=e.hash2,x=e.truthy,q=e.send,U=e.def,z=e.thrower,I=e.top,A=[],w=e.nil;return I.$require("strscan"),I.$require("bcdice/normalize"),W=A,Y=B=[F(A[0],"BCDice")].concat(W),T=u=[F(B[0],"Command")].concat(Y),a=[r=L(u[0],null,"Lexer")].concat(T),b=e.$r(a),(N=r.$$prototype).scanner=N.notations=w,_(a[0],"SYMBOLS",C(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),U(r,"$initialize",function(k,o){var p,v,c;return k=x(c=(p=(v=k)===w||null==v?w:v.$split(" ",2))===w||null==p?w:p.$first())?c:"",this.scanner=b("StringScanner").$new(k),this.notations=q(o,"map",[],function(s){return null==s&&(s=w),x(s["$is_a?"](b("String")))?b("Regexp").$new(s):s})}),U(r,"$next_token",function(){try{var k=z("return"),o=this,p=w,v=w,c=w,f=w;return x(o.scanner["$eos?"]())?[!1,"$"]:(q(o.notations,"each",[],function s(D){var d,E=null==s.$$s?this:s.$$s;if(null==E.scanner&&(E.scanner=w),null==D&&(D=w),d=E.scanner.$scan(D),!x(d))return w;k.$throw(["NOTATION",d])},{$$s:o,$$ret:k}),x(p=o.scanner.$scan(/\d+/))?["NUMBER",p.$to_i()]:x(v=o.scanner.$scan(/[<>!=]+/))?(v=b("Normalize").$comparison_operator(v),[x(v)?"CMP_OP":"ILLEGAL",v]):(c=o.scanner.$getch().$upcase(),[x(f=b("SYMBOLS")["$[]"](c))?f:c.$to_sym(),c]))}catch(s){if(s===k)return s.$v;throw s}}),U(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var I,W,j,u,h,i,T,B,w,F=e.module,L=e.klass,_=e.def,C=e.return_ivar,x=e.truthy,q=[],U=e.nil;return I=q,W=w=[F(q[0],"BCDice")].concat(I),j=B=[F(w[0],"Command")].concat(W),h=[u=L(B[0],null,"Parsed")].concat(j),i=e.$r(h),(T=u.$$prototype).critical=T.fumble=T.dollar=T.modify_number=T.question_target=T.target_number=T.prefix_number=T.command=T.suffix_number=T.cmp_op=U,u.$attr_accessor("command"),u.$attr_accessor("prefix_number"),u.$attr_accessor("suffix_number"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),_(u,"$initialize",function(){var a=this;return a.prefix_number=U,a.suffix_number=U,a.critical=U,a.fumble=U,a.dollar=U,a.cmp_op=U,a.target_number=U,a.question_target=!1}),_(u,"$question_target?",C("question_target")),_(u,"$to_s",function(a){var b=this,N=U,S=U,k=U,o=U,p=U;switch(null==a&&(a="after_command"),N=x(b.critical)?"@"+b.critical:U,S=x(b.fumble)?"#"+b.fumble:U,k=x(b.dollar)?"$"+b.dollar:U,o=i("Format").$modifier(b.modify_number),p=x(b.question_target)?"?":b.target_number,a.valueOf()){case"after_command":return[b.prefix_number,b.command,b.suffix_number,N,S,k,o,b.cmp_op,p].$join();case"after_modify_number":return[b.prefix_number,b.command,b.suffix_number,o,N,S,k,b.cmp_op,p].$join();case"after_target_number":return[b.prefix_number,b.command,b.suffix_number,o,b.cmp_op,p,N,S,k].$join();default:return U}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var a,k,f,R,n,m,$,G,Q,Z,$e,ne,ce,s,d,t,se,p,v,N,F=e.klass,L=e.module,_=e.slice,C=e.extract_kwargs,x=e.ensure_kwargs,q=e.get_kwarg,U=e.send2,z=e.find_super,I=e.def,A=e.send,w=e.eqeq,H=e.thrower,W=e.hash,M=e.const_set,B=e.truthy,l=e.to_ary,Y=e.hash2,j=e.top,u=[],h=e.$r(u),i=e.nil,T=e.$$$;return j.$require("racc/parser.rb"),j.$require("bcdice/arithmetic/node"),j.$require("bcdice/command/lexer"),j.$require("bcdice/command/parsed"),F(T(h("BCDice"),"Command"),T(h("Racc"),"Parser"),"Parser"),a=u,k=N=[L(u[0],"BCDice")].concat(a),p=[L(N[0],"Command")].concat(k),v=e.$r(p),f=p,d=[s=F(p[0],T(v("Racc"),"Parser"),"Parser")].concat(f),t=e.$r(d),(se=s.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=i,I(s,"$initialize",function K(g,V){var X,P,O,te,J=this;return K.$$p=null,X=_(arguments),P=C(X),P=x(P),O=X,te=q(P,"round_type"),U(J,z(J,"initialize",K,!1,!0),"initialize",[],null),J.notations=O,J.round_type=te,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[i,">=",">","<=","<","==","!="],J.question_target=!1},-2),I(s,"$disable_modifier",function(){return this.modifier=!1,this}),I(s,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),I(s,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),I(s,"$has_prefix_number",function(){var g=this;return g.prefix_number=!0,g.need_prefix_number=!0,g}),I(s,"$has_suffix_number",function(){var g=this;return g.suffix_number=!0,g.need_suffix_number=!0,g}),I(s,"$enable_critical",function(){return this.critical=!0,this}),I(s,"$enable_fumble",function(){return this.fumble=!0,this}),I(s,"$enable_dollar",function(){return this.dollar=!0,this}),I(s,"$restrict_cmp_op_to",function(g){var V;return V=_(arguments),this.allowed_cmp_op=V,this},-1),I(s,"$enable_question_target",function(){return this.question_target=!0,this}),I(s,"$parse",function(g){var V=this;try{return V.lexer=t("Lexer").$new(g,V.notations),V.$do_parse()}catch(X){if(!e.rescue(X,[t("ParseError"),t("ZeroDivisionError")]))throw X;try{return i}finally{e.pop_exception()}}}),s.$private(),I(s,"$parsed",function(g,V,X,P){try{return H("eval_return"),A(t("Parsed").$new(),"tap",[],function ee(J){var _e,le,de,me,ve,fe,he,oe=null==ee.$$s?this:ee.$$s;return null==oe.round_type&&(oe.round_type=i),null==J&&(J=i),J["$command="](g["$[]"]("command")),J["$prefix_number="]((_e=g["$[]"]("prefix"))===i||null==_e?i:_e.$eval(oe.round_type)),J["$suffix_number="]((le=g["$[]"]("suffix"))===i||null==le?i:le.$eval(oe.round_type)),J["$critical="]((de=V["$[]"]("critical"))===i||null==de?i:de.$eval(oe.round_type)),J["$fumble="]((me=V["$[]"]("fumble"))===i||null==me?i:me.$eval(oe.round_type)),J["$dollar="]((ve=V["$[]"]("dollar"))===i||null==ve?i:ve.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](P["$[]"]("cmp_op")),w(P["$[]"]("target"),"?")?(J["$question_target="](!0),A(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(he=P["$[]"]("target"),he===i||null==he?i:he.$eval(oe.round_type))],A(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),I(s,"$next_token",function(){return this.lexer.$next_token()}),R=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),m=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),$=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),G=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),Z=[i,6,13,3,9,-1,27,-15,-10,-1,-38],$e=[i,i,i,i,i,i,19,16,15,i,i],ne=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ce=W(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),M(d[0],"Racc_arg",[R,n,$,m,G,Q,$e,Z,19,ne,ce,58,35,!0]),B(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_arg")),M(d[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),B(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),M(d[0],"Racc_debug_parser",!1),I(s,"$_reduce_1",function(g,V,X){var P;return B(this.modifier)||this.$raise(t("ParseError")),P=l(g),this.$parsed(null==P[0]?i:P[0],null==P[1]?i:P[1],null==P[2]?i:P[2],null==P[3]?i:P[3])}),I(s,"$_reduce_2",function(g,V,X){var P;return B(this.modifier)||this.$raise(t("ParseError")),P=l(g),this.$parsed(null==P[0]?i:P[0],null==P[2]?i:P[2],null==P[1]?i:P[1],null==P[3]?i:P[3])}),I(s,"$_reduce_3",function(g,V,X){var P,_e;return _e=null==(P=l(g))[2]?i:P[2],this.$parsed(null==P[0]?i:P[0],null==P[1]?i:P[1],T(T(t("Arithmetic"),"Node"),"Number").$new(0),_e)}),I(s,"$_reduce_4",function(g,V,X){var P=this;return B(P.prefix_number)&&B(P.suffix_number)||P.$raise(t("ParseError")),Y(["command","prefix","suffix"],{command:g["$[]"](1),prefix:g["$[]"](0),suffix:g["$[]"](2)})}),I(s,"$_reduce_5",function(g,V,X){var P=this;return B(P.prefix_number)||P.$raise(t("ParseError")),B(P.need_suffix_number)&&P.$raise(t("ParseError")),Y(["command","prefix"],{command:g["$[]"](1),prefix:g["$[]"](0)})}),I(s,"$_reduce_6",function(g,V,X){var P=this;return B(P.suffix_number)||P.$raise(t("ParseError")),B(P.need_prefix_number)&&P.$raise(t("ParseError")),Y(["command","suffix"],{command:g["$[]"](0),suffix:g["$[]"](1)})}),I(s,"$_reduce_7",function(g,V,X){var P=this;return(B(P.need_prefix_number)||B(P.need_suffix_number))&&P.$raise(t("ParseError")),Y(["command"],{command:g["$[]"](0)})}),I(s,"$_reduce_8",function(g,V,X){return Y([],{})}),I(s,"$_reduce_9",function(g,V,X){var P,_e,ee=i;return ee=null==(P=l(g))[0]?i:P[0],_e=null==P[2]?i:P[2],B(this.critical)&&B(ee["$[]"]("critical")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("critical",_e),ee}),I(s,"$_reduce_10",function(g,V,X){var P,_e,ee=i;return ee=null==(P=l(g))[0]?i:P[0],_e=null==P[2]?i:P[2],B(this.fumble)&&B(ee["$[]"]("fumble")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("fumble",_e),ee}),I(s,"$_reduce_11",function(g,V,X){var P,_e,ee=i;return ee=null==(P=l(g))[0]?i:P[0],_e=null==P[2]?i:P[2],B(this.dollar)&&B(ee["$[]"]("dollar")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("dollar",_e),ee}),I(s,"$_reduce_12",function(g,V,X){return g["$[]"](1)}),I(s,"$_reduce_13",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),I(s,"$_reduce_14",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),I(s,"$_reduce_15",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),I(s,"$_reduce_16",function(g,V,X){return B(this.allowed_cmp_op["$include?"](i))||this.$raise(t("ParseError")),Y([],{})}),I(s,"$_reduce_17",function(g,V,X){var P,ee,J;return J=null==(P=l(g))[1]?i:P[1],B(this.allowed_cmp_op["$include?"](ee=null==P[0]?i:P[0]))||this.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:ee,target:J})}),I(s,"$_reduce_18",function(g,V,X){var O,P=this;return O=g["$[]"](0),B(P.question_target)||P.$raise(t("ParseError")),B(P.allowed_cmp_op["$include?"](O))||P.$raise(t("ParseError")),Y(["cmp_op","target"],{cmp_op:O,target:"?"})}),I(s,"$_reduce_19",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"+",g["$[]"](2))}),I(s,"$_reduce_20",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"-",g["$[]"](2))}),I(s,"$_reduce_22",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"BinaryOp").$new(g["$[]"](0),"*",g["$[]"](2))}),I(s,"$_reduce_23",function(g,V,X){return g["$[]"](3).$new(g["$[]"](0),g["$[]"](2))}),I(s,"$_reduce_25",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),I(s,"$_reduce_26",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"DivideWithCeil")}),I(s,"$_reduce_27",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"DivideWithCeil")}),I(s,"$_reduce_28",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"DivideWithRound")}),I(s,"$_reduce_29",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"DivideWithFloor")}),I(s,"$_reduce_30",function(g,V,X){return g["$[]"](1)}),I(s,"$_reduce_31",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"Negative").$new(g["$[]"](1))}),I(s,"$_reduce_33",function(g,V,X){return g["$[]"](1)}),I(s,"$_reduce_34",function(g,V,X){return T(T(t("Arithmetic"),"Node"),"Number").$new(g["$[]"](0))}),I(s,"$_reduce_none",function(g,V,X){return g["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var A,M,j,u,h,i,l,H,F=e.module,L=e.send,_=e.eqeqeq,C=e.truthy,x=e.def,q=e.return_val,U=[],z=e.nil;return A=U,M=H=[F(U[0],"BCDice")].concat(A),j=l=[F(H[0],"Deprecated")].concat(M),h=[u=F(l[0],"Checker")].concat(j),i=e.$r(h),u.$private(),x(u,"$check_result_legacy",function(r,a,b,N){var p,S=this,k=z,o=z,v=z,y=z;return k=L(a,"map",[],"sides".$to_proc()),p=(o=L(a,"map",[],"value".$to_proc())).$sum(),v=_([100],y=k)?S.$check_1D100(r,p,b,N):_([20],y)?S.$check_1D20(r,p,b,N):_([6,6],y)?S.$check_2D6(r,p,o,b,N):z,(C(v["$nil?"]())||C(v["$empty?"]()))&&(v=_([10],y=k.$uniq())?S.$check_nD10(r,p,o,b,N):_([6],y)?S.$check_nD6(r,p,o,b,N):z,C(v["$nil?"]())||C(v["$empty?"]()))?z:i("Result").$new(v.$delete_prefix(" \uff1e "))}),x(u,"$check_1D100",q(z)),x(u,"$check_1D20",q(z)),x(u,"$check_nD10",q(z)),x(u,"$check_2D6",q(z)),x(u,"$check_nD6",q(z))},Opal.modules["bcdice/base"]=function(e){var h,S,y,E,t,R,c,f,s,D,o,F=e.module,L=e.klass,_=e.slice,C=e.rb_plus,x=e.truthy,q=e.def,U=e.regexp,z=e.send,I=e.thrower,A=e.return_ivar,w=e.assign_ivar_val,H=e.eqeqeq,W=e.eqeq,M=e.return_val,B=e.range,l=e.rb_minus,Y=e.rb_divide,j=e.rb_times,u=e.rb_ge,i=e.top,T=[],r=e.$r(T),a=e.nil,b=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),S=T,y=o=[F(T[0],"BCDice")].concat(S),f=[c=L(o[0],null,"Base")].concat(y),s=e.$r(f),(D=c.$$prototype).raw_input=D.randomizer=D.enabled_upcase_input=D.debug=a,t=[E=e.get_singleton_class(c)].concat(f),R=e.$r(t),E.$attr_reader("prefixes"),q(E,"$register_prefix",function(m){var G,Z,Q=this;return null==Q.prefixes&&(Q.prefixes=a),G=_(arguments),Q.prefixes=C(x(Z=Q.prefixes)?Z:[],G.$flatten())},-1),q(E,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),q(E,"$prefixes_pattern",function(){var m=this,$=a;return null==m.prefixes_pattern&&(m.prefixes_pattern=a),null==m.prefixes&&(m.prefixes=a),m.prefixes_pattern=x($=m.prefixes_pattern)?$:a,x(m.prefixes_pattern)?m.prefixes_pattern:(m.prefixes=x($=m.prefixes)?$:[],m.prefixes.$freeze(),m.prefixes_pattern=(x(m.prefixes["$empty?"]())?/(?!)/:U(["^(S)?(",m.prefixes.$join("|"),")"],"i")).$freeze())}),q(E,"$command_pattern",function(){var m=this,$=a,G=a;return null==m.command_pattern&&(m.command_pattern=a),null==m.prefixes&&(m.prefixes=a),m.command_pattern=x($=m.command_pattern)?$:a,x(m.command_pattern)?m.command_pattern:(m.prefixes=x($=m.prefixes)?$:[],m.prefixes.$freeze(),G=C(z(b(R("CommonCommand"),"COMMANDS"),"map",[],function(Z){return null==Z&&(Z=a),b(Z,"PREFIX_PATTERN").$source()}),m.prefixes),m.command_pattern=U(["^S?(",G.$join("|"),")"],"i").$freeze())}),q(E,"$eval",function(m){try{return I("eval_return"),this.$new(m).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),c.$include(s("Translate")),c.$include(b(s("Deprecated"),"Checker")),q(c,"$initialize",function(d){var t=this;return t.raw_input=d,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=b(s("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=b(s("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=a,t.reroll_dice_reroll_threshold=a,t.default_cmp_op=a,t.default_target_number=a,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=b(s("BCDice"),"Randomizer").$new(),t.debug=!1}),c.$attr_accessor("randomizer"),c.$attr_reader("d66_sort_type"),c.$attr_reader("round_type"),c.$attr_reader("sides_implicit_d"),c.$attr_reader("upper_dice_reroll_threshold"),c.$attr_reader("reroll_dice_reroll_threshold"),c.$attr_reader("default_cmp_op"),c.$attr_reader("default_target_number"),q(c,"$sort_add_dice?",A("sort_add_dice")),q(c,"$sort_barabara_dice?",A("sort_barabara_dice")),q(c,"$enabled_d9?",A("enabled_d9")),q(c,"$enable_debug",w("debug",!0)),q(c,"$eval",function(){var t,n,d=this,R=a;return t=b(s("BCDice"),"Preprocessor").$process(d.raw_input,d),R=x(n=d.$dice_command(t))?n:d.$eval_common_command(d.raw_input),x(R)?(R["$rands="](d.randomizer.$rand_results()),R["$detailed_rands="](d.randomizer.$detailed_rand_results()),R):a}),q(c,"$change_text",function(d){return d}),q(c,"$check_result",function(d,t,R,n){var m=this,$=a,G=a,Q=a,Z=a,$e=a;return $=m.$check_result_legacy(d,t,R,n),x($)?$:(G=z(t,"map",[],"sides".$to_proc()),Z=(Q=z(t,"map",[],"value".$to_proc())).$sum(),$=H([100],$e=G)?m.$result_1d100(d,Z,R,n):H([20],$e)?m.$result_1d20(d,Z,R,n):H([6,6],$e)?m.$result_2d6(d,Z,Q,R,n):a,W($,s("Result").$nothing())?a:x($)?$:($=H([10],$e=G.$uniq())?m.$result_nd10(d,Z,Q,R,n):H([6],$e)?m.$result_nd6(d,Z,Q,R,n):a,W($,s("Result").$nothing())?a:x($)?$:m.$result_ndx(d,R,n)))}),q(c,"$grich_text",M(a)),c.$private(),q(c,"$eval_common_command",function(d){try{I("eval_return");var R=I("return");return d=this.$change_text(d),z(b(s("CommonCommand"),"COMMANDS"),"each",[],function m($){var Q,G=null==m.$$s?this:m.$$s;if(null==G.randomizer&&(G.randomizer=a),null==$&&($=a),Q=$.$eval(d,G,G.randomizer),!x(Q))return a;R.$throw(Q)},{$$s:this,$$ret:R}),a}catch(m){if(m===e.t_eval_return||m===R)return m.$v;throw m}}),q(c,"$dice_command",function(d){var t=this,R=a,n=a,m=a,$=a;return x(t.enabled_upcase_input)&&(d=d.$upcase()),R=t.$class().$prefixes_pattern().$match(d),x(R)?(n=R["$[]"](1)["$nil?"]()["$!"](),x(n)&&(d=d["$[]"](B(1,-1,!1))),m=t.$eval_game_system_specific_command(d),x(m["$is_a?"](s("Result")))?(m["$secret="](x($=m["$secret?"]())?$:n),m):x(m["$nil?"]())||x(m["$empty?"]())||W(m,"1")?a:z(s("Result").$new(),"tap",[],function(Q){var Z;return null==Q&&(Q=a),Q["$text="](m.$to_s()),z(Q,"secret=",Z=[n]),Z[Z.length-1]})):a}),q(c,"$eval_game_system_specific_command",M(a)),q(c,"$result_ndx",function(d,t,R){return x(R["$is_a?"](s("String")))?a:x(d.$send(t,R))?s("Result").$success(this.$translate("success")):s("Result").$failure(this.$translate("failure"))}),q(c,"$result_1d100",M(a)),q(c,"$result_1d20",M(a)),q(c,"$result_nd10",M(a)),q(c,"$result_2d6",M(a)),q(c,"$result_nd6",M(a)),q(c,"$get_table_by_2d6",function(d){return this.$get_table_by_nD6(d,2)}),q(c,"$get_table_by_1d6",function(d){return this.$get_table_by_nD6(d,1)}),q(c,"$get_table_by_nD6",function(d,t){return this.$get_table_by_nDx(d,t,6)}),q(c,"$get_table_by_nDx",function(d,t,R){var m,$=a;return m=this.randomizer.$roll_sum(t,R),$=this.$get_table_value(d["$[]"](l(m,t))),x($["$nil?"]())?["1",0]:[$,m]}),q(c,"$get_table_by_1d3",function(d){var n,m,t=this,$=a;return t.$debug("get_table_by_1d3"),n=t.randomizer.$roll_sum(1,6),t.$debug("num",n),m=Y(l(n,1),2).$to_i(),t.$debug("index",m),$=d["$[]"](m),x($["$nil?"]())?["1",0]:[$,n]}),q(c,"$get_table_by_d66_swap",function(d){var R;return R=this.randomizer.$roll_d66(b(s("D66SortType"),"ASC")),[this.$get_table_by_number(R,d),R]}),q(c,"$get_table_by_d66",function(d){var R,n,m,G,$=a;return R=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),m=C(j(l(R,1),6),l(n,1)),$=d["$[]"](m),G=""+R+n,x($["$nil?"]())?["1",G]:[$,G]}),q(c,"$get_table_by_number",function(d,t,R){try{var n=I("return");return null==R&&(R="1"),z(t,"each",[],function $(G){var Z,Q=null==$.$$s?this:$.$$s;if(null==G&&(G=a),Z=G["$[]"](0),!x(u(Z,d)))return a;n.$throw(Q.$get_table_value(G["$[]"](1)))},{$$s:this,$$ret:n}),this.$get_table_value(R)}catch($){if($===n)return $.$v;throw $}},-3),q(c,"$get_table_value",function(d){return x(d["$is_a?"](s("Proc")))?d.$call():d}),q(c,"$roll_tables",function(d,t){var n=a;return n=t["$[]"](d),x(n)?n.$roll(this.randomizer).$to_s():a}),q(c,"$debug",function(d,t){var n,m=this,$=a,G=a;return n=_(arguments,1),x(m.debug)?($=x(d["$is_a?"](s("String")))?d:d.$inspect(),x(n["$empty?"]())?m.$warn($):(G=z(n,"map",[],function(Z){return null==Z&&(Z=a),x(Z["$is_a?"](s("String")))?'"'+Z+'"':Z.$inspect()}),m.$warn($+": "+G.$join(", ")))):a},-2),b(b(r("I18n"),"Backend"),"Simple").$include(b(b(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),h=[["ja_jp"]],z(r("I18n").$fallbacks(),"defaults=",h),h[h.length-1]},Opal.queue(function(e){var j,T,k,o,p,v,a,b,h,F=e.module,L=e.klass,_=e.const_set,C=e.truthy,x=e.def,q=e.to_ary,U=e.rb_plus,z=e.rb_minus,I=e.rb_gt,A=e.eqeq,w=e.rb_lt,H=e.thrower,W=e.rb_ge,B=[],l=e.nil;return e.top.$require("bcdice/base"),j=B,T=h=[F(B[0],"BCDice")].concat(j),a=[F(h[0],"GameSystem")].concat(T),b=e.$r(a),k=a,p=[o=L(a[0],b("Base"),"ZettaiReido")].concat(k),v=e.$r(p),o.$$prototype.randomizer=l,_(p[0],"ID","ZettaiReido"),_(p[0],"NAME","\u7d76\u5bfe\u96b7\u5974"),_(p[0],"SORT_KEY","\u305b\u3064\u305f\u3044\u308c\u3044\u3068"),_(p[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\nm-2DR+n>=x\nm(\u57fa\u672c\u80fd\u529b),n(\u4fee\u6b63\u5024),x(\u76ee\u6a19\u5024)\nDP\u306e\u53d6\u5f97\u306e\u6709\u7121\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n"),o.$register_prefix("\\d+\\-2DR"),x(o,"$eval_game_system_specific_command",function(f){var D=l,E=l,d=l;return C(f["$=~"](/^(\d+)-2DR([+\-\d]*)(>=(\d+))?$/i))?(D=v("Regexp").$last_match(1).$to_i(),E=v("Regexp").$last_match(2),d=v("Regexp").$last_match(4),this.$roll2DR(D,E,d)):l}),x(o,"$roll2DR",function(f,s,D){var E,d,R,n,m,$,G,t=this,Z=l,$e=l,ne=l,ue=l,ie=l;return d=t.$roll2DarkDice(),R=null==(E=q(d))[0]?l:E[0],n=null==E[1]?l:E[1],m=null==E[2]?l:E[2],d=t.$getModInfo(s),$=null==(E=q(d))[0]?l:E[0],s=null==E[1]?l:E[1],d=t.$getDiffInfo(D),G=null==(E=q(d))[0]?l:E[0],Z="("+f+"-2DR"+s+(null==E[1]?l:E[1])+")",$e=f+"-"+R+"["+n+"]"+s,ne=U(z(f,R),$),ue=t.$getResult(R,ne,G),C(I(m,0))&&(ie=m+"DP"),ue["$text="]([Z,$e,ne.$to_i(),ue.$text(),ie].$compact().$join(" \uff1e ")),ue}),x(o,"$roll2DarkDice",function(){var f,s,E,d,t,R,n,D=this,$=l;return E=D.randomizer.$roll_once(6),d=D.randomizer.$roll_once(6),s=D.$changeDiceToDarkDice(E),t=null==(f=q(s))[0]?l:f[0],R=null==f[1]?l:f[1],s=D.$changeDiceToDarkDice(d),n=null==(f=q(s))[0]?l:f[0],$=U(R,null==f[1]?l:f[1]),A($,2)&&($=4),[U(t,n),t+","+n,$]}),x(o,"$changeDiceToDarkDice",function(f){var s=l,D=l;return s=0,D=f,A(f,6)&&(D=0,s=1),[D,s]}),x(o,"$getModInfo",function(f){try{H("eval_return");var D=l,E=l;return D=v("ArithmeticEvaluator").$eval(f),E="",C(w(D,0))?E=D.$to_s():C(I(D,0))&&(E=U("+",D.$to_s())),[D,E]}catch(d){if(d===e.t_eval_return)return d.$v;throw d}}),x(o,"$getDiffInfo",function(f){var s=l;return s="",C(f["$nil?"]())||(s=">="+(f=f.$to_i()).$to_i()),[f,s]}),x(o,"$getResult",function(f,s,D){var E=l;return A(f,0)?v("Result").$critical("\u30af\u30ea\u30c6\u30a3\u30ab\u30eb"):A(f,10)?v("Result").$fumble("\u30d5\u30a1\u30f3\u30d6\u30eb"):(C(D["$nil?"]())&&(D=0),E=z(s,D),C(W(E,0))?v("Result").$success(E+" \u6210\u529f"):v("Result").$failure("\u5931\u6557"))})})}}]);