(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9640],{7184:(pe,ke,ye)=>{ye(9993),Opal.modules["i18n/backend/fallbacks"]=function(e){var W,u,r,t,c,y,V=e.module,H=e.class_variable_set,_=e.truthy,j=e.class_variable_get,N=e.def,f=e.send,F=e.send2,b=e.find_super,A=e.hash2,L=e.find_block_super,q=e.neqeq,O=e.thrower,Q=e.return_val,K=[],U=e.nil,z=e.$$$;return W=K,y=[c=V(K[0],"I18n")].concat(W),H(y[0],"@@fallbacks",U),u=e.get_singleton_class(c),r=[u].concat(y),t=e.$r(r),N(u,"$fallbacks",function(){var C=U;return H(r[1],"@@fallbacks",_(null!=r[1].$$cvars["@@fallbacks"]?"class variable":U)&&_(C=j(r[1],"@@fallbacks",!1))?C:z(z(t("I18n"),"Locale"),"Fallbacks").$new()),_(C=t("Thread").$current()["$[]"]("i18n_fallbacks"))?C:j(r[1],"@@fallbacks",!1)}),N(u,"$fallbacks=",function(I){var C;return H(r[1],"@@fallbacks",_(I["$is_a?"](t("Array")))?z(z(t("I18n"),"Locale"),"Fallbacks").$new(I):I),C=["i18n_fallbacks",j(r[1],"@@fallbacks",!1)],f(t("Thread").$current(),"[]=",C),C[C.length-1]}),function(u,P){var I,C,x,g,t=[V(u,"Backend")].concat(P);return I=t,x=[C=V(t[0],"Fallbacks")].concat(I),g=e.$r(x),N(C,"$translate",function D(k,R,a){try{var v=O("return"),o=D.$$p||U,G=this,d=U,S=U;return D.$$p=null,null==a&&(a=g("EMPTY_HASH")),_(a.$fetch("fallback",!0))?_(a["$[]"]("fallback_in_progress"))?F(G,b(G,"translate",D,!1,!0),"translate",[k,R,a],o):(_(a["$[]"]("default"))&&(d=G["$extract_non_symbol_default!"](a)),S=a.$merge(A(["fallback_in_progress"],{fallback_in_progress:!0})),f(g("I18n").$fallbacks()["$[]"](k),"each",[],function i(B){var s=null==i.$$s?this:i.$$s;null==B&&(B=U);try{return f(s,"catch",["exception"],function h(){var $=null==h.$$s?this:h.$$s,re=U;if(re=F($,L($,"translate",h.$$def||i.$$def||D,!1,!1),"translate",[B,R,S],null),_(re["$nil?"]()))return U;q(k.$to_s(),B.$to_s())&&$.$on_fallback(k,B,R,a),v.$throw(re)},{$$s:s,$$ret:v})}catch(h){if(!e.rescue(h,[z(g("I18n"),"InvalidLocale")]))throw h;try{return U}finally{e.pop_exception()}}},{$$s:G}),_(a["$key?"]("default"))&&_(a["$[]"]("default")["$nil?"]())?U:_(d)?F(G,b(G,"translate",D,!1,!0),"translate",[k,U,a.$merge(A(["default"],{default:d}))],null):G.$throw("exception",z(g("I18n"),"MissingTranslation").$new(k,R,a))):F(G,b(G,"translate",D,!1,!0),"translate",[k,R,a],o)}catch(i){if(i===v)return i.$v;throw i}},-3),N(C,"$extract_non_symbol_default!",function(k){var a,R=U;return R=[k["$[]"]("default")].$flatten(),a=f(R,"detect",[],function(o){return null==o&&(o=U),o["$is_a?"](g("Symbol"))["$!"]()}),_(a)&&k["$[]="]("default",R["$[]"](0,R.$index(a))),a}),N(C,"$exists?",function D(k,R,a){try{var v=O("return"),o=D.$$p||U,G=this;return D.$$p=null,null==a&&(a=g("EMPTY_HASH")),_(a.$fetch("fallback",!0))?(f(g("I18n").$fallbacks()["$[]"](k),"each",[],function d(S){var i=null==d.$$s?this:d.$$s;null==S&&(S=U);try{if(!_(F(i,L(i,"exists?",d.$$def||D,!1,!1),"exists?",[S,R],null)))return U;v.$throw(!0)}catch(B){if(!e.rescue(B,[z(g("I18n"),"InvalidLocale")]))throw B;try{return U}finally{e.pop_exception()}}},{$$s:G,$$ret:v}),!1):F(G,b(G,"exists?",D,!1,!0),"exists?",[k,R,a],o)}catch(d){if(d===v)return d.$v;throw d}},-3),C.$private(),N(C,"$on_fallback",Q(U))}(y[0],y)},Opal.modules["bcdice/randomizer"]=function(e){var c,p,I,C,x,g,u,P,H=e.klass,_=e.const_set,j=e.def,N=e.truthy,f=e.rb_gt,F=e.rb_plus,b=e.rb_le,A=e.send,L=e.rb_minus,q=e.eqeq,O=e.rb_times,Q=e.eqeqeq,K=e.rb_ge,U=[],z=e.nil,n=e.$$$;return c=U,u=[(0,e.module)(U[0],"BCDice")].concat(c),P=e.$r(u),p=u,C=[I=H(u[0],null,"Randomizer")].concat(p),x=e.$r(C),(g=I.$$prototype).rand_results=g.detailed_rand_results=z,_(C[0],"UPPER_LIMIT_DICE_TIMES",200),_(C[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(C[0],"UPPER_LIMIT_RANDS",1e4),j(I,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),I.$attr_reader("rand_results"),I.$attr_reader("detailed_rand_results"),_(C[0],"DetailedRandResult",x("Struct").$new("kind","sides","value")),j(I,"$roll_barabara",function(k,R){var a=this;return N(f(F(a.rand_results.$size(),k),x("UPPER_LIMIT_RANDS")))&&a.$raise(x("TooManyRandsError")),N(b(k,0))||N(f(k,x("UPPER_LIMIT_DICE_TIMES")))?[]:A(x("Array"),"new",[k],function v(){return(null==v.$$s?this:v.$$s).$roll_once(R)},{$$s:a})}),j(I,"$roll_sum",function(k,R){return this.$roll_barabara(k,R).$sum()}),j(I,"$roll_once",function(k){var a=z;return N(b(k,0))||N(f(k,x("UPPER_LIMIT_DICE_SIDES")))?0:(a=this.$rand_inner(k),this.$push_to_detail("normal",k,a),a)}),j(I,"$roll_index",function(k){return L(this.$roll_once(k),1)}),j(I,"$roll_tens_d10",function(){var a,R=z;return R=this.$rand_inner(10),q(R,10)&&(R=0),a=O(R,10),this.$push_to_detail("tens_d10",10,a),a}),j(I,"$roll_d9",function(){var R;return R=L(this.$rand_inner(10),1),this.$push_to_detail("d9",10,R),R}),j(I,"$roll_d66",function(k){var v,a=z;return a=A(x("Array"),"new",[2],function o(){return(null==o.$$s?this:o.$$s).$roll_once(6)},{$$s:this}),Q(n(x("D66SortType"),"ASC"),v=k)?a["$sort!"]():Q(n(x("D66SortType"),"DESC"),v)&&a["$sort!"]()["$reverse!"](),F(O(a["$[]"](0),10),a["$[]"](1))}),I.$private(),j(I,"$rand_inner",function(k){var a,R=this;return N(K(R.rand_results.$size(),x("UPPER_LIMIT_RANDS")))&&R.$raise(x("TooManyRandsError")),a=R.$random(k),R.rand_results["$<<"]([a,k]),a}),j(I,"$random",function(k){return F(x("Kernel").$rand(k),1)}),j(I,"$push_to_detail",function(k,R,a){var o;return o=x("DetailedRandResult").$new(k,R,a),this.detailed_rand_results.$push(o)}),H(u[0],P("StandardError"),"TooManyRandsError"),z},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var A,Q,W,c,y,u,P,U,q,V=e.module,H=e.klass,_=e.def,j=e.truthy,N=e.return_val,f=[],F=e.nil;return A=f,Q=q=[V(f[0],"BCDice")].concat(A),W=U=[V(q[0],"DiceTable")].concat(Q),y=[c=H(U[0],null,"RollResult")].concat(W),u=e.$r(y),(P=c.$$prototype).table_name=P.value=P.body=F,_(c,"$initialize",function(t,p,I){var C=this;return C.table_name=t,C.value=p,C.body=I}),c.$attr_reader("table_name"),c.$attr_reader("value"),c.$attr_reader("body"),_(c,"$to_s",function(){var t=this;return t.table_name+"("+t.value+") \uff1e "+t.body}),_(c,"$last_body",function(){var t=this;return j(t.body["$is_a?"](u("RollResult")))?t.body.$last_body():t.body}),_(c,"$empty?",N(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var A,Q,W,c,y,u,P,U,q,V=e.module,H=e.klass,_=e.truthy,j=e.def,N=e.rb_minus,f=[],F=e.nil;return A=f,Q=q=[V(f[0],"BCDice")].concat(A),W=U=[V(q[0],"DiceTable")].concat(Q),y=[c=H(U[0],null,"ChainTable")].concat(W),u=e.$r(y),(P=c.$$prototype).times=P.sides=P.items=P.name=F,j(c,"$initialize",function(t,p,I){var C=this,x=F;return C.name=t,C.items=I.$freeze(),x=/(\d+)D(\d+)/i.$match(p),_(x)||C.$raise(u("ArgumentError"),"Unexpected table type: "+p),C.times=x["$[]"](1).$to_i(),C.sides=x["$[]"](2).$to_i()}),j(c,"$roll",function(t){var I,C,p=this,x=F;return I=t.$roll_sum(p.times,p.sides),C=N(I,p.times),x=p.items["$[]"](C),_(x["$respond_to?"]("roll"))&&(x=x.$roll(t)),u("RollResult").$new(p.name,I,x)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var O,z,u,P,r,t,p,W,K,V=e.module,H=e.klass,_=e.hash2,j=e.defs,N=e.def,f=e.rb_plus,F=e.rb_times,b=e.rb_minus,A=[],L=e.nil;return O=A,z=K=[V(A[0],"BCDice")].concat(O),u=W=[V(K[0],"DiceTable")].concat(z),r=[P=H(W[0],null,"D66GridTable")].concat(u),t=e.$r(r),(p=P.$$prototype).name=p.items=L,j(P,"$from_i18n",function(C,x){var D=L;return D=t("I18n").$t(C,_(["locale","raise"],{locale:x,raise:!0})),this.$new(D["$[]"]("name"),D["$[]"]("items"))}),N(P,"$initialize",function(C,x){return this.name=C,this.items=x.$freeze()}),N(P,"$roll",function(C){var g,D,k,R,a;return g=C.$roll_once(6),D=C.$roll_once(6),k=f(F(g,10),D),R=b(g,1),a=b(D,1),t("RollResult").$new(this.name,k,this.items["$[]"](R)["$[]"](a))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var L,K,y,u,P,r,z,n,O,V=e.module,H=e.klass,_=e.hash2,j=e.defs,N=e.def,F=[],b=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),L=F,K=O=[V(F[0],"BCDice")].concat(L),z=[V(O[0],"DiceTable")].concat(K),n=e.$r(z),y=z,P=[u=H(z[0],n("D66GridTable"),"D66HalfGridTable")].concat(y),r=e.$r(P),j(u,"$from_i18n",function(p,I){var x=b;return x=r("I18n").$t(p,_(["locale","raise"],{locale:I,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2_3"),x["$[]"]("items_4_5_6"))}),N(u,"$initialize",function(p,I,C){return this.name=p,this.items=[I,I,I,C,C,C].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var L,K,y,u,P,r,z,n,O,V=e.module,H=e.klass,_=e.hash2,j=e.defs,N=e.def,F=[],b=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),L=F,K=O=[V(F[0],"BCDice")].concat(L),z=[V(O[0],"DiceTable")].concat(K),n=e.$r(z),y=z,P=[u=H(z[0],n("D66GridTable"),"D66OneThirdTable")].concat(y),r=e.$r(P),j(u,"$from_i18n",function(p,I){var x=b;return x=r("I18n").$t(p,_(["locale","raise"],{locale:I,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2"),x["$[]"]("items_3_4"),x["$[]"]("items_5_6"))}),N(u,"$initialize",function(p,I,C,x){return this.name=p,this.items=[I,I,C,C,x,x].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var K,W,r,t,p,I,C,y,z,V=e.module,H=e.klass,_=e.hash2,j=e.defs,N=e.def,f=e.eqeqeq,F=e.rb_plus,b=e.rb_times,A=e.truthy,L=[],q=e.nil,O=e.$$$;return K=L,W=z=[V(L[0],"BCDice")].concat(K),r=y=[V(z[0],"DiceTable")].concat(W),p=[t=H(y[0],null,"D66Table")].concat(r),I=e.$r(p),(C=t.$$prototype).sort_type=C.items=C.name=q,j(t,"$from_i18n",function(g,D){var a,R=q;return R=I("I18n").$t(g,_(["locale"],{locale:D})),a=I("D66SortType").$const_get(R["$[]"]("d66_sort_type")),this.$new(R["$[]"]("name"),a,R["$[]"]("items"))}),N(t,"$initialize",function(g,D,k){var R=this;return R.name=g,R.sort_type=D,R.items=k.$freeze()}),N(t,"$roll",function(g){var D=this,k=q,R=q,a=q,v=q;return k=g.$roll_barabara(2,6),f(O(I("D66SortType"),"ASC"),R=D.sort_type)?k["$sort!"]():f(O(I("D66SortType"),"DESC"),R)&&k["$sort!"]()["$reverse!"](),a=F(b(k["$[]"](0),10),k["$[]"](1)),v=A(R=D.items["$[]"](a))?R:D.items["$[]"](a.$to_s()),A(v["$respond_to?"]("roll"))&&(v=v.$roll(g)),I("RollResult").$new(D.name,a,v)}),N(t,"$choice",function(g){return I("RollResult").$new(this.name,g,this.items["$[]"](g))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var U,c,u,P,n,V=e.module,H=e.klass,_=e.hash2,j=e.send,N=e.to_ary,f=e.rb_plus,F=e.rb_times,b=e.send2,A=e.find_super,L=e.def,O=[],Q=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),U=O,c=n=[V(O[0],"BCDice")].concat(U),u=[V(n[0],"DiceTable")].concat(c),P=e.$r(u),L(H(u[0],P("D66Table"),"D66LeftRangeTable"),"$initialize",function I(C,x,g){var R;return I.$$p=null,R=_([],{}),j(g,"each",[],function(v){var o,S;return null==v&&(v=Q),o=N(v),S=null==o[1]?Q:o[1],j(null==o[0]?Q:o[0],"each",[],function(B){return null==B&&(B=Q),j(S,"each_with_index",[],function(h,$){var re,te;return null==h&&(h=Q),null==$&&($=Q),te=f(F(B,10),f($,1)),j(R,"[]=",re=[te,h]),re[re.length-1]})})}),b(this,A(this,"initialize",I,!1,!0),"initialize",[C,x,R],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var Q,n,P,r,t,p,I,c,U,V=e.module,H=e.klass,_=e.hash2,j=e.defs,N=e.def,f=e.truthy,F=e.rb_minus,b=e.rb_plus,A=e.rb_times,L=[],q=e.nil;return Q=L,n=U=[V(L[0],"BCDice")].concat(Q),P=c=[V(U[0],"DiceTable")].concat(n),t=[r=H(c[0],null,"D66ParityTable")].concat(P),p=e.$r(t),(I=r.$$prototype).odd=I.even=I.name=q,j(r,"$from_i18n",function(x,g){var k=q;return k=p("I18n").$t(x,_(["locale","raise"],{locale:g,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("odd"),k["$[]"]("even"))}),N(r,"$initialize",function(x,g,D){var k=this;return k.name=x,k.odd=g.$freeze(),k.even=D.$freeze()}),N(r,"$roll",function(x){var k,a,v,g=this,D=q;return D=x.$roll_once(6),k=x.$roll_once(6),a=(f(D["$odd?"]())?g.odd:g.even)["$[]"](F(k,1)),v=b(A(D,10),k),p("RollResult").$new(g.name,v,a)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var L,K,c,y,u,P,r,z,O,V=e.module,H=e.klass,_=e.def,j=e.rb_plus,N=e.rb_times,f=e.send,F=[],b=e.nil;return L=F,K=O=[V(F[0],"BCDice")].concat(L),c=z=[V(O[0],"DiceTable")].concat(K),u=[y=H(z[0],null,"D66RangeTable")].concat(c),P=e.$r(u),(r=y.$$prototype).items=r.name=b,_(y,"$initialize",function(p,I){return this.name=p,this.items=I.$freeze()}),_(y,"$roll",function(p){var C,x,g,D=b;return C=p.$roll_once(6),x=p.$roll_once(6),g=j(N(C,10),x),D=f(this.items,"find",[],function(R){return null==R&&(R=b),R["$[]"](0)["$include?"](g)}),P("RollResult").$new(this.name,g,D["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var Q,n,P,r,t,p,I,c,U,V=e.module,H=e.klass,_=e.const_set,j=e.send,N=e.truthy,f=e.def,F=e.eqeqeq,b=e.rb_times,A=e.rb_plus,L=[],q=e.nil;return Q=L,n=U=[V(L[0],"BCDice")].concat(Q),P=c=[V(U[0],"DiceTable")].concat(n),t=[r=H(c[0],null,"RangeTable")].concat(P),p=e.$r(t),(I=r.$$prototype).name=I.items=I.num_of_dice=I.num_of_sides=I.formatter=q,_(t[0],"RollResult",j(p("Struct"),"new",["sum","values","content","formatted"],function C(){return(null==C.$$s?this:C.$$s).$alias_method("to_s","formatted")},{$$s:r})),_(t[0],"Item",p("Struct").$new("range","content")),_(t[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(t[0],"DEFAULT_FORMATTER",j(r,"lambda",[],function(x,g){return null==x&&(x=q),null==g&&(g=q),x.$name()+"("+g.$sum()+") \uff1e "+g.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),f(r,"$initialize",function C(x,g,D){var a,k=C.$$p||q,R=this,v=q;return C.$$p=null,R.name=x.$freeze(),R.formatter=N(a=k)?a:p("DEFAULT_FORMATTER"),v=p("DICE_ROLL_METHOD_RE").$match(g),N(v)||R.$raise(p("ArgumentError"),R.name+": invalid dice roll method: "+g),R.num_of_dice=v["$[]"](1).$to_i(),R.num_of_sides=v["$[]"](2).$to_i(),R.$store(D)}),f(r,"$fetch",function(x){var D,g=this;return D=j(g.items,"find",[],function(R){return null==R&&(R=q),R.$range()["$include?"](x)}),N(D)||g.$raise(p("RangeError"),g.name+": value is out of range: "+x),D}),f(r,"$roll",function(x){var k,g=this,D=q,R=q;return k=(D=x.$roll_barabara(g.num_of_dice,g.num_of_sides)).$sum(),(R=p("RollResult").$new(k,D,g.$fetch(k).$content()))["$formatted="](g.formatter["$[]"](g,R)),R}),r.$private(),f(r,"$store",function(x){var D,k,g=this;return D=j(x,"map",[],function R(a,v){return null==a&&(a=q),null==v&&(v=q),[(null==R.$$s?this:R.$$s).$coerce_to_int_range(a),v]},{$$s:g}),k=j(D,"sort_by",[],function(a,v){return null==a&&(a=q),null==v&&(v=q),a.$min()}),g.$assert_min_sum_is_covered(k),g.$assert_max_sum_is_covered(k),g.$assert_no_gap_or_overlap_in_ranges(k),g.items=j(k,"map",[],function(a,v){return null==a&&(a=q),null==v&&(v=q),p("Item").$new(a,v.$freeze()).$freeze()}).$freeze(),g}),f(r,"$coerce_to_int_range",function(x){var D;return F(p("Integer"),D=x)?p("Range").$new(x,x):F(p("Range"),D)&&N(x.$begin()["$is_a?"](p("Integer")))&&N(x.$end()["$is_a?"](p("Integer")))?x:this.$raise(p("TypeError"),this.name+": "+x+" ("+x.$class()+") must be an Integer or a Range with Integers ")}),f(r,"$assert_min_sum_is_covered",function(x){var D,g=this,k=q;return D=g.num_of_dice,k=x.$first()["$[]"](0),N(k["$include?"](D))||g.$raise(p("RangeError"),g.name+": min value ("+D+") is not covered: "+k),g}),f(r,"$assert_max_sum_is_covered",function(x){var D,g=this,k=q;return D=b(g.num_of_dice,g.num_of_sides),k=x.$last()["$[]"](0),N(k["$include?"](D))||g.$raise(p("RangeError"),g.name+": max value ("+D+") is not covered: "+k),g}),f(r,"$assert_no_gap_or_overlap_in_ranges",function(x){return j(x,"each_cons",[2],function D(k,R){var G,d,a=null==D.$$s?this:D.$$s,v=q,o=q;return null==a.name&&(a.name=q),null==k&&(k=q),null==R&&(R=q),v=k["$[]"](0),o=R["$[]"](0),G=v.$max(),d=A(G,1),N(o["$include?"](G))&&a.$raise(p("RangeError"),a.name+": Range overlap: "+v+" and "+o),N(o["$include?"](d))?q:a.$raise(p("RangeError"),a.name+": Range gap: "+v+" and "+o)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var q,U,y,p,I,C,x,P,n,Q,V=e.module,H=e.klass,_=e.send,j=e.def,N=e.rb_minus,f=e.return_ivar,F=[],b=e.nil,A=e.$$$;return q=F,U=Q=[V(F[0],"BCDice")].concat(q),y=n=[V(Q[0],"DiceTable")].concat(U),p=P=[H(n[0],null,"SaiFicSkillTable")].concat(y),C=[I=H(P[0],null,"Category")].concat(p),x=e.$r(C),j(I,"$initialize",function(D,k,R,a){var v=this;return v.name=D,v.skills=_(k.$map(),"with_index",[2],function(G,d){return null==G&&(G=b),null==d&&(d=b),A(x("SaiFicSkillTable"),"Skill").$new(D,G,R,d,a)}),v.dice=R}),j(I,"$roll",function(D){return this.$skills()["$[]"](N(D.$roll_sum(2,6),2))}),j(I,"$to_s",f("name")),I.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var b,O,n,P,r,c,K,L,V=e.module,H=e.klass,_=e.def,j=e.hash2,N=[],f=e.nil;return b=N,O=L=[V(N[0],"BCDice")].concat(b),n=K=[V(L[0],"DiceTable")].concat(O),c=[H(K[0],null,"SaiFicSkillTable")].concat(n),(r=(P=H(c[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=f,_(P,"$initialize",function(p,I,C,x,g){var D=this;return D.category_name=p,D.name=I,D.category_dice=C,D.row_dice=x,D.s_format=g}),_(P,"$to_s",function(){var p=this;return p.$format(p.s_format,j(["category_dice","row_dice","category_name","skill_name"],{category_dice:p.category_dice,row_dice:p.row_dice,category_name:p.category_name,skill_name:p.name}))}),P.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var c,r,x,g,D,k,R,p,u,V=e.module,H=e.klass,_=e.ensure_kwargs,j=e.hash2,N=e.send,F=e.defs,b=e.const_set,A=e.to_ary,L=e.def,q=e.truthy,O=e.rb_minus,Q=e.rb_plus,K=e.top,U=[],z=e.nil,n=e.$$$;return K.$require("bcdice/dice_table/sai_fic_skill_table/category"),K.$require("bcdice/dice_table/sai_fic_skill_table/skill"),c=U,r=u=[V(U[0],"BCDice")].concat(c),x=p=[V(u[0],"DiceTable")].concat(r),D=[g=H(p[0],null,"SaiFicSkillTable")].concat(x),k=e.$r(D),(R=g.$$prototype).rtt=R.rtt_format=R.rct=R.rct_format=R.rttn=R.rttn_format=R.categories=z,F(g,"$from_i18n",function(v,o,G){var d,S,i,$,h=z;return null==(d=(G=_(G)).$$smap.rtt)&&(d=z),null==(S=G.$$smap.rct)&&(S=z),null==(i=G.$$smap.rttn)&&(i=z),$=(h=k("I18n").$t("RTT",j(["locale","raise","default"],{locale:o,raise:!1,default:j([],{})})).$merge(k("I18n").$t(v,j(["locale","raise"],{locale:o,raise:!0}))))["$[]"]("items"),h=N(h,"select",[],function(te,ee){return null==te&&(te=z),null==ee&&(ee=z),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](te)}),this.$new($,e.to_hash(h).$merge(j(["rtt","rct","rttn"],{rtt:d,rct:S,rttn:i})))},-3),b(D[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),b(D[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),b(D[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),b(D[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),L(g,"$initialize",function(v,o){var G,d,S,i,B,s,h,$=this;return null==(G=(o=_(o)).$$smap.rtt)&&(G=z),null==(d=o.$$smap.rct)&&(d=z),null==(S=o.$$smap.rttn)&&(S=z),null==(i=o.$$smap.rtt_format)&&(i=k("DEFAULT_RTT")),null==(B=o.$$smap.rct_format)&&(B=k("DEFAULT_RCT")),null==(s=o.$$smap.rttn_format)&&(s=k("DEFAULT_RTTN")),null==(h=o.$$smap.s_format)&&(h=k("DEFAULT_S")),$.categories=N(v.$map(),"with_index",[1],function(te,ee){var ue,le,$e;return null==te&&(te=z),null==ee&&(ee=z),le=null==(ue=A(te))[0]?z:ue[0],$e=null==ue[1]?z:ue[1],n(k("SaiFicSkillTable"),"Category").$new(le,$e,ee,h)},{$$has_top_level_mlhs_arg:!0}),$.rtt=G,$.rct=d,$.rttn=S.$to_a(),$.rtt_format=i,$.rct_format=B,$.rttn_format=s},-2),b(D[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),g.$attr_reader("categories"),L(g,"$roll_command",function(v,o){var d,G=this,S=z,i=z;return q(["RTT",G.rtt]["$include?"](d=o))?G.$format_skill(G.rtt_format,G.$roll_skill(v)):q(["RCT",G.rct]["$include?"](d))?(S=G.$roll_category(v),G.$format(G.rct_format,j(["category_dice","category_name"],{category_dice:S.$dice(),category_name:S.$name()}))):q(i=k("RTTN").$index(d))||q(i=G.rttn.$index(d))?G.$format_skill(G.rttn_format,G.categories["$[]"](i).$roll(v)):z}),L(g,"$roll_category",function(v){return this.categories["$[]"](O(v.$roll_once(6),1))}),L(g,"$roll_skill",function(v){return this.$roll_category(v).$roll(v)}),L(g,"$prefixes",function(){var v=this;return Q(["RTT[1-6]?","RCT",v.rtt,v.rct],v.rttn).$compact()}),g.$private(),L(g,"$format_skill",function(v,o){return this.$format(v,j(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:o.$category_dice(),row_dice:o.$row_dice(),category_name:o.$category_name(),skill_name:o.$name(),text:o.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var q,U,y,u,P,r,t,n,Q,V=e.module,H=e.klass,_=e.hash2,j=e.defs,N=e.truthy,f=e.def,F=e.rb_minus,b=[],A=e.nil;return q=b,U=Q=[V(b[0],"BCDice")].concat(q),y=n=[V(Q[0],"DiceTable")].concat(U),P=[u=H(n[0],null,"Table")].concat(y),r=e.$r(P),(t=u.$$prototype).times=t.sides=t.name=t.items=A,j(u,"$from_i18n",function(I,C){var g=A;return g=r("I18n").$t(I,_(["locale"],{locale:C})),this.$new(g["$[]"]("name"),g["$[]"]("type"),g["$[]"]("items"))}),f(u,"$initialize",function(I,C,x){var g=this,D=A;return g.name=I,g.items=x.$freeze(),D=/(\d+)D(\d+)/i.$match(C),N(D)||g.$raise(r("ArgumentError"),"Unexpected table type: "+C),g.times=D["$[]"](1).$to_i(),g.sides=D["$[]"](2).$to_i()}),f(u,"$roll",function(I){var x,C=this;return x=I.$roll_sum(C.times,C.sides),C.$choice(x)}),f(u,"$choice",function(I){var x,C=this;return x=F(I,C.times),r("RollResult").$new(C.name,I,C.items["$[]"](x))})},Opal.modules["bcdice/dice_table"]=function(e){var V=e.top;return V.$require("bcdice/dice_table/roll_result"),V.$require("bcdice/dice_table/chain_table"),V.$require("bcdice/dice_table/d66_grid_table"),V.$require("bcdice/dice_table/d66_half_grid_table"),V.$require("bcdice/dice_table/d66_one_third_table"),V.$require("bcdice/dice_table/d66_left_range_table"),V.$require("bcdice/dice_table/d66_parity_table"),V.$require("bcdice/dice_table/d66_range_table"),V.$require("bcdice/dice_table/d66_table"),V.$require("bcdice/dice_table/range_table"),V.$require("bcdice/dice_table/sai_fic_skill_table"),V.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var f,L,O,b,V=e.module,H=e.const_set,_=[];return f=_,L=b=[V(_[0],"BCDice")].concat(f),O=[V(b[0],"D66SortType")].concat(L),H(O[0],"NO_SORT","no_sort"),H(O[0],"ASC","asc"),H(O[0],"DESC","desc"),function(A,L){var O=[V(A,"RoundType")].concat(L);return H(O[0],"CEIL","ceil"),H(O[0],"FLOOR","floor"),H(O[0],"ROUND","round")}(b[0],b)},Opal.modules["bcdice/translate"]=function(e){var L,K,U,z,n,O,V=e.module,H=e.ensure_kwargs,_=e.kwrestargs,N=e.hash2,f=e.def,F=[],b=e.nil;return L=F,K=O=[V(F[0],"BCDice")].concat(L),z=[U=V(O[0],"Translate")].concat(K),n=e.$r(z),f(U,"$translate",function(c,y){var u,P=this;return null==P.locale&&(P.locale=b),y=H(y),u=_(y,{}),n("I18n").$translate(c,N(["locale","raise"],{locale:P.locale,raise:!0}).$merge(e.to_hash(u)))},-2)},Opal.modules["bcdice/result"]=function(e){var U,W,z,L,O,H=e.klass,_=e.send,j=e.def,N=e.return_val,f=e.return_ivar,F=[],b=e.nil;return L=F,U=O=[(0,e.module)(F[0],"BCDice")].concat(L),[z=H(O[0],null,"Result")].concat(U),j(W=e.get_singleton_class(z),"$success",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=b),t["$text="](u),_(t,"success=",p=[!0]),p[p.length-1]})}),j(W,"$failure",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=b),t["$text="](u),_(t,"failure=",p=[!0]),p[p.length-1]})}),j(W,"$critical",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=b),t["$text="](u),t["$critical="](!0),_(t,"success=",p=[!0]),p[p.length-1]})}),j(W,"$fumble",function(u){return _(this.$new(),"tap",[],function(t){var p;return null==t&&(t=b),t["$text="](u),t["$fumble="](!0),_(t,"failure=",p=[!0]),p[p.length-1]})}),j(W,"$nothing",N("nothing")),j(z,"$initialize",function(c){var y=this;return null==c&&(c=b),y.text=c,y.rands=b,y.detailed_rands=b,y.secret=!1,y.success=!1,y.failure=!1,y.critical=!1,y.fumble=!1},-1),z.$attr_accessor("text","rands","detailed_rands"),z.$attr_writer("secret","success","failure","critical","fumble"),j(z,"$secret?",f("secret")),j(z,"$success?",f("success")),j(z,"$failure?",f("failure")),j(z,"$critical?",f("critical")),j(z,"$fumble?",f("fumble")),j(z,"$condition=",function(c){return this.success=c,this.failure=c["$!"]()})},Opal.modules["racc/parser"]=function(e){var I,x,g,V=e.module,H=e.klass,_=e.truthy,j=e.const_set,N=e.defs,f=e.gvars,F=e.rb_lt,b=e.def,A=e.to_ary,L=e.send,q=e.neqeq,O=e.rb_plus,Q=e.eqeq,K=e.rb_ge,U=e.rb_gt,z=e.rb_minus,n=e.rb_le,W=e.rb_times,c=e.assign_ivar_val,u=[],P=e.$r(u),r=e.nil,t=e.$$$;return I=u,x=[V(u[0],"Racc")].concat(I),g=e.$r(x),H(x[0],g("StandardError"),"ParseError"),_(t("::","ParseError","skip_raise")?"constant":r)||j(u[0],"ParseError",t(P("Racc"),"ParseError")),function(p,I){var a,v,o,G,d,g=[V(p,"Racc")].concat(I),D=e.$r(g);return _(D("Racc_No_Extensions","skip_raise")?"constant":r)||j(g[0],"Racc_No_Extensions",!1),a=g,o=[v=H(g[0],null,"Parser")].concat(a),G=e.$r(o),(d=v.$$prototype).yydebug=d.racc_debug_out=d.racc_error_status=d.racc_t=d.racc_vstack=d.racc_val=d.racc_state=d.racc_tstack=r,j(o[0],"Racc_Runtime_Version","1.4.6"),j(o[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),j(o[0],"Racc_Runtime_Core_Version_R","1.4.6"),j(o[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),j(o[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),j(o[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),j(o[0],"Racc_Runtime_Core_Version",G("Racc_Runtime_Core_Version_R")),j(o[0],"Racc_Runtime_Core_Revision",G("Racc_Runtime_Core_Revision_R")),j(o[0],"Racc_Runtime_Type","ruby"),N(G("Parser"),"$racc_runtime_type",function(){return G("Racc_Runtime_Type")}),b(v,"$_racc_setup",function(){var i,B,s=this,h=r,$=r;return null==f.stderr&&(f.stderr=r),_(t(s.$class(),"Racc_debug_parser"))||(s.yydebug=!1),_(null!=(i=s.yydebug)&&i!==r?"instance-variable":r)||(s.yydebug=!1),_(s.yydebug)&&(_(null!=(B=s.racc_debug_out)&&B!==r?"instance-variable":r)||(s.racc_debug_out=f.stderr),s.racc_debug_out=_(h=s.racc_debug_out)?h:f.stderr),$=t(s.$class(),"Racc_arg"),_(F($.$size(),14))&&$["$[]="](13,!0),$}),b(v,"$_racc_init_sysvars",function(){var i=this;return i.racc_state=[0],i.racc_tstack=[],i.racc_vstack=[],i.racc_t=r,i.racc_val=r,i.racc_read_next=!0,i.racc_user_yyerror=!1,i.racc_error_status=0}),b(v,"$do_parse",function(){return this.$__send__(G("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),b(v,"$next_token",function(){return this.$raise(G("NotImplementedError"),this.$class()+"#next_token is not defined")}),b(v,"$_racc_do_parse_rb",function(i,B){var s,$=this,re=r,te=r,ee=r,ue=r,le=r,$e=r,ae=r,se=r;return s=A(i),re=null==s[0]?r:s[0],te=null==s[1]?r:s[1],ee=null==s[2]?r:s[2],ue=null==s[3]?r:s[3],le=null==s[10]?r:s[10],$.$_racc_init_sysvars(),$e=ae=se=r,L($,"catch",["racc_end_parse"],function X(){var T,Y,m=null==X.$$s?this:X.$$s,w=r;for(null==m.racc_state&&(m.racc_state=r),null==m.racc_read_next&&(m.racc_read_next=r),null==m.racc_t&&(m.racc_t=r),null==m.yydebug&&(m.yydebug=r),null==m.racc_val&&(m.racc_val=r);_(!0);)for(_(se=ue["$[]"](m.racc_state["$[]"](-1)))?(_(m.racc_read_next)&&q(m.racc_t,0)&&(Y=m.$next_token(),T=A(Y),$e=null==T[0]?r:T[0],m.racc_val=null==T[1]?r:T[1],m.racc_t=_($e)?_(w=le["$[]"]($e))?w:1:0,_(m.yydebug)&&m.$racc_read_token(m.racc_t,$e,m.racc_val),m.racc_read_next=!1),se=O(se,m.racc_t),_(K(se,0))&&_(ae=re["$[]"](se))&&Q(te["$[]"](se),m.racc_state["$[]"](-1))||(ae=ee["$[]"](m.racc_state["$[]"](-1)))):ae=ee["$[]"](m.racc_state["$[]"](-1));_(ae=m.$_racc_evalact(ae,i)););},{$$s:$})}),b(v,"$yyparse",function(i,B){return this.$__send__(G("Racc_YY_Parse_Method"),i,B,this.$_racc_setup(),!0)}),b(v,"$_racc_yyparse_rb",function(i,B,s,h){var $,ee=r,ue=r,_e=r,le=r,ae=r,se=r,X=r;return $=A(s),ee=null==$[0]?r:$[0],ue=null==$[1]?r:$[1],_e=null==$[2]?r:$[2],le=null==$[3]?r:$[3],ae=null==$[10]?r:$[10],this.$_racc_init_sysvars(),se=r,X=r,L(this,"catch",["racc_end_parse"],function T(){var Y=null==T.$$s?this:T.$$s;for(null==Y.racc_state&&(Y.racc_state=r);!_(X=le["$[]"](Y.racc_state["$[]"](-1)));)for(;_(se=Y.$_racc_evalact(_e["$[]"](Y.racc_state["$[]"](-1)),s)););return L(i,"__send__",[B],function m(w,J){var l=null==m.$$s?this:m.$$s,E=r,Z=r;for(null==l.racc_t&&(l.racc_t=r),null==l.racc_state&&(l.racc_state=r),null==l.racc_read_next&&(l.racc_read_next=r),null==w&&(w=r),null==J&&(J=r),l.racc_t=_(w)?_(E=ae["$[]"](w))?E:1:0,l.racc_val=J,l.racc_read_next=!1,X=O(X,l.racc_t),_(K(X,0))&&_(se=ee["$[]"](X))&&Q(ue["$[]"](X),l.racc_state["$[]"](-1))||(se=_e["$[]"](l.racc_state["$[]"](-1)));_(se=l.$_racc_evalact(se,s)););for(;_(_(E=_(Z=(X=le["$[]"](l.racc_state["$[]"](-1)))["$!"]())?Z:l.racc_read_next["$!"]())?E:l.racc_t["$=="](0));)for(_(X)&&_(X=O(X,l.racc_t))&&_(K(X,0))&&_(se=ee["$[]"](X))&&Q(ue["$[]"](X),l.racc_state["$[]"](-1))||(se=_e["$[]"](l.racc_state["$[]"](-1)));_(se=l.$_racc_evalact(se,s)););},{$$s:Y})},{$$s:this})}),b(v,"$_racc_evalact",function(i,B){var s,_e,$=this,re=r,te=r,ue=r,le=r,$e=r,ae=r;if(re=null==(s=A(B))[0]?r:s[0],te=null==s[1]?r:s[1],ue=null==s[3]?r:s[3],_e=null==s[11]?r:s[11],le=null==s[12]?r:s[12],_(U(i,0))&&_(F(i,_e)))_(U($.racc_error_status,0))&&(Q($.racc_t,1)||($.racc_error_status=z($.racc_error_status,1))),$.racc_vstack.$push($.racc_val),$.racc_state.$push(i),$.racc_read_next=!0,_($.yydebug)&&($.racc_tstack.$push($.racc_t),$.$racc_shift($.racc_t,$.racc_tstack,$.racc_vstack));else if(_(F(i,0))&&_(U(i,le["$-@"]()))){if($e=L($,"catch",["racc_jump"],function se(){var X=null==se.$$s?this:se.$$s;return null==X.racc_state&&(X.racc_state=r),X.racc_state.$push(X.$_racc_do_reduce(B,i)),!1},{$$s:$}),_($e))switch($e){case 1:return $.racc_user_yyerror=!0,le["$-@"]();case 2:return _e;default:$.$raise("[Racc Bug] unknown jump code")}}else if(Q(i,_e))_($.yydebug)&&$.$racc_accept(),$.$throw("racc_end_parse",$.racc_vstack["$[]"](0));else{if(Q(i,le["$-@"]())){switch($.racc_error_status){case 0:_(B["$[]"](21))||$.$on_error($.racc_t,$.racc_val,$.racc_vstack);break;case 3:Q($.racc_t,0)&&$.$throw("racc_end_parse",r),$.racc_read_next=!0}for($.racc_user_yyerror=!1,$.racc_error_status=3;_(!0)&&!(_(ae=ue["$[]"]($.racc_state["$[]"](-1)))&&(ae=O(ae,1),_(K(ae,0))&&_(i=re["$[]"](ae))&&Q(te["$[]"](ae),$.racc_state["$[]"](-1))));)_(n($.racc_state.$size(),1))&&$.$throw("racc_end_parse",r),$.racc_state.$pop(),$.racc_vstack.$pop(),_($.yydebug)&&($.racc_tstack.$pop(),$.$racc_e_pop($.racc_state,$.racc_tstack,$.racc_vstack));return i}$.$raise("[Racc Bug] unknown action "+i.$inspect())}return _($.yydebug)&&$.$racc_next_state($.racc_state["$[]"](-1),$.racc_state),r}),b(v,"$_racc_do_reduce",function(i,B){var s,le,ae,w,J,l,M,$=this,te=r,ee=r,ue=r,_e=r,$e=r,se=r,X=r,T=r,Y=r,m=r,E=r,Z=r,ne=r;return te=null==(s=A(i))[4]?r:s[4],ee=null==s[5]?r:s[5],ue=null==s[6]?r:s[6],_e=null==s[7]?r:s[7],le=null==s[8]?r:s[8],$e=null==s[9]?r:s[9],ae=null==s[13]?r:s[13],se=$.racc_state,X=$.racc_vstack,T=$.racc_tstack,Y=W(B,-3),m=$e["$[]"](Y),w=$e["$[]"](O(Y,1)),J=$e["$[]"](O(Y,2)),l=[],_($.yydebug)&&(E=T["$[]"](m["$-@"](),m)),Z=X["$[]"](m["$-@"](),m),_($.yydebug)&&T["$[]="](m["$-@"](),m,l),X["$[]="](m["$-@"](),m,l),se["$[]="](m["$-@"](),m,l),_(ae)?X.$push($.$__send__(J,Z,X,Z["$[]"](0))):X.$push($.$__send__(J,Z,X)),T.$push(w),_($.yydebug)&&$.$racc_reduce(E,w,T,X),M=z(w,le),_(Y=_e["$[]"](M))&&(Y=O(Y,se["$[]"](-1)),_(K(Y,0))&&_(ne=te["$[]"](Y))&&Q(ee["$[]"](Y),M))?ne:ue["$[]"](M)}),b(v,"$on_error",function(i,B,s){var $,h=this;return h.$raise(G("ParseError"),h.$sprintf("\nparse error on value %s (%s)",B.$inspect(),_($=h.$token_to_str(i))?$:"?"))}),b(v,"$yyerror",function(){return this.$throw("racc_jump",1)}),b(v,"$yyaccept",function(){return this.$throw("racc_jump",2)}),b(v,"$yyerrok",c("racc_error_status",0)),b(v,"$racc_read_token",function(i,B,s){var h=this;return h.racc_debug_out.$print("read    "),h.racc_debug_out.$print(B.$inspect(),"(",h.$racc_token2str(i),") "),h.racc_debug_out.$puts(s.$inspect()),h.racc_debug_out.$puts()}),b(v,"$racc_shift",function(i,B,s){var h=this;return h.racc_debug_out.$puts("shift   "+h.$racc_token2str(i)),h.$racc_print_stacks(B,s),h.racc_debug_out.$puts()}),b(v,"$racc_reduce",function(i,B,s,h){var $=this,re=r;return(re=$.racc_debug_out).$print("reduce "),_(i["$empty?"]())?re.$print(" <none>"):L(i,"each",[],function te(ee){return null==ee&&(ee=r),re.$print(" ",(null==te.$$s?this:te.$$s).$racc_token2str(ee))},{$$s:$}),re.$puts(" --\x3e "+$.$racc_token2str(B)),$.$racc_print_stacks(s,h),$.racc_debug_out.$puts()}),b(v,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),b(v,"$racc_e_pop",function(i,B,s){var h=this;return h.racc_debug_out.$puts("error recovering mode: pop token"),h.$racc_print_states(i),h.$racc_print_stacks(B,s),h.racc_debug_out.$puts()}),b(v,"$racc_next_state",function(i,B){var s=this;return s.racc_debug_out.$puts("goto    "+i),s.$racc_print_states(B),s.racc_debug_out.$puts()}),b(v,"$racc_print_stacks",function(i,B){var h=r;return(h=this.racc_debug_out).$print("        ["),L(i,"each_index",[],function $(re){return null==re&&(re=r),h.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(i["$[]"](re))," ",B["$[]"](re).$inspect(),")")},{$$s:this}),h.$puts(" ]")}),b(v,"$racc_print_states",function(i){var s=r;return(s=this.racc_debug_out).$print("        ["),L(i,"each",[],function($){return null==$&&($=r),s.$print(" ",$)}),s.$puts(" ]")}),b(v,"$racc_token2str",function(i){var s;return _(s=t(this.$class(),"Racc_token_to_s_table")["$[]"](i))?s:this.$raise("[Racc Bug] can't convert token "+i+" to string")}),b(v,"$token_to_str",function(i){return t(this.$class(),"Racc_token_to_s_table")["$[]"](i)})}(u[0],u)},Opal.modules["bcdice/arithmetic/node"]=function(e){var c,r,C,a,v,g,D,p,u,V=e.module,H=e.klass,_=e.def,j=e.thrower,N=e.return_ivar,f=e.send2,F=e.find_super,b=e.eqeq,A=e.const_set,L=e.eqeqeq,q=e.rb_divide,O=e.truthy,Q=e.assign_ivar,K=e.alias,U=[],z=e.nil,n=e.$$$;return c=U,r=u=[V(U[0],"BCDice")].concat(c),C=p=[V(u[0],"Arithmetic")].concat(r),g=[V(p[0],"Node")].concat(C),D=e.$r(g),(v=(a=H(g[0],null,"BinaryOp")).$$prototype).lhs=v.rhs=v.op=z,_(a,"$initialize",function(G,d,S){var i=this;return i.lhs=G,i.op=d,i.rhs=S}),_(a,"$eval",function(G){try{j("eval_return");var B,S=this,i=z;return i=S.lhs.$eval(G),B=S.rhs.$eval(G),i.$send(S.op,B)}catch(s){if(s===e.t_eval_return)return s.$v;throw s}}),_(a,"$output",function(){var G=this;return""+G.lhs.$output()+G.op+G.rhs.$output()}),_(a,"$s_exp",function(){var G=this;return"("+G.$op_for_s_exp()+" "+G.lhs.$s_exp()+" "+G.rhs.$s_exp()+")"}),_(a,"$op_for_s_exp",N("op")),function(k,R,a){var v=H(k,R,"DivideBase"),o=[v].concat(a),G=e.$r(o),d=v.$$prototype;d.lhs=d.rhs=d.op=z,_(v,"$initialize",function S(i,B){return S.$$p=null,f(this,F(this,"initialize",S,!1,!0),"initialize",[i,"/",B],null)}),_(v,"$eval",function(i){try{j("eval_return");var h,$,s=this;return h=s.lhs.$eval(i),$=s.rhs.$eval(i),b($,0)&&s.$raise(G("ZeroDivisionError")),s.$divide_and_round(h,$,i)}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),_(v,"$output",function S(){var i=S.$$p||z,B=this;return S.$$p=null,""+f(B,F(B,"output",S,!1,!0),"output",[],i)+B.$rounding_method()}),v.$private(),_(v,"$rounding_method",function(){return n(this.$class(),"ROUNDING_METHOD")}),_(v,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(v,"$divide_and_round",function(i,B,s){return this.$raise(G("NotImplementedError"))})}(g[0],D("BinaryOp"),g),function(k,R,a){var v=H(k,R,"DivideWithGameSystemDefault"),o=[v].concat(a),G=e.$r(o);A(o[0],"ROUNDING_METHOD",""),v.$private(),_(v,"$divide_and_round",function(S,i,B){var s,h=z;return L(n(G("RoundType"),"CEIL"),s=B)?q(S.$to_f(),i).$ceil():L(n(G("RoundType"),"ROUND"),s)?(h=q(S.$to_f(),i),O(h["$negative?"]())?h.$abs().$round()["$-@"]():h.$round()):q(S,i).$floor()})}(g[0],D("DivideBase"),g),function(k,R,a){var v=H(k,R,"DivideWithCeil"),o=[v].concat(a);A(o[0],"ROUNDING_METHOD","C"),v.$private(),_(v,"$divide_and_round",function(d,S,i){return q(d.$to_f(),S).$ceil()})}(g[0],D("DivideBase"),g),function(k,R,a){var v=H(k,R,"DivideWithRound"),o=[v].concat(a);A(o[0],"ROUNDING_METHOD","R"),v.$private(),_(v,"$divide_and_round",function(d,S,i){var B=z;return B=q(d.$to_f(),S),O(B["$negative?"]())?B.$abs().$round()["$-@"]():B.$round()})}(g[0],D("DivideBase"),g),function(k,R,a){var v=H(k,R,"DivideWithFloor"),o=[v].concat(a);A(o[0],"ROUNDING_METHOD","F"),v.$private(),_(v,"$divide_and_round",function(d,S,i){return q(d,S).$floor()})}(g[0],D("DivideBase"),g),function(k,R){var a=H(k,null,"Negative");a.$$prototype.body=z,_(a,"$initialize",Q("body")),_(a,"$eval",function(G){try{return j("eval_return"),this.body.$eval(G)["$-@"]()}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),_(a,"$output",function(){return"-"+this.body.$output()}),_(a,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(g[0]),function(k,R){var a=H(k,null,"Parenthesis");a.$$prototype.expr=z,_(a,"$initialize",Q("expr")),_(a,"$eval",function(G){try{return j("eval_return"),this.expr.$eval(G)}catch(i){if(i===e.t_eval_return)return i.$v;throw i}}),_(a,"$output",function(){return"("+this.expr.$output()+")"}),_(a,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(g[0]),function(k,R){var a=H(k,null,"Number");return a.$$prototype.value=z,_(a,"$initialize",Q("value")),_(a,"$eval",N("value")),_(a,"$output",function(){return this.value.$to_s()}),K(a,"s_exp","output")}(g[0])},Opal.modules.strscan=function(e){var Q,K,U,z,n,H=e.def,_=e.truthy,j=e.eqeqeq,N=e.Opal,f=e.return_ivar,F=e.send,b=e.alias,A=[],L=e.nil;return Q=A,U=[K=(0,e.klass)(A[0],null,"StringScanner")].concat(Q),z=e.$r(U),(n=K.$$prototype).pos=n.string=n.working=n.matched=n.prev_pos=n.match=L,K.$attr_reader("pos","matched"),H(K,"$initialize",function(c){var y=this;return y.string=c,y.pos=0,y.matched=L,y.working=c,y.match=[]}),K.$attr_reader("string"),H(K,"$beginning_of_line?",function(){var c=this;return 0===c.pos||"\n"===c.string.charAt(c.pos-1)}),H(K,"$scan",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);return null==u?y.matched=L:(y.prev_pos=y.pos,y.pos+=u[0].length,y.working=y.working.substring(u[0].length),y.matched=u[0],y.match=u,u[0])}),H(K,"$scan_until",function(c){var y=this;c=y.$anchor(c);for(var u=y.working,P=0;u.length!=P;++P){var r=c.exec(u.substr(P));if(null!==r){var t=P+r[0].length,p=u.substr(0,t);return y.matched=r[0],y.match=r,y.prev_pos=y.pos+P,y.pos+=t,y.working=u.substr(t),p}}return y.matched=L}),H(K,"$[]",function(c){var u;if(_(this.match["$empty?"]()))return L;j(z("Symbol"),u=c)?c=c.$to_s():j(z("String"),u)||(c=N["$coerce_to!"](c,z("Integer"),"to_int"));var P=this.match;return c<0&&(c+=P.length),c<0||c>=P.length||null==P[c]?L:P[c]}),H(K,"$check",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);return y.matched=null==u?L:u[0]}),H(K,"$check_until",function(c){var y=this,u=y.prev_pos,P=y.pos,r=y.working,t=y.$scan_until(c);return y.prev_pos=u,y.pos=P,y.working=r,t}),H(K,"$peek",function(c){return this.working.substring(0,c)}),H(K,"$eos?",function(){return 0===this.working.length}),H(K,"$exist?",function(c){var u=c.exec(this.working);return null==u?L:0==u.index?0:u.index+1}),H(K,"$skip",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);if(null==u)return y.match=[],y.matched=L;var P=u[0],r=P.length;return y.matched=P,y.match=u,y.prev_pos=y.pos,y.pos+=r,y.working=y.working.substring(r),r}),H(K,"$skip_until",function(c){var u=this.$scan_until(c);return u===L?L:(this.matched=u.substr(-1),u.length)}),H(K,"$get_byte",function(){var c=this,y=L;return c.pos<c.string.length?(c.prev_pos=c.pos,c.pos+=1,y=c.matched=c.working.substring(0,1),c.working=c.working.substring(1)):c.matched=L,y}),H(K,"$match?",function(c){var y=this,u=(c=y.$anchor(c)).exec(y.working);return null==u?L:(y.prev_pos=y.pos,u[0].length)}),H(K,"$pos=",function(c){var y=this;return c<0&&(c+=y.string.$length()),y.pos=c,y.working=y.string.slice(c)}),H(K,"$matched_size",function(){return this.matched===L?L:this.matched.length}),H(K,"$post_match",function(){var c=this;return c.matched===L?L:c.string.substr(c.pos)}),H(K,"$pre_match",function(){var c=this;return c.matched===L?L:c.string.substr(0,c.prev_pos)}),H(K,"$reset",function(){var c=this;return c.working=c.string,c.matched=L,c.pos=0}),H(K,"$rest",f("working")),H(K,"$rest?",function(){return 0!==this.working.length}),H(K,"$rest_size",function(){return this.$rest().$size()}),H(K,"$terminate",function(){var c,y=this;return y.match=L,c=[y.string.$length()],F(y,"pos=",c),c[c.length-1]}),H(K,"$unscan",function(){var c=this;return c.pos=c.prev_pos,c.prev_pos=L,c.match=L,c}),b(K,"bol?","beginning_of_line?"),b(K,"getch","get_byte"),K.$private(),H(K,"$anchor",function(c){var y=c.toString().match(/\/([^\/]+)$/);return y=y?y[1]:void 0,new RegExp("^(?:"+c.source+")",y)})},Opal.modules["bcdice/normalize"]=function(e){var b,O,L,V=e.module,H=e.eqeqeq,_=e.def,j=e.eqeq,N=[],f=e.nil;return b=N,L=[V(N[0],"BCDice")].concat(b),(O=V(L[0],"Normalize")).$module_function(),_(O,"$comparison_operator",function(K){var U;return H(/<=|=</,U=K)?"<=":H(/>=|=>/,U)?">=":H(/<>|!=|=!/,U)?"!=":H(/</,U)?"<":H(/>/,U)?">":H(/=/,U)?"==":f}),_(O,"$target_number",function(K){return j(K,"?")?K:K.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var Q,n,P,r,t,p,I,c,U,V=e.module,H=e.klass,_=e.const_set,j=e.hash2,N=e.truthy,f=e.send,F=e.def,b=e.thrower,A=e.top,L=[],q=e.nil;return A.$require("strscan"),A.$require("bcdice/normalize"),Q=L,n=U=[V(L[0],"BCDice")].concat(Q),P=c=[V(U[0],"Command")].concat(n),t=[r=H(c[0],null,"Lexer")].concat(P),p=e.$r(t),(I=r.$$prototype).scanner=I.notations=q,_(t[0],"SYMBOLS",j(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),F(r,"$initialize",function(x,g){var D,k,a;return x=N(a=(D=(k=x)===q||null==k?q:k.$split(" ",2))===q||null==D?q:D.$first())?a:"",this.scanner=p("StringScanner").$new(x),this.notations=f(g,"map",[],function(o){return null==o&&(o=q),N(o["$is_a?"](p("String")))?p("Regexp").$new(o):o})}),F(r,"$next_token",function(){try{var x=b("return"),g=this,D=q,k=q,a=q,v=q;return N(g.scanner["$eos?"]())?[!1,"$"]:(f(g.notations,"each",[],function o(G){var S,d=null==o.$$s?this:o.$$s;if(null==d.scanner&&(d.scanner=q),null==G&&(G=q),S=d.scanner.$scan(G),!N(S))return q;x.$throw(["NOTATION",S])},{$$s:g,$$ret:x}),N(D=g.scanner.$scan(/\d+/))?["NUMBER",D.$to_i()]:N(k=g.scanner.$scan(/[<>!=]+/))?(k=p("Normalize").$comparison_operator(k),[N(k)?"CMP_OP":"ILLEGAL",k]):(a=g.scanner.$getch().$upcase(),[N(v=p("SYMBOLS")["$[]"](a))?v:a.$to_sym(),a]))}catch(o){if(o===x)return o.$v;throw o}}),F(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var A,Q,W,c,y,u,P,U,q,V=e.module,H=e.klass,_=e.def,j=e.return_ivar,N=e.truthy,f=[],F=e.nil;return A=f,Q=q=[V(f[0],"BCDice")].concat(A),W=U=[V(q[0],"Command")].concat(Q),y=[c=H(U[0],null,"Parsed")].concat(W),u=e.$r(y),(P=c.$$prototype).critical=P.fumble=P.dollar=P.modify_number=P.question_target=P.target_number=P.prefix_number=P.command=P.suffix_number=P.cmp_op=F,c.$attr_accessor("command"),c.$attr_accessor("prefix_number"),c.$attr_accessor("suffix_number"),c.$attr_accessor("critical"),c.$attr_accessor("fumble"),c.$attr_accessor("dollar"),c.$attr_accessor("modify_number"),c.$attr_accessor("cmp_op"),c.$attr_accessor("target_number"),c.$attr_writer("question_target"),_(c,"$initialize",function(){var t=this;return t.prefix_number=F,t.suffix_number=F,t.critical=F,t.fumble=F,t.dollar=F,t.cmp_op=F,t.target_number=F,t.question_target=!1}),_(c,"$question_target?",j("question_target")),_(c,"$to_s",function(t){var p=this,I=F,C=F,x=F,g=F,D=F;switch(null==t&&(t="after_command"),I=N(p.critical)?"@"+p.critical:F,C=N(p.fumble)?"#"+p.fumble:F,x=N(p.dollar)?"$"+p.dollar:F,g=u("Format").$modifier(p.modify_number),D=N(p.question_target)?"?":p.target_number,t){case"after_command":return[p.prefix_number,p.command,p.suffix_number,I,C,x,g,p.cmp_op,D].$join();case"after_modify_number":return[p.prefix_number,p.command,p.suffix_number,g,I,C,x,p.cmp_op,D].$join();case"after_target_number":return[p.prefix_number,p.command,p.suffix_number,g,p.cmp_op,D,I,C,x].$join();default:return F}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var t,x,v,S,i,B,s,h,$,re,te,ee,le,o,G,d,se,D,k,I,V=e.klass,H=e.module,_=e.slice,j=e.extract_kwargs,N=e.ensure_kwargs,f=e.get_kwarg,F=e.send2,b=e.find_super,A=e.def,L=e.send,q=e.eqeq,O=e.thrower,Q=e.hash,K=e.const_set,U=e.truthy,z=e.to_ary,n=e.hash2,W=e.top,c=[],y=e.$r(c),u=e.nil,P=e.$$$;return W.$require("racc/parser.rb"),W.$require("bcdice/arithmetic/node"),W.$require("bcdice/command/lexer"),W.$require("bcdice/command/parsed"),V(P(y("BCDice"),"Command"),P(y("Racc"),"Parser"),"Parser"),t=c,x=I=[H(c[0],"BCDice")].concat(t),D=[H(I[0],"Command")].concat(x),k=e.$r(D),v=D,G=[o=V(D[0],P(k("Racc"),"Parser"),"Parser")].concat(v),d=e.$r(G),(se=o.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=u,A(o,"$initialize",function X(T,Y){var m,w,J,l,Z=this;return X.$$p=null,m=_(arguments),w=j(m),w=N(w),J=m,l=f(w,"round_type"),F(Z,b(Z,"initialize",X,!1,!0),"initialize",[],null),Z.notations=J,Z.round_type=l,Z.prefix_number=!1,Z.suffix_number=!1,Z.need_prefix_number=!1,Z.need_suffix_number=!1,Z.modifier=!0,Z.critical=!1,Z.fumble=!1,Z.dollar=!1,Z.allowed_cmp_op=[u,">=",">","<=","<","==","!="],Z.question_target=!1},-2),A(o,"$disable_modifier",function(){return this.modifier=!1,this}),A(o,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),A(o,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),A(o,"$has_prefix_number",function(){var T=this;return T.prefix_number=!0,T.need_prefix_number=!0,T}),A(o,"$has_suffix_number",function(){var T=this;return T.suffix_number=!0,T.need_suffix_number=!0,T}),A(o,"$enable_critical",function(){return this.critical=!0,this}),A(o,"$enable_fumble",function(){return this.fumble=!0,this}),A(o,"$enable_dollar",function(){return this.dollar=!0,this}),A(o,"$restrict_cmp_op_to",function(T){var Y;return Y=_(arguments),this.allowed_cmp_op=Y,this},-1),A(o,"$enable_question_target",function(){return this.question_target=!0,this}),A(o,"$parse",function(T){var Y=this;try{return Y.lexer=d("Lexer").$new(T,Y.notations),Y.$do_parse()}catch(m){if(!e.rescue(m,[d("ParseError"),d("ZeroDivisionError")]))throw m;try{return u}finally{e.pop_exception()}}}),o.$private(),A(o,"$parsed",function(T,Y,m,w){try{return O("eval_return"),L(d("Parsed").$new(),"tap",[],function E(Z){var M,ne,ie,ce,fe,oe,de,me=null==E.$$s?this:E.$$s;return null==me.round_type&&(me.round_type=u),null==Z&&(Z=u),Z["$command="](T["$[]"]("command")),Z["$prefix_number="]((M=T["$[]"]("prefix"))===u||null==M?u:M.$eval(me.round_type)),Z["$suffix_number="]((ne=T["$[]"]("suffix"))===u||null==ne?u:ne.$eval(me.round_type)),Z["$critical="]((ie=Y["$[]"]("critical"))===u||null==ie?u:ie.$eval(me.round_type)),Z["$fumble="]((ce=Y["$[]"]("fumble"))===u||null==ce?u:ce.$eval(me.round_type)),Z["$dollar="]((fe=Y["$[]"]("dollar"))===u||null==fe?u:fe.$eval(me.round_type)),Z["$modify_number="](m.$eval(me.round_type)),Z["$cmp_op="](w["$[]"]("cmp_op")),q(w["$[]"]("target"),"?")?(Z["$question_target="](!0),L(Z,"target_number=",oe=[0]),oe[oe.length-1]):(Z["$question_target="](!1),oe=[(de=w["$[]"]("target"),de===u||null==de?u:de.$eval(me.round_type))],L(Z,"target_number=",oe),oe[oe.length-1])},{$$s:this})}catch(E){if(E===e.t_eval_return)return E.$v;throw E}}),A(o,"$next_token",function(){return this.lexer.$next_token()}),S=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),i=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),B=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),s=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),h=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),$=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),re=[u,6,13,3,9,-1,27,-15,-10,-1,-38],te=[u,u,u,u,u,u,19,16,15,u,u],ee=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),le=Q(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),K(G[0],"Racc_arg",[S,i,s,B,h,$,te,re,19,ee,le,58,35,!0]),K(G[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),K(G[0],"Racc_debug_parser",!1),A(o,"$_reduce_1",function(T,Y,m){var w,l=this;return U(l.modifier)||l.$raise(d("ParseError")),w=z(T),l.$parsed(null==w[0]?u:w[0],null==w[1]?u:w[1],null==w[2]?u:w[2],null==w[3]?u:w[3])}),A(o,"$_reduce_2",function(T,Y,m){var w,l=this;return U(l.modifier)||l.$raise(d("ParseError")),w=z(T),l.$parsed(null==w[0]?u:w[0],null==w[2]?u:w[2],null==w[1]?u:w[1],null==w[3]?u:w[3])}),A(o,"$_reduce_3",function(T,Y,m){var w,M;return M=null==(w=z(T))[2]?u:w[2],this.$parsed(null==w[0]?u:w[0],null==w[1]?u:w[1],P(P(d("Arithmetic"),"Node"),"Number").$new(0),M)}),A(o,"$_reduce_4",function(T,Y,m){var w=this;return U(w.prefix_number)&&U(w.suffix_number)||w.$raise(d("ParseError")),n(["command","prefix","suffix"],{command:T["$[]"](1),prefix:T["$[]"](0),suffix:T["$[]"](2)})}),A(o,"$_reduce_5",function(T,Y,m){var w=this;return U(w.prefix_number)||w.$raise(d("ParseError")),U(w.need_suffix_number)&&w.$raise(d("ParseError")),n(["command","prefix"],{command:T["$[]"](1),prefix:T["$[]"](0)})}),A(o,"$_reduce_6",function(T,Y,m){var w=this;return U(w.suffix_number)||w.$raise(d("ParseError")),U(w.need_prefix_number)&&w.$raise(d("ParseError")),n(["command","suffix"],{command:T["$[]"](0),suffix:T["$[]"](1)})}),A(o,"$_reduce_7",function(T,Y,m){var w=this;return(U(w.need_prefix_number)||U(w.need_suffix_number))&&w.$raise(d("ParseError")),n(["command"],{command:T["$[]"](0)})}),A(o,"$_reduce_8",function(T,Y,m){return n([],{})}),A(o,"$_reduce_9",function(T,Y,m){var w,M,E=u;return E=null==(w=z(T))[0]?u:w[0],M=null==w[2]?u:w[2],U(this.critical)&&U(E["$[]"]("critical")["$nil?"]())||this.$raise(d("ParseError")),E["$[]="]("critical",M),E}),A(o,"$_reduce_10",function(T,Y,m){var w,M,E=u;return E=null==(w=z(T))[0]?u:w[0],M=null==w[2]?u:w[2],U(this.fumble)&&U(E["$[]"]("fumble")["$nil?"]())||this.$raise(d("ParseError")),E["$[]="]("fumble",M),E}),A(o,"$_reduce_11",function(T,Y,m){var w,M,E=u;return E=null==(w=z(T))[0]?u:w[0],M=null==w[2]?u:w[2],U(this.dollar)&&U(E["$[]"]("dollar")["$nil?"]())||this.$raise(d("ParseError")),E["$[]="]("dollar",M),E}),A(o,"$_reduce_12",function(T,Y,m){return T["$[]"](1)}),A(o,"$_reduce_13",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"Negative").$new(T["$[]"](1))}),A(o,"$_reduce_14",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"+",T["$[]"](2))}),A(o,"$_reduce_15",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"-",T["$[]"](2))}),A(o,"$_reduce_16",function(T,Y,m){return U(this.allowed_cmp_op["$include?"](u))||this.$raise(d("ParseError")),n([],{})}),A(o,"$_reduce_17",function(T,Y,m){var w,E,Z;return Z=null==(w=z(T))[1]?u:w[1],U(this.allowed_cmp_op["$include?"](E=null==w[0]?u:w[0]))||this.$raise(d("ParseError")),n(["cmp_op","target"],{cmp_op:E,target:Z})}),A(o,"$_reduce_18",function(T,Y,m){var J,w=this;return J=T["$[]"](0),U(w.question_target)||w.$raise(d("ParseError")),U(w.allowed_cmp_op["$include?"](J))||w.$raise(d("ParseError")),n(["cmp_op","target"],{cmp_op:J,target:"?"})}),A(o,"$_reduce_19",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"+",T["$[]"](2))}),A(o,"$_reduce_20",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"-",T["$[]"](2))}),A(o,"$_reduce_22",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"BinaryOp").$new(T["$[]"](0),"*",T["$[]"](2))}),A(o,"$_reduce_23",function(T,Y,m){return T["$[]"](3).$new(T["$[]"](0),T["$[]"](2))}),A(o,"$_reduce_25",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),A(o,"$_reduce_26",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"DivideWithCeil")}),A(o,"$_reduce_27",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"DivideWithCeil")}),A(o,"$_reduce_28",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"DivideWithRound")}),A(o,"$_reduce_29",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"DivideWithFloor")}),A(o,"$_reduce_30",function(T,Y,m){return T["$[]"](1)}),A(o,"$_reduce_31",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"Negative").$new(T["$[]"](1))}),A(o,"$_reduce_33",function(T,Y,m){return T["$[]"](1)}),A(o,"$_reduce_34",function(T,Y,m){return P(P(d("Arithmetic"),"Node"),"Number").$new(T["$[]"](0))}),A(o,"$_reduce_none",function(T,Y,m){return T["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var L,K,W,c,y,u,z,O,V=e.module,H=e.send,_=e.eqeqeq,j=e.truthy,N=e.def,f=e.return_val,F=[],b=e.nil;return L=F,K=O=[V(F[0],"BCDice")].concat(L),W=z=[V(O[0],"Deprecated")].concat(K),y=[c=V(z[0],"Checker")].concat(W),u=e.$r(y),c.$private(),N(c,"$check_result_legacy",function(r,t,p,I){var D,C=this,x=b,g=b,k=b,R=b;return x=H(t,"map",[],"sides".$to_proc()),D=(g=H(t,"map",[],"value".$to_proc())).$sum(),k=_([100],R=x)?C.$check_1D100(r,D,p,I):_([20],R)?C.$check_1D20(r,D,p,I):_([6,6],R)?C.$check_2D6(r,D,g,p,I):b,(j(k["$nil?"]())||j(k["$empty?"]()))&&(k=_([10],R=x.$uniq())?C.$check_nD10(r,D,g,p,I):_([6],R)?C.$check_nD6(r,D,g,p,I):b,j(k["$nil?"]())||j(k["$empty?"]()))?b:u("Result").$new(k.$delete_prefix(" \uff1e "))}),N(c,"$check_1D100",f(b)),N(c,"$check_1D20",f(b)),N(c,"$check_nD10",f(b)),N(c,"$check_2D6",f(b)),N(c,"$check_nD6",f(b))},Opal.modules["bcdice/base"]=function(e){var y,C,R,d,i,B,a,v,o,G,g,V=e.module,H=e.klass,_=e.slice,j=e.rb_plus,N=e.truthy,f=e.def,F=e.regexp,b=e.send,A=e.thrower,L=e.return_ivar,q=e.assign_ivar_val,O=e.eqeqeq,Q=e.eqeq,K=e.return_val,U=e.range,z=e.rb_minus,n=e.rb_divide,W=e.rb_times,c=e.rb_ge,u=e.top,P=[],r=e.$r(P),t=e.nil,p=e.$$$;return u.$require("i18n"),u.$require("i18n/backend/fallbacks"),u.$require("bcdice/randomizer"),u.$require("bcdice/dice_table"),u.$require("bcdice/enum"),u.$require("bcdice/translate"),u.$require("bcdice/result"),u.$require("bcdice/command/parser"),u.$require("bcdice/deprecated/checker"),C=P,R=g=[V(P[0],"BCDice")].concat(C),v=[a=H(g[0],null,"Base")].concat(R),o=e.$r(v),(G=a.$$prototype).raw_input=G.randomizer=G.enabled_upcase_input=G.debug=t,i=[d=e.get_singleton_class(a)].concat(v),B=e.$r(i),d.$attr_reader("prefixes"),f(d,"$register_prefix",function(h){var re,ee;return null==this.prefixes&&(this.prefixes=t),re=_(arguments),this.prefixes=j(N(ee=this.prefixes)?ee:[],re.$flatten())},-1),f(d,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),f(d,"$prefixes_pattern",function(){var h=this,$=t;return null==h.prefixes_pattern&&(h.prefixes_pattern=t),null==h.prefixes&&(h.prefixes=t),h.prefixes_pattern=N($=h.prefixes_pattern)?$:t,N(h.prefixes_pattern)?h.prefixes_pattern:(h.prefixes=N($=h.prefixes)?$:[],h.prefixes.$freeze(),h.prefixes_pattern=(N(h.prefixes["$empty?"]())?/(?!)/:F(["^(S)?(",h.prefixes.$join("|"),")"],"i")).$freeze())}),f(d,"$command_pattern",function(){var h=this,$=t,re=t;return null==h.command_pattern&&(h.command_pattern=t),null==h.prefixes&&(h.prefixes=t),h.command_pattern=N($=h.command_pattern)?$:t,N(h.command_pattern)?h.command_pattern:(h.prefixes=N($=h.prefixes)?$:[],h.prefixes.$freeze(),re=j(b(p(B("CommonCommand"),"COMMANDS"),"map",[],function(ee){return null==ee&&(ee=t),p(ee,"PREFIX_PATTERN").$source()}),h.prefixes),h.command_pattern=F(["^S?(",re.$join("|"),")"],"i").$freeze())}),f(d,"$eval",function(h){try{return A("eval_return"),this.$new(h).$eval()}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),a.$include(o("Translate")),a.$include(p(o("Deprecated"),"Checker")),f(a,"$initialize",function(S){var i=this;return i.raw_input=S,i.sort_add_dice=!1,i.sort_barabara_dice=!1,i.d66_sort_type=p(o("D66SortType"),"NO_SORT"),i.enabled_d9=!1,i.round_type=p(o("RoundType"),"FLOOR"),i.sides_implicit_d=6,i.upper_dice_reroll_threshold=t,i.reroll_dice_reroll_threshold=t,i.default_cmp_op=t,i.default_target_number=t,i.enabled_upcase_input=!0,i.locale="ja_jp",i.randomizer=p(o("BCDice"),"Randomizer").$new(),i.debug=!1}),a.$attr_accessor("randomizer"),a.$attr_reader("d66_sort_type"),a.$attr_reader("round_type"),a.$attr_reader("sides_implicit_d"),a.$attr_reader("upper_dice_reroll_threshold"),a.$attr_reader("reroll_dice_reroll_threshold"),a.$attr_reader("default_cmp_op"),a.$attr_reader("default_target_number"),f(a,"$sort_add_dice?",L("sort_add_dice")),f(a,"$sort_barabara_dice?",L("sort_barabara_dice")),f(a,"$enabled_d9?",L("enabled_d9")),f(a,"$enable_debug",q("debug",!0)),f(a,"$eval",function(){var i,s,S=this,B=t;return i=p(o("BCDice"),"Preprocessor").$process(S.raw_input,S),B=N(s=S.$dice_command(i))?s:S.$eval_common_command(S.raw_input),N(B)?(B["$rands="](S.randomizer.$rand_results()),B["$detailed_rands="](S.randomizer.$detailed_rand_results()),B):t}),f(a,"$change_text",function(S){return S}),f(a,"$check_result",function(S,i,B,s){var h=this,$=t,re=t,te=t,ee=t,ue=t;return $=h.$check_result_legacy(S,i,B,s),N($)?$:(re=b(i,"map",[],"sides".$to_proc()),ee=(te=b(i,"map",[],"value".$to_proc())).$sum(),$=O([100],ue=re)?h.$result_1d100(S,ee,B,s):O([20],ue)?h.$result_1d20(S,ee,B,s):O([6,6],ue)?h.$result_2d6(S,ee,te,B,s):t,Q($,o("Result").$nothing())?t:N($)?$:($=O([10],ue=re.$uniq())?h.$result_nd10(S,ee,te,B,s):O([6],ue)?h.$result_nd6(S,ee,te,B,s):t,Q($,o("Result").$nothing())?t:N($)?$:h.$result_ndx(S,B,s)))}),f(a,"$grich_text",K(t)),a.$private(),f(a,"$eval_common_command",function(S){try{A("eval_return");var B=A("return");return S=this.$change_text(S),b(p(o("CommonCommand"),"COMMANDS"),"each",[],function h($){var te,re=null==h.$$s?this:h.$$s;if(null==re.randomizer&&(re.randomizer=t),null==$&&($=t),te=$.$eval(S,re,re.randomizer),!N(te))return t;B.$throw(te)},{$$s:this,$$ret:B}),t}catch(h){if(h===e.t_eval_return||h===B)return h.$v;throw h}}),f(a,"$dice_command",function(S){var i=this,B=t,s=t,h=t,$=t;return N(i.enabled_upcase_input)&&(S=S.$upcase()),B=i.$class().$prefixes_pattern().$match(S),N(B)?(s=B["$[]"](1)["$nil?"]()["$!"](),N(s)&&(S=S["$[]"](U(1,-1,!1))),h=i.$eval_game_system_specific_command(S),N(h["$is_a?"](o("Result")))?(h["$secret="](N($=h["$secret?"]())?$:s),h):N(h["$nil?"]())||N(h["$empty?"]())||Q(h,"1")?t:b(o("Result").$new(),"tap",[],function(te){var ee;return null==te&&(te=t),te["$text="](h.$to_s()),b(te,"secret=",ee=[s]),ee[ee.length-1]})):t}),f(a,"$eval_game_system_specific_command",K(t)),f(a,"$result_ndx",function(S,i,B){return N(B["$is_a?"](o("String")))?t:N(S.$send(i,B))?o("Result").$success(this.$translate("success")):o("Result").$failure(this.$translate("failure"))}),f(a,"$result_1d100",K(t)),f(a,"$result_1d20",K(t)),f(a,"$result_nd10",K(t)),f(a,"$result_2d6",K(t)),f(a,"$result_nd6",K(t)),f(a,"$get_table_by_2d6",function(S){return this.$get_table_by_nD6(S,2)}),f(a,"$get_table_by_1d6",function(S){return this.$get_table_by_nD6(S,1)}),f(a,"$get_table_by_nD6",function(S,i){return this.$get_table_by_nDx(S,i,6)}),f(a,"$get_table_by_nDx",function(S,i,B){var h,$=t;return h=this.randomizer.$roll_sum(i,B),$=this.$get_table_value(S["$[]"](z(h,i))),N($["$nil?"]())?["1",0]:[$,h]}),f(a,"$get_table_by_1d3",function(S){var s,h,i=this,$=t;return i.$debug("get_table_by_1d3"),s=i.randomizer.$roll_sum(1,6),i.$debug("num",s),h=n(z(s,1),2).$to_i(),i.$debug("index",h),$=S["$[]"](h),N($["$nil?"]())?["1",0]:[$,s]}),f(a,"$get_table_by_d66_swap",function(S){var B;return B=this.randomizer.$roll_d66(p(o("D66SortType"),"ASC")),[this.$get_table_by_number(B,S),B]}),f(a,"$get_table_by_d66",function(S){var B,s,h,re,$=t;return B=this.randomizer.$roll_once(6),s=this.randomizer.$roll_once(6),h=j(W(z(B,1),6),z(s,1)),$=S["$[]"](h),re=""+B+s,N($["$nil?"]())?["1",re]:[$,re]}),f(a,"$get_table_by_number",function(S,i,B){try{var s=A("return");return null==B&&(B="1"),b(i,"each",[],function $(re){var ee,te=null==$.$$s?this:$.$$s;if(null==re&&(re=t),ee=re["$[]"](0),!N(c(ee,S)))return t;s.$throw(te.$get_table_value(re["$[]"](1)))},{$$s:this,$$ret:s}),this.$get_table_value(B)}catch($){if($===s)return $.$v;throw $}},-3),f(a,"$get_table_value",function(S){return N(S["$is_a?"](o("Proc")))?S.$call():S}),f(a,"$roll_tables",function(S,i){var s=t;return s=i["$[]"](S),N(s)?s.$roll(this.randomizer).$to_s():t}),f(a,"$debug",function(S,i){var s,h=this,$=t,re=t;return s=_(arguments,1),N(h.debug)?($=N(S["$is_a?"](o("String")))?S:S.$inspect(),N(s["$empty?"]())?h.$warn($):(re=b(s,"map",[],function(ee){return null==ee&&(ee=t),N(ee["$is_a?"](o("String")))?'"'+ee+'"':ee.$inspect()}),h.$warn($+": "+re.$join(", ")))):t},-2),p(p(r("I18n"),"Backend"),"Simple").$include(p(p(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),y=[["ja_jp"]],b(r("I18n").$fallbacks(),"defaults=",y),y[y.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var q,U,u,I,C,x,g,r,n,W,Q,V=e.module,H=e.klass,_=e.const_set,j=e.hash2,N=e.truthy,f=e.def,b=[],A=e.nil;return e.top.$require("strscan"),q=b,U=Q=[V(b[0],"BCDice")].concat(q),n=[V(Q[0],"GameSystem")].concat(U),W=e.$r(n),u=n,I=r=[H(n[0],W("Base"),"SwordWorld")].concat(u),x=[C=H(r[0],null,"RatingLexer")].concat(I),g=e.$r(x),C.$$prototype.scanner=A,_(x[0],"SYMBOLS",j(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),f(C,"$initialize",function(R){var a,v,G;return R=N(G=(a=(v=R)===A||null==v?A:v.$split(" ",2))===A||null==a?A:a.$first())?G:"",this.scanner=g("StringScanner").$new(R)}),f(C,"$next_token",function(){var R=this,a=A,v=A,G=A;return N(R.scanner["$eos?"]())?[!1,"$"]:N(a=R.scanner.$scan(/\d+/))?["NUMBER",a.$to_i()]:(v=R.scanner.$getch().$upcase(),[N(G=g("SYMBOLS")["$[]"](v))?G:v.$to_sym(),v])}),f(C,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var O,z,P,C,x,g,D,k,t,W,c,K,V=e.module,H=e.klass,_=e.def,j=e.truthy,N=e.rb_le,f=e.rb_plus,F=e.rb_lt,b=e.neqeq,A=[],L=e.nil;return O=A,z=K=[V(A[0],"BCDice")].concat(O),W=[V(K[0],"GameSystem")].concat(z),c=e.$r(W),P=W,C=t=[H(W[0],c("Base"),"SwordWorld")].concat(P),g=[x=H(t[0],null,"RatingParsed")].concat(C),D=e.$r(g),(k=x.$$prototype).modifier_after_half=k.modifier_after_one_and_a_half=k.semi_fixed_val=k.kept_modify=k.rate=k.greatest_fortune=k.modifier=L,x.$attr_accessor("rate"),x.$attr_accessor("critical"),x.$attr_accessor("kept_modify"),x.$attr_accessor("first_to"),x.$attr_accessor("first_modify"),x.$attr_accessor("rateup"),x.$attr_accessor("greatest_fortune"),x.$attr_accessor("semi_fixed_val"),x.$attr_accessor("tmp_fixed_val"),x.$attr_accessor("modifier"),x.$attr_accessor("modifier_after_half"),x.$attr_accessor("modifier_after_one_and_a_half"),_(x,"$initialize",function(a,v){var o=this;return o.rate=a,o.modifier=v,o.critical=13,o.kept_modify=0,o.first_to=0,o.first_modify=0,o.greatest_fortune=!1,o.rateup=0,o.semi_fixed_val=0,o.tmp_fixed_val=0,o.modifier_after_half=L,o.modifier_after_one_and_a_half=L}),_(x,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),_(x,"$one_and_a_half",function(){return this.modifier_after_one_and_a_half["$nil?"]()["$!"]()}),_(x,"$min_critical",function(){var a=this;return j(N(a.semi_fixed_val,1))?3:f(f(a.semi_fixed_val,a.kept_modify),2).$clamp(3,13)}),_(x,"$infinite_roll?",function(){return F(this.$critical(),this.$min_critical())}),_(x,"$to_s",function(){var a=this,v=L;return v="KeyNo."+a.rate,j(F(a.$critical(),13))&&(v=f(v,"c["+a.$critical()+"]")),b(a.$first_modify(),0)&&(v=f(v,"m["+D("Format").$modifier(a.$first_modify())+"]")),b(a.$first_to(),0)&&(v=f(v,"m["+a.$first_to()+"]")),b(a.$rateup(),0)&&(v=f(v,"r["+a.$rateup()+"]")),j(a.greatest_fortune)&&(v=f(v,"gf")),b(a.$semi_fixed_val(),0)&&(v=f(v,"sf["+a.$semi_fixed_val()+"]")),b(a.$tmp_fixed_val(),0)&&(v=f(v,"tf["+a.$tmp_fixed_val()+"]")),b(a.$kept_modify(),0)&&(v=f(v,"a["+D("Format").$modifier(a.$kept_modify())+"]")),b(a.modifier,0)&&(v=f(v,D("Format").$modifier(a.modifier))),v})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var b,O,W,r,y,K,U,L,V=e.module,H=e.klass,_=e.truthy,j=e.def,N=[];return b=N,O=L=[V(N[0],"BCDice")].concat(b),K=[V(L[0],"GameSystem")].concat(O),U=e.$r(K),W=K,y=[H(K[0],U("Base"),"SwordWorld")].concat(W),(r=H(y[0],null,"RatingOptions")).$attr_accessor("critical"),r.$attr_accessor("kept_modify"),r.$attr_accessor("first_to"),r.$attr_accessor("first_modify"),r.$attr_accessor("rateup"),r.$attr_accessor("greatest_fortune"),r.$attr_accessor("semi_fixed_val"),r.$attr_accessor("tmp_fixed_val"),r.$attr_accessor("modifier"),r.$attr_accessor("modifier_after_half"),r.$attr_accessor("modifier_after_one_and_a_half"),j(r,"$settable_first_roll_adjust_option?",function(){var I;return _(I=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():I}),j(r,"$settable_non_2d_roll_option?",function(){var I,C,p=this;return _(I=_(C=p.$greatest_fortune()["$nil?"]())?p.$semi_fixed_val()["$nil?"]():C)?p.$tmp_fixed_val()["$nil?"]():I})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var y,t,D,G,B,s,h,$,re,te,ee,ue,_e,ae,d,S,i,T,R,a,I,C,P,V=e.module,H=e.klass,_=e.ensure_kwargs,j=e.send2,N=e.find_super,f=e.def,F=e.send,b=e.truthy,A=e.not,L=e.thrower,q=e.hash,O=e.const_set,Q=e.to_ary,K=e.eqeq,U=e.top,z=[],n=e.nil,W=e.$$$;return U.$require("racc/parser.rb"),U.$require("bcdice/arithmetic/node"),U.$require("bcdice/enum"),U.$require("bcdice/game_system/sword_world/rating_lexer"),U.$require("bcdice/game_system/sword_world/rating_parsed"),U.$require("bcdice/game_system/sword_world/rating_options"),y=z,t=P=[V(z[0],"BCDice")].concat(y),I=[V(P[0],"GameSystem")].concat(t),C=e.$r(I),D=I,R=[H(I[0],C("Base"),"SwordWorld")].concat(D),a=e.$r(R),G=R,S=[d=H(R[0],W(a("Racc"),"Parser"),"RatingParser")].concat(G),i=e.$r(S),(T=d.$$prototype).lexer=T.round_type=T.version=n,f(d,"$initialize",function Y(m){var w,J,E=this;return Y.$$p=null,null==(w=(m=_(m)).$$smap.version)&&(w="v1_0"),null==(J=m.$$smap.round_type)&&(J=W(i("RoundType"),"CEIL")),j(E,N(E,"initialize",Y,!1,!0),"initialize",[],null),E.version=w,E.round_type=J},-1),f(d,"$set_debug",function(){return this.yydebug=!0,this}),f(d,"$parse",function(m){try{return this.lexer=i("RatingLexer").$new(m),this.$do_parse()}catch(J){if(!e.rescue(J,[i("ParseError"),i("ZeroDivisionError")]))throw J;try{return n}finally{e.pop_exception()}}}),d.$private(),f(d,"$parsed",function(m,w,J){try{return L("eval_return"),F(i("RatingParsed").$new(m,w),"tap",[],function Z(M){var ne,ie,ce,fe,oe,de,me,be,he,ge=null==Z.$$s?this:Z.$$s,ve=n;return null==ge.round_type&&(ge.round_type=n),null==M&&(M=n),M["$kept_modify="](b(ve=(ne=J.$kept_modify())===n||null==ne?n:ne.$eval(ge.round_type))?ve:0),M["$first_to="](b(ve=J.$first_to())?ve:0),M["$first_modify="](b(ve=J.$first_modify())?ve:0),M["$rateup="](b(ve=(ie=J.$rateup())===n||null==ie?n:ie.$eval(ge.round_type))?ve:0),A(J.$greatest_fortune()["$nil?"]())&&M["$greatest_fortune="](J.$greatest_fortune()),M["$semi_fixed_val="](b(ve=(ce=J.$semi_fixed_val())===n||null==ce?n:ce.$clamp(1,6))?ve:0),M["$tmp_fixed_val="](b(ve=(fe=J.$tmp_fixed_val())===n||null==fe?n:fe.$clamp(1,6))?ve:0),M["$modifier_after_half="]((oe=J.$modifier_after_half())===n||null==oe?n:oe.$eval(ge.round_type)),M["$modifier_after_one_and_a_half="]((de=J.$modifier_after_one_and_a_half())===n||null==de?n:de.$eval(ge.round_type)),me=[b((he=J.$critical(),be=he===n||null==he?n:he.$eval(ge.round_type),ve=be===n||null==be?n:be.$clamp(0,13)))?ve:b(M.$half())||b(M.$one_and_a_half())?13:10],F(M,"critical=",me),me[me.length-1]},{$$s:this})}catch(Z){if(Z===e.t_eval_return)return Z.$v;throw Z}}),f(d,"$next_token",function(){return this.lexer.$next_token()}),B=e.large_array_unpack("18,16,17,19,6,20,21,23,24,64,65,27,28,13,66,14,22,15,18,16,17,19,5,20,21,23,24,5,9,3,4,13,10,14,22,15,18,16,17,19,11,20,21,23,24,34,5,34,40,13,42,14,22,15,30,31,30,31,33,34,33,34,62,63,62,63,34,43,30,31,30,31,33,34,33,30,31,44,34,33,34,52,30,31,57,34,33,30,31,30,31,33,34,33,30,31,58,34,33,34,60,30,31,61,34,33,30,31,30,31,33,34,33,30,31,,34,33,34,,30,31,,34,33,30,31,30,31,33,36,33,30,31,62,63,33,62,63,37,38,62,63,62,63,62,63"),s=e.large_array_unpack("7,7,7,7,1,7,7,7,7,55,55,12,12,7,55,7,7,7,25,25,25,25,3,25,25,25,25,0,4,0,0,25,5,25,25,25,49,49,49,49,6,49,49,49,49,13,9,14,17,49,19,49,49,49,13,13,14,14,13,16,14,18,46,46,48,48,22,20,16,16,18,18,16,23,18,22,22,21,24,22,27,29,23,23,37,28,23,24,24,27,27,24,30,27,28,28,38,31,28,33,43,30,30,44,40,30,31,31,33,33,31,62,33,40,40,,63,40,64,,62,62,,65,62,63,63,64,64,63,15,64,65,65,50,50,65,51,51,15,15,56,56,69,69,70,70"),h=e.large_array_unpack("24,4,,19,23,30,40,-4,,43,,,0,43,45,128,57,43,59,42,59,69,64,71,76,14,,78,83,63,90,95,,97,,,,82,94,,102,,,98,101,,49,,51,32,121,124,,,,-2,128,,,,,,109,114,116,121,,,,130,132"),$=e.large_array_unpack("-36,-36,-5,-36,-36,-36,-36,-1,-5,-36,-4,71,-6,-36,-36,-36,-12,-36,-36,-36,-36,-36,-36,-36,-36,-2,-5,-36,-36,-36,-36,-36,-33,-36,-35,-8,-9,-36,-36,-13,-14,-16,-17,-36,-36,-20,-21,-30,-22,-3,-23,-24,-7,-31,-32,-36,-27,-10,-11,-15,-18,-19,-36,-36,-36,-36,-34,-28,-29,-25,-26"),re=e.large_array_unpack("29,35,7,39,1,41,46,48,25,45,50,51,2,55,,8,56,53,54,,,26,,,,,49,59,,,,,,,,,,,,,,,,,,,,69,70,67,68"),te=e.large_array_unpack("5,5,3,5,1,5,6,6,3,5,6,6,2,7,,2,6,5,5,,,2,,,,,3,5,,,,,,,,,,,,,,,,,,,,6,6,5,5"),ee=[n,4,12,0,n,-13,-17,-20,n],ue=[n,n,n,n,12,47,n,n,32],_e=e.large_array_unpack("0,0,racc_error,2,23,_reduce_1,3,23,_reduce_2,4,23,_reduce_3,2,24,_reduce_4,0,25,_reduce_5,2,25,_reduce_6,4,25,_reduce_7,3,25,_reduce_8,3,25,_reduce_9,4,25,_reduce_10,4,25,_reduce_11,2,25,_reduce_12,3,25,_reduce_13,3,25,_reduce_14,4,25,_reduce_15,3,25,_reduce_16,3,25,_reduce_17,4,25,_reduce_18,4,25,_reduce_19,3,25,_reduce_20,2,26,_reduce_21,2,26,_reduce_22,3,26,_reduce_23,3,26,_reduce_24,3,29,_reduce_25,3,29,_reduce_26,1,29,_reduce_none,3,28,_reduce_28,3,28,_reduce_29,1,28,_reduce_none,2,27,_reduce_31,2,27,_reduce_32,1,27,_reduce_none,3,30,_reduce_34,1,30,_reduce_35"),ae=q(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"O",6,"G",7,"F",8,"S",9,"T",10,"PLUS",11,"MINUS",12,"ASTERISK",13,"SLASH",14,"PARENL",15,"PARENR",16,"BRACKETL",17,"BRACKETR",18,"AT",19,"SHARP",20,"DOLLAR",21),O(S[0],"Racc_arg",[B,s,$,h,re,te,ue,ee,22,_e,ae,71,36,!0]),O(S[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","O","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),O(S[0],"Racc_debug_parser",!1),f(d,"$_reduce_1",function(m,w,J){try{L("eval_return");var E,ne,fe,ie=n,ce=n;return ne=null==(E=Q(m))[0]?n:E[0],ce=b(fe=(ie=null==E[1]?n:E[1]).$modifier())?fe:W(W(i("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,ce.$eval(this.round_type),ie)}catch(oe){if(oe===e.t_eval_return)return oe.$v;throw oe}}),f(d,"$_reduce_2",function(m,w,J){try{L("eval_return");var E,ie,fe,M=this,ce=n,oe=n;return ie=null==(E=Q(m))[1]?n:E[1],b((ce=null==E[2]?n:E[2]).$modifier_after_one_and_a_half())&&M.$raise(i("ParseError")),b(ce.$modifier_after_half())||ce["$modifier_after_half="](W(W(i("Arithmetic"),"Node"),"Number").$new(0)),oe=b(fe=ce.$modifier())?fe:W(W(i("Arithmetic"),"Node"),"Number").$new(0),M.$parsed(ie,oe.$eval(M.round_type),ce)}catch(de){if(de===e.t_eval_return)return de.$v;throw de}}),f(d,"$_reduce_3",function(m,w,J){try{L("eval_return");var E,ie,fe,M=this,ce=n,oe=n;return ie=null==(E=Q(m))[2]?n:E[2],b((ce=null==E[3]?n:E[3]).$modifier_after_half())&&M.$raise(i("ParseError")),b(ce.$modifier_after_one_and_a_half())||ce["$modifier_after_one_and_a_half="](W(W(i("Arithmetic"),"Node"),"Number").$new(0)),oe=b(fe=ce.$modifier())?fe:W(W(i("Arithmetic"),"Node"),"Number").$new(0),M.$parsed(ie,oe.$eval(M.round_type),ce)}catch(de){if(de===e.t_eval_return)return de.$v;throw de}}),f(d,"$_reduce_4",function(m,w,J){return m["$[]"](1).$to_i()}),f(d,"$_reduce_5",function(m,w,J){return i("RatingOptions").$new()}),f(d,"$_reduce_6",function(m,w,J){var l,ne,M=n;return ne=null==(l=Q(m))[1]?n:l[1],b((M=null==l[0]?n:l[0]).$modifier()["$nil?"]())||this.$raise(i("ParseError")),M["$modifier="](ne),M}),f(d,"$_reduce_7",function(m,w,J){var l,ie,M=n;return ie=null==(l=Q(m))[2]?n:l[2],b((M=null==l[0]?n:l[0]).$critical()["$nil?"]())||this.$raise(i("ParseError")),M["$critical="](ie),M}),f(d,"$_reduce_8",function(m,w,J){var l,ie,M=n;return ie=null==(l=Q(m))[2]?n:l[2],b((M=null==l[0]?n:l[0]).$critical()["$nil?"]())||this.$raise(i("ParseError")),M["$critical="](ie),M}),f(d,"$_reduce_9",function(m,w,J){var l,M=n,ie=n;return ie=null==(l=Q(m))[2]?n:l[2],b((M=null==l[0]?n:l[0])["$settable_first_roll_adjust_option?"]())||this.$raise(i("ParseError")),M["$first_to="](ie.$to_i()),M}),f(d,"$_reduce_10",function(m,w,J){var l,M=n,ie=n;return ie=null==(l=Q(m))[3]?n:l[3],b((M=null==l[0]?n:l[0])["$settable_first_roll_adjust_option?"]())||this.$raise(i("ParseError")),M["$first_modify="](ie.$to_i()),M}),f(d,"$_reduce_11",function(m,w,J){var l,M=n,ie=n;return ie=null==(l=Q(m))[3]?n:l[3],b((M=null==l[0]?n:l[0])["$settable_first_roll_adjust_option?"]())||this.$raise(i("ParseError")),M["$first_modify="](ie.$to_i()["$-@"]()),M}),f(d,"$_reduce_12",function(m,w,J){var l,M=n;return l=Q(m),b((M=null==l[0]?n:l[0]).$modifier_after_half()["$nil?"]())||this.$raise(i("ParseError")),M["$modifier_after_half="](W(W(i("Arithmetic"),"Node"),"Number").$new(0)),M}),f(d,"$_reduce_13",function(m,w,J){var l,ie,M=n;return ie=null==(l=Q(m))[2]?n:l[2],b((M=null==l[0]?n:l[0]).$modifier_after_half()["$nil?"]())||this.$raise(i("ParseError")),M["$modifier_after_half="](ie),M}),f(d,"$_reduce_14",function(m,w,J){var l,M=n;return l=Q(m),b((M=null==l[0]?n:l[0]).$modifier_after_one_and_a_half())&&this.$raise(i("ParseError")),M["$modifier_after_one_and_a_half="](W(W(i("Arithmetic"),"Node"),"Number").$new(0)),M}),f(d,"$_reduce_15",function(m,w,J){var l,ie,M=n;return ie=null==(l=Q(m))[3]?n:l[3],b((M=null==l[0]?n:l[0]).$modifier_after_one_and_a_half())&&this.$raise(i("ParseError")),M["$modifier_after_one_and_a_half="](ie),M}),f(d,"$_reduce_16",function(m,w,J){var l,ie,M=n;return M=null==(l=Q(m))[0]?n:l[0],ie=null==l[2]?n:l[2],b(["v2_5","v2_0"]["$include?"](this.version))&&b(M.$rateup()["$nil?"]())||this.$raise(i("ParseError")),M["$rateup="](ie),M}),f(d,"$_reduce_17",function(m,w,J){var l,M=n;return M=null==(l=Q(m))[0]?n:l[0],b(["v2_5","v2_0"]["$include?"](this.version))&&b(M["$settable_non_2d_roll_option?"]())||this.$raise(i("ParseError")),M["$greatest_fortune="](!0),M}),f(d,"$_reduce_18",function(m,w,J){var l,M=n,ie=n;return M=null==(l=Q(m))[0]?n:l[0],ie=null==l[3]?n:l[3],b(["v2_5","v2_0"]["$include?"](this.version))&&b(M["$settable_non_2d_roll_option?"]())||this.$raise(i("ParseError")),M["$semi_fixed_val="](ie.$to_i()),M}),f(d,"$_reduce_19",function(m,w,J){var l,M=n,ie=n;return M=null==(l=Q(m))[0]?n:l[0],ie=null==l[3]?n:l[3],b(["v2_5","v2_0"]["$include?"](this.version))&&b(M["$settable_non_2d_roll_option?"]())||this.$raise(i("ParseError")),M["$tmp_fixed_val="](ie.$to_i()),M}),f(d,"$_reduce_20",function(m,w,J){var l,ie,M=n;return M=null==(l=Q(m))[0]?n:l[0],ie=null==l[2]?n:l[2],K(this.version,"v2_5")&&b(M.$kept_modify()["$nil?"]())||this.$raise(i("ParseError")),M["$kept_modify="](ie),M}),f(d,"$_reduce_21",function(m,w,J){return m["$[]"](1)}),f(d,"$_reduce_22",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"Negative").$new(m["$[]"](1))}),f(d,"$_reduce_23",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"+",m["$[]"](2))}),f(d,"$_reduce_24",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"-",m["$[]"](2))}),f(d,"$_reduce_25",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"+",m["$[]"](2))}),f(d,"$_reduce_26",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"-",m["$[]"](2))}),f(d,"$_reduce_28",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"*",m["$[]"](2))}),f(d,"$_reduce_29",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(m["$[]"](0),m["$[]"](2))}),f(d,"$_reduce_31",function(m,w,J){return m["$[]"](1)}),f(d,"$_reduce_32",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"Negative").$new(m["$[]"](1))}),f(d,"$_reduce_34",function(m,w,J){return m["$[]"](1)}),f(d,"$_reduce_35",function(m,w,J){return W(W(i("Arithmetic"),"Node"),"Number").$new(m["$[]"](0))}),f(d,"$_reduce_none",function(m,w,J){return m["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var I,D,G,d,S,i,B,R,a,x,V=e.module,H=e.klass,_=e.const_set,j=e.send2,N=e.find_super,f=e.def,F=e.truthy,b=e.rb_ge,A=e.rb_le,L=e.eqeq,q=e.neqeq,O=e.rb_minus,Q=e.rb_gt,K=e.hash2,U=e.send,z=e.to_ary,n=e.rb_plus,W=e.rb_lt,c=e.rb_times,y=e.thrower,u=e.rb_divide,P=e.top,r=[],t=e.nil;return P.$require("bcdice/base"),P.$require("bcdice/game_system/sword_world/rating_parser"),I=r,D=x=[V(r[0],"BCDice")].concat(I),R=[V(x[0],"GameSystem")].concat(D),a=e.$r(R),G=R,S=[d=H(R[0],a("Base"),"SwordWorld")].concat(G),i=e.$r(S),(B=d.$$prototype).rating_table=B.randomizer=t,_(S[0],"ID","SwordWorld"),_(S[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),_(S[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),_(S[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),d.$register_prefix("H?K"),f(d,"$initialize",function s(h){return s.$$p=null,j(this,N(this,"initialize",s,!1,!0),"initialize",[h],null),this.rating_table=0}),f(d,"$result_2d6",function(h,$,re,te,ee){return F(b($,12))?i("Result").$critical(this.$translate("SwordWorld.critical")):F(A($,2))?i("Result").$fumble(this.$translate("SwordWorld.fumble")):q(te,">=")||L(ee,"?")?t:F(b(h,ee))?i("Result").$success(this.$translate("success")):i("Result").$failure(this.$translate("failure"))}),f(d,"$eval_game_system_specific_command",function(h){return this.$rating(h)}),d.$private(),f(d,"$rating_parser",function(){return i("RatingParser").$new()}),f(d,"$rating",function(h){var $,re,te=this,ee=t,ue=t,_e=t,le=t,$e=t,ae=t,se=t,X=t,T=t,Y=t,m=t,w=t,J=t,l=t,Z=t,M=t;return te.$debug("rating string",h),ee=te.$rating_parser().$parse(h),F(ee)?(ue=te.$getSW2_0_RatingTable(),_e=O(ue.$length(),1),te.$debug("keyMax",_e),F(Q(ee.$rate(),_e))?i("Result").$new(te.$translate("SwordWorld.keynumber_exceeds",K(["keyMax"],{keyMax:_e}))):F(ee["$infinite_roll?"]())?i("Result").$new(te.$translate("SwordWorld.infinite_critical",K(["min_critical"],{min_critical:ee.$min_critical()}))):(le=te.$getNewRates(ue),$e=ee+" \uff1e ",ae=[],se=[],X=[],T=0,Y=0,m=0,w=0,J=ee.$first_to(),l=ee.$first_modify(),function(){try{var ne=y("break");U(te,"loop",[],function ie(){var ce,fe,be,he,oe=null==ie.$$s?this:ie.$$s,de=t,me=t;if(fe=oe.$rollDice(ee,w),me=null==(ce=z(fe))[1]?t:ce[1],T=de=null==ce[0]?t:ce[0],q(J,0)?(T=de=J,J=0):q(l,0)&&(T=n(T,l),l=0),F(A(de,2))&&(ae["$<<"](de.$to_s()),se["$<<"](me.$to_s()),X["$<<"]("**"),w=n(w,1),ne.$throw()),q(ee.$kept_modify(),0)&&q(T,2)&&(T=n(T,ee.$kept_modify())),F(W(T,2))&&(T=2),F(Q(T,12))&&(T=12),be=[n(ee.$rate(),c(w,ee.$rateup())),_e].$min(),oe.$debug("currentKey",be),he=le["$[]"](T)["$[]"](be),oe.$debug("rateValue",he),m=n(m,he),Y=n(Y,T),ae["$<<"](T.$to_s()),se["$<<"](me.$to_s()),X["$<<"](F(Q(T,2))?he:"**"),w=n(w,1),F(b(T,ee.$critical())))return t;ne.$throw()},{$$s:te})}catch(ie){if(ie===ne)return ie.$v;throw ie}}(),re=te.$getResultText(m,ee,se,ae,X,Y,w),$=z(re),Z=null==$[1]?t:$[1],M=null==$[2]?t:$[2],$e=n($e,null==$[0]?t:$[0]),U(i("Result").$new(),"tap",[],function(ie){var ce;return null==ie&&(ie=t),ie["$text="]($e),ie["$critical="](Z),U(ie,"fumble=",ce=[M]),ce[ce.length-1]}))):(te.$debug("not matched"),"1")}),f(d,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),f(d,"$getNewRates",function(h){var $,re,ee=t,ue=t,_e=t,le=t,$e=t,ae=t,se=t,X=t,T=t,Y=t,m=t;return ee=[],ue=[],_e=[],le=[],$e=[],ae=[],se=[],X=[],T=[],Y=[],m=[],U(h,"each",[],function(l){var E=t;return null==l&&(l=t),E=l.$split(/,/),m.$push(0),ee.$push(E["$[]"](1).$to_i()),ue.$push(E["$[]"](2).$to_i()),_e.$push(E["$[]"](3).$to_i()),le.$push(E["$[]"](4).$to_i()),$e.$push(E["$[]"](5).$to_i()),ae.$push(E["$[]"](6).$to_i()),se.$push(E["$[]"](7).$to_i()),X.$push(E["$[]"](8).$to_i()),T.$push(E["$[]"](9).$to_i()),Y.$push(E["$[]"](10).$to_i())}),L(this.rating_table,1)&&Y["$[]="](31,($=[32,(re=[33,10],U(Y,"[]=",re),re[re.length-1])],U(Y,"[]=",$),$[$.length-1])),[m,m,m,ee,ue,_e,le,$e,ae,se,X,T,Y]}),f(d,"$rollDice",function(h,$){var te=t;return[(te=this.randomizer.$roll_barabara(2,6)).$sum(),te.$join(",")]}),f(d,"$getResultText",function(h,$,re,te,ee,ue,_e){var $e=t,ae=t,se=t,X=t,T=t;return($e=[]).$push("2D:["+re.$join(" ")+"]="+te.$join(",")),F(A(ue,2))?($e.$push(ee.$join(",")),$e.$push(this.$translate("SwordWorld.fumble")),[$e.$join(" \uff1e "),!1,!0]):(F(Q(ee.$size(),1))||q($.$modifier(),0)?(ae=n(ee.$join(","),i("Format").$modifier($.$modifier())),F($.$half())?(ae="("+ae+")/2",q($.$modifier_after_half(),0)&&(ae=n(ae,i("Format").$modifier($.$modifier_after_half())))):F($.$one_and_a_half())&&(ae="("+ae+")*1.5",q($.$modifier_after_one_and_a_half(),0)&&(ae=n(ae,i("Format").$modifier($.$modifier_after_one_and_a_half())))),$e.$push(ae)):F($.$half())?(ae=ee.$first()+"/2",q($.$modifier_after_half(),0)&&(ae=n(ae,i("Format").$modifier($.$modifier_after_half()))),$e.$push(ae)):F($.$one_and_a_half())&&(ae=ee.$first()+"*1.5",q($.$modifier_after_one_and_a_half(),0)&&(ae=n(ae,i("Format").$modifier($.$modifier_after_one_and_a_half()))),$e.$push(ae)),F(Q(_e,1))&&(se=this.$translate("SwordWorld.round_text",K(["reroll_count"],{reroll_count:O(_e,1)})),$e.$push(se)),X=n(h,$.$modifier()),F($.$half())?(X=u(X,2).$ceil(),q($.$modifier_after_half(),0)&&(X=n(X,$.$modifier_after_half()))):F($.$one_and_a_half())&&(X=c(X,1.5).$ceil(),q($.$modifier_after_one_and_a_half(),0)&&(X=n(X,$.$modifier_after_one_and_a_half()))),T=X.$to_s(),$e.$push(T),[$e.$join(" \uff1e "),Q(_e,1),!1])})},Opal.queue(function(e){var q,U,u,P,r,n,W,Q,V=e.module,H=e.klass,_=e.const_set,j=e.send2,N=e.find_super,f=e.def,b=[];return e.top.$require("bcdice/game_system/SwordWorld"),q=b,U=Q=[V(b[0],"BCDice")].concat(q),n=[V(Q[0],"GameSystem")].concat(U),W=e.$r(n),u=n,_((r=[P=H(n[0],W("SwordWorld"),"SwordWorld_SimplifiedChinese")].concat(u))[0],"ID","SwordWorld:SimplifiedChinese"),_(r[0],"NAME","\u5251\u4e16\u754c"),_(r[0],"SORT_KEY","\u56fd\u969b\u5316:Simplified Chinese:\u5251\u4e16\u754c"),_(r[0],"HELP_MESSAGE","\u30fbSW\u3000\u5a01\u529b\u8868\u3000(Kx[c]+m$f) (x:\u5a01\u529b\u503c, c:\u66b4\u51fb\u503c, m:\u52a0\u503c, f:\u9ab0\u5b50\u51fa\u76ee\u4fee\u6b63)\n"),P.$register_prefix_from_super_class(),f(P,"$initialize",function t(p){var C=this;return t.$$p=null,j(C,N(C,"initialize",t,!1,!0),"initialize",[p],null),C.locale="zh_hans"})})}}]);