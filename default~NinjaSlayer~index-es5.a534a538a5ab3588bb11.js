(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{mLdZ:function(t,r,e){e("pQ1d"),Opal.modules["racc/parser"]=function(t){function r(t,r){return"number"==typeof t&&"number"==typeof r?t<r:t["$<"](r)}function e(t,r){return"number"==typeof t&&"number"==typeof r?t-r:t["$-"](r)}function n(t,r){return"number"==typeof t&&"number"==typeof r?t+r:t["$+"](r)}function i(t,r){return"number"==typeof t&&"number"==typeof r?t>=r:t["$>="](r)}function c(t,r){return"number"==typeof t&&"number"==typeof r?t>r:t["$>"](r)}var $=[],a=t.nil,s=t.$$$,o=t.$$,u=t.module,_=t.klass,h=t.truthy,d=t.gvars,l=t.send;return function(t,r){var e=[u(t,"Racc")].concat(r);!function(t,r,e){[_(t,r,"ParseError")].concat(e)}(e[0],o(e,"StandardError"),e)}($[0],$),h(s("::","ParseError","skip_raise")?"constant":a)||t.const_set($[0],"ParseError",s(o($,"Racc"),"ParseError")),function($,f){var p=[u($,"Racc")].concat(f);h(o(p,"Racc_No_Extensions","skip_raise")?"constant":a)||t.const_set(p[0],"Racc_No_Extensions",!1),function($,u,f){var p,y,m,v,g,b,R,E,x,k,D,A,w,N,T,L,C,S,B,O,z,I,U,P,V=_($,null,"Parser"),M=[V].concat(f);V.$$prototype.yydebug=V.$$prototype.racc_debug_out=V.$$prototype.racc_error_status=V.$$prototype.racc_t=V.$$prototype.racc_vstack=V.$$prototype.racc_val=V.$$prototype.racc_state=V.$$prototype.racc_tstack=a,t.const_set(M[0],"Racc_Runtime_Version","1.4.6"),t.const_set(M[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),t.const_set(M[0],"Racc_Runtime_Core_Version_R","1.4.6"),t.const_set(M[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),t.const_set(M[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),t.const_set(M[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),t.const_set(M[0],"Racc_Runtime_Core_Version",o(M,"Racc_Runtime_Core_Version_R")),t.const_set(M[0],"Racc_Runtime_Core_Revision",o(M,"Racc_Runtime_Core_Revision_R")),t.const_set(M[0],"Racc_Runtime_Type","ruby"),t.defs(o(M,"Parser"),"$racc_runtime_type",p=function(){return o(M,"Racc_Runtime_Type")},p.$$arity=0),t.def(V,"$_racc_setup",y=function(){var n,i,c=a,$=a,o=a;return null==d.stderr&&(d.stderr=a),h(s(this.$class(),"Racc_debug_parser"))||(this.yydebug=!1),h(null!=(n=this.yydebug)&&n!==a?"instance-variable":a)||(this.yydebug=!1),h(this.yydebug)&&(h(null!=(i=this.racc_debug_out)&&i!==a?"instance-variable":a)||(this.racc_debug_out=d.stderr),this.racc_debug_out=h(c=this.racc_debug_out)?c:d.stderr),$=s(this.$class(),"Racc_arg"),h(r($.$size(),14))&&(l($,"[]=",t.to_a(o=[13,!0])),e(o.length,1)),$},y.$$arity=0),t.def(V,"$_racc_init_sysvars",m=function(){return this.racc_state=[0],this.racc_tstack=[],this.racc_vstack=[],this.racc_t=a,this.racc_val=a,this.racc_read_next=!0,this.racc_user_yyerror=!1,this.racc_error_status=0},m.$$arity=0),t.def(V,"$do_parse",v=function(){return this.$__send__(o(M,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},v.$$arity=0),t.def(V,"$next_token",g=function(){return this.$raise(o(M,"NotImplementedError"),this.$class()+"#next_token is not defined")},g.$$arity=0),t.def(V,"$_racc_do_parse_rb",b=function(r,e){var c,$,s=a,o=a,u=a,_=a,d=a,f=a,p=a,y=a;return c=t.to_ary(r),s=null==c[0]?a:c[0],o=null==c[1]?a:c[1],u=null==c[2]?a:c[2],_=null==c[3]?a:c[3],d=null==c[10]?a:c[10],this.$_racc_init_sysvars(),f=p=y=a,l(this,"catch",["racc_end_parse"],(($=function(){var e,c,l=null==$.$$s?this:$.$$s,m=a,v=a,g=a;for(null==l.racc_state&&(l.racc_state=a),null==l.racc_read_next&&(l.racc_read_next=a),null==l.racc_t&&(l.racc_t=a),null==l.yydebug&&(l.yydebug=a),null==l.racc_val&&(l.racc_val=a);h(!0);)for(h(y=_["$[]"](l.racc_state["$[]"](-1)))?(h(l.racc_read_next)&&h(l.racc_t["$!="](0))&&(c=l.$next_token(),e=t.to_ary(c),f=null==e[0]?a:e[0],l.racc_val=null==e[1]?a:e[1],l.racc_t=h(f)?h(m=d["$[]"](f))?m:1:0,h(l.yydebug)&&l.$racc_read_token(l.racc_t,f,l.racc_val),l.racc_read_next=!1),y=n(y,l.racc_t),h(h(v=h(g=i(y,0))?p=s["$[]"](y):g)?o["$[]"](y)["$=="](l.racc_state["$[]"](-1)):v)||(p=u["$[]"](l.racc_state["$[]"](-1)))):p=u["$[]"](l.racc_state["$[]"](-1));h(p=l.$_racc_evalact(p,r)););}).$$s=this,$.$$arity=0,$))},b.$$arity=2),t.def(V,"$yyparse",R=function(t,r){return this.$__send__(o(M,"Racc_YY_Parse_Method"),t,r,this.$_racc_setup(),!0)},R.$$arity=2),t.def(V,"$_racc_yyparse_rb",E=function(r,e,c,$){var s,o,u=a,_=a,d=a,f=a,p=a,y=a,m=a;return s=t.to_ary(c),u=null==s[0]?a:s[0],_=null==s[1]?a:s[1],d=null==s[2]?a:s[2],f=null==s[3]?a:s[3],p=null==s[10]?a:s[10],this.$_racc_init_sysvars(),y=a,m=a,l(this,"catch",["racc_end_parse"],((o=function(){var t,$=null==o.$$s?this:o.$$s;for(null==$.racc_state&&($.racc_state=a);!h(m=f["$[]"]($.racc_state["$[]"](-1)));)for(;h(y=$.$_racc_evalact(d["$[]"]($.racc_state["$[]"](-1)),c)););return l(r,"__send__",[e],((t=function(r,e){var $,s,o=null==t.$$s?this:t.$$s,l=a,v=a,g=a,b=a,R=a,E=a,x=a;for(null==o.racc_t&&(o.racc_t=a),null==o.racc_state&&(o.racc_state=a),null==o.racc_read_next&&(o.racc_read_next=a),null==r&&(r=a),null==e&&(e=a),o.racc_t=h(r)?h(l=p["$[]"](r))?l:1:0,o.racc_val=e,o.racc_read_next=!1,m=n(m,o.racc_t),h(h($=h(s=i(m,0))?y=u["$[]"](m):s)?_["$[]"](m)["$=="](o.racc_state["$[]"](-1)):$)||(y=d["$[]"](o.racc_state["$[]"](-1)));h(y=o.$_racc_evalact(y,c)););for(;h(h(v=h(g=(m=f["$[]"](o.racc_state["$[]"](-1)))["$!"]())?g:o.racc_read_next["$!"]())?v:o.racc_t["$=="](0));)for(h(h(b=h(R=h(E=h(x=m)?m=n(m,o.racc_t):x)?i(m,0):E)?y=u["$[]"](m):R)?_["$[]"](m)["$=="](o.racc_state["$[]"](-1)):b)||(y=d["$[]"](o.racc_state["$[]"](-1)));h(y=o.$_racc_evalact(y,c)););}).$$s=$,t.$$arity=2,t))}).$$s=this,o.$$arity=0,o))},E.$$arity=4),t.def(V,"$_racc_evalact",x=function($,s){var o,u,_,d,f,p=a,y=a,m=a,v=a,g=a,b=a,R=a,E=a,x=a,k=a;if(p=null==(o=t.to_ary(s))[0]?a:o[0],y=null==o[1]?a:o[1],m=null==o[3]?a:o[3],_=null==o[11]?a:o[11],v=null==o[12]?a:o[12],h(h(f=c($,0))?r($,_):f))h(c(this.racc_error_status,0))&&(this.racc_t["$=="](1)||(this.racc_error_status=e(this.racc_error_status,1))),this.racc_vstack.$push(this.racc_val),this.racc_state.$push($),this.racc_read_next=!0,h(this.yydebug)&&(this.racc_tstack.$push(this.racc_t),this.$racc_shift(this.racc_t,this.racc_tstack,this.racc_vstack));else if(h(h(g=r($,0))?c($,v["$-@"]()):g)){if(b=l(this,"catch",["racc_jump"],((u=function(){var t=null==u.$$s?this:u.$$s;return null==t.racc_state&&(t.racc_state=a),t.racc_state.$push(t.$_racc_do_reduce(s,$)),!1}).$$s=this,u.$$arity=0,u)),h(b)){if(1["$==="](R=b))return this.racc_user_yyerror=!0,v["$-@"]();if(2["$==="](R))return _;this.$raise("[Racc Bug] unknown jump code")}}else if($["$=="](_))h(this.yydebug)&&this.$racc_accept(),this.$throw("racc_end_parse",this.racc_vstack["$[]"](0));else{if($["$=="](v["$-@"]())){for((0)["$==="](R=this.racc_error_status)?h(s["$[]"](21))||this.$on_error(this.racc_t,this.racc_val,this.racc_vstack):3["$==="](R)&&(this.racc_t["$=="](0)&&this.$throw("racc_end_parse",a),this.racc_read_next=!0),this.racc_user_yyerror=!1,this.racc_error_status=3;h(!0)&&(!h(E=m["$[]"](this.racc_state["$[]"](-1)))||(E=n(E,1),!h(h(x=h(k=i(E,0))?$=p["$[]"](E):k)?y["$[]"](E)["$=="](this.racc_state["$[]"](-1)):x)));)h("number"==typeof(d=this.racc_state.$size())?d<=1:d["$<="](1))&&this.$throw("racc_end_parse",a),this.racc_state.$pop(),this.racc_vstack.$pop(),h(this.yydebug)&&(this.racc_tstack.$pop(),this.$racc_e_pop(this.racc_state,this.racc_tstack,this.racc_vstack));return $}this.$raise("[Racc Bug] unknown action "+$.$inspect())}return h(this.yydebug)&&this.$racc_next_state(this.racc_state["$[]"](-1),this.racc_state),a},x.$$arity=2),t.def(V,"$_racc_do_reduce",k=function(r,c){var $,s,o,u,_,d,f,p,y=a,m=a,v=a,g=a,b=a,R=a,E=a,x=a,k=a,D=a,A=a,w=a,N=a,T=a,L=a,C=a;return y=null==($=t.to_ary(r))[4]?a:$[4],m=null==$[5]?a:$[5],v=null==$[6]?a:$[6],g=null==$[7]?a:$[7],s=null==$[8]?a:$[8],b=null==$[9]?a:$[9],o=null==$[13]?a:$[13],R=this.racc_state,E=this.racc_vstack,x=this.racc_tstack,k="number"==typeof(p=c)?-3*p:p["$*"](-3),D=b["$[]"](k),u=b["$[]"](n(k,1)),_=b["$[]"](n(k,2)),d=[],h(this.yydebug)&&(A=x["$[]"](D["$-@"](),D)),w=E["$[]"](D["$-@"](),D),h(this.yydebug)&&(N=[D["$-@"](),D,d],l(x,"[]=",t.to_a(N)),e(N.length,1)),N=[D["$-@"](),D,d],l(E,"[]=",t.to_a(N)),e(N.length,1),N=[D["$-@"](),D,d],l(R,"[]=",t.to_a(N)),e(N.length,1),h(o)?E.$push(this.$__send__(_,w,E,w["$[]"](0))):E.$push(this.$__send__(_,w,E)),x.$push(u),h(this.yydebug)&&this.$racc_reduce(A,u,x,E),f=e(u,s),h(k=g["$[]"](f))&&(k=n(k,R["$[]"](-1)),h(h(T=h(L=i(k,0))?C=y["$[]"](k):L)?m["$[]"](k)["$=="](f):T))?C:v["$[]"](f)},k.$$arity=2),t.def(V,"$on_error",D=function(t,r,e){var n;return this.$raise(o(M,"ParseError"),this.$sprintf("\nparse error on value %s (%s)",r.$inspect(),h(n=this.$token_to_str(t))?n:"?"))},D.$$arity=3),t.def(V,"$yyerror",A=function(){return this.$throw("racc_jump",1)},A.$$arity=0),t.def(V,"$yyaccept",w=function(){return this.$throw("racc_jump",2)},w.$$arity=0),t.def(V,"$yyerrok",N=function(){return this.racc_error_status=0},N.$$arity=0),t.def(V,"$racc_read_token",T=function(t,r,e){return this.racc_debug_out.$print("read    "),this.racc_debug_out.$print(r.$inspect(),"(",this.$racc_token2str(t),") "),this.racc_debug_out.$puts(e.$inspect()),this.racc_debug_out.$puts()},T.$$arity=3),t.def(V,"$racc_shift",L=function(t,r,e){return this.racc_debug_out.$puts("shift   "+this.$racc_token2str(t)),this.$racc_print_stacks(r,e),this.racc_debug_out.$puts()},L.$$arity=3),t.def(V,"$racc_reduce",C=function(t,r,e,n){var i,c=a;return(c=this.racc_debug_out).$print("reduce "),h(t["$empty?"]())?c.$print(" <none>"):l(t,"each",[],((i=function(t){return null==t&&(t=a),c.$print(" ",(null==i.$$s?this:i.$$s).$racc_token2str(t))}).$$s=this,i.$$arity=1,i)),c.$puts(" --\x3e "+this.$racc_token2str(r)),this.$racc_print_stacks(e,n),this.racc_debug_out.$puts()},C.$$arity=4),t.def(V,"$racc_accept",S=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},S.$$arity=0),t.def(V,"$racc_e_pop",B=function(t,r,e){return this.racc_debug_out.$puts("error recovering mode: pop token"),this.$racc_print_states(t),this.$racc_print_stacks(r,e),this.racc_debug_out.$puts()},B.$$arity=3),t.def(V,"$racc_next_state",O=function(t,r){return this.racc_debug_out.$puts("goto    "+t),this.$racc_print_states(r),this.racc_debug_out.$puts()},O.$$arity=2),t.def(V,"$racc_print_stacks",z=function(t,r){var e,n=a;return(n=this.racc_debug_out).$print("        ["),l(t,"each_index",[],((e=function(i){return null==i&&(i=a),n.$print(" (",(null==e.$$s?this:e.$$s).$racc_token2str(t["$[]"](i))," ",r["$[]"](i).$inspect(),")")}).$$s=this,e.$$arity=1,e)),n.$puts(" ]")},z.$$arity=2),t.def(V,"$racc_print_states",I=function(t){var r,e=a;return(e=this.racc_debug_out).$print("        ["),l(t,"each",[],((r=function(t){return null==t&&(t=a),e.$print(" ",t)}).$$s=this,r.$$arity=1,r)),e.$puts(" ]")},I.$$arity=1),t.def(V,"$racc_token2str",U=function(t){var r;return h(r=s(this.$class(),"Racc_token_to_s_table")["$[]"](t))?r:this.$raise("[Racc Bug] can't convert token "+t+" to string")},U.$$arity=1),t.def(V,"$token_to_str",P=function(t){return s(this.$class(),"Racc_token_to_s_table")["$[]"](t)},P.$$arity=1)}(p[0],0,p)}($[0],$)},Opal.modules.strscan=function(t){var r=[],e=t.nil,n=t.$$,i=t.klass,c=t.truthy,$=t.send;return function(r,a,s){var o,u,_,h,d,l,f,p,y,m,v,g,b,R,E,x,k,D,A,w,N,T,L,C,S,B=i(r,null,"StringScanner"),O=[B].concat(s);return B.$$prototype.pos=B.$$prototype.string=B.$$prototype.working=B.$$prototype.matched=B.$$prototype.prev_pos=B.$$prototype.match=e,B.$attr_reader("pos"),B.$attr_reader("matched"),t.def(B,"$initialize",o=function(t){return this.string=t,this.pos=0,this.matched=e,this.working=t,this.match=[]},o.$$arity=1),B.$attr_reader("string"),t.def(B,"$beginning_of_line?",u=function(){return 0===this.pos||"\n"===this.string.charAt(this.pos-1)},u.$$arity=0),t.alias(B,"bol?","beginning_of_line?"),t.def(B,"$scan",_=function(t){var r=(t=this.$anchor(t)).exec(this.working);return null==r?this.matched=e:"object"==typeof r?(this.prev_pos=this.pos,this.pos+=r[0].length,this.working=this.working.substring(r[0].length),this.matched=r[0],this.match=r,r[0]):"string"==typeof r?(this.pos+=r.length,this.working=this.working.substring(r.length),r):e},_.$$arity=1),t.def(B,"$scan_until",h=function(t){t=this.$anchor(t);for(var r,n=this.pos,i=this.working;;){if(r=t.exec(i),n+=1,i=i.substr(1),null!=r)return this.matched=this.string.substr(this.pos,n-this.pos-1+r[0].length),this.match=r,this.prev_pos=n-1,this.pos=n,this.working=i.substr(r[0].length),this.matched;if(0===i.length)return this.match=[],this.matched=e}},h.$$arity=1),t.def(B,"$[]",d=function(t){var r;if(c(this.match["$empty?"]()))return e;r=t,n(O,"Symbol")["$==="](r)?t=t.$to_s():n(O,"String")["$==="](r)||(t=n(O,"Opal")["$coerce_to!"](t,n(O,"Integer"),"to_int"));var i=this.match;return t<0&&(t+=i.length),t<0||t>=i.length||null==i[t]?e:i[t]},d.$$arity=1),t.def(B,"$check",l=function(t){var r=(t=this.$anchor(t)).exec(this.working);return this.matched=null==r?e:r[0]},l.$$arity=1),t.def(B,"$check_until",f=function(t){var r=this.prev_pos,n=this.pos,i=this.$scan_until(t);return i!==e&&(this.matched=i.substr(-1),this.working=this.string.substr(n)),this.prev_pos=r,this.pos=n,i},f.$$arity=1),t.def(B,"$peek",p=function(t){return this.working.substring(0,t)},p.$$arity=1),t.def(B,"$eos?",y=function(){return 0===this.working.length},y.$$arity=0),t.def(B,"$exist?",m=function(t){var r=t.exec(this.working);return null==r?e:0==r.index?0:r.index+1},m.$$arity=1),t.def(B,"$skip",v=function(t){var r=(t=this.$anchor(t)).exec(this.working);if(null==r)return this.match=[],this.matched=e;var n=r[0],i=n.length;return this.matched=n,this.match=r,this.prev_pos=this.pos,this.pos+=i,this.working=this.working.substring(i),i},v.$$arity=1),t.def(B,"$skip_until",g=function(t){var r=this.$scan_until(t);return r===e?e:(this.matched=r.substr(-1),r.length)},g.$$arity=1),t.def(B,"$get_byte",b=function(){var t=e;return this.pos<this.string.length?(this.prev_pos=this.pos,this.pos+=1,t=this.matched=this.working.substring(0,1),this.working=this.working.substring(1)):this.matched=e,t},b.$$arity=0),t.alias(B,"getch","get_byte"),t.def(B,"$match?",R=function(t){var r=(t=this.$anchor(t)).exec(this.working);return null==r?e:(this.prev_pos=this.pos,r[0].length)},R.$$arity=1),t.def(B,"$pos=",E=function(t){return t<0&&(t+=this.string.$length()),this.pos=t,this.working=this.string.slice(t)},E.$$arity=1),t.def(B,"$matched_size",x=function(){return this.matched===e?e:this.matched.length},x.$$arity=0),t.def(B,"$post_match",k=function(){return this.matched===e?e:this.string.substr(this.pos)},k.$$arity=0),t.def(B,"$pre_match",D=function(){return this.matched===e?e:this.string.substr(0,this.prev_pos)},D.$$arity=0),t.def(B,"$reset",A=function(){return this.working=this.string,this.matched=e,this.pos=0},A.$$arity=0),t.def(B,"$rest",w=function(){return this.working},w.$$arity=0),t.def(B,"$rest?",N=function(){return 0!==this.working.length},N.$$arity=0),t.def(B,"$rest_size",T=function(){return this.$rest().$size()},T.$$arity=0),t.def(B,"$terminate",L=function(){var r,n;return this.match=e,r=[this.string.$length()],$(this,"pos=",t.to_a(r)),r[(n=r.length,"number"==typeof n?n-1:n["$-"](1))]},L.$$arity=0),t.def(B,"$unscan",C=function(){return this.pos=this.prev_pos,this.prev_pos=e,this.match=e,this},C.$$arity=0),B.$private(),t.def(B,"$anchor",S=function(t){var r=t.toString().match(/\/([^\/]+)$/);return r=r?r[1]:void 0,new RegExp("^(?:"+t.source+")",r)},S.$$arity=1),e&&"anchor"}(r[0],0,r)},Opal.modules["bcdice/normalize"]=function(t){var r=[],e=t.nil,n=t.module;return function(r,i){var c=[n(r,"BCDice")].concat(i);!function(r,i){var c,$,a=n(r,"Normalize");[a].concat(i),a.$module_function(),t.def(a,"$comparison_operator",c=function(t){var r;return/<=|=</["$==="](r=t)?"<=":/>=|=>/["$==="](r)?">=":/<>|!=|=!/["$==="](r)?"!=":/</["$==="](r)?"<":/>/["$==="](r)?">":/=/["$==="](r)?"==":e},c.$$arity=1),t.def(a,"$target_number",$=function(t){return t["$=="]("?")?t:t.$to_i()},$.$$arity=1)}(c[0],c)}(r[0],r)},Opal.modules["bcdice/common_command/lexer"]=function(t){var r=t.top,e=[],n=t.nil,i=t.$$,c=t.module,$=t.klass,a=t.hash2,s=t.truthy;return r.$require("strscan"),r.$require("bcdice/normalize"),function(r,e){var o=[c(r,"BCDice")].concat(e);!function(r,e){var o=[c(r,"CommonCommand")].concat(e);!function(r,e,c){var o,u,_,h=$(r,null,"Lexer"),d=[h].concat(c);h.$$prototype.scanner=n,t.const_set(d[0],"SYMBOLS",a(["+","-","*","/","(",")","[","]","?","@"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","?":"QUESTION","@":"AT"}).$freeze()),t.def(h,"$initialize",o=function(t){var r;return t=s(r=t.$split(" ",2).$first())?r:"",this.scanner=i(d,"StringScanner").$new(t)},o.$$arity=1),t.def(h,"$next_token",u=function(){var t=n,r=n,e=n,c=n;return s(this.scanner["$eos?"]())?[!1,"$"]:s(t=this.scanner.$scan(/\d+/))?["NUMBER",t.$to_i()]:s(r=this.scanner.$scan(/[<>!=]+/))?["CMP_OP",i(d,"Normalize").$comparison_operator(r)]:(e=this.scanner.$getch().$upcase(),[s(c=i(d,"SYMBOLS")["$[]"](e))?c:e.$to_sym(),e])},u.$$arity=0),t.def(h,"$source",_=function(){return this.scanner.$string()},_.$$arity=0)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/common_command/reroll_dice/node"]=function(t){function r(t,r){return"number"==typeof t&&"number"==typeof r?t<r:t["$<"](r)}function e(t,r){return"number"==typeof t&&"number"==typeof r?t>r:t["$>"](r)}function n(t,r){return"number"==typeof t&&"number"==typeof r?t-r:t["$-"](r)}var i=[],c=t.nil,$=t.$$,a=t.module,s=t.klass,o=t.hash2,u=t.truthy,_=t.send;return function(i,h){var d=[a(i,"BCDice")].concat(h);!function(i,h){var d=[a(i,"CommonCommand")].concat(h);!function(i,h){var d=[a(i,"RerollDice")].concat(h);!function(i,h){var d=[a(i,"Node")].concat(h);!function(i,a,h){var d,l,f,p,y,m=s(i,null,"Command"),v=[m].concat(h);m.$$prototype.cmp_op=m.$$prototype.reroll_cmp_op=m.$$prototype.target_number_node=m.$$prototype.reroll_threshold_node=m.$$prototype.notations=m.$$prototype.source=c,t.def(m,"$initialize",d=function(r){var e,n,i,$,a,s,u;if(null==r)r=o([],{});else if(!r.$$is_hash)throw t.ArgumentError.$new("expected kwargs");if(!t.hasOwnProperty.call(r.$$smap,"secret"))throw t.ArgumentError.$new("missing keyword: secret");if(e=r.$$smap.secret,!t.hasOwnProperty.call(r.$$smap,"notations"))throw t.ArgumentError.$new("missing keyword: notations");if(n=r.$$smap.notations,!t.hasOwnProperty.call(r.$$smap,"source"))throw t.ArgumentError.$new("missing keyword: source");return i=r.$$smap.source,null==($=r.$$smap.cmp_op)&&($=c),null==(a=r.$$smap.target_number)&&(a=c),null==(s=r.$$smap.reroll_cmp_op)&&(s=c),null==(u=r.$$smap.reroll_threshold)&&(u=c),this.secret=e,this.notations=n,this.cmp_op=$,this.target_number_node=a,this.reroll_cmp_op=s,this.reroll_threshold_node=u,this.source=i},d.$$arity=1),t.def(m,"$eval",l=function(t,r){var e,n,i,a,s,o,h,d,l,f,p,y,m,g,b,R,E,x,k,D,A=c,w=c,N=c,T=c;return h=t.$round_type(),d=u(b=this.cmp_op)?b:t.$default_cmp_op(),l=u(R=u(E=this.reroll_cmp_op)?E:d)?R:">=",f=u(x=(e=this.target_number_node)===c||null==e?c:_(e,"eval",[h]))?x:t.$default_target_number(),p=u(k=u(D=(n=this.reroll_threshold_node)===c||null==n?c:_(n,"eval",[h]))?D:t.$reroll_dice_reroll_threshold())?k:f,A=$(v,"RerollCondition").$new(l,p),y=_(this.notations,"map",[],((i=function(t){return null==t&&(t=c),t.$to_dice(h)}).$$s=this,i.$$arity=1,i)),u(_(y,"all?",[],((a=function(t){return null==t&&(t=c),A["$valid?"](t.$sides())}).$$s=this,a.$$arity=1,a)))?(N=(w=this.$roll(y,r,A,t["$sort_barabara_dice?"]())).$flatten(),m=w.$take(this.notations.$size()).$flatten().$count(1),g=u(d)?_(N,"count",[],((s=function(t){return null==t&&(t=c),t.$send(d,f)}).$$s=this,s.$$arity=1,s)):0,T=[this.$expr(h,A,d,f),_(w,"map",[],(o=function(t){return null==t&&(t=c),t.$join(",")},o.$$s=this,o.$$arity=1,o)).$join(" + "),"\u6210\u529f\u6570"+g,t.$grich_text(m,N.$size(),g)].$compact(),this.$result_with_text(T.$join(" \uff1e "))):this.$result_with_text(this.source+" \uff1e \u6761\u4ef6\u304c\u9593\u9055\u3063\u3066\u3044\u307e\u3059\u30022R6>=5 \u3042\u308b\u3044\u306f 2R6[5] \u306e\u3088\u3046\u306b\u632f\u308a\u8db3\u3057\u76ee\u6a19\u5024\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002")},l.$$arity=2),m.$private(),t.def(m,"$roll",f=function(t,n,i,a){var s,o,h=c,d=c,l=c,f=c,p=c,y=c;for(h=[],d=0;u(u(l=t["$empty?"]()["$!"]())?r(d,$(v,"REROLL_LIMIT")):l);)f=t.$shift(),d="number"==typeof(o=d)?o+1:o["$+"](1),p=f.$roll(n),u(a)&&p["$sort!"](),h.$push(p),y=_(p,"count",[],((s=function(t){return null==t&&(t=c),i["$reroll?"](t)}).$$s=this,s.$$arity=1,s)),u(e(y,0))&&t.$push($(v,"Dice").$new(y,f.$sides()));return h},f.$$arity=4),t.def(m,"$expr",p=function(t,r,e,n){var i,a,s,o;return a=_(this.notations,"map",[],(i=function(r){return null==r&&(r=c),r.$to_dice(t)},i.$$s=this,i.$$arity=1,i)).$join("+"),s=r.$cmp_op()["$=="](e)?"":$(v,"Format").$comparison_operator(r.$cmp_op()),o=$(v,"Format").$comparison_operator(e),"("+a+"["+s+r.$threshold()+"]"+o+n+")"},p.$$arity=4),t.def(m,"$result_with_text",y=function(r){var e;return _($(v,"Result").$new(),"tap",[],((e=function(i){var $=null==e.$$s?this:e.$$s,a=c;return null==$.secret&&($.secret=c),null==i&&(i=c),_(i,"secret=",t.to_a(a=[$.secret])),n(a.length,1),_(i,"text=",t.to_a(a=[r])),a[n(a.length,1)]}).$$s=this,e.$$arity=1,e))},y.$$arity=1)}(d[0],0,d),function(n,i,$){var a,o,_,h=s(n,null,"RerollCondition");[h].concat($),h.$$prototype.threshold=h.$$prototype.cmp_op=c,h.$attr_reader("cmp_op"),h.$attr_reader("threshold"),t.def(h,"$initialize",a=function(t,r){return this.cmp_op=t,this.threshold=r},a.$$arity=2),t.def(h,"$valid?",o=function(n){var i,$,a=c;return!!u(this.threshold)&&("<="["$==="](a=this.cmp_op)?r(this.threshold,n):"<"["$==="](a)?($=n,"number"==typeof(i=this.threshold)&&"number"==typeof $?i<=$:i["$<="]($)):">="["$==="](a)?e(this.threshold,1):">"["$==="](a)?function(t,r){return"number"==typeof t?t>=1:t["$>="](1)}(this.threshold):!"!="["$==="](a)||t.Range.$new(1,n,!1)["$include?"](this.threshold))},o.$$arity=1),t.def(h,"$reroll?",_=function(t){return t.$send(this.cmp_op,this.threshold)},_.$$arity=1)}(d[0],0,d),function(r,e,n){var i,a,o=s(r,null,"Notation"),u=[o].concat(n);o.$$prototype.times=o.$$prototype.sides=c,t.def(o,"$initialize",i=function(t,r){return this.times=t,this.sides=r},i.$$arity=2),t.def(o,"$to_dice",a=function(t){var r,e;return r=this.times.$eval(t),e=this.sides.$eval(t),$(u,"Dice").$new(r,e)},a.$$arity=1)}(d[0],0,d),function(r,e,n){var i,c,$,a=s(r,null,"Dice");[a].concat(n),a.$attr_reader("times","sides"),t.def(a,"$initialize",i=function(t,r){return this.times=t,this.sides=r},i.$$arity=2),t.def(a,"$roll",c=function(t){return t.$roll_barabara(this.$times(),this.$sides())},c.$$arity=1),t.def(a,"$to_s",$=function(){return this.$times()+"R"+this.$sides()},$.$$arity=0)}(d[0],0,d)}(d[0],d)}(d[0],d)}(d[0],d)}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(t){function r(t,r){return"number"==typeof t&&"number"==typeof r?t/r:t["$/"](r)}var e=[],n=t.nil,i=t.$$$,c=t.$$,$=t.module,a=t.klass,s=t.send2;return function(e,o){var u=[$(e,"BCDice")].concat(o);!function(e,o){var u=[$(e,"Arithmetic")].concat(o);!function(e,o){var u=[$(e,"Node")].concat(o);!function(r,e,i){var c,$,s,o,u,_=a(r,null,"BinaryOp");[_].concat(i),_.$$prototype.lhs=_.$$prototype.rhs=_.$$prototype.op=n,t.def(_,"$initialize",c=function(t,r,e){return this.lhs=t,this.op=r,this.rhs=e},c.$$arity=3),t.def(_,"$eval",$=function(t){var r,e=n;return e=this.lhs.$eval(t),r=this.rhs.$eval(t),e.$send(this.op,r)},$.$$arity=1),t.def(_,"$output",s=function(){return""+this.lhs.$output()+this.op+this.rhs.$output()},s.$$arity=0),t.def(_,"$s_exp",o=function(){return"("+this.$op_for_s_exp()+" "+this.lhs.$s_exp()+" "+this.rhs.$s_exp()+")"},o.$$arity=0),t.def(_,"$op_for_s_exp",u=function(){return this.op},u.$$arity=0)}(u[0],0,u),function(r,e,$){var o,u,_,h,d,l,f=a(r,e,"DivideBase"),p=[f].concat($);f.$$prototype.lhs=f.$$prototype.rhs=f.$$prototype.op=n,t.def(f,"$initialize",o=function(r,e){return o.$$p&&(o.$$p=null),s(this,t.find_super_dispatcher(this,"initialize",o,!1,!0),"initialize",[r,"/",e],null)},o.$$arity=2),t.def(f,"$eval",u=function(t){var r,e=n;return r=this.lhs.$eval(t),(e=this.rhs.$eval(t))["$=="](0)&&this.$raise(c(p,"ZeroDivisionError")),this.$divide_and_round(r,e,t)},u.$$arity=1),t.def(f,"$output",_=function(){var r=_.$$p,e=this,i=n,c=n,$=n;for(r&&(_.$$p=null),c=0,$=arguments.length,i=new Array($);c<$;c++)i[c]=arguments[c];return""+s(e,t.find_super_dispatcher(e,"output",_,!1,!0),"output",i,r)+e.$rounding_method()},_.$$arity=0),f.$private(),t.def(f,"$rounding_method",h=function(){return i(this.$class(),"ROUNDING_METHOD")},h.$$arity=0),t.def(f,"$op_for_s_exp",d=function(){return""+this.op+this.$rounding_method()},d.$$arity=0),t.def(f,"$divide_and_round",l=function(t,r,e){return this.$raise(c(p,"NotImplementedError"))},l.$$arity=3)}(u[0],c(u,"BinaryOp"),u),function(e,n,$){var s,o=a(e,n,"DivideWithGameSystemDefault"),u=[o].concat($);t.const_set(u[0],"ROUNDING_METHOD",""),o.$private(),t.def(o,"$divide_and_round",s=function(t,e,n){var $;return $=n,i(c(u,"RoundType"),"CEIL")["$==="]($)?r(t.$to_f(),e).$ceil():i(c(u,"RoundType"),"ROUND")["$==="]($)?r(t.$to_f(),e).$round():r(t,e).$to_i()},s.$$arity=3)}(u[0],c(u,"DivideBase"),u),function(e,n,i){var c,$=a(e,n,"DivideWithCeil"),s=[$].concat(i);t.const_set(s[0],"ROUNDING_METHOD","C"),$.$private(),t.def($,"$divide_and_round",c=function(t,e,n){return r(t.$to_f(),e).$ceil()},c.$$arity=3)}(u[0],c(u,"DivideBase"),u),function(e,n,i){var c,$=a(e,n,"DivideWithRound"),s=[$].concat(i);t.const_set(s[0],"ROUNDING_METHOD","R"),$.$private(),t.def($,"$divide_and_round",c=function(t,e,n){return r(t.$to_f(),e).$round()},c.$$arity=3)}(u[0],c(u,"DivideBase"),u),function(e,n,i){var c,$=a(e,n,"DivideWithFloor"),s=[$].concat(i);t.const_set(s[0],"ROUNDING_METHOD","F"),$.$private(),t.def($,"$divide_and_round",c=function(t,e,n){return r(t,e).$to_i()},c.$$arity=3)}(u[0],c(u,"DivideBase"),u),function(r,e,i){var c,$,s,o,u=a(r,null,"Negative");[u].concat(i),u.$$prototype.body=n,t.def(u,"$initialize",c=function(t){return this.body=t},c.$$arity=1),t.def(u,"$eval",$=function(t){return this.body.$eval(t)["$-@"]()},$.$$arity=1),t.def(u,"$output",s=function(){return"-"+this.body.$output()},s.$$arity=0),t.def(u,"$s_exp",o=function(){return"(- "+this.body.$s_exp()+")"},o.$$arity=0)}(u[0],0,u),function(r,e,i){var c,$,s,o,u=a(r,null,"Parenthesis");[u].concat(i),u.$$prototype.expr=n,t.def(u,"$initialize",c=function(t){return this.expr=t},c.$$arity=1),t.def(u,"$eval",$=function(t){return this.expr.$eval(t)},$.$$arity=1),t.def(u,"$output",s=function(){return"("+this.expr.$output()+")"},s.$$arity=0),t.def(u,"$s_exp",o=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},o.$$arity=0)}(u[0],0,u),function(r,e,i){var c,$,s,o=a(r,null,"Number");[o].concat(i),o.$$prototype.value=n,t.def(o,"$initialize",c=function(t){return this.value=t},c.$$arity=1),t.def(o,"$eval",$=function(t){return this.value},$.$$arity=1),t.def(o,"$output",s=function(){return this.value.$to_s()},s.$$arity=0),t.alias(o,"s_exp","output")}(u[0],0,u)}(u[0],u)}(u[0],u)}(e[0],e)},Opal.modules["bcdice/common_command/barabara_dice/parser"]=function(t){var r=t.top,e=[],n=t.nil,i=t.$$$,c=t.$$,$=t.module,a=t.klass,s=t.hash,o=t.hash2,u=t.truthy;return r.$require("racc/parser.rb"),r.$require("bcdice/common_command/lexer"),r.$require("bcdice/common_command/reroll_dice/node"),r.$require("bcdice/arithmetic/node"),function(r,e){var _=[$(r,"BCDice")].concat(e);!function(r,e){var _=[$(r,"CommonCommand")].concat(e);!function(r,e){var _=[$(r,"BarabaraDice")].concat(e);!function(r,e,$){var _,h,d,l,f,p,y,m,v,g,b,R,E,x,k,D,A,w,N,T,L,C,S,B,O,z,I,U,P,V,M,F,H,K,Y,G=a(r,e,"Parser"),j=[G].concat($);G.$$prototype.lexer=n,t.defs(G,"$parse",_=function(t){return this.$new().$parse(t)},_.$$arity=1),t.def(G,"$parse",h=function(r){try{return this.lexer=c(j,"Lexer").$new(r),this.$do_parse()}catch(e){if(!t.rescue(e,[c(j,"ParseError")]))throw e;try{return n}finally{t.pop_exception()}}},h.$$arity=1),G.$private(),t.def(G,"$next_token",d=function(){return this.lexer.$next_token()},d.$$arity=0),z=[13,9,3,9,24,25,9,9,9,26,18,19,8,12,8,18,19,8,8,8,9,4,9,38,36,37,39,18,19,18,19,8,9,8,9,27,28,24,25,18,19,18,19,8,9,8,9,27,28,27,28,18,19,18,19,8,10,8,14],I=[5,2,0,8,15,15,13,14,12,15,8,8,2,5,8,12,12,13,14,12,18,1,19,34,34,34,34,18,18,19,19,18,24,19,25,16,16,21,21,24,24,25,25,24,27,25,28,31,31,32,32,27,27,28,28,27,4,28,7],U=[-6,21,-1,n,56,-9,n,55,1,n,n,n,6,4,5,-5,24,n,18,20,n,28,n,n,30,32,n,42,44,n,n,36,38,n,19,n,n,n,n,n],P=[-2,-25,-25,-3,-25,-4,-7,-25,-25,-24,40,-1,-25,-25,-25,-25,-11,-14,-25,-25,-22,-5,-6,-8,-25,-25,-23,-25,-25,-20,-21,-9,-10,-12,-15,-13,-16,-17,-18,-19],V=[7,1,6,15,2,29,30,21,31,32,5,7,23,22,33,34,11,35],M=[7,1,6,5,2,9,9,5,8,8,3,7,7,6,9,9,4,10],F=[n,1,4,8,11,-5,0,-2,-16,-13,-17],H=[n,n,n,n,n,n,n,20,16,17,n],K=[0,0,"racc_error",3,24,"_reduce_1",0,25,"_reduce_2",1,25,"_reduce_3",0,27,"_reduce_4",2,27,"_reduce_5",3,26,"_reduce_6",1,26,"_reduce_7",3,29,"_reduce_8",3,28,"_reduce_9",3,28,"_reduce_10",1,28,"_reduce_none",3,31,"_reduce_12",4,31,"_reduce_13",1,31,"_reduce_none",0,33,"_reduce_15",1,33,"_reduce_16",1,33,"_reduce_17",1,33,"_reduce_18",1,33,"_reduce_19",2,32,"_reduce_20",2,32,"_reduce_21",1,32,"_reduce_none",3,30,"_reduce_23",1,30,"_reduce_24"],Y=s(!1,0,"error",1,"NUMBER",2,"B",3,"R",4,"U",5,"C",6,"F",7,"S",8,"PLUS",9,"MINUS",10,"ASTERISK",11,"SLASH",12,"PARENL",13,"PARENR",14,"BRACKETL",15,"BRACKETR",16,"LESS",17,"GREATER",18,"EQUAL",19,"NOT",20,"AT",21,"CMP_OP",22),t.const_set(j[0],"Racc_arg",[z,I,P,U,V,M,H,F,23,K,Y,40,25,!0]),t.const_set(j[0],"Racc_token_to_s_table",["$end","error","NUMBER","B","R","U","C","F","S","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","LESS","GREATER","EQUAL","NOT","AT","CMP_OP","$start","expr","secret","notations","target","add","dice","term","mul","unary","round_type"]),t.const_set(j[0],"Racc_debug_parser",!1),t.def(G,"$_reduce_1",l=function(t,r,e){return i(c(j,"Node"),"Command").$new(o(["secret","notations","cmp_op","target_number"],{secret:t["$[]"](0),notations:t["$[]"](1),cmp_op:t["$[]"](2)["$[]"]("cmp_op"),target_number:t["$[]"](2)["$[]"]("target")}))},l.$$arity=3),t.def(G,"$_reduce_2",f=function(t,r,e){return!1},f.$$arity=3),t.def(G,"$_reduce_3",p=function(t,r,e){return!0},p.$$arity=3),t.def(G,"$_reduce_4",y=function(t,r,e){return o([],{})},y.$$arity=3),t.def(G,"$_reduce_5",m=function(r,e,i){var $,a,s;return s=null==($=t.to_ary(r))[1]?n:$[1],u(a=null==$[0]?n:$[0])||this.$raise(c(j,"ParseError")),o(["cmp_op","target"],{cmp_op:a,target:s})},m.$$arity=3),t.def(G,"$_reduce_6",v=function(t,r,e){var i=n;return(i=t["$[]"](0)).$push(t["$[]"](2)),i},v.$$arity=3),t.def(G,"$_reduce_7",g=function(t,r,e){return[t["$[]"](0)]},g.$$arity=3),t.def(G,"$_reduce_8",b=function(t,r,e){var n,$;return n=t["$[]"](0),$=t["$[]"](2),i(c(j,"Node"),"Notation").$new(n,$)},b.$$arity=3),t.def(G,"$_reduce_9",R=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"+",t["$[]"](2))},R.$$arity=3),t.def(G,"$_reduce_10",E=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"-",t["$[]"](2))},E.$$arity=3),t.def(G,"$_reduce_12",x=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"*",t["$[]"](2))},x.$$arity=3),t.def(G,"$_reduce_13",k=function(t,r,e){return t["$[]"](3).$new(t["$[]"](0),t["$[]"](2))},k.$$arity=3),t.def(G,"$_reduce_15",D=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},D.$$arity=3),t.def(G,"$_reduce_16",A=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"DivideWithCeil")},A.$$arity=3),t.def(G,"$_reduce_17",w=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"DivideWithCeil")},w.$$arity=3),t.def(G,"$_reduce_18",N=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"DivideWithRound")},N.$$arity=3),t.def(G,"$_reduce_19",T=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"DivideWithFloor")},T.$$arity=3),t.def(G,"$_reduce_20",L=function(t,r,e){return t["$[]"](1)},L.$$arity=3),t.def(G,"$_reduce_21",C=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"Negative").$new(t["$[]"](1))},C.$$arity=3),t.def(G,"$_reduce_23",S=function(t,r,e){return t["$[]"](1)},S.$$arity=3),t.def(G,"$_reduce_24",B=function(t,r,e){return i(i(c(j,"Arithmetic"),"Node"),"Number").$new(t["$[]"](0))},B.$$arity=3),t.def(G,"$_reduce_none",O=function(t,r,e){return t["$[]"](0)},O.$$arity=3)}(_[0],i(c(_,"Racc"),"Parser"),_)}(_[0],_)}(_[0],_)}(e[0],e)},Opal.modules["bcdice/common_command/barabara_dice"]=function(t){var r=[],e=t.nil,n=t.$$,i=t.module,c=t.send;return t.top.$require("bcdice/common_command/barabara_dice/parser"),function(r,$){var a=[i(r,"BCDice")].concat($);!function(r,$){var a=[i(r,"CommonCommand")].concat($);!function(r,$){var a=i(r,"BarabaraDice"),s=[a].concat($);t.const_set(s[0],"PREFIX_PATTERN",/\d+B\d+/.$freeze()),function(r,i){var $,a=[r].concat(i);t.def(r,"$eval",$=function(t,r,i){var $;return($=n(a,"Parser").$parse(t))===e||null==$?e:c($,"eval",[r,i])},$.$$arity=3)}(t.get_singleton_class(a),s)}(a[0],a)}(a[0],a)}(r[0],r)},Opal.modules["bcdice/dice_table/table"]=function(t){var r=[],e=t.nil,n=t.$$,i=t.module,c=t.klass,$=t.hash2,a=t.truthy;return function(r,s){var o=[i(r,"BCDice")].concat(s);!function(r,s){var o=[i(r,"DiceTable")].concat(s);!function(r,i,s){var o,u,_,h,d=c(r,null,"Table"),l=[d].concat(s);d.$$prototype.times=d.$$prototype.sides=d.$$prototype.name=d.$$prototype.items=e,t.defs(d,"$from_i18n",o=function(t,r){var i=e;return i=n(l,"I18n").$t(t,$(["locale"],{locale:r})),this.$new(i["$[]"]("name"),i["$[]"]("type"),i["$[]"]("items"))},o.$$arity=2),t.def(d,"$initialize",u=function(t,r,i){var c=e;return this.name=t,this.items=i.$freeze(),c=/(\d+)D(\d+)/i.$match(r),a(c)||this.$raise(n(l,"ArgumentError"),"Unexpected table type: "+r),this.times=c["$[]"](1).$to_i(),this.sides=c["$[]"](2).$to_i()},u.$$arity=3),t.def(d,"$roll",_=function(t){var r;return r=t.$roll_sum(this.times,this.sides),this.$choice(r)},_.$$arity=1),t.def(d,"$choice",h=function(t){var r,e,i;return e=this.times,i="number"==typeof(r=t)&&"number"==typeof e?r-e:r["$-"](e),n(l,"RollResult").$new(this.name,t,this.items["$[]"](i))},h.$$arity=1)}(o[0],0,o)}(o[0],o)}(r[0],r)},function(t){function r(t,r){return"number"==typeof t&&"number"==typeof r?t>=r:t["$>="](r)}var e=t.top,n=[],i=t.nil,c=t.$$$,$=t.$$,a=t.module,s=t.klass,o=t.send2,u=t.hash2,_=t.truthy,h=t.send;e.$require("bcdice/common_command/barabara_dice"),e.$require("bcdice/dice_table/table"),function(e,n){var d=[a(e,"BCDice")].concat(n);!function(e,n){var d=[a(e,"GameSystem")].concat(n);!function(e,n,a){var d,l,f,p,y,m,v,g,b,R,E,x,k=s(e,n,"NinjaSlayer"),D=[k].concat(a);k.$$prototype.randomizer=i,t.const_set(D[0],"ID","NinjaSlayer"),t.const_set(D[0],"NAME","\u30cb\u30f3\u30b8\u30e3\u30b9\u30ec\u30a4\u30e4\u30fcTRPG"),t.const_set(D[0],"SORT_KEY","\u306b\u3093\u3057\u3084\u3059\u308c\u3044\u3084\u3042RPG"),t.const_set(D[0],"HELP_MESSAGE","\u30fb\u901a\u5e38\u5224\u5b9a\u3000NJ\n\u3000NJx[y] or NJx@y or NJx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 \u7701\u7565\u6642\u306fNORMAL(4)\n\u3000\u4f8b:NJ4@H \u96e3\u6613\u5ea6HARD\u3001\u5224\u5b9a\u30c0\u30a4\u30b94\u3067\u5224\u5b9a\n\u30fb\u56de\u907f\u5224\u5b9a\u3000EV\n\u3000EVx[y]/z or EVx@y/z or EVx/z or EVx[y] or EVx@y or EVx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 z=\u653b\u6483\u5074\u306e\u6210\u529f\u6570(\u7701\u7565\u53ef) \u96e3\u6613\u5ea6\u3092\u7701\u7565\u6642\u306fNORMAL(4)\n\u3000\u653b\u6483\u5074\u306e\u6210\u529f\u6570\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u3001\u30ab\u30a6\u30f3\u30bf\u30fc\u30ab\u30e9\u30c6\u767a\u751f\u6642\u306b\u306f\u8868\u793a\n\u3000\u4f8b:EV5/3 \u96e3\u6613\u5ea6NORMAL(\u7701\u7565\u6642)\u3001\u5224\u5b9a\u30c0\u30a4\u30b95\u3001\u653b\u6483\u5074\u306e\u6210\u529f\u65703\u3067\u5224\u5b9a\n\u30fb\u8fd1\u63a5\u653b\u6483\u3000AT\n\u3000ATx[y] or ATx@y or ATx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 \u7701\u7565\u6642\u306fNORMAL(4) \u30b5\u30c4\u30d0\u30c4\uff01\u767a\u751f\u6642\u306b\u306f\u8868\u793a\n\u3000\u4f8b:AT6[H] \u96e3\u6613\u5ea6HARD,\u5224\u5b9a\u30c0\u30a4\u30b95\u3067\u8fd1\u63a5\u653b\u6483\u306e\u5224\u5b9a\n\u30fb\u30b5\u30c4\u30d0\u30c4\u5224\u5b9a\u3000SB\n\u30fb\u96fb\u5b50\u6226\u3000EL\n\u3000ELx[y] or ELx@y or ELx\n\u3000x=\u5224\u5b9a\u30c0\u30a4\u30b9 y=\u96e3\u6613\u5ea6 \u7701\u7565\u6642\u306fNORMAL(4)\n\u3000\u4f8b:EL6[H] \u96e3\u6613\u5ea6HARD,\u5224\u5b9a\u30c0\u30a4\u30b95\u3067\u96fb\u5b50\u6226\u306e\u5224\u5b9a\n\n\u30fb\u96e3\u6613\u5ea6\n\u3000KIDS=K,EASY=E,NORMAL=N,HARD=H,ULTRA HARD=UH \u6570\u5b57\u306b\u3082\u5bfe\u5fdc\n"),t.def(k,"$initialize",d=function(r){return d.$$p&&(d.$$p=null),o(this,t.find_super_dispatcher(this,"initialize",d,!1,!0),"initialize",[r],null),this.default_cmp_op=">=",this.default_target_number=4},d.$$arity=1),t.const_set(D[0],"DIFFICULTY_VALUE_RE","UH|[2-6KENH]".$freeze()),t.const_set(D[0],"DIFFICULTY_RE",("(\\[("+$(D,"DIFFICULTY_VALUE_RE")+")\\]|@("+$(D,"DIFFICULTY_VALUE_RE")+"))").$freeze()),t.const_set(D[0],"NJ_RE",t.regexp(["^(S)?NJ(\\d+)",$(D,"DIFFICULTY_RE"),"?$"],"i").$freeze()),t.const_set(D[0],"EV_RE",t.regexp(["^EV(\\d+)",$(D,"DIFFICULTY_RE"),"?(?:/(\\d+))?$"],"i").$freeze()),t.const_set(D[0],"AT_RE",t.regexp(["^AT(\\d+)",$(D,"DIFFICULTY_RE"),"?$"],"i").$freeze()),t.const_set(D[0],"EL_RE",t.regexp(["^EL(\\d+)",$(D,"DIFFICULTY_RE"),"?$"],"i").$freeze()),t.const_set(D[0],"EV",$(D,"Struct").$new("num","difficulty","targetValue")),t.const_set(D[0],"AT",$(D,"Struct").$new("num","difficulty")),t.const_set(D[0],"EL",$(D,"Struct").$new("num","difficulty")),t.const_set(D[0],"DIFFICULTY_SYMBOL_TO_INTEGER",u(["K","E","N","H","UH"],{K:2,E:3,N:4,H:5,UH:6}).$freeze()),t.def(k,"$change_text",l=function(t){var r,e=i,n=i;return e=$(D,"NJ_RE").$match(t),_(e)?(r=this.$bRollCommand(e["$[]"](2),this.$integerValueOfDifficulty(_(n=e["$[]"](4))?n:e["$[]"](5))),""+e["$[]"](1)+r):t},l.$$arity=1),t.def(k,"$eval_game_system_specific_command",f=function(t){var r=i,e=i,n=i;return this.$debug("eval_game_system_specific_command begin string",t),_(r=$(D,"TABLES")["$[]"](t))?r.$roll(this.$randomizer()):(e=n=this.$parse(t),$(D,"EV")["$==="](e)?this.$executeEV(n):$(D,"AT")["$==="](e)?this.$executeAT(n):$(D,"EL")["$==="](e)?this.$executeEL(n):i)},f.$$arity=1),k.$private(),t.def(k,"$parse",p=function(t){var r;return r=t,$(D,"EV_RE")["$==="](r)?this.$parseEV($(D,"Regexp").$last_match()):$(D,"AT_RE")["$==="](r)?this.$parseAT($(D,"Regexp").$last_match()):$(D,"EL_RE")["$==="](r)?this.$parseEL($(D,"Regexp").$last_match()):i},p.$$arity=1),t.def(k,"$parseEV",y=function(t){var r,e,n,c,a;return e=t["$[]"](1).$to_i(),n=this.$integerValueOfDifficulty(_(c=t["$[]"](3))?c:t["$[]"](4)),a=(r=t["$[]"](5))===i||null==r?i:h(r,"to_i",[]),$(D,"EV").$new(e,n,a)},y.$$arity=1),t.def(k,"$parseAT",m=function(t){var r,e,n;return r=t["$[]"](1).$to_i(),e=this.$integerValueOfDifficulty(_(n=t["$[]"](3))?n:t["$[]"](4)),$(D,"AT").$new(r,e)},m.$$arity=1),t.def(k,"$parseEL",v=function(t){var r,e,n;return r=t["$[]"](1).$to_i(),e=this.$integerValueOfDifficulty(_(n=t["$[]"](3))?n:t["$[]"](4)),$(D,"EL").$new(r,e)},v.$$arity=1),t.def(k,"$executeEV",g=function(t){var r,e,n,a,s=i,o=i;return r=this.$bRollCommand(t.$num(),t.$difficulty()),o=[(s=c(c($(D,"BCDice"),"CommonCommand"),"BarabaraDice").$eval(r,this,this.randomizer)).$text()],_(_(a=t.$targetValue())?(e=s.$success_num(),n=t.$targetValue(),"number"==typeof e&&"number"==typeof n?e>n:e["$>"](n)):a)&&o.$push("\u30ab\u30a6\u30f3\u30bf\u30fc\u30ab\u30e9\u30c6!!"),o.$join(" \uff1e ")},g.$$arity=1),t.def(k,"$executeAT",b=function(t){var e,n,a=i,s=i;return e=this.$bRollCommand(t.$num(),t.$difficulty()),n=(a=c(c($(D,"BCDice"),"CommonCommand"),"BarabaraDice").$eval(e,this,this.randomizer)).$last_dice_list().$count(6),s=[a.$text()],_(r(n,2))&&s.$push("\u30b5\u30c4\u30d0\u30c4!!"),s.$join(" \uff1e ")},b.$$arity=1),t.def(k,"$executeEL",R=function(t){var e,n,a,s,o,u,d=i,l=i;return n=this.$bRollCommand(t.$num(),t.$difficulty()),a=(l=(d=c(c($(D,"BCDice"),"CommonCommand"),"BarabaraDice").$eval(n,this,this.randomizer)).$last_dice_list()).$count(6),s=h(l,"count",[],((e=function(e){return null==e&&(e=i),r(e,t.$difficulty())}).$$s=this,e.$$arity=1,e)),_(r(a,1))?[d.$text()+" + "+a,(o=s,u=a,"number"==typeof o&&"number"==typeof u?o+u:o["$+"](u))].$join(" \uff1e "):d.$text()},R.$$arity=1),t.def(k,"$integerValueOfDifficulty",E=function(t){return _(t)?_(/^[2-6]$/.$match(t))?t.$to_i():$(D,"DIFFICULTY_SYMBOL_TO_INTEGER").$fetch(t.$upcase()):4},E.$$arity=1),t.def(k,"$bRollCommand",x=function(t,r){return t+"B6>="+r},x.$$arity=2),t.const_set(D[0],"SATSUBATSU_TABLE",["\u300c\u6b7b\u306d\u30fc\u30c3\uff01\u300d\u8179\u90e8\u306b\u5f37\u70c8\u306a\u4e00\u6483\uff01\u3000\u6575\u306f\u304f\u306e\u5b57\u306b\u6298\u308c\u66f2\u304c\u308a\u3001\u30ef\u30a4\u30e4\u30fc\u30a2\u30af\u30b7\u30e7\u30f3\u3081\u3044\u3066\u5439\u3063\u98db\u3093\u3060\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8+1\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u6575\u306f\u5f8c\u65b9\u306e\u58c1\u307e\u305f\u306f\u969c\u5bb3\u7269\u306b\u5411\u304b\u3063\u3066\u3001\u4f55\u30de\u30b9\u3067\u3082\u307e\u3063\u3059\u3050\u5f3e\u304d\u98db\u3070\u3055\u308c\u308b\uff08\u4ed6\u306e\u30ad\u30e3\u30e9\u306e\u3044\u308b\u30de\u30b9\u306f\u901a\u904e\u3059\u308b\uff09\u3002\u58c1\u307e\u305f\u306f\u969c\u5bb3\u7269\u306b\u63a5\u89e6\u3057\u305f\u6642\u70b9\u3067\u3001\u6575\u306f\u3055\u3089\u306b1\u30c0\u30e1\u30fc\u30b8\u3092\u53d7\u3051\u308b\u3002\u6575\u306f\u3053\u306e\u6fc0\u7a81\u30c0\u30e1\u30fc\u30b8\u306b\u5bfe\u3057\u3066\u6539\u3081\u3066\u300e\u56de\u907f\u5224\u5b9a\u300f\u3092\u884c\u3063\u3066\u3082\u826f\u3044\u3002","\u300c\u30a4\u30e4\u30fc\u30c3\uff01\u300d\u982d\u90e8\u3078\u306e\u75db\u70c8\u306a\u30ab\u30e9\u30c6\uff01\u3000\u773c\u7403\u7834\u58ca\u3082\u3057\u304f\u306f\u6fc0\u3057\u3044\u8133\u9707\u76ea\u304c\u6575\u3092\u8972\u3046\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u3055\u3089\u306b\u6575\u306e\u3010\u30cb\u30e5\u30fc\u30ed\u30f3\u3011\u3068\u3010\u30ef\u30b6\u30de\u30a8\u3011\u304c\u305d\u308c\u305e\u308c1\u305a\u3064\u6e1b\u5c11\u3059\u308b\uff08\u3053\u308c\u306b\u3088\u308b\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u82e6\u3057\u307f\u629c\u3044\u3066\u6b7b\u306c\u304c\u3044\u3044\u300d\u6025\u6240\u3092\u60c5\u3051\u5bb9\u8d66\u306a\u304f\u7834\u58ca\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8+1\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u8010\u3048\u96e3\u3044\u82e6\u75db\u306b\u3088\u308a\u3001\u6575\u306f\u3010\u7cbe\u795e\u529b\u3011\u304c-2\u3055\u308c\u3001\u3010\u30cb\u30e5\u30fc\u30ed\u30f3\u3011\u304c1\u6e1b\u5c11\u3059\u308b\uff08\u3053\u308c\u306b\u3088\u308b\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u9003\u3052\u3089\u308c\u308b\u3082\u306e\u306a\u3089\u9003\u3052\u3066\u307f\u3088\u300d\u6575\u306e\u811a\u3092\u7c89\u7815\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u3055\u3089\u306b\u6575\u306e\u3010\u811a\u529b\u3011\u304cD3\u6e1b\u5c11\u3059\u308b\uff08\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u3053\u308c\u3067\u624b\u3082\u8db3\u3082\u51fa\u307e\u3044\uff01\u300d\u6575\u306e\u4e21\u8155\u3092\u5207\u308a\u98db\u3070\u3057\u305f\uff01\u3000\u9bae\u8840\u304c\u30b9\u30d7\u30ea\u30f3\u30af\u30e9\u30fc\u3081\u3044\u3066\u5674\u304d\u51fa\u3059\uff01\uff1a\u672c\u6765\u306e\u30c0\u30e1\u30fc\u30b8+1\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u308b\u3002\u3055\u3089\u306b\u6575\u306e\u3010\u30ef\u30b6\u30de\u30a8\u3011\u3068\u3010\u30ab\u30e9\u30c6\u3011\u304c\u305d\u308c\u305e\u308c2\u6e1b\u5c11\u3059\u308b\uff08\u6700\u4f4e\u5024\u306f1\uff09\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD3\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD3\u4e0a\u6607\u3059\u308b\u3002","\u300c\u30a4\u30a4\u30a4\u30e4\u30a2\u30a2\u30a2\u30a2\u30fc\u30fc\u30fc\u30fc\u30c3\uff01\u300d\u30e4\u30ea\u3081\u3044\u305f\u30c1\u30e7\u30c3\u30d7\u304c\u6575\u306e\u80f8\u3092\u8cab\u901a\uff01\u3000\u3055\u3089\u306b\u5fc3\u81d3\u3092\u63b4\u307f\u53d6\u308a\u3001\u63e1\u308a\u3064\u3076\u3057\u305f\uff01\u3000\u30ca\u30e0\u30a2\u30df\u30c0\u30d6\u30c4\uff01\uff1a\u6575\u306f\u6b8b\u308a\u3010\u4f53\u529b\u3011\u306b\u95a2\u4fc2\u306a\u304f\u5373\u6b7b\u3059\u308b\u3002\u6b8b\u8650\u30dc\u30fc\u30ca\u30b9\u306b\u3088\u308a\u3010\u4e07\u672d\u3011\u304cD6\u767a\u751f\u3002\u3053\u306e\u653b\u6483\u3092\u3010\u30ab\u30eb\u30de\uff1a\u5584\u3011\u306e\u30ad\u30e3\u30e9\u306b\u5bfe\u3057\u3066\u884c\u3063\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u3010DKK\u3011\u304cD6\u4e0a\u6607\u3059\u308b\u3002"].$freeze()),t.const_set(D[0],"TABLES",u(["SB"],{SB:c($(D,"DiceTable"),"Table").$new("\u30b5\u30c4\u30d0\u30c4\u8868","1D6",$(D,"SATSUBATSU_TABLE"))}).$freeze()),k.$register_prefix("NJ","EV","AT","EL",$(D,"TABLES").$keys())}(d[0],$(d,"Base"),d)}(d[0],d)}(n[0],n)}(Opal)}}]);