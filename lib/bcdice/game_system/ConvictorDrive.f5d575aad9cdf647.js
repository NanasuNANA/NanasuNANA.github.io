(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[8138],{5939:(ge,pe,he)=>{he(3986),Opal.modules["i18n/backend/fallbacks"]=function(e){var j,i,r,a,s,d,U=e.module,B=e.class_variable_set,c=e.truthy,A=e.class_variable_get,R=e.def,C=e.send,M=e.send2,q=e.find_super,S=e.hash2,N=e.find_block_super,x=e.neqeq,H=e.thrower,G=e.return_val,L=[],T=e.nil,k=e.$$$;return j=L,d=[s=U(L[0],"I18n")].concat(j),B(d[0],"@@fallbacks",T),i=e.get_singleton_class(s),r=[i].concat(d),a=e.$r(r),R(i,"$fallbacks",function(){var E=T;return B(r[1],"@@fallbacks",c(null!=r[1].$$cvars["@@fallbacks"]?"class variable":T)&&c(E=A(r[1],"@@fallbacks",!1))?E:k(k(a("I18n"),"Locale"),"Fallbacks").$new()),c(E=a("Thread").$current()["$[]"]("i18n_fallbacks"))?E:A(r[1],"@@fallbacks",!1)}),R(i,"$fallbacks=",function(P){var E;return B(r[1],"@@fallbacks",c(P["$is_a?"](a("Array")))?k(k(a("I18n"),"Locale"),"Fallbacks").$new(P):P),E=["i18n_fallbacks",A(r[1],"@@fallbacks",!1)],C(a("Thread").$current(),"[]=",E),E[E.length-1]}),function(i,w){var P,E,y,l,a=[U(i,"Backend")].concat(w);return P=a,y=[E=U(a[0],"Fallbacks")].concat(P),l=e.$r(y),R(E,"$translate",function g(f,p,u){try{var b=H("return"),_=g.$$p||T,I=this,F=T,v=T;return g.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?c(u["$[]"]("fallback_in_progress"))?M(I,q(I,"translate",g,!1,!0),"translate",[f,p,u],_):(c(u["$[]"]("default"))&&(F=I["$extract_non_symbol_default!"](u)),v=u.$merge(S(["fallback_in_progress"],{fallback_in_progress:!0})),C(l("I18n").$fallbacks()["$[]"](f),"each",[],function t(D){var n=null==t.$$s?this:t.$$s;null==D&&(D=T);try{return C(n,"catch",["exception"],function o(){var $=null==o.$$s?this:o.$$s,W=T;if(W=M($,N($,"translate",o.$$def||t.$$def||g,!1,!1),"translate",[D,p,v],null),c(W["$nil?"]()))return T;x(f.$to_s(),D.$to_s())&&$.$on_fallback(f,D,p,u),b.$throw(W)},{$$s:n,$$ret:b})}catch(o){if(!e.rescue(o,[k(l("I18n"),"InvalidLocale")]))throw o;try{return T}finally{e.pop_exception()}}},{$$s:I}),c(u["$key?"]("default"))&&c(u["$[]"]("default")["$nil?"]())?T:c(F)?M(I,q(I,"translate",g,!1,!0),"translate",[f,T,u.$merge(S(["default"],{default:F}))],null):I.$throw("exception",k(l("I18n"),"MissingTranslation").$new(f,p,u))):M(I,q(I,"translate",g,!1,!0),"translate",[f,p,u],_)}catch(t){if(t===b)return t.$v;throw t}},-3),R(E,"$extract_non_symbol_default!",function(f){var u,p=T;return p=[f["$[]"]("default")].$flatten(),u=C(p,"detect",[],function(_){return null==_&&(_=T),_["$is_a?"](l("Symbol"))["$!"]()}),c(u)&&f["$[]="]("default",p["$[]"](0,p.$index(u))),u}),R(E,"$exists?",function g(f,p,u){try{var b=H("return"),_=g.$$p||T,I=this;return g.$$p=null,null==u&&(u=l("EMPTY_HASH")),c(u.$fetch("fallback",!0))?(C(l("I18n").$fallbacks()["$[]"](f),"each",[],function F(v){var t=null==F.$$s?this:F.$$s;null==v&&(v=T);try{if(!c(M(t,N(t,"exists?",F.$$def||g,!1,!1),"exists?",[v,p],null)))return T;b.$throw(!0)}catch(D){if(!e.rescue(D,[k(l("I18n"),"InvalidLocale")]))throw D;try{return T}finally{e.pop_exception()}}},{$$s:I,$$ret:b}),!1):M(I,q(I,"exists?",g,!1,!0),"exists?",[f,p,u],_)}catch(F){if(F===b)return F.$v;throw F}},-3),E.$private(),R(E,"$on_fallback",G(T))}(d[0],d)},Opal.modules["bcdice/randomizer"]=function(e){var s,m,P,E,y,l,i,w,B=e.klass,c=e.const_set,A=e.def,R=e.truthy,C=e.rb_gt,M=e.rb_plus,q=e.rb_le,S=e.send,N=e.rb_minus,x=e.eqeq,H=e.rb_times,G=e.eqeqeq,L=e.rb_ge,T=[],k=e.nil,K=e.$$$;return s=T,i=[(0,e.module)(T[0],"BCDice")].concat(s),w=e.$r(i),m=i,E=[P=B(i[0],null,"Randomizer")].concat(m),y=e.$r(E),(l=P.$$prototype).rand_results=l.detailed_rand_results=k,c(E[0],"UPPER_LIMIT_DICE_TIMES",200),c(E[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(E[0],"UPPER_LIMIT_RANDS",1e4),A(P,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),P.$attr_reader("rand_results"),P.$attr_reader("detailed_rand_results"),c(E[0],"DetailedRandResult",y("Struct").$new("kind","sides","value")),A(P,"$roll_barabara",function(f,p){var u=this;return R(C(M(u.rand_results.$size(),f),y("UPPER_LIMIT_RANDS")))&&u.$raise(y("TooManyRandsError")),R(q(f,0))||R(C(f,y("UPPER_LIMIT_DICE_TIMES")))?[]:S(y("Array"),"new",[f],function b(){return(null==b.$$s?this:b.$$s).$roll_once(p)},{$$s:u})}),A(P,"$roll_sum",function(f,p){return this.$roll_barabara(f,p).$sum()}),A(P,"$roll_once",function(f){var u=k;return R(q(f,0))||R(C(f,y("UPPER_LIMIT_DICE_SIDES")))?0:(u=this.$rand_inner(f),this.$push_to_detail("normal",f,u),u)}),A(P,"$roll_index",function(f){return N(this.$roll_once(f),1)}),A(P,"$roll_tens_d10",function(){var u,p=k;return p=this.$rand_inner(10),x(p,10)&&(p=0),u=H(p,10),this.$push_to_detail("tens_d10",10,u),u}),A(P,"$roll_d9",function(){var p;return p=N(this.$rand_inner(10),1),this.$push_to_detail("d9",10,p),p}),A(P,"$roll_d66",function(f){var b,u=k;return u=S(y("Array"),"new",[2],function _(){return(null==_.$$s?this:_.$$s).$roll_once(6)},{$$s:this}),G(K(y("D66SortType"),"ASC"),b=f)?u["$sort!"]():G(K(y("D66SortType"),"DESC"),b)&&u["$sort!"]()["$reverse!"](),M(H(u["$[]"](0),10),u["$[]"](1))}),P.$private(),A(P,"$rand_inner",function(f){var u,p=this;return R(L(p.rand_results.$size(),y("UPPER_LIMIT_RANDS")))&&p.$raise(y("TooManyRandsError")),u=p.$random(f),p.rand_results["$<<"]([u,f]),u}),A(P,"$random",function(f){return M(y("Kernel").$rand(f),1)}),A(P,"$push_to_detail",function(f,p,u){var _;return _=y("DetailedRandResult").$new(f,p,u),this.detailed_rand_results.$push(_)}),B(i[0],w("StandardError"),"TooManyRandsError"),k},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var S,G,j,s,d,i,w,T,x,U=e.module,B=e.klass,c=e.def,A=e.truthy,R=e.return_val,C=[],M=e.nil;return S=C,G=x=[U(C[0],"BCDice")].concat(S),j=T=[U(x[0],"DiceTable")].concat(G),d=[s=B(T[0],null,"RollResult")].concat(j),i=e.$r(d),(w=s.$$prototype).table_name=w.value=w.body=M,c(s,"$initialize",function(a,m,P){var E=this;return E.table_name=a,E.value=m,E.body=P}),s.$attr_reader("table_name"),s.$attr_reader("value"),s.$attr_reader("body"),c(s,"$to_s",function(){var a=this;return a.table_name+"("+a.value+") \uff1e "+a.body}),c(s,"$last_body",function(){var a=this;return A(a.body["$is_a?"](i("RollResult")))?a.body.$last_body():a.body}),c(s,"$empty?",R(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var S,G,j,s,d,i,w,T,x,U=e.module,B=e.klass,c=e.truthy,A=e.def,R=e.rb_minus,C=[],M=e.nil;return S=C,G=x=[U(C[0],"BCDice")].concat(S),j=T=[U(x[0],"DiceTable")].concat(G),d=[s=B(T[0],null,"ChainTable")].concat(j),i=e.$r(d),(w=s.$$prototype).times=w.sides=w.items=w.name=M,A(s,"$initialize",function(a,m,P){var E=this,y=M;return E.name=a,E.items=P.$freeze(),y=/(\d+)D(\d+)/i.$match(m),c(y)||E.$raise(i("ArgumentError"),"Unexpected table type: "+m),E.times=y["$[]"](1).$to_i(),E.sides=y["$[]"](2).$to_i()}),A(s,"$roll",function(a){var P,E,m=this,y=M;return P=a.$roll_sum(m.times,m.sides),E=R(P,m.times),y=m.items["$[]"](E),c(y["$respond_to?"]("roll"))&&(y=y.$roll(a)),i("RollResult").$new(m.name,P,y)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var H,k,i,w,r,a,m,j,L,U=e.module,B=e.klass,c=e.hash2,A=e.defs,R=e.def,C=e.rb_plus,M=e.rb_times,q=e.rb_minus,S=[],N=e.nil;return H=S,k=L=[U(S[0],"BCDice")].concat(H),i=j=[U(L[0],"DiceTable")].concat(k),r=[w=B(j[0],null,"D66GridTable")].concat(i),a=e.$r(r),(m=w.$$prototype).name=m.items=N,A(w,"$from_i18n",function(E,y){var g=N;return g=a("I18n").$t(E,c(["locale","raise"],{locale:y,raise:!0})),this.$new(g["$[]"]("name"),g["$[]"]("items"))}),R(w,"$initialize",function(E,y){return this.name=E,this.items=y.$freeze()}),R(w,"$roll",function(E){var l,g,f,p,u;return l=E.$roll_once(6),g=E.$roll_once(6),f=C(M(l,10),g),p=q(l,1),u=q(g,1),a("RollResult").$new(this.name,f,this.items["$[]"](p)["$[]"](u))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var N,L,d,i,w,r,k,K,H,U=e.module,B=e.klass,c=e.hash2,A=e.defs,R=e.def,M=[],q=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=M,L=H=[U(M[0],"BCDice")].concat(N),k=[U(H[0],"DiceTable")].concat(L),K=e.$r(k),d=k,w=[i=B(k[0],K("D66GridTable"),"D66HalfGridTable")].concat(d),r=e.$r(w),A(i,"$from_i18n",function(m,P){var y=q;return y=r("I18n").$t(m,c(["locale","raise"],{locale:P,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2_3"),y["$[]"]("items_4_5_6"))}),R(i,"$initialize",function(m,P,E){return this.name=m,this.items=[P,P,P,E,E,E].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var N,L,d,i,w,r,k,K,H,U=e.module,B=e.klass,c=e.hash2,A=e.defs,R=e.def,M=[],q=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),N=M,L=H=[U(M[0],"BCDice")].concat(N),k=[U(H[0],"DiceTable")].concat(L),K=e.$r(k),d=k,w=[i=B(k[0],K("D66GridTable"),"D66OneThirdTable")].concat(d),r=e.$r(w),A(i,"$from_i18n",function(m,P){var y=q;return y=r("I18n").$t(m,c(["locale","raise"],{locale:P,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("items_1_2"),y["$[]"]("items_3_4"),y["$[]"]("items_5_6"))}),R(i,"$initialize",function(m,P,E,y){return this.name=m,this.items=[P,P,E,E,y,y].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var L,j,r,a,m,P,E,d,k,U=e.module,B=e.klass,c=e.hash2,A=e.defs,R=e.def,C=e.eqeqeq,M=e.rb_plus,q=e.rb_times,S=e.truthy,N=[],x=e.nil,H=e.$$$;return L=N,j=k=[U(N[0],"BCDice")].concat(L),r=d=[U(k[0],"DiceTable")].concat(j),m=[a=B(d[0],null,"D66Table")].concat(r),P=e.$r(m),(E=a.$$prototype).sort_type=E.items=E.name=x,A(a,"$from_i18n",function(l,g){var u,p=x;return p=P("I18n").$t(l,c(["locale"],{locale:g})),u=P("D66SortType").$const_get(p["$[]"]("d66_sort_type")),this.$new(p["$[]"]("name"),u,p["$[]"]("items"))}),R(a,"$initialize",function(l,g,f){var p=this;return p.name=l,p.sort_type=g,p.items=f.$freeze()}),R(a,"$roll",function(l){var g=this,f=x,p=x,u=x,b=x;return f=l.$roll_barabara(2,6),C(H(P("D66SortType"),"ASC"),p=g.sort_type)?f["$sort!"]():C(H(P("D66SortType"),"DESC"),p)&&f["$sort!"]()["$reverse!"](),u=M(q(f["$[]"](0),10),f["$[]"](1)),b=S(p=g.items["$[]"](u))?p:g.items["$[]"](u.$to_s()),S(b["$respond_to?"]("roll"))&&(b=b.$roll(l)),P("RollResult").$new(g.name,u,b)}),R(a,"$choice",function(l){return P("RollResult").$new(this.name,l,this.items["$[]"](l))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var T,s,i,w,K,U=e.module,B=e.klass,c=e.hash2,A=e.send,R=e.to_ary,C=e.rb_plus,M=e.rb_times,q=e.send2,S=e.find_super,N=e.def,H=[],G=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),T=H,s=K=[U(H[0],"BCDice")].concat(T),i=[U(K[0],"DiceTable")].concat(s),w=e.$r(i),N(B(i[0],w("D66Table"),"D66LeftRangeTable"),"$initialize",function P(E,y,l){var p;return P.$$p=null,p=c([],{}),A(l,"each",[],function(b){var _,v;return null==b&&(b=G),_=R(b),v=null==_[1]?G:_[1],A(null==_[0]?G:_[0],"each",[],function(D){return null==D&&(D=G),A(v,"each_with_index",[],function(o,$){var W,Q;return null==o&&(o=G),null==$&&($=G),Q=C(M(D,10),C($,1)),A(p,"[]=",W=[Q,o]),W[W.length-1]})})}),q(this,S(this,"initialize",P,!1,!0),"initialize",[E,y,p],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var G,K,w,r,a,m,P,s,T,U=e.module,B=e.klass,c=e.hash2,A=e.defs,R=e.def,C=e.truthy,M=e.rb_minus,q=e.rb_plus,S=e.rb_times,N=[],x=e.nil;return G=N,K=T=[U(N[0],"BCDice")].concat(G),w=s=[U(T[0],"DiceTable")].concat(K),a=[r=B(s[0],null,"D66ParityTable")].concat(w),m=e.$r(a),(P=r.$$prototype).odd=P.even=P.name=x,A(r,"$from_i18n",function(y,l){var f=x;return f=m("I18n").$t(y,c(["locale","raise"],{locale:l,raise:!0})),this.$new(f["$[]"]("name"),f["$[]"]("odd"),f["$[]"]("even"))}),R(r,"$initialize",function(y,l,g){var f=this;return f.name=y,f.odd=l.$freeze(),f.even=g.$freeze()}),R(r,"$roll",function(y){var f,u,b,l=this,g=x;return g=y.$roll_once(6),f=y.$roll_once(6),u=(C(g["$odd?"]())?l.odd:l.even)["$[]"](M(f,1)),b=q(S(g,10),f),m("RollResult").$new(l.name,b,u)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var N,L,s,d,i,w,r,k,H,U=e.module,B=e.klass,c=e.def,A=e.rb_plus,R=e.rb_times,C=e.send,M=[],q=e.nil;return N=M,L=H=[U(M[0],"BCDice")].concat(N),s=k=[U(H[0],"DiceTable")].concat(L),i=[d=B(k[0],null,"D66RangeTable")].concat(s),w=e.$r(i),(r=d.$$prototype).items=r.name=q,c(d,"$initialize",function(m,P){return this.name=m,this.items=P.$freeze()}),c(d,"$roll",function(m){var E,y,l,g=q;return E=m.$roll_once(6),y=m.$roll_once(6),l=A(R(E,10),y),g=C(this.items,"find",[],function(p){return null==p&&(p=q),p["$[]"](0)["$include?"](l)}),w("RollResult").$new(this.name,l,g["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var G,K,w,r,a,m,P,s,T,U=e.module,B=e.klass,c=e.const_set,A=e.send,R=e.truthy,C=e.def,M=e.eqeqeq,q=e.rb_times,S=e.rb_plus,N=[],x=e.nil;return G=N,K=T=[U(N[0],"BCDice")].concat(G),w=s=[U(T[0],"DiceTable")].concat(K),a=[r=B(s[0],null,"RangeTable")].concat(w),m=e.$r(a),(P=r.$$prototype).name=P.items=P.num_of_dice=P.num_of_sides=P.formatter=x,c(a[0],"RollResult",A(m("Struct"),"new",["sum","values","content","formatted"],function E(){return(null==E.$$s?this:E.$$s).$alias_method("to_s","formatted")},{$$s:r})),c(a[0],"Item",m("Struct").$new("range","content")),c(a[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(a[0],"DEFAULT_FORMATTER",A(r,"lambda",[],function(y,l){return null==y&&(y=x),null==l&&(l=x),y.$name()+"("+l.$sum()+") \uff1e "+l.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),C(r,"$initialize",function E(y,l,g){var u,f=E.$$p||x,p=this,b=x;return E.$$p=null,p.name=y.$freeze(),p.formatter=R(u=f)?u:m("DEFAULT_FORMATTER"),b=m("DICE_ROLL_METHOD_RE").$match(l),R(b)||p.$raise(m("ArgumentError"),p.name+": invalid dice roll method: "+l),p.num_of_dice=b["$[]"](1).$to_i(),p.num_of_sides=b["$[]"](2).$to_i(),p.$store(g)}),C(r,"$fetch",function(y){var g,l=this;return g=A(l.items,"find",[],function(p){return null==p&&(p=x),p.$range()["$include?"](y)}),R(g)||l.$raise(m("RangeError"),l.name+": value is out of range: "+y),g}),C(r,"$roll",function(y){var f,l=this,g=x,p=x;return f=(g=y.$roll_barabara(l.num_of_dice,l.num_of_sides)).$sum(),(p=m("RollResult").$new(f,g,l.$fetch(f).$content()))["$formatted="](l.formatter["$[]"](l,p)),p}),r.$private(),C(r,"$store",function(y){var g,f,l=this;return g=A(y,"map",[],function p(u,b){return null==u&&(u=x),null==b&&(b=x),[(null==p.$$s?this:p.$$s).$coerce_to_int_range(u),b]},{$$s:l}),f=A(g,"sort_by",[],function(u,b){return null==u&&(u=x),null==b&&(b=x),u.$min()}),l.$assert_min_sum_is_covered(f),l.$assert_max_sum_is_covered(f),l.$assert_no_gap_or_overlap_in_ranges(f),l.items=A(f,"map",[],function(u,b){return null==u&&(u=x),null==b&&(b=x),m("Item").$new(u,b.$freeze()).$freeze()}).$freeze(),l}),C(r,"$coerce_to_int_range",function(y){var g;return M(m("Integer"),g=y)?m("Range").$new(y,y):M(m("Range"),g)&&R(y.$begin()["$is_a?"](m("Integer")))&&R(y.$end()["$is_a?"](m("Integer")))?y:this.$raise(m("TypeError"),this.name+": "+y+" ("+y.$class()+") must be an Integer or a Range with Integers ")}),C(r,"$assert_min_sum_is_covered",function(y){var g,l=this,f=x;return g=l.num_of_dice,f=y.$first()["$[]"](0),R(f["$include?"](g))||l.$raise(m("RangeError"),l.name+": min value ("+g+") is not covered: "+f),l}),C(r,"$assert_max_sum_is_covered",function(y){var g,l=this,f=x;return g=q(l.num_of_dice,l.num_of_sides),f=y.$last()["$[]"](0),R(f["$include?"](g))||l.$raise(m("RangeError"),l.name+": max value ("+g+") is not covered: "+f),l}),C(r,"$assert_no_gap_or_overlap_in_ranges",function(y){return A(y,"each_cons",[2],function g(f,p){var I,F,u=null==g.$$s?this:g.$$s,b=x,_=x;return null==u.name&&(u.name=x),null==f&&(f=x),null==p&&(p=x),b=f["$[]"](0),_=p["$[]"](0),I=b.$max(),F=S(I,1),R(_["$include?"](I))&&u.$raise(m("RangeError"),u.name+": Range overlap: "+b+" and "+_),R(_["$include?"](F))?x:u.$raise(m("RangeError"),u.name+": Range gap: "+b+" and "+_)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var x,T,d,m,P,E,y,w,K,G,U=e.module,B=e.klass,c=e.send,A=e.def,R=e.rb_minus,C=e.return_ivar,M=[],q=e.nil,S=e.$$$;return x=M,T=G=[U(M[0],"BCDice")].concat(x),d=K=[U(G[0],"DiceTable")].concat(T),m=w=[B(K[0],null,"SaiFicSkillTable")].concat(d),E=[P=B(w[0],null,"Category")].concat(m),y=e.$r(E),A(P,"$initialize",function(g,f,p,u){var b=this;return b.name=g,b.skills=c(f.$map(),"with_index",[2],function(I,F){return null==I&&(I=q),null==F&&(F=q),S(y("SaiFicSkillTable"),"Skill").$new(g,I,p,F,u)}),b.dice=p}),A(P,"$roll",function(g){return this.$skills()["$[]"](R(g.$roll_sum(2,6),2))}),A(P,"$to_s",C("name")),P.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var q,H,K,w,r,s,L,N,U=e.module,B=e.klass,c=e.def,A=e.hash2,R=[],C=e.nil;return q=R,H=N=[U(R[0],"BCDice")].concat(q),K=L=[U(N[0],"DiceTable")].concat(H),s=[B(L[0],null,"SaiFicSkillTable")].concat(K),(r=(w=B(s[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=C,c(w,"$initialize",function(m,P,E,y,l){var g=this;return g.category_name=m,g.name=P,g.category_dice=E,g.row_dice=y,g.s_format=l}),c(w,"$to_s",function(){var m=this;return m.$format(m.s_format,A(["category_dice","row_dice","category_name","skill_name"],{category_dice:m.category_dice,row_dice:m.row_dice,category_name:m.category_name,skill_name:m.name}))}),w.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var s,r,y,l,g,f,p,m,i,U=e.module,B=e.klass,c=e.ensure_kwargs,A=e.hash2,R=e.send,M=e.defs,q=e.const_set,S=e.to_ary,N=e.def,x=e.truthy,H=e.rb_minus,G=e.rb_plus,L=e.top,T=[],k=e.nil,K=e.$$$;return L.$require("bcdice/dice_table/sai_fic_skill_table/category"),L.$require("bcdice/dice_table/sai_fic_skill_table/skill"),s=T,r=i=[U(T[0],"BCDice")].concat(s),y=m=[U(i[0],"DiceTable")].concat(r),g=[l=B(m[0],null,"SaiFicSkillTable")].concat(y),f=e.$r(g),(p=l.$$prototype).rtt=p.rtt_format=p.rct=p.rct_format=p.rttn=p.rttn_format=p.categories=k,M(l,"$from_i18n",function(b,_,I){var F,v,t,$,o=k;return null==(F=(I=c(I)).$$smap.rtt)&&(F=k),null==(v=I.$$smap.rct)&&(v=k),null==(t=I.$$smap.rttn)&&(t=k),$=(o=f("I18n").$t("RTT",A(["locale","raise","default"],{locale:_,raise:!1,default:A([],{})})).$merge(f("I18n").$t(b,A(["locale","raise"],{locale:_,raise:!0}))))["$[]"]("items"),o=R(o,"select",[],function(Q,Y){return null==Q&&(Q=k),null==Y&&(Y=k),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](Q)}),this.$new($,e.to_hash(o).$merge(A(["rtt","rct","rttn"],{rtt:F,rct:v,rttn:t})))},-3),q(g[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),q(g[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),q(g[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),q(g[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),N(l,"$initialize",function(b,_){var I,F,v,t,D,n,o,$=this;return null==(I=(_=c(_)).$$smap.rtt)&&(I=k),null==(F=_.$$smap.rct)&&(F=k),null==(v=_.$$smap.rttn)&&(v=k),null==(t=_.$$smap.rtt_format)&&(t=f("DEFAULT_RTT")),null==(D=_.$$smap.rct_format)&&(D=f("DEFAULT_RCT")),null==(n=_.$$smap.rttn_format)&&(n=f("DEFAULT_RTTN")),null==(o=_.$$smap.s_format)&&(o=f("DEFAULT_S")),$.categories=R(b.$map(),"with_index",[1],function(Q,Y){var re,_e,ie;return null==Q&&(Q=k),null==Y&&(Y=k),_e=null==(re=S(Q))[0]?k:re[0],ie=null==re[1]?k:re[1],K(f("SaiFicSkillTable"),"Category").$new(_e,ie,Y,o)},{$$has_top_level_mlhs_arg:!0}),$.rtt=I,$.rct=F,$.rttn=v.$to_a(),$.rtt_format=t,$.rct_format=D,$.rttn_format=n},-2),q(g[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),l.$attr_reader("categories"),N(l,"$roll_command",function(b,_){var F,I=this,v=k,t=k;return x(["RTT",I.rtt]["$include?"](F=_))?I.$format_skill(I.rtt_format,I.$roll_skill(b)):x(["RCT",I.rct]["$include?"](F))?(v=I.$roll_category(b),I.$format(I.rct_format,A(["category_dice","category_name"],{category_dice:v.$dice(),category_name:v.$name()}))):x(t=f("RTTN").$index(F))||x(t=I.rttn.$index(F))?I.$format_skill(I.rttn_format,I.categories["$[]"](t).$roll(b)):k}),N(l,"$roll_category",function(b){return this.categories["$[]"](H(b.$roll_once(6),1))}),N(l,"$roll_skill",function(b){return this.$roll_category(b).$roll(b)}),N(l,"$prefixes",function(){var b=this;return G(["RTT[1-6]?","RCT",b.rtt,b.rct],b.rttn).$compact()}),l.$private(),N(l,"$format_skill",function(b,_){return this.$format(b,A(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:_.$category_dice(),row_dice:_.$row_dice(),category_name:_.$category_name(),skill_name:_.$name(),text:_.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var x,T,d,i,w,r,a,K,G,U=e.module,B=e.klass,c=e.hash2,A=e.defs,R=e.truthy,C=e.def,M=e.rb_minus,q=[],S=e.nil;return x=q,T=G=[U(q[0],"BCDice")].concat(x),d=K=[U(G[0],"DiceTable")].concat(T),w=[i=B(K[0],null,"Table")].concat(d),r=e.$r(w),(a=i.$$prototype).times=a.sides=a.name=a.items=S,A(i,"$from_i18n",function(P,E){var l=S;return l=r("I18n").$t(P,c(["locale"],{locale:E})),this.$new(l["$[]"]("name"),l["$[]"]("type"),l["$[]"]("items"))}),C(i,"$initialize",function(P,E,y){var l=this,g=S;return l.name=P,l.items=y.$freeze(),g=/(\d+)D(\d+)/i.$match(E),R(g)||l.$raise(r("ArgumentError"),"Unexpected table type: "+E),l.times=g["$[]"](1).$to_i(),l.sides=g["$[]"](2).$to_i()}),C(i,"$roll",function(P){var y,E=this;return y=P.$roll_sum(E.times,E.sides),E.$choice(y)}),C(i,"$choice",function(P){var y,E=this;return y=M(P,E.times),r("RollResult").$new(E.name,P,E.items["$[]"](y))})},Opal.modules["bcdice/dice_table"]=function(e){var U=e.top;return U.$require("bcdice/dice_table/roll_result"),U.$require("bcdice/dice_table/chain_table"),U.$require("bcdice/dice_table/d66_grid_table"),U.$require("bcdice/dice_table/d66_half_grid_table"),U.$require("bcdice/dice_table/d66_one_third_table"),U.$require("bcdice/dice_table/d66_left_range_table"),U.$require("bcdice/dice_table/d66_parity_table"),U.$require("bcdice/dice_table/d66_range_table"),U.$require("bcdice/dice_table/d66_table"),U.$require("bcdice/dice_table/range_table"),U.$require("bcdice/dice_table/sai_fic_skill_table"),U.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var C,N,H,q,U=e.module,B=e.const_set,c=[];return C=c,N=q=[U(c[0],"BCDice")].concat(C),H=[U(q[0],"D66SortType")].concat(N),B(H[0],"NO_SORT","no_sort"),B(H[0],"ASC","asc"),B(H[0],"DESC","desc"),function(S,N){var H=[U(S,"RoundType")].concat(N);return B(H[0],"CEIL","ceil"),B(H[0],"FLOOR","floor"),B(H[0],"ROUND","round")}(q[0],q)},Opal.modules["bcdice/translate"]=function(e){var N,L,T,k,K,H,U=e.module,B=e.ensure_kwargs,c=e.kwrestargs,R=e.hash2,C=e.def,M=[],q=e.nil;return N=M,L=H=[U(M[0],"BCDice")].concat(N),k=[T=U(H[0],"Translate")].concat(L),K=e.$r(k),C(T,"$translate",function(s,d){var i,w=this;return null==w.locale&&(w.locale=q),d=B(d),i=c(d,{}),K("I18n").$translate(s,R(["locale","raise"],{locale:w.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var T,j,k,N,H,B=e.klass,c=e.send,A=e.def,R=e.return_val,C=e.return_ivar,M=[],q=e.nil;return N=M,T=H=[(0,e.module)(M[0],"BCDice")].concat(N),[k=B(H[0],null,"Result")].concat(T),A(j=e.get_singleton_class(k),"$success",function(i){return c(this.$new(),"tap",[],function(a){var m;return null==a&&(a=q),a["$text="](i),c(a,"success=",m=[!0]),m[m.length-1]})}),A(j,"$failure",function(i){return c(this.$new(),"tap",[],function(a){var m;return null==a&&(a=q),a["$text="](i),c(a,"failure=",m=[!0]),m[m.length-1]})}),A(j,"$critical",function(i){return c(this.$new(),"tap",[],function(a){var m;return null==a&&(a=q),a["$text="](i),a["$critical="](!0),c(a,"success=",m=[!0]),m[m.length-1]})}),A(j,"$fumble",function(i){return c(this.$new(),"tap",[],function(a){var m;return null==a&&(a=q),a["$text="](i),a["$fumble="](!0),c(a,"failure=",m=[!0]),m[m.length-1]})}),A(j,"$nothing",R("nothing")),A(k,"$initialize",function(s){var d=this;return null==s&&(s=q),d.text=s,d.rands=q,d.detailed_rands=q,d.secret=!1,d.success=!1,d.failure=!1,d.critical=!1,d.fumble=!1},-1),k.$attr_accessor("text","rands","detailed_rands"),k.$attr_writer("secret","success","failure","critical","fumble"),A(k,"$secret?",C("secret")),A(k,"$success?",C("success")),A(k,"$failure?",C("failure")),A(k,"$critical?",C("critical")),A(k,"$fumble?",C("fumble")),A(k,"$condition=",function(s){return this.success=s,this.failure=s["$!"]()})},Opal.modules["racc/parser"]=function(e){var P,y,l,U=e.module,B=e.klass,c=e.truthy,A=e.const_set,R=e.defs,C=e.gvars,M=e.rb_lt,q=e.def,S=e.to_ary,N=e.send,x=e.neqeq,H=e.rb_plus,G=e.eqeq,L=e.rb_ge,T=e.rb_gt,k=e.rb_minus,K=e.rb_le,j=e.rb_times,s=e.assign_ivar_val,i=[],w=e.$r(i),r=e.nil,a=e.$$$;return P=i,y=[U(i[0],"Racc")].concat(P),l=e.$r(y),B(y[0],l("StandardError"),"ParseError"),c(a("::","ParseError","skip_raise")?"constant":r)||A(i[0],"ParseError",a(w("Racc"),"ParseError")),function(m,P){var u,b,_,I,F,l=[U(m,"Racc")].concat(P),g=e.$r(l);return c(g("Racc_No_Extensions","skip_raise")?"constant":r)||A(l[0],"Racc_No_Extensions",!1),u=l,_=[b=B(l[0],null,"Parser")].concat(u),I=e.$r(_),(F=b.$$prototype).yydebug=F.racc_debug_out=F.racc_error_status=F.racc_t=F.racc_vstack=F.racc_val=F.racc_state=F.racc_tstack=r,A(_[0],"Racc_Runtime_Version","1.4.6"),A(_[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),A(_[0],"Racc_Runtime_Core_Version_R","1.4.6"),A(_[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),A(_[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),A(_[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),A(_[0],"Racc_Runtime_Core_Version",I("Racc_Runtime_Core_Version_R")),A(_[0],"Racc_Runtime_Core_Revision",I("Racc_Runtime_Core_Revision_R")),A(_[0],"Racc_Runtime_Type","ruby"),R(I("Parser"),"$racc_runtime_type",function(){return I("Racc_Runtime_Type")}),q(b,"$_racc_setup",function(){var t,D,n=this,o=r,$=r;return null==C.stderr&&(C.stderr=r),c(a(n.$class(),"Racc_debug_parser"))||(n.yydebug=!1),c(null!=(t=n.yydebug)&&t!==r?"instance-variable":r)||(n.yydebug=!1),c(n.yydebug)&&(c(null!=(D=n.racc_debug_out)&&D!==r?"instance-variable":r)||(n.racc_debug_out=C.stderr),n.racc_debug_out=c(o=n.racc_debug_out)?o:C.stderr),$=a(n.$class(),"Racc_arg"),c(M($.$size(),14))&&$["$[]="](13,!0),$}),q(b,"$_racc_init_sysvars",function(){var t=this;return t.racc_state=[0],t.racc_tstack=[],t.racc_vstack=[],t.racc_t=r,t.racc_val=r,t.racc_read_next=!0,t.racc_user_yyerror=!1,t.racc_error_status=0}),q(b,"$do_parse",function(){return this.$__send__(I("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),q(b,"$next_token",function(){return this.$raise(I("NotImplementedError"),this.$class()+"#next_token is not defined")}),q(b,"$_racc_do_parse_rb",function(t,D){var n,$=this,W=r,Q=r,Y=r,re=r,_e=r,ie=r,ue=r,ae=r;return n=S(t),W=null==n[0]?r:n[0],Q=null==n[1]?r:n[1],Y=null==n[2]?r:n[2],re=null==n[3]?r:n[3],_e=null==n[10]?r:n[10],$.$_racc_init_sysvars(),ie=ue=ae=r,N($,"catch",["racc_end_parse"],function te(){var se,V,h=null==te.$$s?this:te.$$s,Z=r;for(null==h.racc_state&&(h.racc_state=r),null==h.racc_read_next&&(h.racc_read_next=r),null==h.racc_t&&(h.racc_t=r),null==h.yydebug&&(h.yydebug=r),null==h.racc_val&&(h.racc_val=r);c(!0);)for(c(ae=re["$[]"](h.racc_state["$[]"](-1)))?(c(h.racc_read_next)&&x(h.racc_t,0)&&(V=h.$next_token(),se=S(V),ie=null==se[0]?r:se[0],h.racc_val=null==se[1]?r:se[1],h.racc_t=c(ie)?c(Z=_e["$[]"](ie))?Z:1:0,c(h.yydebug)&&h.$racc_read_token(h.racc_t,ie,h.racc_val),h.racc_read_next=!1),ae=H(ae,h.racc_t),c(L(ae,0))&&c(ue=W["$[]"](ae))&&G(Q["$[]"](ae),h.racc_state["$[]"](-1))||(ue=Y["$[]"](h.racc_state["$[]"](-1)))):ue=Y["$[]"](h.racc_state["$[]"](-1));c(ue=h.$_racc_evalact(ue,t)););},{$$s:$})}),q(b,"$yyparse",function(t,D){return this.$__send__(I("Racc_YY_Parse_Method"),t,D,this.$_racc_setup(),!0)}),q(b,"$_racc_yyparse_rb",function(t,D,n,o){var $,Q=this,Y=r,re=r,$e=r,_e=r,ue=r,ae=r,te=r;return $=S(n),Y=null==$[0]?r:$[0],re=null==$[1]?r:$[1],$e=null==$[2]?r:$[2],_e=null==$[3]?r:$[3],ue=null==$[10]?r:$[10],Q.$_racc_init_sysvars(),ae=r,te=r,N(Q,"catch",["racc_end_parse"],function se(){var V=null==se.$$s?this:se.$$s;for(null==V.racc_state&&(V.racc_state=r);!c(te=_e["$[]"](V.racc_state["$[]"](-1)));)for(;c(ae=V.$_racc_evalact($e["$[]"](V.racc_state["$[]"](-1)),n)););return N(t,"__send__",[D],function h(Z,X){var z=null==h.$$s?this:h.$$s,O=r,ne=r;for(null==z.racc_t&&(z.racc_t=r),null==z.racc_state&&(z.racc_state=r),null==z.racc_read_next&&(z.racc_read_next=r),null==Z&&(Z=r),null==X&&(X=r),z.racc_t=c(Z)?c(O=ue["$[]"](Z))?O:1:0,z.racc_val=X,z.racc_read_next=!1,te=H(te,z.racc_t),c(L(te,0))&&c(ae=Y["$[]"](te))&&G(re["$[]"](te),z.racc_state["$[]"](-1))||(ae=$e["$[]"](z.racc_state["$[]"](-1)));c(ae=z.$_racc_evalact(ae,n)););for(;c(c(O=c(ne=(te=_e["$[]"](z.racc_state["$[]"](-1)))["$!"]())?ne:z.racc_read_next["$!"]())?O:z.racc_t["$=="](0));)for(c(te)&&c(te=H(te,z.racc_t))&&c(L(te,0))&&c(ae=Y["$[]"](te))&&G(re["$[]"](te),z.racc_state["$[]"](-1))||(ae=$e["$[]"](z.racc_state["$[]"](-1)));c(ae=z.$_racc_evalact(ae,n)););},{$$s:V})},{$$s:Q})}),q(b,"$_racc_evalact",function(t,D){var n,$e,$=this,W=r,Q=r,re=r,_e=r,ie=r,ue=r;if(W=null==(n=S(D))[0]?r:n[0],Q=null==n[1]?r:n[1],re=null==n[3]?r:n[3],$e=null==n[11]?r:n[11],_e=null==n[12]?r:n[12],c(T(t,0))&&c(M(t,$e)))c(T($.racc_error_status,0))&&(G($.racc_t,1)||($.racc_error_status=k($.racc_error_status,1))),$.racc_vstack.$push($.racc_val),$.racc_state.$push(t),$.racc_read_next=!0,c($.yydebug)&&($.racc_tstack.$push($.racc_t),$.$racc_shift($.racc_t,$.racc_tstack,$.racc_vstack));else if(c(M(t,0))&&c(T(t,_e["$-@"]()))){if(ie=N($,"catch",["racc_jump"],function ae(){var te=null==ae.$$s?this:ae.$$s;return null==te.racc_state&&(te.racc_state=r),te.racc_state.$push(te.$_racc_do_reduce(D,t)),!1},{$$s:$}),c(ie))switch(ie.valueOf()){case 1:return $.racc_user_yyerror=!0,_e["$-@"]();case 2:return $e;default:$.$raise("[Racc Bug] unknown jump code")}}else if(G(t,$e))c($.yydebug)&&$.$racc_accept(),$.$throw("racc_end_parse",$.racc_vstack["$[]"](0));else{if(G(t,_e["$-@"]())){switch($.racc_error_status.valueOf()){case 0:c(D["$[]"](21))||$.$on_error($.racc_t,$.racc_val,$.racc_vstack);break;case 3:G($.racc_t,0)&&$.$throw("racc_end_parse",r),$.racc_read_next=!0}for($.racc_user_yyerror=!1,$.racc_error_status=3;c(!0)&&!(c(ue=re["$[]"]($.racc_state["$[]"](-1)))&&(ue=H(ue,1),c(L(ue,0))&&c(t=W["$[]"](ue))&&G(Q["$[]"](ue),$.racc_state["$[]"](-1))));)c(K($.racc_state.$size(),1))&&$.$throw("racc_end_parse",r),$.racc_state.$pop(),$.racc_vstack.$pop(),c($.yydebug)&&($.racc_tstack.$pop(),$.$racc_e_pop($.racc_state,$.racc_tstack,$.racc_vstack));return t}$.$raise("[Racc Bug] unknown action "+t.$inspect())}return c($.yydebug)&&$.$racc_next_state($.racc_state["$[]"](-1),$.racc_state),r}),q(b,"$_racc_do_reduce",function(t,D){var n,_e,ue,Z,X,z,ee,$=this,Q=r,Y=r,re=r,$e=r,ie=r,ae=r,te=r,se=r,V=r,h=r,O=r,ne=r,J=r;return Q=null==(n=S(t))[4]?r:n[4],Y=null==n[5]?r:n[5],re=null==n[6]?r:n[6],$e=null==n[7]?r:n[7],_e=null==n[8]?r:n[8],ie=null==n[9]?r:n[9],ue=null==n[13]?r:n[13],ae=$.racc_state,te=$.racc_vstack,se=$.racc_tstack,V=j(D,-3),h=ie["$[]"](V),Z=ie["$[]"](H(V,1)),X=ie["$[]"](H(V,2)),z=[],c($.yydebug)&&(O=se["$[]"](h["$-@"](),h)),ne=te["$[]"](h["$-@"](),h),c($.yydebug)&&se["$[]="](h["$-@"](),h,z),te["$[]="](h["$-@"](),h,z),ae["$[]="](h["$-@"](),h,z),c(ue)?te.$push($.$__send__(X,ne,te,ne["$[]"](0))):te.$push($.$__send__(X,ne,te)),se.$push(Z),c($.yydebug)&&$.$racc_reduce(O,Z,se,te),ee=k(Z,_e),c(V=$e["$[]"](ee))&&(V=H(V,ae["$[]"](-1)),c(L(V,0))&&c(J=Q["$[]"](V))&&G(Y["$[]"](V),ee))?J:re["$[]"](ee)}),q(b,"$on_error",function(t,D,n){var $,o=this;return o.$raise(I("ParseError"),o.$sprintf("\nparse error on value %s (%s)",D.$inspect(),c($=o.$token_to_str(t))?$:"?"))}),q(b,"$yyerror",function(){return this.$throw("racc_jump",1)}),q(b,"$yyaccept",function(){return this.$throw("racc_jump",2)}),q(b,"$yyerrok",s("racc_error_status",0)),q(b,"$racc_read_token",function(t,D,n){var o=this;return o.racc_debug_out.$print("read    "),o.racc_debug_out.$print(D.$inspect(),"(",o.$racc_token2str(t),") "),o.racc_debug_out.$puts(n.$inspect()),o.racc_debug_out.$puts()}),q(b,"$racc_shift",function(t,D,n){var o=this;return o.racc_debug_out.$puts("shift   "+o.$racc_token2str(t)),o.$racc_print_stacks(D,n),o.racc_debug_out.$puts()}),q(b,"$racc_reduce",function(t,D,n,o){var $=this,W=r;return(W=$.racc_debug_out).$print("reduce "),c(t["$empty?"]())?W.$print(" <none>"):N(t,"each",[],function Q(Y){return null==Y&&(Y=r),W.$print(" ",(null==Q.$$s?this:Q.$$s).$racc_token2str(Y))},{$$s:$}),W.$puts(" --\x3e "+$.$racc_token2str(D)),$.$racc_print_stacks(n,o),$.racc_debug_out.$puts()}),q(b,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),q(b,"$racc_e_pop",function(t,D,n){var o=this;return o.racc_debug_out.$puts("error recovering mode: pop token"),o.$racc_print_states(t),o.$racc_print_stacks(D,n),o.racc_debug_out.$puts()}),q(b,"$racc_next_state",function(t,D){var n=this;return n.racc_debug_out.$puts("goto    "+t),n.$racc_print_states(D),n.racc_debug_out.$puts()}),q(b,"$racc_print_stacks",function(t,D){var o=r;return(o=this.racc_debug_out).$print("        ["),N(t,"each_index",[],function $(W){return null==W&&(W=r),o.$print(" (",(null==$.$$s?this:$.$$s).$racc_token2str(t["$[]"](W))," ",D["$[]"](W).$inspect(),")")},{$$s:this}),o.$puts(" ]")}),q(b,"$racc_print_states",function(t){var n=r;return(n=this.racc_debug_out).$print("        ["),N(t,"each",[],function($){return null==$&&($=r),n.$print(" ",$)}),n.$puts(" ]")}),q(b,"$racc_token2str",function(t){var n;return c(n=a(this.$class(),"Racc_token_to_s_table")["$[]"](t))?n:this.$raise("[Racc Bug] can't convert token "+t+" to string")}),q(b,"$token_to_str",function(t){return a(this.$class(),"Racc_token_to_s_table")["$[]"](t)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var s,r,E,u,b,l,g,m,i,U=e.module,B=e.klass,c=e.def,A=e.thrower,R=e.return_ivar,C=e.send2,M=e.find_super,q=e.eqeq,S=e.const_set,N=e.eqeqeq,x=e.rb_divide,H=e.truthy,G=e.assign_ivar,L=e.alias,T=[],k=e.nil,K=e.$$$;return s=T,r=i=[U(T[0],"BCDice")].concat(s),E=m=[U(i[0],"Arithmetic")].concat(r),l=[U(m[0],"Node")].concat(E),g=e.$r(l),(b=(u=B(l[0],null,"BinaryOp")).$$prototype).lhs=b.rhs=b.op=k,c(u,"$initialize",function(I,F,v){var t=this;return t.lhs=I,t.op=F,t.rhs=v}),c(u,"$eval",function(I){try{A("eval_return");var D,v=this,t=k;return t=v.lhs.$eval(I),D=v.rhs.$eval(I),t.$send(v.op,D)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),c(u,"$output",function(){var I=this;return""+I.lhs.$output()+I.op+I.rhs.$output()}),c(u,"$s_exp",function(){var I=this;return"("+I.$op_for_s_exp()+" "+I.lhs.$s_exp()+" "+I.rhs.$s_exp()+")"}),c(u,"$op_for_s_exp",R("op")),function(f,p,u){var b=B(f,p,"DivideBase"),_=[b].concat(u),I=e.$r(_),F=b.$$prototype;F.lhs=F.rhs=F.op=k,c(b,"$initialize",function v(t,D){return v.$$p=null,C(this,M(this,"initialize",v,!1,!0),"initialize",[t,"/",D],null)}),c(b,"$eval",function(t){try{A("eval_return");var o,$,n=this;return o=n.lhs.$eval(t),$=n.rhs.$eval(t),q($,0)&&n.$raise(I("ZeroDivisionError")),n.$divide_and_round(o,$,t)}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),c(b,"$output",function v(){var t=v.$$p||k,D=this;return v.$$p=null,""+C(D,M(D,"output",v,!1,!0),"output",[],t)+D.$rounding_method()}),b.$private(),c(b,"$rounding_method",function(){return K(this.$class(),"ROUNDING_METHOD")}),c(b,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(b,"$divide_and_round",function(t,D,n){return this.$raise(I("NotImplementedError"))})}(l[0],g("BinaryOp"),l),function(f,p,u){var b=B(f,p,"DivideWithGameSystemDefault"),_=[b].concat(u),I=e.$r(_);S(_[0],"ROUNDING_METHOD",""),b.$private(),c(b,"$divide_and_round",function(v,t,D){var n,o=k;return N(K(I("RoundType"),"CEIL"),n=D)?x(v.$to_f(),t).$ceil():N(K(I("RoundType"),"ROUND"),n)?(o=x(v.$to_f(),t),H(o["$negative?"]())?o.$abs().$round()["$-@"]():o.$round()):x(v,t).$floor()})}(l[0],g("DivideBase"),l),function(f,p,u){var b=B(f,p,"DivideWithCeil"),_=[b].concat(u);S(_[0],"ROUNDING_METHOD","C"),b.$private(),c(b,"$divide_and_round",function(F,v,t){return x(F.$to_f(),v).$ceil()})}(l[0],g("DivideBase"),l),function(f,p,u){var b=B(f,p,"DivideWithRound"),_=[b].concat(u);S(_[0],"ROUNDING_METHOD","R"),b.$private(),c(b,"$divide_and_round",function(F,v,t){var D=k;return D=x(F.$to_f(),v),H(D["$negative?"]())?D.$abs().$round()["$-@"]():D.$round()})}(l[0],g("DivideBase"),l),function(f,p,u){var b=B(f,p,"DivideWithFloor"),_=[b].concat(u);S(_[0],"ROUNDING_METHOD","F"),b.$private(),c(b,"$divide_and_round",function(F,v,t){return x(F,v).$floor()})}(l[0],g("DivideBase"),l),function(f,p){var u=B(f,null,"Negative");u.$$prototype.body=k,c(u,"$initialize",G("body")),c(u,"$eval",function(I){try{return A("eval_return"),this.body.$eval(I)["$-@"]()}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(u,"$output",function(){return"-"+this.body.$output()}),c(u,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(l[0]),function(f,p){var u=B(f,null,"Parenthesis");u.$$prototype.expr=k,c(u,"$initialize",G("expr")),c(u,"$eval",function(I){try{return A("eval_return"),this.expr.$eval(I)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),c(u,"$output",function(){return"("+this.expr.$output()+")"}),c(u,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(l[0]),function(f,p){var u=B(f,null,"Number");return u.$$prototype.value=k,c(u,"$initialize",G("value")),c(u,"$eval",R("value")),c(u,"$output",function(){return this.value.$to_s()}),L(u,"s_exp","output")}(l[0])},Opal.modules.strscan=function(e){var G,L,T,k,K,B=e.def,c=e.truthy,A=e.eqeqeq,R=e.Opal,C=e.return_ivar,M=e.send,q=e.alias,S=[],N=e.nil;return G=S,T=[L=(0,e.klass)(S[0],null,"StringScanner")].concat(G),k=e.$r(T),(K=L.$$prototype).pos=K.string=K.working=K.matched=K.prev_pos=K.match=N,L.$attr_reader("pos","matched"),B(L,"$initialize",function(s){var d=this;return d.string=s,d.pos=0,d.matched=N,d.working=s,d.match=[]}),L.$attr_reader("string"),B(L,"$beginning_of_line?",function(){var s=this;return 0===s.pos||"\n"===s.string.charAt(s.pos-1)}),B(L,"$scan",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);return null==i?d.matched=N:(d.prev_pos=d.pos,d.pos+=i[0].length,d.working=d.working.substring(i[0].length),d.matched=i[0],d.match=i,i[0])}),B(L,"$scan_until",function(s){var d=this;s=d.$anchor(s);for(var i=d.working,w=0;i.length!=w;++w){var r=s.exec(i.substr(w));if(null!==r){var a=w+r[0].length,m=i.substr(0,a);return d.matched=r[0],d.match=r,d.prev_pos=d.pos+w,d.pos+=a,d.working=i.substr(a),m}}return d.matched=N}),B(L,"$[]",function(s){var i;if(c(this.match["$empty?"]()))return N;A(k("Symbol"),i=s)?s=s.$to_s():A(k("String"),i)||(s=R["$coerce_to!"](s,k("Integer"),"to_int"));var w=this.match;return s<0&&(s+=w.length),s<0||s>=w.length||null==w[s]?N:w[s]}),B(L,"$check",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);return d.matched=null==i?N:i[0]}),B(L,"$check_until",function(s){var d=this,i=d.prev_pos,w=d.pos,r=d.working,a=d.$scan_until(s);return d.prev_pos=i,d.pos=w,d.working=r,a}),B(L,"$peek",function(s){return this.working.substring(0,s)}),B(L,"$eos?",function(){return 0===this.working.length}),B(L,"$exist?",function(s){var i=s.exec(this.working);return null==i?N:0==i.index?0:i.index+1}),B(L,"$skip",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);if(null==i)return d.match=[],d.matched=N;var w=i[0],r=w.length;return d.matched=w,d.match=i,d.prev_pos=d.pos,d.pos+=r,d.working=d.working.substring(r),r}),B(L,"$skip_until",function(s){var i=this.$scan_until(s);return i===N?N:(this.matched=i.substr(-1),i.length)}),B(L,"$get_byte",function(){var s=this,d=N;return s.pos<s.string.length?(s.prev_pos=s.pos,s.pos+=1,d=s.matched=s.working.substring(0,1),s.working=s.working.substring(1)):s.matched=N,d}),B(L,"$match?",function(s){var d=this,i=(s=d.$anchor(s)).exec(d.working);return null==i?N:(d.prev_pos=d.pos,i[0].length)}),B(L,"$pos=",function(s){var d=this;return s<0&&(s+=d.string.$length()),d.pos=s,d.working=d.string.slice(s)}),B(L,"$matched_size",function(){return this.matched===N?N:this.matched.length}),B(L,"$post_match",function(){var s=this;return s.matched===N?N:s.string.substr(s.pos)}),B(L,"$pre_match",function(){var s=this;return s.matched===N?N:s.string.substr(0,s.prev_pos)}),B(L,"$reset",function(){var s=this;return s.working=s.string,s.matched=N,s.pos=0}),B(L,"$rest",C("working")),B(L,"$rest?",function(){return 0!==this.working.length}),B(L,"$rest_size",function(){return this.$rest().$size()}),B(L,"$terminate",function(){var s,d=this;return d.match=N,s=[d.string.$length()],M(d,"pos=",s),s[s.length-1]}),B(L,"$unscan",function(){var s=this;return s.pos=s.prev_pos,s.prev_pos=N,s.match=N,s}),q(L,"bol?","beginning_of_line?"),q(L,"getch","get_byte"),L.$private(),B(L,"$anchor",function(s){var d=s.toString().match(/\/([^\/]+)$/);return d=d?d[1]:void 0,new RegExp("^(?:"+s.source+")",d)})},Opal.modules["bcdice/normalize"]=function(e){var q,H,N,U=e.module,B=e.eqeqeq,c=e.def,A=e.eqeq,R=[],C=e.nil;return q=R,N=[U(R[0],"BCDice")].concat(q),(H=U(N[0],"Normalize")).$module_function(),c(H,"$comparison_operator",function(L){var T;return B(/<=|=</,T=L)?"<=":B(/>=|=>/,T)?">=":B(/<>|!=|=!/,T)?"!=":B(/</,T)?"<":B(/>/,T)?">":B(/=/,T)?"==":C}),c(H,"$target_number",function(L){return A(L,"?")?L:L.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var G,K,w,r,a,m,P,s,T,U=e.module,B=e.klass,c=e.const_set,A=e.hash2,R=e.truthy,C=e.send,M=e.def,q=e.thrower,S=e.top,N=[],x=e.nil;return S.$require("strscan"),S.$require("bcdice/normalize"),G=N,K=T=[U(N[0],"BCDice")].concat(G),w=s=[U(T[0],"Command")].concat(K),a=[r=B(s[0],null,"Lexer")].concat(w),m=e.$r(a),(P=r.$$prototype).scanner=P.notations=x,c(a[0],"SYMBOLS",A(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),M(r,"$initialize",function(y,l){var g,f,u;return y=R(u=(g=(f=y)===x||null==f?x:f.$split(" ",2))===x||null==g?x:g.$first())?u:"",this.scanner=m("StringScanner").$new(y),this.notations=C(l,"map",[],function(_){return null==_&&(_=x),R(_["$is_a?"](m("String")))?m("Regexp").$new(_):_})}),M(r,"$next_token",function(){try{var y=q("return"),l=this,g=x,f=x,u=x,b=x;return R(l.scanner["$eos?"]())?[!1,"$"]:(C(l.notations,"each",[],function _(I){var v,F=null==_.$$s?this:_.$$s;if(null==F.scanner&&(F.scanner=x),null==I&&(I=x),v=F.scanner.$scan(I),!R(v))return x;y.$throw(["NOTATION",v])},{$$s:l,$$ret:y}),R(g=l.scanner.$scan(/\d+/))?["NUMBER",g.$to_i()]:R(f=l.scanner.$scan(/[<>!=]+/))?(f=m("Normalize").$comparison_operator(f),[R(f)?"CMP_OP":"ILLEGAL",f]):(u=l.scanner.$getch().$upcase(),[R(b=m("SYMBOLS")["$[]"](u))?b:u.$to_sym(),u]))}catch(_){if(_===y)return _.$v;throw _}}),M(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var S,G,j,s,d,i,w,T,x,U=e.module,B=e.klass,c=e.def,A=e.return_ivar,R=e.truthy,C=[],M=e.nil;return S=C,G=x=[U(C[0],"BCDice")].concat(S),j=T=[U(x[0],"Command")].concat(G),d=[s=B(T[0],null,"Parsed")].concat(j),i=e.$r(d),(w=s.$$prototype).critical=w.fumble=w.dollar=w.modify_number=w.question_target=w.target_number=w.prefix_number=w.command=w.suffix_number=w.cmp_op=M,s.$attr_accessor("command"),s.$attr_accessor("prefix_number"),s.$attr_accessor("suffix_number"),s.$attr_accessor("critical"),s.$attr_accessor("fumble"),s.$attr_accessor("dollar"),s.$attr_accessor("modify_number"),s.$attr_accessor("cmp_op"),s.$attr_accessor("target_number"),s.$attr_writer("question_target"),c(s,"$initialize",function(){var a=this;return a.prefix_number=M,a.suffix_number=M,a.critical=M,a.fumble=M,a.dollar=M,a.cmp_op=M,a.target_number=M,a.question_target=!1}),c(s,"$question_target?",A("question_target")),c(s,"$to_s",function(a){var m=this,P=M,E=M,y=M,l=M,g=M;switch(null==a&&(a="after_command"),P=R(m.critical)?"@"+m.critical:M,E=R(m.fumble)?"#"+m.fumble:M,y=R(m.dollar)?"$"+m.dollar:M,l=i("Format").$modifier(m.modify_number),g=R(m.question_target)?"?":m.target_number,a.valueOf()){case"after_command":return[m.prefix_number,m.command,m.suffix_number,P,E,y,l,m.cmp_op,g].$join();case"after_modify_number":return[m.prefix_number,m.command,m.suffix_number,l,P,E,y,m.cmp_op,g].$join();case"after_target_number":return[m.prefix_number,m.command,m.suffix_number,l,m.cmp_op,g,P,E,y].$join();default:return M}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var a,y,b,D,n,o,$,W,Q,Y,re,$e,ue,_,v,t,se,g,f,P,U=e.klass,B=e.module,c=e.slice,A=e.extract_kwargs,R=e.ensure_kwargs,C=e.get_kwarg,M=e.send2,q=e.find_super,S=e.def,N=e.send,x=e.eqeq,H=e.thrower,G=e.hash,L=e.const_set,T=e.truthy,k=e.to_ary,K=e.hash2,j=e.top,s=[],d=e.$r(s),i=e.nil,w=e.$$$;return j.$require("racc/parser.rb"),j.$require("bcdice/arithmetic/node"),j.$require("bcdice/command/lexer"),j.$require("bcdice/command/parsed"),U(w(d("BCDice"),"Command"),w(d("Racc"),"Parser"),"Parser"),a=s,y=P=[B(s[0],"BCDice")].concat(a),g=[B(P[0],"Command")].concat(y),f=e.$r(g),b=g,v=[_=U(g[0],w(f("Racc"),"Parser"),"Parser")].concat(b),t=e.$r(v),(se=_.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=i,S(_,"$initialize",function V(h,Z){var X,z,O,ne,J=this;return V.$$p=null,X=c(arguments),z=A(X),z=R(z),O=X,ne=C(z,"round_type"),M(J,q(J,"initialize",V,!1,!0),"initialize",[],null),J.notations=O,J.round_type=ne,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[i,">=",">","<=","<","==","!="],J.question_target=!1},-2),S(_,"$disable_modifier",function(){return this.modifier=!1,this}),S(_,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),S(_,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),S(_,"$has_prefix_number",function(){var h=this;return h.prefix_number=!0,h.need_prefix_number=!0,h}),S(_,"$has_suffix_number",function(){var h=this;return h.suffix_number=!0,h.need_suffix_number=!0,h}),S(_,"$enable_critical",function(){return this.critical=!0,this}),S(_,"$enable_fumble",function(){return this.fumble=!0,this}),S(_,"$enable_dollar",function(){return this.dollar=!0,this}),S(_,"$restrict_cmp_op_to",function(h){var Z;return Z=c(arguments),this.allowed_cmp_op=Z,this},-1),S(_,"$enable_question_target",function(){return this.question_target=!0,this}),S(_,"$parse",function(h){var Z=this;try{return Z.lexer=t("Lexer").$new(h,Z.notations),Z.$do_parse()}catch(X){if(!e.rescue(X,[t("ParseError"),t("ZeroDivisionError")]))throw X;try{return i}finally{e.pop_exception()}}}),_.$private(),S(_,"$parsed",function(h,Z,X,z){try{return H("eval_return"),N(t("Parsed").$new(),"tap",[],function ee(J){var ce,le,de,me,ve,fe,be,oe=null==ee.$$s?this:ee.$$s;return null==oe.round_type&&(oe.round_type=i),null==J&&(J=i),J["$command="](h["$[]"]("command")),J["$prefix_number="]((ce=h["$[]"]("prefix"))===i||null==ce?i:ce.$eval(oe.round_type)),J["$suffix_number="]((le=h["$[]"]("suffix"))===i||null==le?i:le.$eval(oe.round_type)),J["$critical="]((de=Z["$[]"]("critical"))===i||null==de?i:de.$eval(oe.round_type)),J["$fumble="]((me=Z["$[]"]("fumble"))===i||null==me?i:me.$eval(oe.round_type)),J["$dollar="]((ve=Z["$[]"]("dollar"))===i||null==ve?i:ve.$eval(oe.round_type)),J["$modify_number="](X.$eval(oe.round_type)),J["$cmp_op="](z["$[]"]("cmp_op")),x(z["$[]"]("target"),"?")?(J["$question_target="](!0),N(J,"target_number=",fe=[0]),fe[fe.length-1]):(J["$question_target="](!1),fe=[(be=z["$[]"]("target"),be===i||null==be?i:be.$eval(oe.round_type))],N(J,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),S(_,"$next_token",function(){return this.lexer.$next_token()}),D=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),n=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),o=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),$=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),W=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),Q=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),Y=[i,6,13,3,9,-1,27,-15,-10,-1,-38],re=[i,i,i,i,i,i,19,16,15,i,i],$e=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ue=G(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),L(v[0],"Racc_arg",[D,n,$,o,W,Q,re,Y,19,$e,ue,58,35,!0]),T(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_arg")),L(v[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),T(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),L(v[0],"Racc_debug_parser",!1),S(_,"$_reduce_1",function(h,Z,X){var z;return T(this.modifier)||this.$raise(t("ParseError")),z=k(h),this.$parsed(null==z[0]?i:z[0],null==z[1]?i:z[1],null==z[2]?i:z[2],null==z[3]?i:z[3])}),S(_,"$_reduce_2",function(h,Z,X){var z;return T(this.modifier)||this.$raise(t("ParseError")),z=k(h),this.$parsed(null==z[0]?i:z[0],null==z[2]?i:z[2],null==z[1]?i:z[1],null==z[3]?i:z[3])}),S(_,"$_reduce_3",function(h,Z,X){var z,ce;return ce=null==(z=k(h))[2]?i:z[2],this.$parsed(null==z[0]?i:z[0],null==z[1]?i:z[1],w(w(t("Arithmetic"),"Node"),"Number").$new(0),ce)}),S(_,"$_reduce_4",function(h,Z,X){var z=this;return T(z.prefix_number)&&T(z.suffix_number)||z.$raise(t("ParseError")),K(["command","prefix","suffix"],{command:h["$[]"](1),prefix:h["$[]"](0),suffix:h["$[]"](2)})}),S(_,"$_reduce_5",function(h,Z,X){var z=this;return T(z.prefix_number)||z.$raise(t("ParseError")),T(z.need_suffix_number)&&z.$raise(t("ParseError")),K(["command","prefix"],{command:h["$[]"](1),prefix:h["$[]"](0)})}),S(_,"$_reduce_6",function(h,Z,X){var z=this;return T(z.suffix_number)||z.$raise(t("ParseError")),T(z.need_prefix_number)&&z.$raise(t("ParseError")),K(["command","suffix"],{command:h["$[]"](0),suffix:h["$[]"](1)})}),S(_,"$_reduce_7",function(h,Z,X){var z=this;return(T(z.need_prefix_number)||T(z.need_suffix_number))&&z.$raise(t("ParseError")),K(["command"],{command:h["$[]"](0)})}),S(_,"$_reduce_8",function(h,Z,X){return K([],{})}),S(_,"$_reduce_9",function(h,Z,X){var z,ce,ee=i;return ee=null==(z=k(h))[0]?i:z[0],ce=null==z[2]?i:z[2],T(this.critical)&&T(ee["$[]"]("critical")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("critical",ce),ee}),S(_,"$_reduce_10",function(h,Z,X){var z,ce,ee=i;return ee=null==(z=k(h))[0]?i:z[0],ce=null==z[2]?i:z[2],T(this.fumble)&&T(ee["$[]"]("fumble")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("fumble",ce),ee}),S(_,"$_reduce_11",function(h,Z,X){var z,ce,ee=i;return ee=null==(z=k(h))[0]?i:z[0],ce=null==z[2]?i:z[2],T(this.dollar)&&T(ee["$[]"]("dollar")["$nil?"]())||this.$raise(t("ParseError")),ee["$[]="]("dollar",ce),ee}),S(_,"$_reduce_12",function(h,Z,X){return h["$[]"](1)}),S(_,"$_reduce_13",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"Negative").$new(h["$[]"](1))}),S(_,"$_reduce_14",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"BinaryOp").$new(h["$[]"](0),"+",h["$[]"](2))}),S(_,"$_reduce_15",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"BinaryOp").$new(h["$[]"](0),"-",h["$[]"](2))}),S(_,"$_reduce_16",function(h,Z,X){return T(this.allowed_cmp_op["$include?"](i))||this.$raise(t("ParseError")),K([],{})}),S(_,"$_reduce_17",function(h,Z,X){var z,ee,J;return J=null==(z=k(h))[1]?i:z[1],T(this.allowed_cmp_op["$include?"](ee=null==z[0]?i:z[0]))||this.$raise(t("ParseError")),K(["cmp_op","target"],{cmp_op:ee,target:J})}),S(_,"$_reduce_18",function(h,Z,X){var O,z=this;return O=h["$[]"](0),T(z.question_target)||z.$raise(t("ParseError")),T(z.allowed_cmp_op["$include?"](O))||z.$raise(t("ParseError")),K(["cmp_op","target"],{cmp_op:O,target:"?"})}),S(_,"$_reduce_19",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"BinaryOp").$new(h["$[]"](0),"+",h["$[]"](2))}),S(_,"$_reduce_20",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"BinaryOp").$new(h["$[]"](0),"-",h["$[]"](2))}),S(_,"$_reduce_22",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"BinaryOp").$new(h["$[]"](0),"*",h["$[]"](2))}),S(_,"$_reduce_23",function(h,Z,X){return h["$[]"](3).$new(h["$[]"](0),h["$[]"](2))}),S(_,"$_reduce_25",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),S(_,"$_reduce_26",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"DivideWithCeil")}),S(_,"$_reduce_27",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"DivideWithCeil")}),S(_,"$_reduce_28",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"DivideWithRound")}),S(_,"$_reduce_29",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"DivideWithFloor")}),S(_,"$_reduce_30",function(h,Z,X){return h["$[]"](1)}),S(_,"$_reduce_31",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"Negative").$new(h["$[]"](1))}),S(_,"$_reduce_33",function(h,Z,X){return h["$[]"](1)}),S(_,"$_reduce_34",function(h,Z,X){return w(w(t("Arithmetic"),"Node"),"Number").$new(h["$[]"](0))}),S(_,"$_reduce_none",function(h,Z,X){return h["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var N,L,j,s,d,i,k,H,U=e.module,B=e.send,c=e.eqeqeq,A=e.truthy,R=e.def,C=e.return_val,M=[],q=e.nil;return N=M,L=H=[U(M[0],"BCDice")].concat(N),j=k=[U(H[0],"Deprecated")].concat(L),d=[s=U(k[0],"Checker")].concat(j),i=e.$r(d),s.$private(),R(s,"$check_result_legacy",function(r,a,m,P){var g,E=this,y=q,l=q,f=q,p=q;return y=B(a,"map",[],"sides".$to_proc()),g=(l=B(a,"map",[],"value".$to_proc())).$sum(),f=c([100],p=y)?E.$check_1D100(r,g,m,P):c([20],p)?E.$check_1D20(r,g,m,P):c([6,6],p)?E.$check_2D6(r,g,l,m,P):q,(A(f["$nil?"]())||A(f["$empty?"]()))&&(f=c([10],p=y.$uniq())?E.$check_nD10(r,g,l,m,P):c([6],p)?E.$check_nD6(r,g,l,m,P):q,A(f["$nil?"]())||A(f["$empty?"]()))?q:i("Result").$new(f.$delete_prefix(" \uff1e "))}),R(s,"$check_1D100",C(q)),R(s,"$check_1D20",C(q)),R(s,"$check_nD10",C(q)),R(s,"$check_2D6",C(q)),R(s,"$check_nD6",C(q))},Opal.modules["bcdice/base"]=function(e){var d,E,p,F,t,D,u,b,_,I,l,U=e.module,B=e.klass,c=e.slice,A=e.rb_plus,R=e.truthy,C=e.def,M=e.regexp,q=e.send,S=e.thrower,N=e.return_ivar,x=e.assign_ivar_val,H=e.eqeqeq,G=e.eqeq,L=e.return_val,T=e.range,k=e.rb_minus,K=e.rb_divide,j=e.rb_times,s=e.rb_ge,i=e.top,w=[],r=e.$r(w),a=e.nil,m=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),E=w,p=l=[U(w[0],"BCDice")].concat(E),b=[u=B(l[0],null,"Base")].concat(p),_=e.$r(b),(I=u.$$prototype).raw_input=I.randomizer=I.enabled_upcase_input=I.debug=a,t=[F=e.get_singleton_class(u)].concat(b),D=e.$r(t),F.$attr_reader("prefixes"),C(F,"$register_prefix",function(o){var W,Y,Q=this;return null==Q.prefixes&&(Q.prefixes=a),W=c(arguments),Q.prefixes=A(R(Y=Q.prefixes)?Y:[],W.$flatten())},-1),C(F,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),C(F,"$prefixes_pattern",function(){var o=this,$=a;return null==o.prefixes_pattern&&(o.prefixes_pattern=a),null==o.prefixes&&(o.prefixes=a),o.prefixes_pattern=R($=o.prefixes_pattern)?$:a,R(o.prefixes_pattern)?o.prefixes_pattern:(o.prefixes=R($=o.prefixes)?$:[],o.prefixes.$freeze(),o.prefixes_pattern=(R(o.prefixes["$empty?"]())?/(?!)/:M(["^(S)?(",o.prefixes.$join("|"),")"],"i")).$freeze())}),C(F,"$command_pattern",function(){var o=this,$=a,W=a;return null==o.command_pattern&&(o.command_pattern=a),null==o.prefixes&&(o.prefixes=a),o.command_pattern=R($=o.command_pattern)?$:a,R(o.command_pattern)?o.command_pattern:(o.prefixes=R($=o.prefixes)?$:[],o.prefixes.$freeze(),W=A(q(m(D("CommonCommand"),"COMMANDS"),"map",[],function(Y){return null==Y&&(Y=a),m(Y,"PREFIX_PATTERN").$source()}),o.prefixes),o.command_pattern=M(["^S?(",W.$join("|"),")"],"i").$freeze())}),C(F,"$eval",function(o){try{return S("eval_return"),this.$new(o).$eval()}catch(Q){if(Q===e.t_eval_return)return Q.$v;throw Q}}),u.$include(_("Translate")),u.$include(m(_("Deprecated"),"Checker")),C(u,"$initialize",function(v){var t=this;return t.raw_input=v,t.sort_add_dice=!1,t.sort_barabara_dice=!1,t.d66_sort_type=m(_("D66SortType"),"NO_SORT"),t.enabled_d9=!1,t.round_type=m(_("RoundType"),"FLOOR"),t.sides_implicit_d=6,t.upper_dice_reroll_threshold=a,t.reroll_dice_reroll_threshold=a,t.default_cmp_op=a,t.default_target_number=a,t.enabled_upcase_input=!0,t.locale="ja_jp",t.randomizer=m(_("BCDice"),"Randomizer").$new(),t.debug=!1}),u.$attr_accessor("randomizer"),u.$attr_reader("d66_sort_type"),u.$attr_reader("round_type"),u.$attr_reader("sides_implicit_d"),u.$attr_reader("upper_dice_reroll_threshold"),u.$attr_reader("reroll_dice_reroll_threshold"),u.$attr_reader("default_cmp_op"),u.$attr_reader("default_target_number"),C(u,"$sort_add_dice?",N("sort_add_dice")),C(u,"$sort_barabara_dice?",N("sort_barabara_dice")),C(u,"$enabled_d9?",N("enabled_d9")),C(u,"$enable_debug",x("debug",!0)),C(u,"$eval",function(){var t,n,v=this,D=a;return t=m(_("BCDice"),"Preprocessor").$process(v.raw_input,v),D=R(n=v.$dice_command(t))?n:v.$eval_common_command(v.raw_input),R(D)?(D["$rands="](v.randomizer.$rand_results()),D["$detailed_rands="](v.randomizer.$detailed_rand_results()),D):a}),C(u,"$change_text",function(v){return v}),C(u,"$check_result",function(v,t,D,n){var o=this,$=a,W=a,Q=a,Y=a,re=a;return $=o.$check_result_legacy(v,t,D,n),R($)?$:(W=q(t,"map",[],"sides".$to_proc()),Y=(Q=q(t,"map",[],"value".$to_proc())).$sum(),$=H([100],re=W)?o.$result_1d100(v,Y,D,n):H([20],re)?o.$result_1d20(v,Y,D,n):H([6,6],re)?o.$result_2d6(v,Y,Q,D,n):a,G($,_("Result").$nothing())?a:R($)?$:($=H([10],re=W.$uniq())?o.$result_nd10(v,Y,Q,D,n):H([6],re)?o.$result_nd6(v,Y,Q,D,n):a,G($,_("Result").$nothing())?a:R($)?$:o.$result_ndx(v,D,n)))}),C(u,"$grich_text",L(a)),u.$private(),C(u,"$eval_common_command",function(v){try{S("eval_return");var D=S("return");return v=this.$change_text(v),q(m(_("CommonCommand"),"COMMANDS"),"each",[],function o($){var Q,W=null==o.$$s?this:o.$$s;if(null==W.randomizer&&(W.randomizer=a),null==$&&($=a),Q=$.$eval(v,W,W.randomizer),!R(Q))return a;D.$throw(Q)},{$$s:this,$$ret:D}),a}catch(o){if(o===e.t_eval_return||o===D)return o.$v;throw o}}),C(u,"$dice_command",function(v){var t=this,D=a,n=a,o=a,$=a;return R(t.enabled_upcase_input)&&(v=v.$upcase()),D=t.$class().$prefixes_pattern().$match(v),R(D)?(n=D["$[]"](1)["$nil?"]()["$!"](),R(n)&&(v=v["$[]"](T(1,-1,!1))),o=t.$eval_game_system_specific_command(v),R(o["$is_a?"](_("Result")))?(o["$secret="](R($=o["$secret?"]())?$:n),o):R(o["$nil?"]())||R(o["$empty?"]())||G(o,"1")?a:q(_("Result").$new(),"tap",[],function(Q){var Y;return null==Q&&(Q=a),Q["$text="](o.$to_s()),q(Q,"secret=",Y=[n]),Y[Y.length-1]})):a}),C(u,"$eval_game_system_specific_command",L(a)),C(u,"$result_ndx",function(v,t,D){return R(D["$is_a?"](_("String")))?a:R(v.$send(t,D))?_("Result").$success(this.$translate("success")):_("Result").$failure(this.$translate("failure"))}),C(u,"$result_1d100",L(a)),C(u,"$result_1d20",L(a)),C(u,"$result_nd10",L(a)),C(u,"$result_2d6",L(a)),C(u,"$result_nd6",L(a)),C(u,"$get_table_by_2d6",function(v){return this.$get_table_by_nD6(v,2)}),C(u,"$get_table_by_1d6",function(v){return this.$get_table_by_nD6(v,1)}),C(u,"$get_table_by_nD6",function(v,t){return this.$get_table_by_nDx(v,t,6)}),C(u,"$get_table_by_nDx",function(v,t,D){var o,$=a;return o=this.randomizer.$roll_sum(t,D),$=this.$get_table_value(v["$[]"](k(o,t))),R($["$nil?"]())?["1",0]:[$,o]}),C(u,"$get_table_by_1d3",function(v){var n,o,t=this,$=a;return t.$debug("get_table_by_1d3"),n=t.randomizer.$roll_sum(1,6),t.$debug("num",n),o=K(k(n,1),2).$to_i(),t.$debug("index",o),$=v["$[]"](o),R($["$nil?"]())?["1",0]:[$,n]}),C(u,"$get_table_by_d66_swap",function(v){var D;return D=this.randomizer.$roll_d66(m(_("D66SortType"),"ASC")),[this.$get_table_by_number(D,v),D]}),C(u,"$get_table_by_d66",function(v){var D,n,o,W,$=a;return D=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),o=A(j(k(D,1),6),k(n,1)),$=v["$[]"](o),W=""+D+n,R($["$nil?"]())?["1",W]:[$,W]}),C(u,"$get_table_by_number",function(v,t,D){try{var n=S("return");return null==D&&(D="1"),q(t,"each",[],function $(W){var Y,Q=null==$.$$s?this:$.$$s;if(null==W&&(W=a),Y=W["$[]"](0),!R(s(Y,v)))return a;n.$throw(Q.$get_table_value(W["$[]"](1)))},{$$s:this,$$ret:n}),this.$get_table_value(D)}catch($){if($===n)return $.$v;throw $}},-3),C(u,"$get_table_value",function(v){return R(v["$is_a?"](_("Proc")))?v.$call():v}),C(u,"$roll_tables",function(v,t){var n=a;return n=t["$[]"](v),R(n)?n.$roll(this.randomizer).$to_s():a}),C(u,"$debug",function(v,t){var n,o=this,$=a,W=a;return n=c(arguments,1),R(o.debug)?($=R(v["$is_a?"](_("String")))?v:v.$inspect(),R(n["$empty?"]())?o.$warn($):(W=q(n,"map",[],function(Y){return null==Y&&(Y=a),R(Y["$is_a?"](_("String")))?'"'+Y+'"':Y.$inspect()}),o.$warn($+": "+W.$join(", ")))):a},-2),m(m(r("I18n"),"Backend"),"Simple").$include(m(m(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),d=[["ja_jp"]],q(r("I18n").$fallbacks(),"defaults=",d),d[d.length-1]},Opal.queue(function(e){var j,w,y,l,g,f,a,m,d,U=e.module,B=e.klass,c=e.const_set,A=e.hash2,R=e.send2,C=e.find_super,M=e.def,q=e.truthy,S=e.send,N=e.rb_ge,x=e.rb_gt,H=e.rb_plus,L=[],T=e.nil,k=e.$$$;return e.top.$require("bcdice/base"),j=L,w=d=[U(L[0],"BCDice")].concat(j),a=[U(d[0],"GameSystem")].concat(w),m=e.$r(a),y=a,g=[l=B(a[0],m("Base"),"ConvictorDrive")].concat(y),f=e.$r(g),l.$$prototype.randomizer=T,c(g[0],"ID","ConvictorDrive"),c(g[0],"NAME","\u30b3\u30f3\u30f4\u30a3\u30af\u30bf\u30fc\u30fb\u30c9\u30e9\u30a4\u30d6"),c(g[0],"SORT_KEY","\u3053\u3093\u3046\u3044\u304f\u305f\u3042\u3068\u3089\u3044\u3075"),c(g[0],"HELP_MESSAGE","xCD@z>=y: x\u500b\u306e10\u9762\u30c0\u30a4\u30b9\u3067\u76ee\u6a19\u5024y\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30e9\u30a4\u30f3z\u306e\u5224\u5b9a\u3092\u884c\u3046\nSLT: \u6280\u80fd\u30ec\u30d9\u30eb\u8868\u3092\u632f\u308b\nDCT: \u9045\u5ef6\u30a4\u30d9\u30f3\u30c8\u8868\u3092\u632f\u308b\n"),c(g[0],"TABLES",A(["SLT","DCT"],{SLT:k(f("DiceTable"),"Table").$new("\u6280\u80fd\u30e9\u30f3\u30af\u8868","2D10",["\u30e9\u30f3\u30af\u5916","E-","E","E+","D-","D","D+","C-","C","C+","B-","B","B+","A-","A","A+","S-","S","S+"]),DCT:k(f("DiceTable"),"Table").$new("\u9045\u5ef6\u30a4\u30d9\u30f3\u30c8\u8868","1D10",["\u72b6\u6cc1\u9045\u5ef6\u2160\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-1\u3059\u308b\uff09","\u72b6\u6cc1\u9045\u5ef6\u2161\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-1\u3059\u308b\uff09","\u72b6\u6cc1\u9045\u5ef6\u2162\uff08\u5168\u54e1\u306e\u521d\u671f\u30ea\u30bd\u30fc\u30b9\u3092-2\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2160\uff08\u30dc\u30b9\u306e\u653b\u6483\u30c0\u30a4\u30b9\u3092+1d\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2161\uff08\u8105\u5a01\u5ea64\u4ee5\u4e0b\u306e\u30a8\u30cd\u30df\u30fc\u306e\u653b\u6483\u30c0\u30a4\u30b9\u30922\u4f53\u307e\u3067+1d\u3059\u308b\uff09","\u6b66\u88c5\u3092\u8a31\u3059\u2162\uff08\u8105\u5a01\u5ea63\u4ee5\u4e0b\u306e\u30a8\u30cd\u30df\u30fc\u306e\u653b\u6483\u30c0\u30a4\u30b9\u30921\u4f53+2d\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2160\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC\u306eHP\u3092-1\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2161\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC\u306eHP\u3092-1\u3059\u308b\uff09","\u7dca\u6025\u51fa\u6483\u2162\uff08\u30e9\u30f3\u30c0\u30e0\u306aPC2\u4eba\u306eHP\u3092-1\u3059\u308b\uff09","\u7d76\u671b\uff08\u30c0\u30a4\u30b9\u3092\u4e8c\u5ea6\u632f\u308a\u3001\u4e8c\u3064\u9069\u7528\u3059\u308b\uff09"])}).$freeze()),l.$register_prefix("[-+*0-9()]*CD",f("TABLES").$keys()),M(l,"$initialize",function u(b){var I=this;return u.$$p=null,R(I,C(I,"initialize",u,!1,!0),"initialize",[b],null),I.sides_implicit_d=10}),M(l,"$eval_game_system_specific_command",function(b){var I,_=this;return _.$debug("eval_game_system_specific_command Begin"),q(I=_.$roll_command(b))?I:_.$roll_tables(b,f("TABLES"))}),M(l,"$roll_command",function(b){var _,F=T,v=T,t=T,D=T,n=T,o=T,$=T,W=T;return F=k(f("Command"),"Parser").$new("CD",A(["round_type"],{round_type:this.$round_type()})).$has_prefix_number().$enable_critical().$restrict_cmp_op_to(">="),v=F.$parse(b),q(v)?(t=this.randomizer.$roll_barabara(v.$prefix_number(),10),D=q(n=(_=v.$critical())===T||null==_?T:_.$clamp(v.$target_number(),10))?n:10,o=S(t,"count",[],function(Y){return null==Y&&(Y=T),N(Y,v.$target_number())}),$=S(t,"count",[],function(Y){return null==Y&&(Y=T),N(Y,D)}),W=[v.$to_s(),t.$join(","),q(x($,0))?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u6570"+$:T,"\u6210\u529f\u6570"+H(o,$)].$compact().$join(" \uff1e "),S(f("Result").$new(),"tap",[],function(Y){var re;return null==Y&&(Y=T),Y["$success="](x(o,0)),Y["$critical="](x($,0)),S(Y,"text=",re=[W]),re[re.length-1]})):T})})}}]);