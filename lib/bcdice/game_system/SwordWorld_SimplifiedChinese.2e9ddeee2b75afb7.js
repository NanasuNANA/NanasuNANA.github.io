(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[9640],{6224:(Re,xe,ke)=>{ke(3986),Opal.modules["i18n/backend/fallbacks"]=function(e){var W,u,r,n,c,b,Y=e.module,H=e.class_variable_set,_=e.truthy,j=e.class_variable_get,A=e.def,o=e.send,F=e.send2,f=e.find_super,D=e.hash2,U=e.find_block_super,S=e.neqeq,J=e.thrower,V=e.return_val,G=[],M=e.nil,E=e.$$$;return W=G,b=[c=Y(G[0],"I18n")].concat(W),H(b[0],"@@fallbacks",M),u=e.get_singleton_class(c),r=[u].concat(b),n=e.$r(r),A(u,"$fallbacks",function(){var N=M;return H(r[1],"@@fallbacks",_(null!=r[1].$$cvars["@@fallbacks"]?"class variable":M)&&_(N=j(r[1],"@@fallbacks",!1))?N:E(E(n("I18n"),"Locale"),"Fallbacks").$new()),_(N=n("Thread").$current()["$[]"]("i18n_fallbacks"))?N:j(r[1],"@@fallbacks",!1)}),A(u,"$fallbacks=",function(B){var N;return H(r[1],"@@fallbacks",_(B["$is_a?"](n("Array")))?E(E(n("I18n"),"Locale"),"Fallbacks").$new(B):B),N=["i18n_fallbacks",j(r[1],"@@fallbacks",!1)],o(n("Thread").$current(),"[]=",N),N[N.length-1]}),function(u,z){var B,N,p,h,n=[Y(u,"Backend")].concat(z);return B=n,p=[N=Y(n[0],"Fallbacks")].concat(B),h=e.$r(p),A(N,"$translate",function T(y,R,s){try{var d=J("return"),l=T.$$p||M,K=this,q=M,w=M;return T.$$p=null,null==s&&(s=h("EMPTY_HASH")),_(s.$fetch("fallback",!0))?_(s["$[]"]("fallback_in_progress"))?F(K,f(K,"translate",T,!1,!0),"translate",[y,R,s],l):(_(s["$[]"]("default"))&&(q=K["$extract_non_symbol_default!"](s)),w=s.$merge(D(["fallback_in_progress"],{fallback_in_progress:!0})),o(h("I18n").$fallbacks()["$[]"](y),"each",[],function $(I){var t=null==$.$$s?this:$.$$s;null==I&&(I=M);try{return o(t,"catch",["exception"],function m(){var a=null==m.$$s?this:m.$$s,ee=M;if(ee=F(a,U(a,"translate",m.$$def||$.$$def||T,!1,!1),"translate",[I,R,w],null),_(ee["$nil?"]()))return M;S(y.$to_s(),I.$to_s())&&a.$on_fallback(y,I,R,s),d.$throw(ee)},{$$s:t,$$ret:d})}catch(m){if(!e.rescue(m,[E(h("I18n"),"InvalidLocale")]))throw m;try{return M}finally{e.pop_exception()}}},{$$s:K}),_(s["$key?"]("default"))&&_(s["$[]"]("default")["$nil?"]())?M:_(q)?F(K,f(K,"translate",T,!1,!0),"translate",[y,M,s.$merge(D(["default"],{default:q}))],null):K.$throw("exception",E(h("I18n"),"MissingTranslation").$new(y,R,s))):F(K,f(K,"translate",T,!1,!0),"translate",[y,R,s],l)}catch($){if($===d)return $.$v;throw $}},-3),A(N,"$extract_non_symbol_default!",function(y){var s,R=M;return R=[y["$[]"]("default")].$flatten(),s=o(R,"detect",[],function(l){return null==l&&(l=M),l["$is_a?"](h("Symbol"))["$!"]()}),_(s)&&y["$[]="]("default",R["$[]"](0,R.$index(s))),s}),A(N,"$exists?",function T(y,R,s){try{var d=J("return"),l=T.$$p||M,K=this;return T.$$p=null,null==s&&(s=h("EMPTY_HASH")),_(s.$fetch("fallback",!0))?(o(h("I18n").$fallbacks()["$[]"](y),"each",[],function q(w){var $=null==q.$$s?this:q.$$s;null==w&&(w=M);try{if(!_(F($,U($,"exists?",q.$$def||T,!1,!1),"exists?",[w,R],null)))return M;d.$throw(!0)}catch(I){if(!e.rescue(I,[E(h("I18n"),"InvalidLocale")]))throw I;try{return M}finally{e.pop_exception()}}},{$$s:K,$$ret:d}),!1):F(K,f(K,"exists?",T,!1,!0),"exists?",[y,R,s],l)}catch(q){if(q===d)return q.$v;throw q}},-3),N.$private(),A(N,"$on_fallback",V(M))}(b[0],b)},Opal.modules["bcdice/randomizer"]=function(e){var c,g,B,N,p,h,u,z,H=e.klass,_=e.const_set,j=e.def,A=e.truthy,o=e.rb_gt,F=e.rb_plus,f=e.rb_le,D=e.send,U=e.rb_minus,S=e.eqeq,J=e.rb_times,V=e.eqeqeq,G=e.rb_ge,M=[],E=e.nil,i=e.$$$;return c=M,u=[(0,e.module)(M[0],"BCDice")].concat(c),z=e.$r(u),g=u,N=[B=H(u[0],null,"Randomizer")].concat(g),p=e.$r(N),(h=B.$$prototype).rand_results=h.detailed_rand_results=E,_(N[0],"UPPER_LIMIT_DICE_TIMES",200),_(N[0],"UPPER_LIMIT_DICE_SIDES",1e4),_(N[0],"UPPER_LIMIT_RANDS",1e4),j(B,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),B.$attr_reader("rand_results"),B.$attr_reader("detailed_rand_results"),_(N[0],"DetailedRandResult",p("Struct").$new("kind","sides","value")),j(B,"$roll_barabara",function(y,R){var s=this;return A(o(F(s.rand_results.$size(),y),p("UPPER_LIMIT_RANDS")))&&s.$raise(p("TooManyRandsError")),A(f(y,0))||A(o(y,p("UPPER_LIMIT_DICE_TIMES")))?[]:D(p("Array"),"new",[y],function d(){return(null==d.$$s?this:d.$$s).$roll_once(R)},{$$s:s})}),j(B,"$roll_sum",function(y,R){return this.$roll_barabara(y,R).$sum()}),j(B,"$roll_once",function(y){var s=E;return A(f(y,0))||A(o(y,p("UPPER_LIMIT_DICE_SIDES")))?0:(s=this.$rand_inner(y),this.$push_to_detail("normal",y,s),s)}),j(B,"$roll_index",function(y){return U(this.$roll_once(y),1)}),j(B,"$roll_tens_d10",function(){var s,R=E;return R=this.$rand_inner(10),S(R,10)&&(R=0),s=J(R,10),this.$push_to_detail("tens_d10",10,s),s}),j(B,"$roll_d9",function(){var R;return R=U(this.$rand_inner(10),1),this.$push_to_detail("d9",10,R),R}),j(B,"$roll_d66",function(y){var d,s=E;return s=D(p("Array"),"new",[2],function l(){return(null==l.$$s?this:l.$$s).$roll_once(6)},{$$s:this}),V(i(p("D66SortType"),"ASC"),d=y)?s["$sort!"]():V(i(p("D66SortType"),"DESC"),d)&&s["$sort!"]()["$reverse!"](),F(J(s["$[]"](0),10),s["$[]"](1))}),B.$private(),j(B,"$rand_inner",function(y){var s,R=this;return A(G(R.rand_results.$size(),p("UPPER_LIMIT_RANDS")))&&R.$raise(p("TooManyRandsError")),s=R.$random(y),R.rand_results["$<<"]([s,y]),s}),j(B,"$random",function(y){return F(p("Kernel").$rand(y),1)}),j(B,"$push_to_detail",function(y,R,s){var l;return l=p("DetailedRandResult").$new(y,R,s),this.detailed_rand_results.$push(l)}),H(u[0],z("StandardError"),"TooManyRandsError"),E},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var D,V,W,c,b,u,z,M,S,Y=e.module,H=e.klass,_=e.def,j=e.truthy,A=e.return_val,o=[],F=e.nil;return D=o,V=S=[Y(o[0],"BCDice")].concat(D),W=M=[Y(S[0],"DiceTable")].concat(V),b=[c=H(M[0],null,"RollResult")].concat(W),u=e.$r(b),(z=c.$$prototype).table_name=z.value=z.body=F,_(c,"$initialize",function(n,g,B){var N=this;return N.table_name=n,N.value=g,N.body=B}),c.$attr_reader("table_name"),c.$attr_reader("value"),c.$attr_reader("body"),_(c,"$to_s",function(){var n=this;return n.table_name+"("+n.value+") \uff1e "+n.body}),_(c,"$last_body",function(){var n=this;return j(n.body["$is_a?"](u("RollResult")))?n.body.$last_body():n.body}),_(c,"$empty?",A(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var D,V,W,c,b,u,z,M,S,Y=e.module,H=e.klass,_=e.truthy,j=e.def,A=e.rb_minus,o=[],F=e.nil;return D=o,V=S=[Y(o[0],"BCDice")].concat(D),W=M=[Y(S[0],"DiceTable")].concat(V),b=[c=H(M[0],null,"ChainTable")].concat(W),u=e.$r(b),(z=c.$$prototype).times=z.sides=z.items=z.name=F,j(c,"$initialize",function(n,g,B){var N=this,p=F;return N.name=n,N.items=B.$freeze(),p=/(\d+)D(\d+)/i.$match(g),_(p)||N.$raise(u("ArgumentError"),"Unexpected table type: "+g),N.times=p["$[]"](1).$to_i(),N.sides=p["$[]"](2).$to_i()}),j(c,"$roll",function(n){var B,N,g=this,p=F;return B=n.$roll_sum(g.times,g.sides),N=A(B,g.times),p=g.items["$[]"](N),_(p["$respond_to?"]("roll"))&&(p=p.$roll(n)),u("RollResult").$new(g.name,B,p)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var J,E,u,z,r,n,g,W,G,Y=e.module,H=e.klass,_=e.hash2,j=e.defs,A=e.def,o=e.rb_plus,F=e.rb_times,f=e.rb_minus,D=[],U=e.nil;return J=D,E=G=[Y(D[0],"BCDice")].concat(J),u=W=[Y(G[0],"DiceTable")].concat(E),r=[z=H(W[0],null,"D66GridTable")].concat(u),n=e.$r(r),(g=z.$$prototype).name=g.items=U,j(z,"$from_i18n",function(N,p){var T=U;return T=n("I18n").$t(N,_(["locale","raise"],{locale:p,raise:!0})),this.$new(T["$[]"]("name"),T["$[]"]("items"))}),A(z,"$initialize",function(N,p){return this.name=N,this.items=p.$freeze()}),A(z,"$roll",function(N){var h,T,y,R,s;return h=N.$roll_once(6),T=N.$roll_once(6),y=o(F(h,10),T),R=f(h,1),s=f(T,1),n("RollResult").$new(this.name,y,this.items["$[]"](R)["$[]"](s))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var U,G,b,u,z,r,E,i,J,Y=e.module,H=e.klass,_=e.hash2,j=e.defs,A=e.def,F=[],f=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),U=F,G=J=[Y(F[0],"BCDice")].concat(U),E=[Y(J[0],"DiceTable")].concat(G),i=e.$r(E),b=E,z=[u=H(E[0],i("D66GridTable"),"D66HalfGridTable")].concat(b),r=e.$r(z),j(u,"$from_i18n",function(g,B){var p=f;return p=r("I18n").$t(g,_(["locale","raise"],{locale:B,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items_1_2_3"),p["$[]"]("items_4_5_6"))}),A(u,"$initialize",function(g,B,N){return this.name=g,this.items=[B,B,B,N,N,N].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var U,G,b,u,z,r,E,i,J,Y=e.module,H=e.klass,_=e.hash2,j=e.defs,A=e.def,F=[],f=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),U=F,G=J=[Y(F[0],"BCDice")].concat(U),E=[Y(J[0],"DiceTable")].concat(G),i=e.$r(E),b=E,z=[u=H(E[0],i("D66GridTable"),"D66OneThirdTable")].concat(b),r=e.$r(z),j(u,"$from_i18n",function(g,B){var p=f;return p=r("I18n").$t(g,_(["locale","raise"],{locale:B,raise:!0})),this.$new(p["$[]"]("name"),p["$[]"]("items_1_2"),p["$[]"]("items_3_4"),p["$[]"]("items_5_6"))}),A(u,"$initialize",function(g,B,N,p){return this.name=g,this.items=[B,B,N,N,p,p].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var G,W,r,n,g,B,N,b,E,Y=e.module,H=e.klass,_=e.hash2,j=e.defs,A=e.def,o=e.eqeqeq,F=e.rb_plus,f=e.rb_times,D=e.truthy,U=[],S=e.nil,J=e.$$$;return G=U,W=E=[Y(U[0],"BCDice")].concat(G),r=b=[Y(E[0],"DiceTable")].concat(W),g=[n=H(b[0],null,"D66Table")].concat(r),B=e.$r(g),(N=n.$$prototype).sort_type=N.items=N.name=S,j(n,"$from_i18n",function(h,T){var s,R=S;return R=B("I18n").$t(h,_(["locale"],{locale:T})),s=B("D66SortType").$const_get(R["$[]"]("d66_sort_type")),this.$new(R["$[]"]("name"),s,R["$[]"]("items"))}),A(n,"$initialize",function(h,T,y){var R=this;return R.name=h,R.sort_type=T,R.items=y.$freeze()}),A(n,"$roll",function(h){var T=this,y=S,R=S,s=S,d=S;return y=h.$roll_barabara(2,6),o(J(B("D66SortType"),"ASC"),R=T.sort_type)?y["$sort!"]():o(J(B("D66SortType"),"DESC"),R)&&y["$sort!"]()["$reverse!"](),s=F(f(y["$[]"](0),10),y["$[]"](1)),d=D(R=T.items["$[]"](s))?R:T.items["$[]"](s.$to_s()),D(d["$respond_to?"]("roll"))&&(d=d.$roll(h)),B("RollResult").$new(T.name,s,d)}),A(n,"$choice",function(h){return B("RollResult").$new(this.name,h,this.items["$[]"](h))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var M,c,u,z,i,Y=e.module,H=e.klass,_=e.hash2,j=e.send,A=e.to_ary,o=e.rb_plus,F=e.rb_times,f=e.send2,D=e.find_super,U=e.def,J=[],V=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),M=J,c=i=[Y(J[0],"BCDice")].concat(M),u=[Y(i[0],"DiceTable")].concat(c),z=e.$r(u),U(H(u[0],z("D66Table"),"D66LeftRangeTable"),"$initialize",function B(N,p,h){var R;return B.$$p=null,R=_([],{}),j(h,"each",[],function(d){var l,w;return null==d&&(d=V),l=A(d),w=null==l[1]?V:l[1],j(null==l[0]?V:l[0],"each",[],function(I){return null==I&&(I=V),j(w,"each_with_index",[],function(m,a){var ee,te;return null==m&&(m=V),null==a&&(a=V),te=o(F(I,10),o(a,1)),j(R,"[]=",ee=[te,m]),ee[ee.length-1]})})}),f(this,D(this,"initialize",B,!1,!0),"initialize",[N,p,R],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var V,i,z,r,n,g,B,c,M,Y=e.module,H=e.klass,_=e.hash2,j=e.defs,A=e.def,o=e.truthy,F=e.rb_minus,f=e.rb_plus,D=e.rb_times,U=[],S=e.nil;return V=U,i=M=[Y(U[0],"BCDice")].concat(V),z=c=[Y(M[0],"DiceTable")].concat(i),n=[r=H(c[0],null,"D66ParityTable")].concat(z),g=e.$r(n),(B=r.$$prototype).odd=B.even=B.name=S,j(r,"$from_i18n",function(p,h){var y=S;return y=g("I18n").$t(p,_(["locale","raise"],{locale:h,raise:!0})),this.$new(y["$[]"]("name"),y["$[]"]("odd"),y["$[]"]("even"))}),A(r,"$initialize",function(p,h,T){var y=this;return y.name=p,y.odd=h.$freeze(),y.even=T.$freeze()}),A(r,"$roll",function(p){var y,s,d,h=this,T=S;return T=p.$roll_once(6),y=p.$roll_once(6),s=(o(T["$odd?"]())?h.odd:h.even)["$[]"](F(y,1)),d=f(D(T,10),y),g("RollResult").$new(h.name,d,s)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var U,G,c,b,u,z,r,E,J,Y=e.module,H=e.klass,_=e.def,j=e.rb_plus,A=e.rb_times,o=e.send,F=[],f=e.nil;return U=F,G=J=[Y(F[0],"BCDice")].concat(U),c=E=[Y(J[0],"DiceTable")].concat(G),u=[b=H(E[0],null,"D66RangeTable")].concat(c),z=e.$r(u),(r=b.$$prototype).items=r.name=f,_(b,"$initialize",function(g,B){return this.name=g,this.items=B.$freeze()}),_(b,"$roll",function(g){var N,p,h,T=f;return N=g.$roll_once(6),p=g.$roll_once(6),h=j(A(N,10),p),T=o(this.items,"find",[],function(R){return null==R&&(R=f),R["$[]"](0)["$include?"](h)}),z("RollResult").$new(this.name,h,T["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var V,i,z,r,n,g,B,c,M,Y=e.module,H=e.klass,_=e.const_set,j=e.send,A=e.truthy,o=e.def,F=e.eqeqeq,f=e.rb_times,D=e.rb_plus,U=[],S=e.nil;return V=U,i=M=[Y(U[0],"BCDice")].concat(V),z=c=[Y(M[0],"DiceTable")].concat(i),n=[r=H(c[0],null,"RangeTable")].concat(z),g=e.$r(n),(B=r.$$prototype).name=B.items=B.num_of_dice=B.num_of_sides=B.formatter=S,_(n[0],"RollResult",j(g("Struct"),"new",["sum","values","content","formatted"],function N(){return(null==N.$$s?this:N.$$s).$alias_method("to_s","formatted")},{$$s:r})),_(n[0],"Item",g("Struct").$new("range","content")),_(n[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),_(n[0],"DEFAULT_FORMATTER",j(r,"lambda",[],function(p,h){return null==p&&(p=S),null==h&&(h=S),p.$name()+"("+h.$sum()+") \uff1e "+h.$content()})),r.$attr_reader("name"),r.$attr_reader("num_of_dice"),r.$attr_reader("num_of_sides"),o(r,"$initialize",function N(p,h,T){var s,y=N.$$p||S,R=this,d=S;return N.$$p=null,R.name=p.$freeze(),R.formatter=A(s=y)?s:g("DEFAULT_FORMATTER"),d=g("DICE_ROLL_METHOD_RE").$match(h),A(d)||R.$raise(g("ArgumentError"),R.name+": invalid dice roll method: "+h),R.num_of_dice=d["$[]"](1).$to_i(),R.num_of_sides=d["$[]"](2).$to_i(),R.$store(T)}),o(r,"$fetch",function(p){var T,h=this;return T=j(h.items,"find",[],function(R){return null==R&&(R=S),R.$range()["$include?"](p)}),A(T)||h.$raise(g("RangeError"),h.name+": value is out of range: "+p),T}),o(r,"$roll",function(p){var y,h=this,T=S,R=S;return y=(T=p.$roll_barabara(h.num_of_dice,h.num_of_sides)).$sum(),(R=g("RollResult").$new(y,T,h.$fetch(y).$content()))["$formatted="](h.formatter["$[]"](h,R)),R}),r.$private(),o(r,"$store",function(p){var T,y,h=this;return T=j(p,"map",[],function R(s,d){return null==s&&(s=S),null==d&&(d=S),[(null==R.$$s?this:R.$$s).$coerce_to_int_range(s),d]},{$$s:h}),y=j(T,"sort_by",[],function(s,d){return null==s&&(s=S),null==d&&(d=S),s.$min()}),h.$assert_min_sum_is_covered(y),h.$assert_max_sum_is_covered(y),h.$assert_no_gap_or_overlap_in_ranges(y),h.items=j(y,"map",[],function(s,d){return null==s&&(s=S),null==d&&(d=S),g("Item").$new(s,d.$freeze()).$freeze()}).$freeze(),h}),o(r,"$coerce_to_int_range",function(p){var T;return F(g("Integer"),T=p)?g("Range").$new(p,p):F(g("Range"),T)&&A(p.$begin()["$is_a?"](g("Integer")))&&A(p.$end()["$is_a?"](g("Integer")))?p:this.$raise(g("TypeError"),this.name+": "+p+" ("+p.$class()+") must be an Integer or a Range with Integers ")}),o(r,"$assert_min_sum_is_covered",function(p){var T,h=this,y=S;return T=h.num_of_dice,y=p.$first()["$[]"](0),A(y["$include?"](T))||h.$raise(g("RangeError"),h.name+": min value ("+T+") is not covered: "+y),h}),o(r,"$assert_max_sum_is_covered",function(p){var T,h=this,y=S;return T=f(h.num_of_dice,h.num_of_sides),y=p.$last()["$[]"](0),A(y["$include?"](T))||h.$raise(g("RangeError"),h.name+": max value ("+T+") is not covered: "+y),h}),o(r,"$assert_no_gap_or_overlap_in_ranges",function(p){return j(p,"each_cons",[2],function T(y,R){var K,q,s=null==T.$$s?this:T.$$s,d=S,l=S;return null==s.name&&(s.name=S),null==y&&(y=S),null==R&&(R=S),d=y["$[]"](0),l=R["$[]"](0),K=d.$max(),q=D(K,1),A(l["$include?"](K))&&s.$raise(g("RangeError"),s.name+": Range overlap: "+d+" and "+l),A(l["$include?"](q))?S:s.$raise(g("RangeError"),s.name+": Range gap: "+d+" and "+l)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var S,M,b,g,B,N,p,z,i,V,Y=e.module,H=e.klass,_=e.send,j=e.def,A=e.rb_minus,o=e.return_ivar,F=[],f=e.nil,D=e.$$$;return S=F,M=V=[Y(F[0],"BCDice")].concat(S),b=i=[Y(V[0],"DiceTable")].concat(M),g=z=[H(i[0],null,"SaiFicSkillTable")].concat(b),N=[B=H(z[0],null,"Category")].concat(g),p=e.$r(N),j(B,"$initialize",function(T,y,R,s){var d=this;return d.name=T,d.skills=_(y.$map(),"with_index",[2],function(K,q){return null==K&&(K=f),null==q&&(q=f),D(p("SaiFicSkillTable"),"Skill").$new(T,K,R,q,s)}),d.dice=R}),j(B,"$roll",function(T){return this.$skills()["$[]"](A(T.$roll_sum(2,6),2))}),j(B,"$to_s",o("name")),B.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var f,J,i,z,r,c,G,U,Y=e.module,H=e.klass,_=e.def,j=e.hash2,A=[],o=e.nil;return f=A,J=U=[Y(A[0],"BCDice")].concat(f),i=G=[Y(U[0],"DiceTable")].concat(J),c=[H(G[0],null,"SaiFicSkillTable")].concat(i),(r=(z=H(c[0],null,"Skill")).$$prototype).s_format=r.category_dice=r.row_dice=r.category_name=r.name=o,_(z,"$initialize",function(g,B,N,p,h){var T=this;return T.category_name=g,T.name=B,T.category_dice=N,T.row_dice=p,T.s_format=h}),_(z,"$to_s",function(){var g=this;return g.$format(g.s_format,j(["category_dice","row_dice","category_name","skill_name"],{category_dice:g.category_dice,row_dice:g.row_dice,category_name:g.category_name,skill_name:g.name}))}),z.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var c,r,p,h,T,y,R,g,u,Y=e.module,H=e.klass,_=e.ensure_kwargs,j=e.hash2,A=e.send,F=e.defs,f=e.const_set,D=e.to_ary,U=e.def,S=e.truthy,J=e.rb_minus,V=e.rb_plus,G=e.top,M=[],E=e.nil,i=e.$$$;return G.$require("bcdice/dice_table/sai_fic_skill_table/category"),G.$require("bcdice/dice_table/sai_fic_skill_table/skill"),c=M,r=u=[Y(M[0],"BCDice")].concat(c),p=g=[Y(u[0],"DiceTable")].concat(r),T=[h=H(g[0],null,"SaiFicSkillTable")].concat(p),y=e.$r(T),(R=h.$$prototype).rtt=R.rtt_format=R.rct=R.rct_format=R.rttn=R.rttn_format=R.categories=E,F(h,"$from_i18n",function(d,l,K){var q,w,$,a,m=E;return null==(q=(K=_(K)).$$smap.rtt)&&(q=E),null==(w=K.$$smap.rct)&&(w=E),null==($=K.$$smap.rttn)&&($=E),a=(m=y("I18n").$t("RTT",j(["locale","raise","default"],{locale:l,raise:!1,default:j([],{})})).$merge(y("I18n").$t(d,j(["locale","raise"],{locale:l,raise:!0}))))["$[]"]("items"),m=A(m,"select",[],function(te,O){return null==te&&(te=E),null==O&&(O=E),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](te)}),this.$new(a,e.to_hash(m).$merge(j(["rtt","rct","rttn"],{rtt:q,rct:w,rttn:$})))},-3),f(T[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),f(T[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),f(T[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),f(T[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),U(h,"$initialize",function(d,l){var K,q,w,$,I,t,m,a=this;return null==(K=(l=_(l)).$$smap.rtt)&&(K=E),null==(q=l.$$smap.rct)&&(q=E),null==(w=l.$$smap.rttn)&&(w=E),null==($=l.$$smap.rtt_format)&&($=y("DEFAULT_RTT")),null==(I=l.$$smap.rct_format)&&(I=y("DEFAULT_RCT")),null==(t=l.$$smap.rttn_format)&&(t=y("DEFAULT_RTTN")),null==(m=l.$$smap.s_format)&&(m=y("DEFAULT_S")),a.categories=A(d.$map(),"with_index",[1],function(te,O){var _e,oe,se;return null==te&&(te=E),null==O&&(O=E),oe=null==(_e=D(te))[0]?E:_e[0],se=null==_e[1]?E:_e[1],i(y("SaiFicSkillTable"),"Category").$new(oe,se,O,m)},{$$has_top_level_mlhs_arg:!0}),a.rtt=K,a.rct=q,a.rttn=w.$to_a(),a.rtt_format=$,a.rct_format=I,a.rttn_format=t},-2),f(T[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),h.$attr_reader("categories"),U(h,"$roll_command",function(d,l){var q,K=this,w=E,$=E;return S(["RTT",K.rtt]["$include?"](q=l))?K.$format_skill(K.rtt_format,K.$roll_skill(d)):S(["RCT",K.rct]["$include?"](q))?(w=K.$roll_category(d),K.$format(K.rct_format,j(["category_dice","category_name"],{category_dice:w.$dice(),category_name:w.$name()}))):S($=y("RTTN").$index(q))||S($=K.rttn.$index(q))?K.$format_skill(K.rttn_format,K.categories["$[]"]($).$roll(d)):E}),U(h,"$roll_category",function(d){return this.categories["$[]"](J(d.$roll_once(6),1))}),U(h,"$roll_skill",function(d){return this.$roll_category(d).$roll(d)}),U(h,"$prefixes",function(){var d=this;return V(["RTT[1-6]?","RCT",d.rtt,d.rct],d.rttn).$compact()}),h.$private(),U(h,"$format_skill",function(d,l){return this.$format(d,j(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:l.$category_dice(),row_dice:l.$row_dice(),category_name:l.$category_name(),skill_name:l.$name(),text:l.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var S,M,b,u,z,r,n,i,V,Y=e.module,H=e.klass,_=e.hash2,j=e.defs,A=e.truthy,o=e.def,F=e.rb_minus,f=[],D=e.nil;return S=f,M=V=[Y(f[0],"BCDice")].concat(S),b=i=[Y(V[0],"DiceTable")].concat(M),z=[u=H(i[0],null,"Table")].concat(b),r=e.$r(z),(n=u.$$prototype).times=n.sides=n.name=n.items=D,j(u,"$from_i18n",function(B,N){var h=D;return h=r("I18n").$t(B,_(["locale"],{locale:N})),this.$new(h["$[]"]("name"),h["$[]"]("type"),h["$[]"]("items"))}),o(u,"$initialize",function(B,N,p){var h=this,T=D;return h.name=B,h.items=p.$freeze(),T=/(\d+)D(\d+)/i.$match(N),A(T)||h.$raise(r("ArgumentError"),"Unexpected table type: "+N),h.times=T["$[]"](1).$to_i(),h.sides=T["$[]"](2).$to_i()}),o(u,"$roll",function(B){var p,N=this;return p=B.$roll_sum(N.times,N.sides),N.$choice(p)}),o(u,"$choice",function(B){var p,N=this;return p=F(B,N.times),r("RollResult").$new(N.name,B,N.items["$[]"](p))})},Opal.modules["bcdice/dice_table"]=function(e){var Y=e.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var o,U,J,f,Y=e.module,H=e.const_set,_=[];return o=_,U=f=[Y(_[0],"BCDice")].concat(o),J=[Y(f[0],"D66SortType")].concat(U),H(J[0],"NO_SORT","no_sort"),H(J[0],"ASC","asc"),H(J[0],"DESC","desc"),function(D,U){var J=[Y(D,"RoundType")].concat(U);return H(J[0],"CEIL","ceil"),H(J[0],"FLOOR","floor"),H(J[0],"ROUND","round")}(f[0],f)},Opal.modules["bcdice/translate"]=function(e){var U,G,M,E,i,J,Y=e.module,H=e.ensure_kwargs,_=e.kwrestargs,A=e.hash2,o=e.def,F=[],f=e.nil;return U=F,G=J=[Y(F[0],"BCDice")].concat(U),E=[M=Y(J[0],"Translate")].concat(G),i=e.$r(E),o(M,"$translate",function(c,b){var u,z=this;return null==z.locale&&(z.locale=f),b=H(b),u=_(b,{}),i("I18n").$translate(c,A(["locale","raise"],{locale:z.locale,raise:!0}).$merge(e.to_hash(u)))},-2)},Opal.modules["bcdice/result"]=function(e){var M,W,E,U,J,H=e.klass,_=e.send,j=e.def,A=e.return_val,o=e.return_ivar,F=[],f=e.nil;return U=F,M=J=[(0,e.module)(F[0],"BCDice")].concat(U),[E=H(J[0],null,"Result")].concat(M),j(W=e.get_singleton_class(E),"$success",function(u){return _(this.$new(),"tap",[],function(n){var g;return null==n&&(n=f),n["$text="](u),_(n,"success=",g=[!0]),g[g.length-1]})}),j(W,"$failure",function(u){return _(this.$new(),"tap",[],function(n){var g;return null==n&&(n=f),n["$text="](u),_(n,"failure=",g=[!0]),g[g.length-1]})}),j(W,"$critical",function(u){return _(this.$new(),"tap",[],function(n){var g;return null==n&&(n=f),n["$text="](u),n["$critical="](!0),_(n,"success=",g=[!0]),g[g.length-1]})}),j(W,"$fumble",function(u){return _(this.$new(),"tap",[],function(n){var g;return null==n&&(n=f),n["$text="](u),n["$fumble="](!0),_(n,"failure=",g=[!0]),g[g.length-1]})}),j(W,"$nothing",A("nothing")),j(E,"$initialize",function(c){var b=this;return null==c&&(c=f),b.text=c,b.rands=f,b.detailed_rands=f,b.secret=!1,b.success=!1,b.failure=!1,b.critical=!1,b.fumble=!1},-1),E.$attr_accessor("text","rands","detailed_rands"),E.$attr_writer("secret","success","failure","critical","fumble"),j(E,"$secret?",o("secret")),j(E,"$success?",o("success")),j(E,"$failure?",o("failure")),j(E,"$critical?",o("critical")),j(E,"$fumble?",o("fumble")),j(E,"$condition=",function(c){return this.success=c,this.failure=c["$!"]()})},Opal.modules["racc/parser"]=function(e){var B,p,h,Y=e.module,H=e.klass,_=e.truthy,j=e.const_set,A=e.defs,o=e.gvars,F=e.rb_lt,f=e.def,D=e.to_ary,U=e.send,S=e.neqeq,J=e.rb_plus,V=e.eqeq,G=e.rb_ge,M=e.rb_gt,E=e.rb_minus,i=e.rb_le,W=e.rb_times,c=e.assign_ivar_val,u=[],z=e.$r(u),r=e.nil,n=e.$$$;return B=u,p=[Y(u[0],"Racc")].concat(B),h=e.$r(p),H(p[0],h("StandardError"),"ParseError"),_(n("::","ParseError","skip_raise")?"constant":r)||j(u[0],"ParseError",n(z("Racc"),"ParseError")),function(g,B){var s,d,l,K,q,h=[Y(g,"Racc")].concat(B),T=e.$r(h);return _(T("Racc_No_Extensions","skip_raise")?"constant":r)||j(h[0],"Racc_No_Extensions",!1),s=h,l=[d=H(h[0],null,"Parser")].concat(s),K=e.$r(l),(q=d.$$prototype).yydebug=q.racc_debug_out=q.racc_error_status=q.racc_t=q.racc_vstack=q.racc_val=q.racc_state=q.racc_tstack=r,j(l[0],"Racc_Runtime_Version","1.4.6"),j(l[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),j(l[0],"Racc_Runtime_Core_Version_R","1.4.6"),j(l[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),j(l[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),j(l[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),j(l[0],"Racc_Runtime_Core_Version",K("Racc_Runtime_Core_Version_R")),j(l[0],"Racc_Runtime_Core_Revision",K("Racc_Runtime_Core_Revision_R")),j(l[0],"Racc_Runtime_Type","ruby"),A(K("Parser"),"$racc_runtime_type",function(){return K("Racc_Runtime_Type")}),f(d,"$_racc_setup",function(){var $,I,t=this,m=r,a=r;return null==o.stderr&&(o.stderr=r),_(n(t.$class(),"Racc_debug_parser"))||(t.yydebug=!1),_(null!=($=t.yydebug)&&$!==r?"instance-variable":r)||(t.yydebug=!1),_(t.yydebug)&&(_(null!=(I=t.racc_debug_out)&&I!==r?"instance-variable":r)||(t.racc_debug_out=o.stderr),t.racc_debug_out=_(m=t.racc_debug_out)?m:o.stderr),a=n(t.$class(),"Racc_arg"),_(F(a.$size(),14))&&a["$[]="](13,!0),a}),f(d,"$_racc_init_sysvars",function(){var $=this;return $.racc_state=[0],$.racc_tstack=[],$.racc_vstack=[],$.racc_t=r,$.racc_val=r,$.racc_read_next=!0,$.racc_user_yyerror=!1,$.racc_error_status=0}),f(d,"$do_parse",function(){return this.$__send__(K("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),f(d,"$next_token",function(){return this.$raise(K("NotImplementedError"),this.$class()+"#next_token is not defined")}),f(d,"$_racc_do_parse_rb",function($,I){var t,a=this,ee=r,te=r,O=r,_e=r,oe=r,se=r,ue=r,le=r;return t=D($),ee=null==t[0]?r:t[0],te=null==t[1]?r:t[1],O=null==t[2]?r:t[2],_e=null==t[3]?r:t[3],oe=null==t[10]?r:t[10],a.$_racc_init_sysvars(),se=ue=le=r,U(a,"catch",["racc_end_parse"],function ie(){var ae,re,x=null==ie.$$s?this:ie.$$s,Z=r;for(null==x.racc_state&&(x.racc_state=r),null==x.racc_read_next&&(x.racc_read_next=r),null==x.racc_t&&(x.racc_t=r),null==x.yydebug&&(x.yydebug=r),null==x.racc_val&&(x.racc_val=r);_(!0);)for(_(le=_e["$[]"](x.racc_state["$[]"](-1)))?(_(x.racc_read_next)&&S(x.racc_t,0)&&(re=x.$next_token(),ae=D(re),se=null==ae[0]?r:ae[0],x.racc_val=null==ae[1]?r:ae[1],x.racc_t=_(se)?_(Z=oe["$[]"](se))?Z:1:0,_(x.yydebug)&&x.$racc_read_token(x.racc_t,se,x.racc_val),x.racc_read_next=!1),le=J(le,x.racc_t),_(G(le,0))&&_(ue=ee["$[]"](le))&&V(te["$[]"](le),x.racc_state["$[]"](-1))||(ue=O["$[]"](x.racc_state["$[]"](-1)))):ue=O["$[]"](x.racc_state["$[]"](-1));_(ue=x.$_racc_evalact(ue,$)););},{$$s:a})}),f(d,"$yyparse",function($,I){return this.$__send__(K("Racc_YY_Parse_Method"),$,I,this.$_racc_setup(),!0)}),f(d,"$_racc_yyparse_rb",function($,I,t,m){var a,O=r,_e=r,ce=r,oe=r,ue=r,le=r,ie=r;return a=D(t),O=null==a[0]?r:a[0],_e=null==a[1]?r:a[1],ce=null==a[2]?r:a[2],oe=null==a[3]?r:a[3],ue=null==a[10]?r:a[10],this.$_racc_init_sysvars(),le=r,ie=r,U(this,"catch",["racc_end_parse"],function ae(){var re=null==ae.$$s?this:ae.$$s;for(null==re.racc_state&&(re.racc_state=r);!_(ie=oe["$[]"](re.racc_state["$[]"](-1)));)for(;_(le=re.$_racc_evalact(ce["$[]"](re.racc_state["$[]"](-1)),t)););return U($,"__send__",[I],function x(Z,P){var v=null==x.$$s?this:x.$$s,Q=r,k=r;for(null==v.racc_t&&(v.racc_t=r),null==v.racc_state&&(v.racc_state=r),null==v.racc_read_next&&(v.racc_read_next=r),null==Z&&(Z=r),null==P&&(P=r),v.racc_t=_(Z)?_(Q=ue["$[]"](Z))?Q:1:0,v.racc_val=P,v.racc_read_next=!1,ie=J(ie,v.racc_t),_(G(ie,0))&&_(le=O["$[]"](ie))&&V(_e["$[]"](ie),v.racc_state["$[]"](-1))||(le=ce["$[]"](v.racc_state["$[]"](-1)));_(le=v.$_racc_evalact(le,t)););for(;_(_(Q=_(k=(ie=oe["$[]"](v.racc_state["$[]"](-1)))["$!"]())?k:v.racc_read_next["$!"]())?Q:v.racc_t["$=="](0));)for(_(ie)&&_(ie=J(ie,v.racc_t))&&_(G(ie,0))&&_(le=O["$[]"](ie))&&V(_e["$[]"](ie),v.racc_state["$[]"](-1))||(le=ce["$[]"](v.racc_state["$[]"](-1)));_(le=v.$_racc_evalact(le,t)););},{$$s:re})},{$$s:this})}),f(d,"$_racc_evalact",function($,I){var t,ce,a=this,ee=r,te=r,_e=r,oe=r,se=r,ue=r;if(ee=null==(t=D(I))[0]?r:t[0],te=null==t[1]?r:t[1],_e=null==t[3]?r:t[3],ce=null==t[11]?r:t[11],oe=null==t[12]?r:t[12],_(M($,0))&&_(F($,ce)))_(M(a.racc_error_status,0))&&(V(a.racc_t,1)||(a.racc_error_status=E(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push($),a.racc_read_next=!0,_(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(_(F($,0))&&_(M($,oe["$-@"]()))){if(se=U(a,"catch",["racc_jump"],function le(){var ie=null==le.$$s?this:le.$$s;return null==ie.racc_state&&(ie.racc_state=r),ie.racc_state.$push(ie.$_racc_do_reduce(I,$)),!1},{$$s:a}),_(se))switch(se.valueOf()){case 1:return a.racc_user_yyerror=!0,oe["$-@"]();case 2:return ce;default:a.$raise("[Racc Bug] unknown jump code")}}else if(V($,ce))_(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(V($,oe["$-@"]())){switch(a.racc_error_status.valueOf()){case 0:_(I["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:V(a.racc_t,0)&&a.$throw("racc_end_parse",r),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;_(!0)&&!(_(ue=_e["$[]"](a.racc_state["$[]"](-1)))&&(ue=J(ue,1),_(G(ue,0))&&_($=ee["$[]"](ue))&&V(te["$[]"](ue),a.racc_state["$[]"](-1))));)_(i(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",r),a.racc_state.$pop(),a.racc_vstack.$pop(),_(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return $}a.$raise("[Racc Bug] unknown action "+$.$inspect())}return _(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),r}),f(d,"$_racc_do_reduce",function($,I){var t,oe,ue,Z,P,v,L,a=this,te=r,O=r,_e=r,ce=r,se=r,le=r,ie=r,ae=r,re=r,x=r,Q=r,k=r,X=r;return te=null==(t=D($))[4]?r:t[4],O=null==t[5]?r:t[5],_e=null==t[6]?r:t[6],ce=null==t[7]?r:t[7],oe=null==t[8]?r:t[8],se=null==t[9]?r:t[9],ue=null==t[13]?r:t[13],le=a.racc_state,ie=a.racc_vstack,ae=a.racc_tstack,re=W(I,-3),x=se["$[]"](re),Z=se["$[]"](J(re,1)),P=se["$[]"](J(re,2)),v=[],_(a.yydebug)&&(Q=ae["$[]"](x["$-@"](),x)),k=ie["$[]"](x["$-@"](),x),_(a.yydebug)&&ae["$[]="](x["$-@"](),x,v),ie["$[]="](x["$-@"](),x,v),le["$[]="](x["$-@"](),x,v),_(ue)?ie.$push(a.$__send__(P,k,ie,k["$[]"](0))):ie.$push(a.$__send__(P,k,ie)),ae.$push(Z),_(a.yydebug)&&a.$racc_reduce(Q,Z,ae,ie),L=E(Z,oe),_(re=ce["$[]"](L))&&(re=J(re,le["$[]"](-1)),_(G(re,0))&&_(X=te["$[]"](re))&&V(O["$[]"](re),L))?X:_e["$[]"](L)}),f(d,"$on_error",function($,I,t){var a,m=this;return m.$raise(K("ParseError"),m.$sprintf("\nparse error on value %s (%s)",I.$inspect(),_(a=m.$token_to_str($))?a:"?"))}),f(d,"$yyerror",function(){return this.$throw("racc_jump",1)}),f(d,"$yyaccept",function(){return this.$throw("racc_jump",2)}),f(d,"$yyerrok",c("racc_error_status",0)),f(d,"$racc_read_token",function($,I,t){var m=this;return m.racc_debug_out.$print("read    "),m.racc_debug_out.$print(I.$inspect(),"(",m.$racc_token2str($),") "),m.racc_debug_out.$puts(t.$inspect()),m.racc_debug_out.$puts()}),f(d,"$racc_shift",function($,I,t){var m=this;return m.racc_debug_out.$puts("shift   "+m.$racc_token2str($)),m.$racc_print_stacks(I,t),m.racc_debug_out.$puts()}),f(d,"$racc_reduce",function($,I,t,m){var a=this,ee=r;return(ee=a.racc_debug_out).$print("reduce "),_($["$empty?"]())?ee.$print(" <none>"):U($,"each",[],function te(O){return null==O&&(O=r),ee.$print(" ",(null==te.$$s?this:te.$$s).$racc_token2str(O))},{$$s:a}),ee.$puts(" --\x3e "+a.$racc_token2str(I)),a.$racc_print_stacks(t,m),a.racc_debug_out.$puts()}),f(d,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),f(d,"$racc_e_pop",function($,I,t){var m=this;return m.racc_debug_out.$puts("error recovering mode: pop token"),m.$racc_print_states($),m.$racc_print_stacks(I,t),m.racc_debug_out.$puts()}),f(d,"$racc_next_state",function($,I){var t=this;return t.racc_debug_out.$puts("goto    "+$),t.$racc_print_states(I),t.racc_debug_out.$puts()}),f(d,"$racc_print_stacks",function($,I){var m=r;return(m=this.racc_debug_out).$print("        ["),U($,"each_index",[],function a(ee){return null==ee&&(ee=r),m.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str($["$[]"](ee))," ",I["$[]"](ee).$inspect(),")")},{$$s:this}),m.$puts(" ]")}),f(d,"$racc_print_states",function($){var t=r;return(t=this.racc_debug_out).$print("        ["),U($,"each",[],function(a){return null==a&&(a=r),t.$print(" ",a)}),t.$puts(" ]")}),f(d,"$racc_token2str",function($){var t;return _(t=n(this.$class(),"Racc_token_to_s_table")["$[]"]($))?t:this.$raise("[Racc Bug] can't convert token "+$+" to string")}),f(d,"$token_to_str",function($){return n(this.$class(),"Racc_token_to_s_table")["$[]"]($)})}(u[0],u)},Opal.modules["bcdice/arithmetic/node"]=function(e){var c,r,N,s,d,h,T,g,u,Y=e.module,H=e.klass,_=e.def,j=e.thrower,A=e.return_ivar,o=e.send2,F=e.find_super,f=e.eqeq,D=e.const_set,U=e.eqeqeq,S=e.rb_divide,J=e.truthy,V=e.assign_ivar,G=e.alias,M=[],E=e.nil,i=e.$$$;return c=M,r=u=[Y(M[0],"BCDice")].concat(c),N=g=[Y(u[0],"Arithmetic")].concat(r),h=[Y(g[0],"Node")].concat(N),T=e.$r(h),(d=(s=H(h[0],null,"BinaryOp")).$$prototype).lhs=d.rhs=d.op=E,_(s,"$initialize",function(K,q,w){var $=this;return $.lhs=K,$.op=q,$.rhs=w}),_(s,"$eval",function(K){try{j("eval_return");var I,w=this,$=E;return $=w.lhs.$eval(K),I=w.rhs.$eval(K),$.$send(w.op,I)}catch(t){if(t===e.t_eval_return)return t.$v;throw t}}),_(s,"$output",function(){var K=this;return""+K.lhs.$output()+K.op+K.rhs.$output()}),_(s,"$s_exp",function(){var K=this;return"("+K.$op_for_s_exp()+" "+K.lhs.$s_exp()+" "+K.rhs.$s_exp()+")"}),_(s,"$op_for_s_exp",A("op")),function(y,R,s){var d=H(y,R,"DivideBase"),l=[d].concat(s),K=e.$r(l),q=d.$$prototype;q.lhs=q.rhs=q.op=E,_(d,"$initialize",function w($,I){return w.$$p=null,o(this,F(this,"initialize",w,!1,!0),"initialize",[$,"/",I],null)}),_(d,"$eval",function($){try{j("eval_return");var m,a,t=this;return m=t.lhs.$eval($),a=t.rhs.$eval($),f(a,0)&&t.$raise(K("ZeroDivisionError")),t.$divide_and_round(m,a,$)}catch(ee){if(ee===e.t_eval_return)return ee.$v;throw ee}}),_(d,"$output",function w(){var $=w.$$p||E,I=this;return w.$$p=null,""+o(I,F(I,"output",w,!1,!0),"output",[],$)+I.$rounding_method()}),d.$private(),_(d,"$rounding_method",function(){return i(this.$class(),"ROUNDING_METHOD")}),_(d,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),_(d,"$divide_and_round",function($,I,t){return this.$raise(K("NotImplementedError"))})}(h[0],T("BinaryOp"),h),function(y,R,s){var d=H(y,R,"DivideWithGameSystemDefault"),l=[d].concat(s),K=e.$r(l);D(l[0],"ROUNDING_METHOD",""),d.$private(),_(d,"$divide_and_round",function(w,$,I){var t,m=E;return U(i(K("RoundType"),"CEIL"),t=I)?S(w.$to_f(),$).$ceil():U(i(K("RoundType"),"ROUND"),t)?(m=S(w.$to_f(),$),J(m["$negative?"]())?m.$abs().$round()["$-@"]():m.$round()):S(w,$).$floor()})}(h[0],T("DivideBase"),h),function(y,R,s){var d=H(y,R,"DivideWithCeil"),l=[d].concat(s);D(l[0],"ROUNDING_METHOD","C"),d.$private(),_(d,"$divide_and_round",function(q,w,$){return S(q.$to_f(),w).$ceil()})}(h[0],T("DivideBase"),h),function(y,R,s){var d=H(y,R,"DivideWithRound"),l=[d].concat(s);D(l[0],"ROUNDING_METHOD","R"),d.$private(),_(d,"$divide_and_round",function(q,w,$){var I=E;return I=S(q.$to_f(),w),J(I["$negative?"]())?I.$abs().$round()["$-@"]():I.$round()})}(h[0],T("DivideBase"),h),function(y,R,s){var d=H(y,R,"DivideWithFloor"),l=[d].concat(s);D(l[0],"ROUNDING_METHOD","F"),d.$private(),_(d,"$divide_and_round",function(q,w,$){return S(q,w).$floor()})}(h[0],T("DivideBase"),h),function(y,R){var s=H(y,null,"Negative");s.$$prototype.body=E,_(s,"$initialize",V("body")),_(s,"$eval",function(K){try{return j("eval_return"),this.body.$eval(K)["$-@"]()}catch($){if($===e.t_eval_return)return $.$v;throw $}}),_(s,"$output",function(){return"-"+this.body.$output()}),_(s,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(h[0]),function(y,R){var s=H(y,null,"Parenthesis");s.$$prototype.expr=E,_(s,"$initialize",V("expr")),_(s,"$eval",function(K){try{return j("eval_return"),this.expr.$eval(K)}catch($){if($===e.t_eval_return)return $.$v;throw $}}),_(s,"$output",function(){return"("+this.expr.$output()+")"}),_(s,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(h[0]),function(y,R){var s=H(y,null,"Number");return s.$$prototype.value=E,_(s,"$initialize",V("value")),_(s,"$eval",A("value")),_(s,"$output",function(){return this.value.$to_s()}),G(s,"s_exp","output")}(h[0])},Opal.modules.strscan=function(e){var V,G,M,E,i,H=e.def,_=e.truthy,j=e.eqeqeq,A=e.Opal,o=e.return_ivar,F=e.send,f=e.alias,D=[],U=e.nil;return V=D,M=[G=(0,e.klass)(D[0],null,"StringScanner")].concat(V),E=e.$r(M),(i=G.$$prototype).pos=i.string=i.working=i.matched=i.prev_pos=i.match=U,G.$attr_reader("pos","matched"),H(G,"$initialize",function(c){var b=this;return b.string=c,b.pos=0,b.matched=U,b.working=c,b.match=[]}),G.$attr_reader("string"),H(G,"$beginning_of_line?",function(){var c=this;return 0===c.pos||"\n"===c.string.charAt(c.pos-1)}),H(G,"$scan",function(c){var b=this,u=(c=b.$anchor(c)).exec(b.working);return null==u?b.matched=U:(b.prev_pos=b.pos,b.pos+=u[0].length,b.working=b.working.substring(u[0].length),b.matched=u[0],b.match=u,u[0])}),H(G,"$scan_until",function(c){var b=this;c=b.$anchor(c);for(var u=b.working,z=0;u.length!=z;++z){var r=c.exec(u.substr(z));if(null!==r){var n=z+r[0].length,g=u.substr(0,n);return b.matched=r[0],b.match=r,b.prev_pos=b.pos+z,b.pos+=n,b.working=u.substr(n),g}}return b.matched=U}),H(G,"$[]",function(c){var u;if(_(this.match["$empty?"]()))return U;j(E("Symbol"),u=c)?c=c.$to_s():j(E("String"),u)||(c=A["$coerce_to!"](c,E("Integer"),"to_int"));var z=this.match;return c<0&&(c+=z.length),c<0||c>=z.length||null==z[c]?U:z[c]}),H(G,"$check",function(c){var b=this,u=(c=b.$anchor(c)).exec(b.working);return b.matched=null==u?U:u[0]}),H(G,"$check_until",function(c){var b=this,u=b.prev_pos,z=b.pos,r=b.working,n=b.$scan_until(c);return b.prev_pos=u,b.pos=z,b.working=r,n}),H(G,"$peek",function(c){return this.working.substring(0,c)}),H(G,"$eos?",function(){return 0===this.working.length}),H(G,"$exist?",function(c){var u=c.exec(this.working);return null==u?U:0==u.index?0:u.index+1}),H(G,"$skip",function(c){var b=this,u=(c=b.$anchor(c)).exec(b.working);if(null==u)return b.match=[],b.matched=U;var z=u[0],r=z.length;return b.matched=z,b.match=u,b.prev_pos=b.pos,b.pos+=r,b.working=b.working.substring(r),r}),H(G,"$skip_until",function(c){var u=this.$scan_until(c);return u===U?U:(this.matched=u.substr(-1),u.length)}),H(G,"$get_byte",function(){var c=this,b=U;return c.pos<c.string.length?(c.prev_pos=c.pos,c.pos+=1,b=c.matched=c.working.substring(0,1),c.working=c.working.substring(1)):c.matched=U,b}),H(G,"$match?",function(c){var b=this,u=(c=b.$anchor(c)).exec(b.working);return null==u?U:(b.prev_pos=b.pos,u[0].length)}),H(G,"$pos=",function(c){var b=this;return c<0&&(c+=b.string.$length()),b.pos=c,b.working=b.string.slice(c)}),H(G,"$matched_size",function(){return this.matched===U?U:this.matched.length}),H(G,"$post_match",function(){var c=this;return c.matched===U?U:c.string.substr(c.pos)}),H(G,"$pre_match",function(){var c=this;return c.matched===U?U:c.string.substr(0,c.prev_pos)}),H(G,"$reset",function(){var c=this;return c.working=c.string,c.matched=U,c.pos=0}),H(G,"$rest",o("working")),H(G,"$rest?",function(){return 0!==this.working.length}),H(G,"$rest_size",function(){return this.$rest().$size()}),H(G,"$terminate",function(){var c,b=this;return b.match=U,c=[b.string.$length()],F(b,"pos=",c),c[c.length-1]}),H(G,"$unscan",function(){var c=this;return c.pos=c.prev_pos,c.prev_pos=U,c.match=U,c}),f(G,"bol?","beginning_of_line?"),f(G,"getch","get_byte"),G.$private(),H(G,"$anchor",function(c){var b=c.toString().match(/\/([^\/]+)$/);return b=b?b[1]:void 0,new RegExp("^(?:"+c.source+")",b)})},Opal.modules["bcdice/normalize"]=function(e){var f,J,U,Y=e.module,H=e.eqeqeq,_=e.def,j=e.eqeq,A=[],o=e.nil;return f=A,U=[Y(A[0],"BCDice")].concat(f),(J=Y(U[0],"Normalize")).$module_function(),_(J,"$comparison_operator",function(G){var M;return H(/<=|=</,M=G)?"<=":H(/>=|=>/,M)?">=":H(/<>|!=|=!/,M)?"!=":H(/</,M)?"<":H(/>/,M)?">":H(/=/,M)?"==":o}),_(J,"$target_number",function(G){return j(G,"?")?G:G.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var V,i,z,r,n,g,B,c,M,Y=e.module,H=e.klass,_=e.const_set,j=e.hash2,A=e.truthy,o=e.send,F=e.def,f=e.thrower,D=e.top,U=[],S=e.nil;return D.$require("strscan"),D.$require("bcdice/normalize"),V=U,i=M=[Y(U[0],"BCDice")].concat(V),z=c=[Y(M[0],"Command")].concat(i),n=[r=H(c[0],null,"Lexer")].concat(z),g=e.$r(n),(B=r.$$prototype).scanner=B.notations=S,_(n[0],"SYMBOLS",j(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),F(r,"$initialize",function(p,h){var T,y,s;return p=A(s=(T=(y=p)===S||null==y?S:y.$split(" ",2))===S||null==T?S:T.$first())?s:"",this.scanner=g("StringScanner").$new(p),this.notations=o(h,"map",[],function(l){return null==l&&(l=S),A(l["$is_a?"](g("String")))?g("Regexp").$new(l):l})}),F(r,"$next_token",function(){try{var p=f("return"),h=this,T=S,y=S,s=S,d=S;return A(h.scanner["$eos?"]())?[!1,"$"]:(o(h.notations,"each",[],function l(K){var w,q=null==l.$$s?this:l.$$s;if(null==q.scanner&&(q.scanner=S),null==K&&(K=S),w=q.scanner.$scan(K),!A(w))return S;p.$throw(["NOTATION",w])},{$$s:h,$$ret:p}),A(T=h.scanner.$scan(/\d+/))?["NUMBER",T.$to_i()]:A(y=h.scanner.$scan(/[<>!=]+/))?(y=g("Normalize").$comparison_operator(y),[A(y)?"CMP_OP":"ILLEGAL",y]):(s=h.scanner.$getch().$upcase(),[A(d=g("SYMBOLS")["$[]"](s))?d:s.$to_sym(),s]))}catch(l){if(l===p)return l.$v;throw l}}),F(r,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var D,V,W,c,b,u,z,M,S,Y=e.module,H=e.klass,_=e.def,j=e.return_ivar,A=e.truthy,o=[],F=e.nil;return D=o,V=S=[Y(o[0],"BCDice")].concat(D),W=M=[Y(S[0],"Command")].concat(V),b=[c=H(M[0],null,"Parsed")].concat(W),u=e.$r(b),(z=c.$$prototype).critical=z.fumble=z.dollar=z.modify_number=z.question_target=z.target_number=z.prefix_number=z.command=z.suffix_number=z.cmp_op=F,c.$attr_accessor("command"),c.$attr_accessor("prefix_number"),c.$attr_accessor("suffix_number"),c.$attr_accessor("critical"),c.$attr_accessor("fumble"),c.$attr_accessor("dollar"),c.$attr_accessor("modify_number"),c.$attr_accessor("cmp_op"),c.$attr_accessor("target_number"),c.$attr_writer("question_target"),_(c,"$initialize",function(){var n=this;return n.prefix_number=F,n.suffix_number=F,n.critical=F,n.fumble=F,n.dollar=F,n.cmp_op=F,n.target_number=F,n.question_target=!1}),_(c,"$question_target?",j("question_target")),_(c,"$to_s",function(n){var g=this,B=F,N=F,p=F,h=F,T=F;switch(null==n&&(n="after_command"),B=A(g.critical)?"@"+g.critical:F,N=A(g.fumble)?"#"+g.fumble:F,p=A(g.dollar)?"$"+g.dollar:F,h=u("Format").$modifier(g.modify_number),T=A(g.question_target)?"?":g.target_number,n.valueOf()){case"after_command":return[g.prefix_number,g.command,g.suffix_number,B,N,p,h,g.cmp_op,T].$join();case"after_modify_number":return[g.prefix_number,g.command,g.suffix_number,h,B,N,p,g.cmp_op,T].$join();case"after_target_number":return[g.prefix_number,g.command,g.suffix_number,h,g.cmp_op,T,B,N,p].$join();default:return F}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var n,p,d,I,t,m,a,ee,te,O,_e,ce,ue,l,w,$,ae,T,y,B,Y=e.klass,H=e.module,_=e.slice,j=e.extract_kwargs,A=e.ensure_kwargs,o=e.get_kwarg,F=e.send2,f=e.find_super,D=e.def,U=e.send,S=e.eqeq,J=e.thrower,V=e.hash,G=e.const_set,M=e.truthy,E=e.to_ary,i=e.hash2,W=e.top,c=[],b=e.$r(c),u=e.nil,z=e.$$$;return W.$require("racc/parser.rb"),W.$require("bcdice/arithmetic/node"),W.$require("bcdice/command/lexer"),W.$require("bcdice/command/parsed"),Y(z(b("BCDice"),"Command"),z(b("Racc"),"Parser"),"Parser"),n=c,p=B=[H(c[0],"BCDice")].concat(n),T=[H(B[0],"Command")].concat(p),y=e.$r(T),d=T,w=[l=Y(T[0],z(y("Racc"),"Parser"),"Parser")].concat(d),$=e.$r(w),(ae=l.$$prototype).notations=ae.lexer=ae.modifier=ae.suffix_number=ae.prefix_number=ae.need_suffix_number=ae.need_prefix_number=ae.critical=ae.fumble=ae.dollar=ae.allowed_cmp_op=ae.question_target=u,D(l,"$initialize",function re(x,Z){var P,v,Q,k,X=this;return re.$$p=null,P=_(arguments),v=j(P),v=A(v),Q=P,k=o(v,"round_type"),F(X,f(X,"initialize",re,!1,!0),"initialize",[],null),X.notations=Q,X.round_type=k,X.prefix_number=!1,X.suffix_number=!1,X.need_prefix_number=!1,X.need_suffix_number=!1,X.modifier=!0,X.critical=!1,X.fumble=!1,X.dollar=!1,X.allowed_cmp_op=[u,">=",">","<=","<","==","!="],X.question_target=!1},-2),D(l,"$disable_modifier",function(){return this.modifier=!1,this}),D(l,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),D(l,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),D(l,"$has_prefix_number",function(){var x=this;return x.prefix_number=!0,x.need_prefix_number=!0,x}),D(l,"$has_suffix_number",function(){var x=this;return x.suffix_number=!0,x.need_suffix_number=!0,x}),D(l,"$enable_critical",function(){return this.critical=!0,this}),D(l,"$enable_fumble",function(){return this.fumble=!0,this}),D(l,"$enable_dollar",function(){return this.dollar=!0,this}),D(l,"$restrict_cmp_op_to",function(x){var Z;return Z=_(arguments),this.allowed_cmp_op=Z,this},-1),D(l,"$enable_question_target",function(){return this.question_target=!0,this}),D(l,"$parse",function(x){var Z=this;try{return Z.lexer=$("Lexer").$new(x,Z.notations),Z.$do_parse()}catch(P){if(!e.rescue(P,[$("ParseError"),$("ZeroDivisionError")]))throw P;try{return u}finally{e.pop_exception()}}}),l.$private(),D(l,"$parsed",function(x,Z,P,v){try{return J("eval_return"),U($("Parsed").$new(),"tap",[],function L(X){var C,ne,$e,fe,de,me,ve,he=null==L.$$s?this:L.$$s;return null==he.round_type&&(he.round_type=u),null==X&&(X=u),X["$command="](x["$[]"]("command")),X["$prefix_number="]((C=x["$[]"]("prefix"))===u||null==C?u:C.$eval(he.round_type)),X["$suffix_number="]((ne=x["$[]"]("suffix"))===u||null==ne?u:ne.$eval(he.round_type)),X["$critical="](($e=Z["$[]"]("critical"))===u||null==$e?u:$e.$eval(he.round_type)),X["$fumble="]((fe=Z["$[]"]("fumble"))===u||null==fe?u:fe.$eval(he.round_type)),X["$dollar="]((de=Z["$[]"]("dollar"))===u||null==de?u:de.$eval(he.round_type)),X["$modify_number="](P.$eval(he.round_type)),X["$cmp_op="](v["$[]"]("cmp_op")),S(v["$[]"]("target"),"?")?(X["$question_target="](!0),U(X,"target_number=",me=[0]),me[me.length-1]):(X["$question_target="](!1),me=[(ve=v["$[]"]("target"),ve===u||null==ve?u:ve.$eval(he.round_type))],U(X,"target_number=",me),me[me.length-1])},{$$s:this})}catch(L){if(L===e.t_eval_return)return L.$v;throw L}}),D(l,"$next_token",function(){return this.lexer.$next_token()}),I=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),t=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),m=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),a=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),ee=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),te=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),O=[u,6,13,3,9,-1,27,-15,-10,-1,-38],_e=[u,u,u,u,u,u,19,16,15,u,u],ce=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),ue=V(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),G(w[0],"Racc_arg",[I,t,a,m,ee,te,_e,O,19,ce,ue,58,35,!0]),M($("Ractor","skip_raise")?"constant":u)&&$("Ractor").$make_shareable($("Racc_arg")),G(w[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),M($("Ractor","skip_raise")?"constant":u)&&$("Ractor").$make_shareable($("Racc_token_to_s_table")),G(w[0],"Racc_debug_parser",!1),D(l,"$_reduce_1",function(x,Z,P){var v,k=this;return M(k.modifier)||k.$raise($("ParseError")),v=E(x),k.$parsed(null==v[0]?u:v[0],null==v[1]?u:v[1],null==v[2]?u:v[2],null==v[3]?u:v[3])}),D(l,"$_reduce_2",function(x,Z,P){var v,k=this;return M(k.modifier)||k.$raise($("ParseError")),v=E(x),k.$parsed(null==v[0]?u:v[0],null==v[2]?u:v[2],null==v[1]?u:v[1],null==v[3]?u:v[3])}),D(l,"$_reduce_3",function(x,Z,P){var v,C;return C=null==(v=E(x))[2]?u:v[2],this.$parsed(null==v[0]?u:v[0],null==v[1]?u:v[1],z(z($("Arithmetic"),"Node"),"Number").$new(0),C)}),D(l,"$_reduce_4",function(x,Z,P){var v=this;return M(v.prefix_number)&&M(v.suffix_number)||v.$raise($("ParseError")),i(["command","prefix","suffix"],{command:x["$[]"](1),prefix:x["$[]"](0),suffix:x["$[]"](2)})}),D(l,"$_reduce_5",function(x,Z,P){var v=this;return M(v.prefix_number)||v.$raise($("ParseError")),M(v.need_suffix_number)&&v.$raise($("ParseError")),i(["command","prefix"],{command:x["$[]"](1),prefix:x["$[]"](0)})}),D(l,"$_reduce_6",function(x,Z,P){var v=this;return M(v.suffix_number)||v.$raise($("ParseError")),M(v.need_prefix_number)&&v.$raise($("ParseError")),i(["command","suffix"],{command:x["$[]"](0),suffix:x["$[]"](1)})}),D(l,"$_reduce_7",function(x,Z,P){var v=this;return(M(v.need_prefix_number)||M(v.need_suffix_number))&&v.$raise($("ParseError")),i(["command"],{command:x["$[]"](0)})}),D(l,"$_reduce_8",function(x,Z,P){return i([],{})}),D(l,"$_reduce_9",function(x,Z,P){var v,C,L=u;return L=null==(v=E(x))[0]?u:v[0],C=null==v[2]?u:v[2],M(this.critical)&&M(L["$[]"]("critical")["$nil?"]())||this.$raise($("ParseError")),L["$[]="]("critical",C),L}),D(l,"$_reduce_10",function(x,Z,P){var v,C,L=u;return L=null==(v=E(x))[0]?u:v[0],C=null==v[2]?u:v[2],M(this.fumble)&&M(L["$[]"]("fumble")["$nil?"]())||this.$raise($("ParseError")),L["$[]="]("fumble",C),L}),D(l,"$_reduce_11",function(x,Z,P){var v,C,L=u;return L=null==(v=E(x))[0]?u:v[0],C=null==v[2]?u:v[2],M(this.dollar)&&M(L["$[]"]("dollar")["$nil?"]())||this.$raise($("ParseError")),L["$[]="]("dollar",C),L}),D(l,"$_reduce_12",function(x,Z,P){return x["$[]"](1)}),D(l,"$_reduce_13",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),D(l,"$_reduce_14",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),D(l,"$_reduce_15",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),D(l,"$_reduce_16",function(x,Z,P){return M(this.allowed_cmp_op["$include?"](u))||this.$raise($("ParseError")),i([],{})}),D(l,"$_reduce_17",function(x,Z,P){var v,L,X;return X=null==(v=E(x))[1]?u:v[1],M(this.allowed_cmp_op["$include?"](L=null==v[0]?u:v[0]))||this.$raise($("ParseError")),i(["cmp_op","target"],{cmp_op:L,target:X})}),D(l,"$_reduce_18",function(x,Z,P){var Q,v=this;return Q=x["$[]"](0),M(v.question_target)||v.$raise($("ParseError")),M(v.allowed_cmp_op["$include?"](Q))||v.$raise($("ParseError")),i(["cmp_op","target"],{cmp_op:Q,target:"?"})}),D(l,"$_reduce_19",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"+",x["$[]"](2))}),D(l,"$_reduce_20",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"-",x["$[]"](2))}),D(l,"$_reduce_22",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"BinaryOp").$new(x["$[]"](0),"*",x["$[]"](2))}),D(l,"$_reduce_23",function(x,Z,P){return x["$[]"](3).$new(x["$[]"](0),x["$[]"](2))}),D(l,"$_reduce_25",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),D(l,"$_reduce_26",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"DivideWithCeil")}),D(l,"$_reduce_27",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"DivideWithCeil")}),D(l,"$_reduce_28",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"DivideWithRound")}),D(l,"$_reduce_29",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"DivideWithFloor")}),D(l,"$_reduce_30",function(x,Z,P){return x["$[]"](1)}),D(l,"$_reduce_31",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"Negative").$new(x["$[]"](1))}),D(l,"$_reduce_33",function(x,Z,P){return x["$[]"](1)}),D(l,"$_reduce_34",function(x,Z,P){return z(z($("Arithmetic"),"Node"),"Number").$new(x["$[]"](0))}),D(l,"$_reduce_none",function(x,Z,P){return x["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var U,G,W,c,b,u,E,J,Y=e.module,H=e.send,_=e.eqeqeq,j=e.truthy,A=e.def,o=e.return_val,F=[],f=e.nil;return U=F,G=J=[Y(F[0],"BCDice")].concat(U),W=E=[Y(J[0],"Deprecated")].concat(G),b=[c=Y(E[0],"Checker")].concat(W),u=e.$r(b),c.$private(),A(c,"$check_result_legacy",function(r,n,g,B){var T,N=this,p=f,h=f,y=f,R=f;return p=H(n,"map",[],"sides".$to_proc()),T=(h=H(n,"map",[],"value".$to_proc())).$sum(),y=_([100],R=p)?N.$check_1D100(r,T,g,B):_([20],R)?N.$check_1D20(r,T,g,B):_([6,6],R)?N.$check_2D6(r,T,h,g,B):f,(j(y["$nil?"]())||j(y["$empty?"]()))&&(y=_([10],R=p.$uniq())?N.$check_nD10(r,T,h,g,B):_([6],R)?N.$check_nD6(r,T,h,g,B):f,j(y["$nil?"]())||j(y["$empty?"]()))?f:u("Result").$new(y.$delete_prefix(" \uff1e "))}),A(c,"$check_1D100",o(f)),A(c,"$check_1D20",o(f)),A(c,"$check_nD10",o(f)),A(c,"$check_2D6",o(f)),A(c,"$check_nD6",o(f))},Opal.modules["bcdice/base"]=function(e){var b,N,R,q,$,I,s,d,l,K,h,Y=e.module,H=e.klass,_=e.slice,j=e.rb_plus,A=e.truthy,o=e.def,F=e.regexp,f=e.send,D=e.thrower,U=e.return_ivar,S=e.assign_ivar_val,J=e.eqeqeq,V=e.eqeq,G=e.return_val,M=e.range,E=e.rb_minus,i=e.rb_divide,W=e.rb_times,c=e.rb_ge,u=e.top,z=[],r=e.$r(z),n=e.nil,g=e.$$$;return u.$require("i18n"),u.$require("i18n/backend/fallbacks"),u.$require("bcdice/randomizer"),u.$require("bcdice/dice_table"),u.$require("bcdice/enum"),u.$require("bcdice/translate"),u.$require("bcdice/result"),u.$require("bcdice/command/parser"),u.$require("bcdice/deprecated/checker"),N=z,R=h=[Y(z[0],"BCDice")].concat(N),d=[s=H(h[0],null,"Base")].concat(R),l=e.$r(d),(K=s.$$prototype).raw_input=K.randomizer=K.enabled_upcase_input=K.debug=n,$=[q=e.get_singleton_class(s)].concat(d),I=e.$r($),q.$attr_reader("prefixes"),o(q,"$register_prefix",function(m){var ee,O;return null==this.prefixes&&(this.prefixes=n),ee=_(arguments),this.prefixes=j(A(O=this.prefixes)?O:[],ee.$flatten())},-1),o(q,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),o(q,"$prefixes_pattern",function(){var m=this,a=n;return null==m.prefixes_pattern&&(m.prefixes_pattern=n),null==m.prefixes&&(m.prefixes=n),m.prefixes_pattern=A(a=m.prefixes_pattern)?a:n,A(m.prefixes_pattern)?m.prefixes_pattern:(m.prefixes=A(a=m.prefixes)?a:[],m.prefixes.$freeze(),m.prefixes_pattern=(A(m.prefixes["$empty?"]())?/(?!)/:F(["^(S)?(",m.prefixes.$join("|"),")"],"i")).$freeze())}),o(q,"$command_pattern",function(){var m=this,a=n,ee=n;return null==m.command_pattern&&(m.command_pattern=n),null==m.prefixes&&(m.prefixes=n),m.command_pattern=A(a=m.command_pattern)?a:n,A(m.command_pattern)?m.command_pattern:(m.prefixes=A(a=m.prefixes)?a:[],m.prefixes.$freeze(),ee=j(f(g(I("CommonCommand"),"COMMANDS"),"map",[],function(O){return null==O&&(O=n),g(O,"PREFIX_PATTERN").$source()}),m.prefixes),m.command_pattern=F(["^S?(",ee.$join("|"),")"],"i").$freeze())}),o(q,"$eval",function(m){try{return D("eval_return"),this.$new(m).$eval()}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),s.$include(l("Translate")),s.$include(g(l("Deprecated"),"Checker")),o(s,"$initialize",function(w){var $=this;return $.raw_input=w,$.sort_add_dice=!1,$.sort_barabara_dice=!1,$.d66_sort_type=g(l("D66SortType"),"NO_SORT"),$.enabled_d9=!1,$.round_type=g(l("RoundType"),"FLOOR"),$.sides_implicit_d=6,$.upper_dice_reroll_threshold=n,$.reroll_dice_reroll_threshold=n,$.default_cmp_op=n,$.default_target_number=n,$.enabled_upcase_input=!0,$.locale="ja_jp",$.randomizer=g(l("BCDice"),"Randomizer").$new(),$.debug=!1}),s.$attr_accessor("randomizer"),s.$attr_reader("d66_sort_type"),s.$attr_reader("round_type"),s.$attr_reader("sides_implicit_d"),s.$attr_reader("upper_dice_reroll_threshold"),s.$attr_reader("reroll_dice_reroll_threshold"),s.$attr_reader("default_cmp_op"),s.$attr_reader("default_target_number"),o(s,"$sort_add_dice?",U("sort_add_dice")),o(s,"$sort_barabara_dice?",U("sort_barabara_dice")),o(s,"$enabled_d9?",U("enabled_d9")),o(s,"$enable_debug",S("debug",!0)),o(s,"$eval",function(){var $,t,w=this,I=n;return $=g(l("BCDice"),"Preprocessor").$process(w.raw_input,w),I=A(t=w.$dice_command($))?t:w.$eval_common_command(w.raw_input),A(I)?(I["$rands="](w.randomizer.$rand_results()),I["$detailed_rands="](w.randomizer.$detailed_rand_results()),I):n}),o(s,"$change_text",function(w){return w}),o(s,"$check_result",function(w,$,I,t){var m=this,a=n,ee=n,te=n,O=n,_e=n;return a=m.$check_result_legacy(w,$,I,t),A(a)?a:(ee=f($,"map",[],"sides".$to_proc()),O=(te=f($,"map",[],"value".$to_proc())).$sum(),a=J([100],_e=ee)?m.$result_1d100(w,O,I,t):J([20],_e)?m.$result_1d20(w,O,I,t):J([6,6],_e)?m.$result_2d6(w,O,te,I,t):n,V(a,l("Result").$nothing())?n:A(a)?a:(a=J([10],_e=ee.$uniq())?m.$result_nd10(w,O,te,I,t):J([6],_e)?m.$result_nd6(w,O,te,I,t):n,V(a,l("Result").$nothing())?n:A(a)?a:m.$result_ndx(w,I,t)))}),o(s,"$grich_text",G(n)),s.$private(),o(s,"$eval_common_command",function(w){try{D("eval_return");var I=D("return");return w=this.$change_text(w),f(g(l("CommonCommand"),"COMMANDS"),"each",[],function m(a){var te,ee=null==m.$$s?this:m.$$s;if(null==ee.randomizer&&(ee.randomizer=n),null==a&&(a=n),te=a.$eval(w,ee,ee.randomizer),!A(te))return n;I.$throw(te)},{$$s:this,$$ret:I}),n}catch(m){if(m===e.t_eval_return||m===I)return m.$v;throw m}}),o(s,"$dice_command",function(w){var $=this,I=n,t=n,m=n,a=n;return A($.enabled_upcase_input)&&(w=w.$upcase()),I=$.$class().$prefixes_pattern().$match(w),A(I)?(t=I["$[]"](1)["$nil?"]()["$!"](),A(t)&&(w=w["$[]"](M(1,-1,!1))),m=$.$eval_game_system_specific_command(w),A(m["$is_a?"](l("Result")))?(m["$secret="](A(a=m["$secret?"]())?a:t),m):A(m["$nil?"]())||A(m["$empty?"]())||V(m,"1")?n:f(l("Result").$new(),"tap",[],function(te){var O;return null==te&&(te=n),te["$text="](m.$to_s()),f(te,"secret=",O=[t]),O[O.length-1]})):n}),o(s,"$eval_game_system_specific_command",G(n)),o(s,"$result_ndx",function(w,$,I){return A(I["$is_a?"](l("String")))?n:A(w.$send($,I))?l("Result").$success(this.$translate("success")):l("Result").$failure(this.$translate("failure"))}),o(s,"$result_1d100",G(n)),o(s,"$result_1d20",G(n)),o(s,"$result_nd10",G(n)),o(s,"$result_2d6",G(n)),o(s,"$result_nd6",G(n)),o(s,"$get_table_by_2d6",function(w){return this.$get_table_by_nD6(w,2)}),o(s,"$get_table_by_1d6",function(w){return this.$get_table_by_nD6(w,1)}),o(s,"$get_table_by_nD6",function(w,$){return this.$get_table_by_nDx(w,$,6)}),o(s,"$get_table_by_nDx",function(w,$,I){var m,a=n;return m=this.randomizer.$roll_sum($,I),a=this.$get_table_value(w["$[]"](E(m,$))),A(a["$nil?"]())?["1",0]:[a,m]}),o(s,"$get_table_by_1d3",function(w){var t,m,$=this,a=n;return $.$debug("get_table_by_1d3"),t=$.randomizer.$roll_sum(1,6),$.$debug("num",t),m=i(E(t,1),2).$to_i(),$.$debug("index",m),a=w["$[]"](m),A(a["$nil?"]())?["1",0]:[a,t]}),o(s,"$get_table_by_d66_swap",function(w){var I;return I=this.randomizer.$roll_d66(g(l("D66SortType"),"ASC")),[this.$get_table_by_number(I,w),I]}),o(s,"$get_table_by_d66",function(w){var I,t,m,ee,a=n;return I=this.randomizer.$roll_once(6),t=this.randomizer.$roll_once(6),m=j(W(E(I,1),6),E(t,1)),a=w["$[]"](m),ee=""+I+t,A(a["$nil?"]())?["1",ee]:[a,ee]}),o(s,"$get_table_by_number",function(w,$,I){try{var t=D("return");return null==I&&(I="1"),f($,"each",[],function a(ee){var O,te=null==a.$$s?this:a.$$s;if(null==ee&&(ee=n),O=ee["$[]"](0),!A(c(O,w)))return n;t.$throw(te.$get_table_value(ee["$[]"](1)))},{$$s:this,$$ret:t}),this.$get_table_value(I)}catch(a){if(a===t)return a.$v;throw a}},-3),o(s,"$get_table_value",function(w){return A(w["$is_a?"](l("Proc")))?w.$call():w}),o(s,"$roll_tables",function(w,$){var t=n;return t=$["$[]"](w),A(t)?t.$roll(this.randomizer).$to_s():n}),o(s,"$debug",function(w,$){var t,m=this,a=n,ee=n;return t=_(arguments,1),A(m.debug)?(a=A(w["$is_a?"](l("String")))?w:w.$inspect(),A(t["$empty?"]())?m.$warn(a):(ee=f(t,"map",[],function(O){return null==O&&(O=n),A(O["$is_a?"](l("String")))?'"'+O+'"':O.$inspect()}),m.$warn(a+": "+ee.$join(", ")))):n},-2),g(g(r("I18n"),"Backend"),"Simple").$include(g(g(r("I18n"),"Backend"),"Fallbacks")),r("I18n").$load_path()["$<<"](r("Dir")["$[]"](r("File").$join("bcdice","../../i18n/**/*.yml"))),r("I18n")["$default_locale="]("ja_jp"),b=[["ja_jp"]],f(r("I18n").$fallbacks(),"defaults=",b),b[b.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var S,M,u,B,N,p,h,r,i,W,V,Y=e.module,H=e.klass,_=e.const_set,j=e.hash2,A=e.truthy,o=e.def,f=[],D=e.nil;return e.top.$require("strscan"),S=f,M=V=[Y(f[0],"BCDice")].concat(S),i=[Y(V[0],"GameSystem")].concat(M),W=e.$r(i),u=i,B=r=[H(i[0],W("Base"),"SwordWorld")].concat(u),p=[N=H(r[0],null,"RatingLexer")].concat(B),h=e.$r(p),N.$$prototype.scanner=D,_(p[0],"SYMBOLS",j(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),o(N,"$initialize",function(R){var s,d,K;return R=A(K=(s=(d=R)===D||null==d?D:d.$split(" ",2))===D||null==s?D:s.$first())?K:"",this.scanner=h("StringScanner").$new(R)}),o(N,"$next_token",function(){var R=this,s=D,d=D,K=D;return A(R.scanner["$eos?"]())?[!1,"$"]:A(s=R.scanner.$scan(/\d+/))?["NUMBER",s.$to_i()]:(d=R.scanner.$getch().$upcase(),[A(K=h("SYMBOLS")["$[]"](d))?K:d.$to_sym(),d])}),o(N,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var J,E,z,N,p,h,T,y,n,W,c,G,Y=e.module,H=e.klass,_=e.def,j=e.truthy,A=e.rb_le,o=e.rb_plus,F=e.rb_lt,f=e.neqeq,D=[],U=e.nil;return J=D,E=G=[Y(D[0],"BCDice")].concat(J),W=[Y(G[0],"GameSystem")].concat(E),c=e.$r(W),z=W,N=n=[H(W[0],c("Base"),"SwordWorld")].concat(z),h=[p=H(n[0],null,"RatingParsed")].concat(N),T=e.$r(h),(y=p.$$prototype).modifier_after_half=y.modifier_after_one_and_a_half=y.semi_fixed_val=y.kept_modify=y.rate=y.greatest_fortune=y.modifier=U,p.$attr_accessor("rate"),p.$attr_accessor("critical"),p.$attr_accessor("kept_modify"),p.$attr_accessor("first_to"),p.$attr_accessor("first_modify"),p.$attr_accessor("rateup"),p.$attr_accessor("greatest_fortune"),p.$attr_accessor("semi_fixed_val"),p.$attr_accessor("tmp_fixed_val"),p.$attr_accessor("modifier"),p.$attr_accessor("modifier_after_half"),p.$attr_accessor("modifier_after_one_and_a_half"),_(p,"$initialize",function(s,d){var l=this;return l.rate=s,l.modifier=d,l.critical=13,l.kept_modify=0,l.first_to=0,l.first_modify=0,l.greatest_fortune=!1,l.rateup=0,l.semi_fixed_val=0,l.tmp_fixed_val=0,l.modifier_after_half=U,l.modifier_after_one_and_a_half=U}),_(p,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),_(p,"$one_and_a_half",function(){return this.modifier_after_one_and_a_half["$nil?"]()["$!"]()}),_(p,"$min_critical",function(){var s=this;return j(A(s.semi_fixed_val,1))?3:o(o(s.semi_fixed_val,s.kept_modify),2).$clamp(3,13)}),_(p,"$infinite_roll?",function(){return F(this.$critical(),this.$min_critical())}),_(p,"$to_s",function(){var s=this,d=U;return d="KeyNo."+s.rate,j(F(s.$critical(),13))&&(d=o(d,"c["+s.$critical()+"]")),f(s.$first_modify(),0)&&(d=o(d,"m["+T("Format").$modifier(s.$first_modify())+"]")),f(s.$first_to(),0)&&(d=o(d,"m["+s.$first_to()+"]")),f(s.$rateup(),0)&&(d=o(d,"r["+s.$rateup()+"]")),j(s.greatest_fortune)&&(d=o(d,"gf")),f(s.$semi_fixed_val(),0)&&(d=o(d,"sf["+s.$semi_fixed_val()+"]")),f(s.$tmp_fixed_val(),0)&&(d=o(d,"tf["+s.$tmp_fixed_val()+"]")),f(s.$kept_modify(),0)&&(d=o(d,"a["+T("Format").$modifier(s.$kept_modify())+"]")),f(s.modifier,0)&&(d=o(d,T("Format").$modifier(s.modifier))),d})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var f,J,W,r,b,G,M,U,Y=e.module,H=e.klass,_=e.truthy,j=e.def,A=[];return f=A,J=U=[Y(A[0],"BCDice")].concat(f),G=[Y(U[0],"GameSystem")].concat(J),M=e.$r(G),W=G,b=[H(G[0],M("Base"),"SwordWorld")].concat(W),(r=H(b[0],null,"RatingOptions")).$attr_accessor("critical"),r.$attr_accessor("kept_modify"),r.$attr_accessor("first_to"),r.$attr_accessor("first_modify"),r.$attr_accessor("rateup"),r.$attr_accessor("greatest_fortune"),r.$attr_accessor("semi_fixed_val"),r.$attr_accessor("tmp_fixed_val"),r.$attr_accessor("modifier"),r.$attr_accessor("modifier_after_half"),r.$attr_accessor("modifier_after_one_and_a_half"),j(r,"$settable_first_roll_adjust_option?",function(){var B;return _(B=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():B}),j(r,"$settable_non_2d_roll_option?",function(){var B,N,g=this;return _(B=_(N=g.$greatest_fortune()["$nil?"]())?g.$semi_fixed_val()["$nil?"]():N)?g.$tmp_fixed_val()["$nil?"]():B})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var b,n,T,K,m,a,ee,te,O,_e,ce,oe,se,ie,q,I,t,x,R,s,B,N,z,Y=e.module,H=e.klass,_=e.ensure_kwargs,j=e.send2,A=e.find_super,o=e.def,F=e.send,f=e.truthy,D=e.not,U=e.thrower,S=e.hash,J=e.const_set,V=e.to_ary,G=e.eqeq,M=e.top,E=[],i=e.nil,W=e.$$$;return M.$require("racc/parser.rb"),M.$require("bcdice/arithmetic/node"),M.$require("bcdice/enum"),M.$require("bcdice/game_system/sword_world/rating_lexer"),M.$require("bcdice/game_system/sword_world/rating_parsed"),M.$require("bcdice/game_system/sword_world/rating_options"),b=E,n=z=[Y(E[0],"BCDice")].concat(b),B=[Y(z[0],"GameSystem")].concat(n),N=e.$r(B),T=B,R=[H(B[0],N("Base"),"SwordWorld")].concat(T),s=e.$r(R),K=R,I=[q=H(R[0],W(s("Racc"),"Parser"),"RatingParser")].concat(K),t=e.$r(I),(x=q.$$prototype).lexer=x.round_type=x.version=i,o(q,"$initialize",function Z(P){var v,Q,L=this;return Z.$$p=null,null==(v=(P=_(P)).$$smap.version)&&(v="v1_0"),null==(Q=P.$$smap.round_type)&&(Q=W(t("RoundType"),"CEIL")),j(L,A(L,"initialize",Z,!1,!0),"initialize",[],null),L.version=v,L.round_type=Q},-1),o(q,"$set_debug",function(){return this.yydebug=!0,this}),o(q,"$parse",function(P){try{return this.lexer=t("RatingLexer").$new(P),this.$do_parse()}catch(Q){if(!e.rescue(Q,[t("ParseError"),t("ZeroDivisionError")]))throw Q;try{return i}finally{e.pop_exception()}}}),q.$private(),o(q,"$parsed",function(P,v,Q){try{return U("eval_return"),F(t("RatingParsed").$new(P,v),"tap",[],function X(C){var ne,$e,fe,de,me,ve,he,ye,pe,ge=null==X.$$s?this:X.$$s,be=i;return null==ge.round_type&&(ge.round_type=i),null==C&&(C=i),C["$kept_modify="](f(be=(ne=Q.$kept_modify())===i||null==ne?i:ne.$eval(ge.round_type))?be:0),C["$first_to="](f(be=Q.$first_to())?be:0),C["$first_modify="](f(be=Q.$first_modify())?be:0),C["$rateup="](f(be=($e=Q.$rateup())===i||null==$e?i:$e.$eval(ge.round_type))?be:0),D(Q.$greatest_fortune()["$nil?"]())&&C["$greatest_fortune="](Q.$greatest_fortune()),C["$semi_fixed_val="](f(be=(fe=Q.$semi_fixed_val())===i||null==fe?i:fe.$clamp(1,6))?be:0),C["$tmp_fixed_val="](f(be=(de=Q.$tmp_fixed_val())===i||null==de?i:de.$clamp(1,6))?be:0),C["$modifier_after_half="]((me=Q.$modifier_after_half())===i||null==me?i:me.$eval(ge.round_type)),C["$modifier_after_one_and_a_half="]((ve=Q.$modifier_after_one_and_a_half())===i||null==ve?i:ve.$eval(ge.round_type)),he=[f((pe=Q.$critical(),ye=pe===i||null==pe?i:pe.$eval(ge.round_type),be=ye===i||null==ye?i:ye.$clamp(0,13)))?be:f(C.$half())||f(C.$one_and_a_half())?13:10],F(C,"critical=",he),he[he.length-1]},{$$s:this})}catch(X){if(X===e.t_eval_return)return X.$v;throw X}}),o(q,"$next_token",function(){return this.lexer.$next_token()}),m=e.large_array_unpack("18,16,17,19,6,20,21,23,24,64,65,27,28,13,66,14,22,15,18,16,17,19,5,20,21,23,24,5,9,3,4,13,10,14,22,15,18,16,17,19,11,20,21,23,24,34,5,34,40,13,42,14,22,15,30,31,30,31,33,34,33,34,62,63,62,63,34,43,30,31,30,31,33,34,33,30,31,44,34,33,34,52,30,31,57,34,33,30,31,30,31,33,34,33,30,31,58,34,33,34,60,30,31,61,34,33,30,31,30,31,33,34,33,30,31,,34,33,34,,30,31,,34,33,30,31,30,31,33,36,33,30,31,62,63,33,62,63,37,38,62,63,62,63,62,63"),a=e.large_array_unpack("7,7,7,7,1,7,7,7,7,55,55,12,12,7,55,7,7,7,25,25,25,25,3,25,25,25,25,0,4,0,0,25,5,25,25,25,49,49,49,49,6,49,49,49,49,13,9,14,17,49,19,49,49,49,13,13,14,14,13,16,14,18,46,46,48,48,22,20,16,16,18,18,16,23,18,22,22,21,24,22,27,29,23,23,37,28,23,24,24,27,27,24,30,27,28,28,38,31,28,33,43,30,30,44,40,30,31,31,33,33,31,62,33,40,40,,63,40,64,,62,62,,65,62,63,63,64,64,63,15,64,65,65,50,50,65,51,51,15,15,56,56,69,69,70,70"),ee=e.large_array_unpack("24,4,,19,23,30,40,-4,,43,,,0,43,45,128,57,43,59,42,59,69,64,71,76,14,,78,83,63,90,95,,97,,,,82,94,,102,,,98,101,,49,,51,32,121,124,,,,-2,128,,,,,,109,114,116,121,,,,130,132"),te=e.large_array_unpack("-36,-36,-5,-36,-36,-36,-36,-1,-5,-36,-4,71,-6,-36,-36,-36,-12,-36,-36,-36,-36,-36,-36,-36,-36,-2,-5,-36,-36,-36,-36,-36,-33,-36,-35,-8,-9,-36,-36,-13,-14,-16,-17,-36,-36,-20,-21,-30,-22,-3,-23,-24,-7,-31,-32,-36,-27,-10,-11,-15,-18,-19,-36,-36,-36,-36,-34,-28,-29,-25,-26"),O=e.large_array_unpack("29,35,7,39,1,41,46,48,25,45,50,51,2,55,,8,56,53,54,,,26,,,,,49,59,,,,,,,,,,,,,,,,,,,,69,70,67,68"),_e=e.large_array_unpack("5,5,3,5,1,5,6,6,3,5,6,6,2,7,,2,6,5,5,,,2,,,,,3,5,,,,,,,,,,,,,,,,,,,,6,6,5,5"),ce=[i,4,12,0,i,-13,-17,-20,i],oe=[i,i,i,i,12,47,i,i,32],se=e.large_array_unpack("0,0,racc_error,2,23,_reduce_1,3,23,_reduce_2,4,23,_reduce_3,2,24,_reduce_4,0,25,_reduce_5,2,25,_reduce_6,4,25,_reduce_7,3,25,_reduce_8,3,25,_reduce_9,4,25,_reduce_10,4,25,_reduce_11,2,25,_reduce_12,3,25,_reduce_13,3,25,_reduce_14,4,25,_reduce_15,3,25,_reduce_16,3,25,_reduce_17,4,25,_reduce_18,4,25,_reduce_19,3,25,_reduce_20,2,26,_reduce_21,2,26,_reduce_22,3,26,_reduce_23,3,26,_reduce_24,3,29,_reduce_25,3,29,_reduce_26,1,29,_reduce_none,3,28,_reduce_28,3,28,_reduce_29,1,28,_reduce_none,2,27,_reduce_31,2,27,_reduce_32,1,27,_reduce_none,3,30,_reduce_34,1,30,_reduce_35"),ie=S(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"O",6,"G",7,"F",8,"S",9,"T",10,"PLUS",11,"MINUS",12,"ASTERISK",13,"SLASH",14,"PARENL",15,"PARENR",16,"BRACKETL",17,"BRACKETR",18,"AT",19,"SHARP",20,"DOLLAR",21),J(I[0],"Racc_arg",[m,a,te,ee,O,_e,oe,ce,22,se,ie,71,36,!0]),f(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_arg")),J(I[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","O","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),f(t("Ractor","skip_raise")?"constant":i)&&t("Ractor").$make_shareable(t("Racc_token_to_s_table")),J(I[0],"Racc_debug_parser",!1),o(q,"$_reduce_1",function(P,v,Q){try{U("eval_return");var L,ne,de,$e=i,fe=i;return ne=null==(L=V(P))[0]?i:L[0],fe=f(de=($e=null==L[1]?i:L[1]).$modifier())?de:W(W(t("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,fe.$eval(this.round_type),$e)}catch(me){if(me===e.t_eval_return)return me.$v;throw me}}),o(q,"$_reduce_2",function(P,v,Q){try{U("eval_return");var L,$e,de,C=this,fe=i,me=i;return $e=null==(L=V(P))[1]?i:L[1],f((fe=null==L[2]?i:L[2]).$modifier_after_one_and_a_half())&&C.$raise(t("ParseError")),f(fe.$modifier_after_half())||fe["$modifier_after_half="](W(W(t("Arithmetic"),"Node"),"Number").$new(0)),me=f(de=fe.$modifier())?de:W(W(t("Arithmetic"),"Node"),"Number").$new(0),C.$parsed($e,me.$eval(C.round_type),fe)}catch(ve){if(ve===e.t_eval_return)return ve.$v;throw ve}}),o(q,"$_reduce_3",function(P,v,Q){try{U("eval_return");var L,$e,de,C=this,fe=i,me=i;return $e=null==(L=V(P))[2]?i:L[2],f((fe=null==L[3]?i:L[3]).$modifier_after_half())&&C.$raise(t("ParseError")),f(fe.$modifier_after_one_and_a_half())||fe["$modifier_after_one_and_a_half="](W(W(t("Arithmetic"),"Node"),"Number").$new(0)),me=f(de=fe.$modifier())?de:W(W(t("Arithmetic"),"Node"),"Number").$new(0),C.$parsed($e,me.$eval(C.round_type),fe)}catch(ve){if(ve===e.t_eval_return)return ve.$v;throw ve}}),o(q,"$_reduce_4",function(P,v,Q){return P["$[]"](1).$to_i()}),o(q,"$_reduce_5",function(P,v,Q){return t("RatingOptions").$new()}),o(q,"$_reduce_6",function(P,v,Q){var k,ne,C=i;return ne=null==(k=V(P))[1]?i:k[1],f((C=null==k[0]?i:k[0]).$modifier()["$nil?"]())||this.$raise(t("ParseError")),C["$modifier="](ne),C}),o(q,"$_reduce_7",function(P,v,Q){var k,$e,C=i;return $e=null==(k=V(P))[2]?i:k[2],f((C=null==k[0]?i:k[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),C["$critical="]($e),C}),o(q,"$_reduce_8",function(P,v,Q){var k,$e,C=i;return $e=null==(k=V(P))[2]?i:k[2],f((C=null==k[0]?i:k[0]).$critical()["$nil?"]())||this.$raise(t("ParseError")),C["$critical="]($e),C}),o(q,"$_reduce_9",function(P,v,Q){var k,C=i,$e=i;return $e=null==(k=V(P))[2]?i:k[2],f((C=null==k[0]?i:k[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),C["$first_to="]($e.$to_i()),C}),o(q,"$_reduce_10",function(P,v,Q){var k,C=i,$e=i;return $e=null==(k=V(P))[3]?i:k[3],f((C=null==k[0]?i:k[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),C["$first_modify="]($e.$to_i()),C}),o(q,"$_reduce_11",function(P,v,Q){var k,C=i,$e=i;return $e=null==(k=V(P))[3]?i:k[3],f((C=null==k[0]?i:k[0])["$settable_first_roll_adjust_option?"]())||this.$raise(t("ParseError")),C["$first_modify="]($e.$to_i()["$-@"]()),C}),o(q,"$_reduce_12",function(P,v,Q){var k,C=i;return k=V(P),f((C=null==k[0]?i:k[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),C["$modifier_after_half="](W(W(t("Arithmetic"),"Node"),"Number").$new(0)),C}),o(q,"$_reduce_13",function(P,v,Q){var k,$e,C=i;return $e=null==(k=V(P))[2]?i:k[2],f((C=null==k[0]?i:k[0]).$modifier_after_half()["$nil?"]())||this.$raise(t("ParseError")),C["$modifier_after_half="]($e),C}),o(q,"$_reduce_14",function(P,v,Q){var k,C=i;return k=V(P),f((C=null==k[0]?i:k[0]).$modifier_after_one_and_a_half())&&this.$raise(t("ParseError")),C["$modifier_after_one_and_a_half="](W(W(t("Arithmetic"),"Node"),"Number").$new(0)),C}),o(q,"$_reduce_15",function(P,v,Q){var k,$e,C=i;return $e=null==(k=V(P))[3]?i:k[3],f((C=null==k[0]?i:k[0]).$modifier_after_one_and_a_half())&&this.$raise(t("ParseError")),C["$modifier_after_one_and_a_half="]($e),C}),o(q,"$_reduce_16",function(P,v,Q){var k,$e,C=i;return C=null==(k=V(P))[0]?i:k[0],$e=null==k[2]?i:k[2],f(["v2_5","v2_0"]["$include?"](this.version))&&f(C.$rateup()["$nil?"]())||this.$raise(t("ParseError")),C["$rateup="]($e),C}),o(q,"$_reduce_17",function(P,v,Q){var k,C=i;return C=null==(k=V(P))[0]?i:k[0],f(["v2_5","v2_0"]["$include?"](this.version))&&f(C["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),C["$greatest_fortune="](!0),C}),o(q,"$_reduce_18",function(P,v,Q){var k,C=i,$e=i;return C=null==(k=V(P))[0]?i:k[0],$e=null==k[3]?i:k[3],f(["v2_5","v2_0"]["$include?"](this.version))&&f(C["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),C["$semi_fixed_val="]($e.$to_i()),C}),o(q,"$_reduce_19",function(P,v,Q){var k,C=i,$e=i;return C=null==(k=V(P))[0]?i:k[0],$e=null==k[3]?i:k[3],f(["v2_5","v2_0"]["$include?"](this.version))&&f(C["$settable_non_2d_roll_option?"]())||this.$raise(t("ParseError")),C["$tmp_fixed_val="]($e.$to_i()),C}),o(q,"$_reduce_20",function(P,v,Q){var k,$e,C=i;return C=null==(k=V(P))[0]?i:k[0],$e=null==k[2]?i:k[2],G(this.version,"v2_5")&&f(C.$kept_modify()["$nil?"]())||this.$raise(t("ParseError")),C["$kept_modify="]($e),C}),o(q,"$_reduce_21",function(P,v,Q){return P["$[]"](1)}),o(q,"$_reduce_22",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"Negative").$new(P["$[]"](1))}),o(q,"$_reduce_23",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"+",P["$[]"](2))}),o(q,"$_reduce_24",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"-",P["$[]"](2))}),o(q,"$_reduce_25",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"+",P["$[]"](2))}),o(q,"$_reduce_26",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"-",P["$[]"](2))}),o(q,"$_reduce_28",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"BinaryOp").$new(P["$[]"](0),"*",P["$[]"](2))}),o(q,"$_reduce_29",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(P["$[]"](0),P["$[]"](2))}),o(q,"$_reduce_31",function(P,v,Q){return P["$[]"](1)}),o(q,"$_reduce_32",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"Negative").$new(P["$[]"](1))}),o(q,"$_reduce_34",function(P,v,Q){return P["$[]"](1)}),o(q,"$_reduce_35",function(P,v,Q){return W(W(t("Arithmetic"),"Node"),"Number").$new(P["$[]"](0))}),o(q,"$_reduce_none",function(P,v,Q){return P["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var B,T,K,q,w,$,I,R,s,p,Y=e.module,H=e.klass,_=e.const_set,j=e.send2,A=e.find_super,o=e.def,F=e.truthy,f=e.rb_ge,D=e.rb_le,U=e.eqeq,S=e.neqeq,J=e.rb_minus,V=e.rb_gt,G=e.hash2,M=e.send,E=e.to_ary,i=e.rb_plus,W=e.rb_lt,c=e.rb_times,b=e.thrower,u=e.rb_divide,z=e.top,r=[],n=e.nil;return z.$require("bcdice/base"),z.$require("bcdice/game_system/sword_world/rating_parser"),B=r,T=p=[Y(r[0],"BCDice")].concat(B),R=[Y(p[0],"GameSystem")].concat(T),s=e.$r(R),K=R,w=[q=H(R[0],s("Base"),"SwordWorld")].concat(K),$=e.$r(w),(I=q.$$prototype).rating_table=I.randomizer=n,_(w[0],"ID","SwordWorld"),_(w[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),_(w[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),_(w[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),q.$register_prefix("H?K"),o(q,"$initialize",function t(m){return t.$$p=null,j(this,A(this,"initialize",t,!1,!0),"initialize",[m],null),this.rating_table=0}),o(q,"$result_2d6",function(m,a,ee,te,O){return F(f(a,12))?$("Result").$critical(this.$translate("SwordWorld.critical")):F(D(a,2))?$("Result").$fumble(this.$translate("SwordWorld.fumble")):S(te,">=")||U(O,"?")?n:F(f(m,O))?$("Result").$success(this.$translate("success")):$("Result").$failure(this.$translate("failure"))}),o(q,"$eval_game_system_specific_command",function(m){return this.$rating(m)}),q.$private(),o(q,"$rating_parser",function(){return $("RatingParser").$new()}),o(q,"$rating",function(m){var a,ee,te=this,O=n,_e=n,ce=n,oe=n,se=n,ue=n,le=n,ie=n,ae=n,re=n,x=n,Z=n,P=n,v=n,k=n,L=n;return te.$debug("rating string",m),O=te.$rating_parser().$parse(m),F(O)?(_e=te.$getSW2_0_RatingTable(),ce=J(_e.$length(),1),te.$debug("keyMax",ce),F(V(O.$rate(),ce))?$("Result").$new(te.$translate("SwordWorld.keynumber_exceeds",G(["keyMax"],{keyMax:ce}))):F(O["$infinite_roll?"]())?$("Result").$new(te.$translate("SwordWorld.infinite_critical",G(["min_critical"],{min_critical:O.$min_critical()}))):(oe=te.$getNewRates(_e),se=O+" \uff1e ",ue=[],le=[],ie=[],ae=0,re=0,x=0,Z=0,P=O.$first_to(),v=O.$first_modify(),function(){try{var X=b("break");return M(te,"loop",[],function C(){var ne,$e,ve,he,fe=null==C.$$s?this:C.$$s,de=n,me=n;if($e=fe.$rollDice(O,Z),me=null==(ne=E($e))[1]?n:ne[1],ae=de=null==ne[0]?n:ne[0],S(P,0)?(ae=de=P,P=0):S(v,0)&&(ae=i(ae,v),v=0),F(D(de,2))&&(ue["$<<"](de.$to_s()),le["$<<"](me.$to_s()),ie["$<<"]("**"),Z=i(Z,1),X.$throw()),S(O.$kept_modify(),0)&&S(ae,2)&&(ae=i(ae,O.$kept_modify())),F(W(ae,2))&&(ae=2),F(V(ae,12))&&(ae=12),ve=[i(O.$rate(),c(Z,O.$rateup())),ce].$min(),fe.$debug("currentKey",ve),he=oe["$[]"](ae)["$[]"](ve),fe.$debug("rateValue",he),x=i(x,he),re=i(re,ae),ue["$<<"](ae.$to_s()),le["$<<"](me.$to_s()),ie["$<<"](F(V(ae,2))?he:"**"),Z=i(Z,1),F(f(ae,O.$critical())))return n;X.$throw()},{$$s:te})}catch(C){if(C===X)return C.$v;throw C}}(),ee=te.$getResultText(x,O,le,ue,ie,re,Z),a=E(ee),k=null==a[1]?n:a[1],L=null==a[2]?n:a[2],se=i(se,null==a[0]?n:a[0]),M($("Result").$new(),"tap",[],function(C){var ne;return null==C&&(C=n),C["$text="](se),C["$critical="](k),M(C,"fumble=",ne=[L]),ne[ne.length-1]}))):(te.$debug("not matched"),"1")}),o(q,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),o(q,"$getNewRates",function(m){var a,ee,O=n,_e=n,ce=n,oe=n,se=n,ue=n,le=n,ie=n,ae=n,re=n,x=n;return O=[],_e=[],ce=[],oe=[],se=[],ue=[],le=[],ie=[],ae=[],re=[],x=[],M(m,"each",[],function(v){var Q=n;return null==v&&(v=n),Q=v.$split(/,/),x.$push(0),O.$push(Q["$[]"](1).$to_i()),_e.$push(Q["$[]"](2).$to_i()),ce.$push(Q["$[]"](3).$to_i()),oe.$push(Q["$[]"](4).$to_i()),se.$push(Q["$[]"](5).$to_i()),ue.$push(Q["$[]"](6).$to_i()),le.$push(Q["$[]"](7).$to_i()),ie.$push(Q["$[]"](8).$to_i()),ae.$push(Q["$[]"](9).$to_i()),re.$push(Q["$[]"](10).$to_i())}),U(this.rating_table,1)&&re["$[]="](31,(a=[32,(ee=[33,10],M(re,"[]=",ee),ee[ee.length-1])],M(re,"[]=",a),a[a.length-1])),[x,x,x,O,_e,ce,oe,se,ue,le,ie,ae,re]}),o(q,"$rollDice",function(m,a){var te=n;return[(te=this.randomizer.$roll_barabara(2,6)).$sum(),te.$join(",")]}),o(q,"$getResultText",function(m,a,ee,te,O,_e,ce){var se=n,ue=n,le=n,ie=n,ae=n;return(se=[]).$push("2D:["+ee.$join(" ")+"]="+te.$join(",")),F(D(_e,2))?(se.$push(O.$join(",")),se.$push(this.$translate("SwordWorld.fumble")),[se.$join(" \uff1e "),!1,!0]):(F(V(O.$size(),1))||S(a.$modifier(),0)?(ue=i(O.$join(","),$("Format").$modifier(a.$modifier())),F(a.$half())?(ue="("+ue+")/2",S(a.$modifier_after_half(),0)&&(ue=i(ue,$("Format").$modifier(a.$modifier_after_half())))):F(a.$one_and_a_half())&&(ue="("+ue+")*1.5",S(a.$modifier_after_one_and_a_half(),0)&&(ue=i(ue,$("Format").$modifier(a.$modifier_after_one_and_a_half())))),se.$push(ue)):F(a.$half())?(ue=O.$first()+"/2",S(a.$modifier_after_half(),0)&&(ue=i(ue,$("Format").$modifier(a.$modifier_after_half()))),se.$push(ue)):F(a.$one_and_a_half())&&(ue=O.$first()+"*1.5",S(a.$modifier_after_one_and_a_half(),0)&&(ue=i(ue,$("Format").$modifier(a.$modifier_after_one_and_a_half()))),se.$push(ue)),F(V(ce,1))&&(le=this.$translate("SwordWorld.round_text",G(["reroll_count"],{reroll_count:J(ce,1)})),se.$push(le)),ie=i(m,a.$modifier()),F(a.$half())?(ie=u(ie,2).$ceil(),S(a.$modifier_after_half(),0)&&(ie=i(ie,a.$modifier_after_half()))):F(a.$one_and_a_half())&&(ie=c(ie,1.5).$ceil(),S(a.$modifier_after_one_and_a_half(),0)&&(ie=i(ie,a.$modifier_after_one_and_a_half()))),ae=ie.$to_s(),se.$push(ae),[se.$join(" \uff1e "),V(ce,1),!1])})},Opal.queue(function(e){var S,M,u,z,r,i,W,V,Y=e.module,H=e.klass,_=e.const_set,j=e.send2,A=e.find_super,o=e.def,f=[];return e.top.$require("bcdice/game_system/SwordWorld"),S=f,M=V=[Y(f[0],"BCDice")].concat(S),i=[Y(V[0],"GameSystem")].concat(M),W=e.$r(i),u=i,_((r=[z=H(i[0],W("SwordWorld"),"SwordWorld_SimplifiedChinese")].concat(u))[0],"ID","SwordWorld:SimplifiedChinese"),_(r[0],"NAME","\u5251\u4e16\u754c"),_(r[0],"SORT_KEY","\u56fd\u969b\u5316:Simplified Chinese:\u5251\u4e16\u754c"),_(r[0],"HELP_MESSAGE","\u30fbSW\u3000\u5a01\u529b\u8868\u3000(Kx[c]+m$f) (x:\u5a01\u529b\u503c, c:\u66b4\u51fb\u503c, m:\u52a0\u503c, f:\u9ab0\u5b50\u51fa\u76ee\u4fee\u6b63)\n"),z.$register_prefix_from_super_class(),o(z,"$initialize",function n(g){var N=this;return n.$$p=null,j(N,A(N,"initialize",n,!1,!0),"initialize",[g],null),N.locale="zh_hans"})})}}]);