(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{tPkg:function(t,e,r){r("pQ1d"),Opal.modules["bcdice/arithmetic_evaluator"]=function(t){var e=[],r=t.$$$,n=t.$$,i=t.module,a=t.hash2,$=t.truthy;return function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=i(e,"ArithmeticEvaluator"),c=[o].concat(s);!function(e,i){var s,o=[e].concat(i);t.def(e,"$eval",s=function(e,i){var s,c;if(null==i)i=a([],{});else if(!i.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return null==(s=i.$$smap.round_type)&&(s=r(n(o,"RoundType"),"FLOOR")),$(e)&&$(c=n(o,"Arithmetic").$eval(e,s))?c:0},s.$$arity=-2)}(t.get_singleton_class(o),c)}(o[0],o)}(e[0],e)},Opal.modules["i18n/backend/fallbacks"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r=[],n=t.nil,i=t.$$$,a=t.$$,$=t.module,s=t.truthy,o=t.send,c=t.send2,u=t.hash2;return function(r,_){var l=$(r,"I18n"),d=[l].concat(_);t.class_variable_set(d[0],"@@fallbacks",n),function(r,$){var c,u,_=[r].concat($);t.def(r,"$fallbacks",c=function(){var e,r,$;return t.class_variable_set(_[1],"@@fallbacks",s($=null==(e=_[1].$$cvars["@@fallbacks"])?n:e)?$:i(i(a(_,"I18n"),"Locale"),"Fallbacks").$new()),s(r=a(_,"Thread").$current()["$[]"]("i18n_fallbacks"))?r:null==(e=_[1].$$cvars["@@fallbacks"])?n:e},c.$$arity=0),t.def(r,"$fallbacks=",u=function(r){var $,c;return t.class_variable_set(_[1],"@@fallbacks",s(r["$is_a?"](a(_,"Array")))?i(i(a(_,"I18n"),"Locale"),"Fallbacks").$new(r):r),c=["i18n_fallbacks",null==($=_[1].$$cvars["@@fallbacks"])?n:$],o(a(_,"Thread").$current(),"[]=",t.to_a(c)),c[e(c.length,1)]},u.$$arity=1)}(t.get_singleton_class(l),d),function(r,_){var l=[$(r,"Backend")].concat(_);!function(r,_){var l,d,f,h,p=$(r,"Fallbacks"),m=[p].concat(_);t.def(p,"$translate",l=function(e,r,$){try{var _,d=l.$$p,f=this,h=n,p=n,y=n,b=n,v=n,g=n;for(d&&(l.$$p=null),v=0,g=arguments.length,b=new Array(g);v<g;v++)b[v]=arguments[v];return null==$&&($=a(m,"EMPTY_HASH")),s($.$fetch("fallback",!0))?s($["$[]"]("fallback_in_progress"))?c(f,t.find_super_dispatcher(f,"translate",l,!1,!0),"translate",b,d):(s($["$[]"]("default"))&&(h=f["$extract_non_symbol_default!"]($)),p=$.$merge(u(["fallback_in_progress"],{fallback_in_progress:!0})),o(a(m,"I18n").$fallbacks()["$[]"](e),"each",[],((_=function(u){var d,f=null==_.$$s?this:_.$$s;null==u&&(u=n);try{return o(f,"catch",["exception"],((d=function(){var i=null==d.$$s?this:d.$$s,a=n;if(a=c(i,t.find_iter_super_dispatcher(i,"translate",d.$$def||_.$$def||l,!1,!1),"translate",[u,r,p],null),s(a["$nil?"]()))return n;s(e.$to_s()["$!="](u.$to_s()))&&i.$on_fallback(e,u,r,$),t.ret(a)}).$$s=f,d.$$arity=0,d))}catch(h){if(!t.rescue(h,[i(a(m,"I18n"),"InvalidLocale")]))throw h;try{return n}finally{t.pop_exception()}}}).$$s=f,_.$$arity=1,_)),s(s(y=$["$key?"]("default"))?$["$[]"]("default")["$nil?"]():y)?n:s(h)?c(f,t.find_super_dispatcher(f,"translate",l,!1,!0),"translate",[e,n,$.$merge(u(["default"],{default:h}))],null):f.$throw("exception",i(a(m,"I18n"),"MissingTranslation").$new(e,r,$))):c(f,t.find_super_dispatcher(f,"translate",l,!1,!0),"translate",b,d)}catch(R){if(R===t.returner)return R.$v;throw R}},l.$$arity=-3),t.def(p,"$extract_non_symbol_default!",d=function(r){var i,$,c=n,u=n;return c=[r["$[]"]("default")].$flatten(),$=o(c,"detect",[],((i=function(t){return null==t&&(t=n),t["$is_a?"](a(m,"Symbol"))["$!"]()}).$$s=this,i.$$arity=1,i)),s($)&&(u=["default",c["$[]"](0,c.$index($))],o(r,"[]=",t.to_a(u)),e(u.length,1)),$},d.$$arity=1),t.def(p,"$exists?",f=function(e,r,$){try{var u,_=f.$$p,l=this,d=n,h=n,p=n;for(_&&(f.$$p=null),h=0,p=arguments.length,d=new Array(p);h<p;h++)d[h]=arguments[h];return null==$&&($=a(m,"EMPTY_HASH")),s($.$fetch("fallback",!0))?(o(a(m,"I18n").$fallbacks()["$[]"](e),"each",[],((u=function(e){var $=null==u.$$s?this:u.$$s;null==e&&(e=n);try{if(!s(c($,t.find_iter_super_dispatcher($,"exists?",u.$$def||f,!1,!1),"exists?",[e,r],null)))return n;t.ret(!0)}catch(o){if(!t.rescue(o,[i(a(m,"I18n"),"InvalidLocale")]))throw o;try{return n}finally{t.pop_exception()}}}).$$s=l,u.$$arity=1,u)),!1):c(l,t.find_super_dispatcher(l,"exists?",f,!1,!0),"exists?",d,_)}catch(y){if(y===t.returner)return y.$v;throw y}},f.$$arity=-3),p.$private(),t.def(p,"$on_fallback",h=function(t,e,r,i){return n},h.$$arity=4)}(l[0],l)}(d[0],d)}(r[0],r)},Opal.modules["bcdice/randomizer"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t<=e:t["$<="](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function a(t,e){return"number"==typeof t&&"number"==typeof e?t*e:t["$*"](e)}var $=[],s=t.nil,o=t.$$$,c=t.$$,u=t.module,_=t.klass,l=t.truthy,d=t.send;return function($,f){var h=[u($,"BCDice")].concat(f);!function($,u,f){var h,p,m,y,b,v,g,R,x,k,w,T=_($,null,"Randomizer"),D=[T].concat(f);T.$$prototype.rand_results=T.$$prototype.detailed_rand_results=s,t.const_set(D[0],"UPPER_LIMIT_DICE_TIMES",200),t.const_set(D[0],"UPPER_LIMIT_DICE_SIDES",1e3),t.const_set(D[0],"UPPER_LIMIT_RANDS",1e4),t.def(T,"$initialize",h=function(){return this.rand_results=[],this.detailed_rand_results=[]},h.$$arity=0),T.$attr_reader("rand_results"),T.$attr_reader("detailed_rand_results"),t.const_set(D[0],"DetailedRandResult",c(D,"Struct").$new("kind","sides","value")),t.def(T,"$roll_barabara",p=function(t,i){var a,$;return l(e(r(this.rand_results.$size(),t),c(D,"UPPER_LIMIT_RANDS")))&&this.$raise(c(D,"TooManyRandsError")),l(l($=n(t,0))?$:e(t,c(D,"UPPER_LIMIT_DICE_TIMES")))?[]:d(c(D,"Array"),"new",[t],((a=function(){return(null==a.$$s?this:a.$$s).$roll_once(i)}).$$s=this,a.$$arity=0,a))},p.$$arity=2),t.def(T,"$roll_sum",m=function(t,e){return this.$roll_barabara(t,e).$sum()},m.$$arity=2),t.def(T,"$roll_once",y=function(t){var r,i;return l(l(i=n(t,0))?i:e(t,c(D,"UPPER_LIMIT_DICE_SIDES")))?0:(r=this.$rand_inner(t),this.$push_to_detail("normal",t,r),r)},y.$$arity=1),t.def(T,"$roll_index",b=function(t){return i(this.$roll_once(t),1)},b.$$arity=1),t.def(T,"$roll_tens_d10",v=function(){var t,e=s;return(e=this.$rand_inner(10))["$=="](10)&&(e=0),t=a(e,10),this.$push_to_detail("tens_d10",10,t),t},v.$$arity=0),t.def(T,"$roll_d9",g=function(){var t;return t=i(this.$rand_inner(10),1),this.$push_to_detail("d9",10,t),t},g.$$arity=0),t.def(T,"$roll_d66",R=function(t){var e,n,i=s;return i=d(c(D,"Array"),"new",[2],((e=function(){return(null==e.$$s?this:e.$$s).$roll_once(6)}).$$s=this,e.$$arity=0,e)),n=t,o(c(D,"D66SortType"),"ASC")["$==="](n)?i["$sort!"]():o(c(D,"D66SortType"),"DESC")["$==="](n)&&i["$sort!"]()["$reverse!"](),r(a(i["$[]"](0),10),i["$[]"](1))},R.$$arity=1),T.$private(),t.def(T,"$rand_inner",x=function(t){var e,r,n;return l((r=this.rand_results.$size(),n=c(D,"UPPER_LIMIT_RANDS"),"number"==typeof r&&"number"==typeof n?r>=n:r["$>="](n)))&&this.$raise(c(D,"TooManyRandsError")),e=this.$random(t),this.rand_results["$<<"]([e,t]),e},x.$$arity=1),t.def(T,"$random",k=function(t){return r(c(D,"Kernel").$rand(t),1)},k.$$arity=1),t.def(T,"$push_to_detail",w=function(t,e,r){var n;return n=c(D,"DetailedRandResult").$new(t,e,r),this.detailed_rand_results.$push(n)},w.$$arity=3)}(h[0],0,h),function(t,e,r){[_(t,e,"TooManyRandsError")].concat(r)}(h[0],c(h,"StandardError"),h)}($[0],$)},Opal.modules["bcdice/dice_table/roll_result"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.truthy;return function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"DiceTable")].concat(s);!function(e,i,s){var o,c,u,_,l=a(e,null,"RollResult"),d=[l].concat(s);l.$$prototype.table_name=l.$$prototype.value=l.$$prototype.body=r,t.def(l,"$initialize",o=function(t,e,r){return this.table_name=t,this.value=e,this.body=r},o.$$arity=3),l.$attr_reader("table_name"),l.$attr_reader("value"),l.$attr_reader("body"),t.def(l,"$to_s",c=function(){return this.table_name+"("+this.value+") \uff1e "+this.body},c.$$arity=0),t.def(l,"$last_body",u=function(){return $(this.body["$is_a?"](n(d,"RollResult")))?this.body.$last_body():this.body},u.$$arity=0),t.def(l,"$empty?",_=function(){return!1},_.$$arity=0)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/chain_table"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.truthy;return function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"DiceTable")].concat(s);!function(e,i,s){var o,c,u=a(e,null,"ChainTable"),_=[u].concat(s);u.$$prototype.times=u.$$prototype.sides=u.$$prototype.items=u.$$prototype.name=r,t.def(u,"$initialize",o=function(t,e,i){var a=r;return this.name=t,this.items=i.$freeze(),a=/(\d+)D(\d+)/i.$match(e),$(a)||this.$raise(n(_,"ArgumentError"),"Unexpected table type: "+e),this.times=a["$[]"](1).$to_i(),this.sides=a["$[]"](2).$to_i()},o.$$arity=3),t.def(u,"$roll",c=function(t){var e,i,a,s,o=r;return e=t.$roll_sum(this.times,this.sides),a=this.times,s="number"==typeof(i=e)&&"number"==typeof a?i-a:i["$-"](a),o=this.items["$[]"](s),$(o["$respond_to?"]("roll"))&&(o=o.$roll(t)),n(_,"RollResult").$new(this.name,e,o)},c.$$arity=1)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r=[],n=t.nil,i=t.$$,a=t.module,$=t.klass,s=t.hash2;return function(r,o){var c=[a(r,"BCDice")].concat(o);!function(r,o){var c=[a(r,"DiceTable")].concat(o);!function(r,a,o){var c,u,_,l=$(r,null,"D66GridTable"),d=[l].concat(o);l.$$prototype.name=l.$$prototype.items=n,t.defs(l,"$from_i18n",c=function(t,e){var r=n;return r=i(d,"I18n").$t(t,s(["locale","raise"],{locale:e,raise:!0})),this.$new(r["$[]"]("name"),r["$[]"]("items"))},c.$$arity=2),t.def(l,"$initialize",u=function(t,e){return this.name=t,this.items=e.$freeze()},u.$$arity=2),t.def(l,"$roll",_=function(t){var r,n,a,$,s,o;return r=t.$roll_once(6),n=t.$roll_once(6),a=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}("number"==typeof(o=r)?10*o:o["$*"](10),n),$=e(r,1),s=e(n,1),i(d,"RollResult").$new(this.name,a,this.items["$[]"]($)["$[]"](s))},_.$$arity=1)}(c[0],0,c)}(c[0],c)}(r[0],r)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.hash2;return t.top.$require("bcdice/dice_table/d66_grid_table"),function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"DiceTable")].concat(s);!function(e,i,s){var o,c,u=a(e,i,"D66HalfGridTable"),_=[u].concat(s);t.defs(u,"$from_i18n",o=function(t,e){var i=r;return i=n(_,"I18n").$t(t,$(["locale","raise"],{locale:e,raise:!0})),this.$new(i["$[]"]("name"),i["$[]"]("items_1_2_3"),i["$[]"]("items_4_5_6"))},o.$$arity=2),t.def(u,"$initialize",c=function(t,e,r){return this.name=t,this.items=[e,e,e,r,r,r].$freeze()},c.$$arity=3)}(o[0],n(o,"D66GridTable"),o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.hash2;return t.top.$require("bcdice/dice_table/d66_grid_table"),function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"DiceTable")].concat(s);!function(e,i,s){var o,c,u=a(e,i,"D66OneThirdTable"),_=[u].concat(s);t.defs(u,"$from_i18n",o=function(t,e){var i=r;return i=n(_,"I18n").$t(t,$(["locale","raise"],{locale:e,raise:!0})),this.$new(i["$[]"]("name"),i["$[]"]("items_1_2"),i["$[]"]("items_3_4"),i["$[]"]("items_5_6"))},o.$$arity=2),t.def(u,"$initialize",c=function(t,e,r,n){return this.name=t,this.items=[e,e,r,r,n,n].$freeze()},c.$$arity=4)}(o[0],n(o,"D66GridTable"),o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_table"]=function(t){var e=[],r=t.nil,n=t.$$$,i=t.$$,a=t.module,$=t.klass,s=t.hash2,o=t.truthy;return function(e,c){var u=[a(e,"BCDice")].concat(c);!function(e,c){var u=[a(e,"DiceTable")].concat(c);!function(e,a,c){var u,_,l,d=$(e,null,"D66Table"),f=[d].concat(c);d.$$prototype.sort_type=d.$$prototype.items=d.$$prototype.name=r,t.defs(d,"$from_i18n",u=function(t,e){var n,a=r;return a=i(f,"I18n").$t(t,s(["locale"],{locale:e})),n=i(f,"D66SortType").$const_get(a["$[]"]("d66_sort_type")),this.$new(a["$[]"]("name"),n,a["$[]"]("items"))},u.$$arity=2),t.def(d,"$initialize",_=function(t,e,r){return this.name=t,this.sort_type=e,this.items=r.$freeze()},_.$$arity=3),t.def(d,"$roll",l=function(t){var e,a,$,s=r,c=r,u=r;return s=t.$roll_barabara(2,6),e=this.sort_type,n(i(f,"D66SortType"),"ASC")["$==="](e)?s["$sort!"]():n(i(f,"D66SortType"),"DESC")["$==="](e)&&s["$sort!"]()["$reverse!"](),c=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}("number"==typeof(a=s["$[]"](0))?10*a:a["$*"](10),s["$[]"](1)),u=o($=this.items["$[]"](c))?$:this.items["$[]"](c.$to_s()),o(u["$respond_to?"]("roll"))&&(u=u.$roll(t)),i(f,"RollResult").$new(this.name,c,u)},l.$$arity=1)}(u[0],0,u)}(u[0],u)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}var r=[],n=t.nil,i=t.$$,a=t.module,$=t.klass,s=t.hash2,o=t.send,c=t.send2;return t.top.$require("bcdice/dice_table/d66_table"),function(r,u){var _=[a(r,"BCDice")].concat(u);!function(r,u){var _=[a(r,"DiceTable")].concat(u);!function(r,i,a){var u,_=$(r,i,"D66LeftRangeTable");[_].concat(a),t.def(_,"$initialize",u=function(r,i,a){var $,_;return u.$$p&&(u.$$p=null),_=s([],{}),o(a,"each",[],(($=function(r){var i,a,s,c=null==$.$$s?this:$.$$s;return null==r&&(r=n),i=t.to_ary(r),s=null==i[1]?n:i[1],o(null==i[0]?n:i[0],"each",[],((a=function(r){var i;return null==r&&(r=n),o(s,"each_with_index",[],((i=function(i,a){var $,s,c;return null==i&&(i=n),null==a&&(a=n),$=e("number"==typeof(c=r)?10*c:c["$*"](10),e(a,1)),o(_,"[]=",t.to_a(s=[$,i])),s[function(t,e){return"number"==typeof t?t-1:t["$-"](1)}(s.length)]}).$$s=null==a.$$s?this:a.$$s,i.$$arity=2,i))}).$$s=c,a.$$arity=1,a))}).$$s=this,$.$$arity=1,$)),c(this,t.find_super_dispatcher(this,"initialize",u,!1,!0),"initialize",[r,i,_],null)},u.$$arity=3)}(_[0],i(_,"D66Table"),_)}(_[0],_)}(r[0],r)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.truthy;return function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"DiceTable")].concat(s);!function(e,i,s){var o,c,u=a(e,null,"D66ParityTable"),_=[u].concat(s);u.$$prototype.odd=u.$$prototype.even=u.$$prototype.name=r,t.def(u,"$initialize",o=function(t,e,r){return this.name=t,this.odd=e.$freeze(),this.even=r.$freeze()},o.$$arity=3),t.def(u,"$roll",c=function(t){var e,i,a,s,o=r;return o=t.$roll_once(6),e=t.$roll_once(6),i=($(o["$odd?"]())?this.odd:this.even)["$[]"]("number"==typeof(s=e)?s-1:s["$-"](1)),a=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}(function(t,e){return"number"==typeof t?10*t:t["$*"](10)}(o),e),n(_,"RollResult").$new(this.name,a,i)},c.$$arity=1)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.send;return function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"DiceTable")].concat(s);!function(e,i,s){var o,c,u=a(e,null,"D66RangeTable"),_=[u].concat(s);u.$$prototype.items=u.$$prototype.name=r,t.def(u,"$initialize",o=function(t,e){return this.name=t,this.items=e.$freeze()},o.$$arity=2),t.def(u,"$roll",c=function(t){var e,i,a,s,o,c=r;return i=t.$roll_once(6),a=t.$roll_once(6),s=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}("number"==typeof(o=i)?10*o:o["$*"](10),a),c=$(this.items,"find",[],((e=function(t){return null==t&&(t=r),t["$[]"](0)["$include?"](s)}).$$s=this,e.$$arity=1,e)),n(_,"RollResult").$new(this.name,s,c["$[]"](1))},c.$$arity=1)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/range_table"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.send,s=t.truthy;return function(e,o){var c=[i(e,"BCDice")].concat(o);!function(e,o){var c=[i(e,"DiceTable")].concat(o);!function(e,i,o){var c,u,_,l,d,f,h,p,m,y=a(e,null,"RangeTable"),b=[y].concat(o);y.$$prototype.name=y.$$prototype.items=y.$$prototype.num_of_dice=y.$$prototype.num_of_sides=y.$$prototype.formatter=r,t.const_set(b[0],"RollResult",$(n(b,"Struct"),"new",["sum","values","content","formatted"],((c=function(){return(null==c.$$s?this:c.$$s).$alias_method("to_s","formatted")}).$$s=y,c.$$arity=0,c))),t.const_set(b[0],"Item",n(b,"Struct").$new("range","content")),t.const_set(b[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),t.const_set(b[0],"DEFAULT_FORMATTER",$(y,"lambda",[],($$2=function(t,e){return null==$$2.$$s||$$2,null==t&&(t=r),null==e&&(e=r),t.$name()+"("+e.$sum()+") \uff1e "+e.$content()},$$2.$$s=y,$$2.$$arity=2,$$2))),y.$attr_reader("name"),y.$attr_reader("num_of_dice"),y.$attr_reader("num_of_sides"),t.def(y,"$initialize",u=function(t,e,i){var a,$=u.$$p,o=$||r,c=r;return $&&(u.$$p=null),$&&(u.$$p=null),this.name=t.$freeze(),this.formatter=s(a=o)?a:n(b,"DEFAULT_FORMATTER"),c=n(b,"DICE_ROLL_METHOD_RE").$match(e),s(c)||this.$raise(n(b,"ArgumentError"),this.name+": invalid dice roll method: "+e),this.num_of_dice=c["$[]"](1).$to_i(),this.num_of_sides=c["$[]"](2).$to_i(),this.$store(i)},u.$$arity=3),t.def(y,"$fetch",_=function(t){var e,i;return i=$(this.items,"find",[],((e=function(e){return null==e&&(e=r),e.$range()["$include?"](t)}).$$s=this,e.$$arity=1,e)),s(i)||this.$raise(n(b,"RangeError"),this.name+": value is out of range: "+t),i},_.$$arity=1),t.def(y,"$roll",l=function(e){var i,a,s,o,c=r;return i=(c=e.$roll_barabara(this.num_of_dice,this.num_of_sides)).$sum(),a=n(b,"RollResult").$new(i,c,this.$fetch(i).$content()),s=[this.formatter["$[]"](this,a)],$(a,"formatted=",t.to_a(s)),"number"==typeof(o=s.length)||o["$-"](1),a},l.$$arity=1),y.$private(),t.def(y,"$store",d=function(t){var e,i,a,s,o;return s=$(t,"map",[],((e=function(t,n){return null==t&&(t=r),null==n&&(n=r),[(null==e.$$s?this:e.$$s).$coerce_to_int_range(t),n]}).$$s=this,e.$$arity=2,e)),o=$(s,"sort_by",[],((i=function(t,e){return null==t&&(t=r),null==e&&(e=r),t.$min()}).$$s=this,i.$$arity=2,i)),this.$assert_min_sum_is_covered(o),this.$assert_max_sum_is_covered(o),this.$assert_no_gap_or_overlap_in_ranges(o),this.items=$(o,"map",[],(a=function(t,e){return null==t&&(t=r),null==e&&(e=r),n(b,"Item").$new(t,e.$freeze()).$freeze()},a.$$s=this,a.$$arity=2,a)).$freeze(),this},d.$$arity=1),t.def(y,"$coerce_to_int_range",f=function(t){var e,i=r;return e=t,n(b,"Integer")["$==="](e)?n(b,"Range").$new(t,t):n(b,"Range")["$==="](e)&&s(s(i=t.$begin()["$is_a?"](n(b,"Integer")))?t.$end()["$is_a?"](n(b,"Integer")):i)?t:this.$raise(n(b,"TypeError"),this.name+": "+t+" ("+t.$class()+") must be an Integer or a Range with Integers ")},f.$$arity=1),t.def(y,"$assert_min_sum_is_covered",h=function(t){var e,i=r;return e=this.num_of_dice,i=t.$first()["$[]"](0),s(i["$include?"](e))||this.$raise(n(b,"RangeError"),this.name+": min value ("+e+") is not covered: "+i),this},h.$$arity=1),t.def(y,"$assert_max_sum_is_covered",p=function(t){var e,i,a,$=r;return i=this.num_of_sides,a="number"==typeof(e=this.num_of_dice)&&"number"==typeof i?e*i:e["$*"](i),$=t.$last()["$[]"](0),s($["$include?"](a))||this.$raise(n(b,"RangeError"),this.name+": max value ("+a+") is not covered: "+$),this},p.$$arity=1),t.def(y,"$assert_no_gap_or_overlap_in_ranges",m=function(t){var e;return $(t,"each_cons",[2],((e=function(t,i){var a,$,o,c=null==e.$$s?this:e.$$s,u=r,_=r;return null==c.name&&(c.name=r),null==t&&(t=r),null==i&&(i=r),u=t["$[]"](0),_=i["$[]"](0),o="number"==typeof($=a=u.$max())?$+1:$["$+"](1),s(_["$include?"](a))&&c.$raise(n(b,"RangeError"),c.name+": Range overlap: "+u+" and "+_),s(_["$include?"](o))?r:c.$raise(n(b,"RangeError"),c.name+": Range gap: "+u+" and "+_)}).$$s=this,e.$$arity=2,e)),this},m.$$arity=1)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(t){var e=[],r=t.nil,n=t.$$$,i=t.$$,a=t.module,$=t.klass,s=t.send;return function(e,o){var c=[a(e,"BCDice")].concat(o);!function(e,o){var c=[a(e,"DiceTable")].concat(o);!function(e,a,o){var c=[$(e,null,"SaiFicSkillTable")].concat(o);!function(e,a,o){var c,u,_,l=$(e,null,"Category"),d=[l].concat(o);l.$$prototype.name=r,t.def(l,"$initialize",c=function(t,e,a,$){var o;return this.name=t,this.skills=s(e.$map(),"with_index",[2],((o=function(e,s){return null==e&&(e=r),null==s&&(s=r),n(i(d,"SaiFicSkillTable"),"Skill").$new(t,e,a,s,$)}).$$s=this,o.$$arity=2,o)),this.dice=a},c.$$arity=4),t.def(l,"$roll",u=function(t){var e;return this.$skills()["$[]"]("number"==typeof(e=t.$roll_sum(2,6))?e-2:e["$-"](2))},u.$$arity=1),t.def(l,"$to_s",_=function(){return this.name},_.$$arity=0),l.$attr_reader("name","dice","skills")}(c[0],0,c)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(t){var e=[],r=t.nil,n=t.module,i=t.klass,a=t.hash2;return function(e,$){var s=[n(e,"BCDice")].concat($);!function(e,$){var s=[n(e,"DiceTable")].concat($);!function(e,n,$){var s=[i(e,null,"SaiFicSkillTable")].concat($);!function(e,n,$){var s,o,c=i(e,null,"Skill");[c].concat($),c.$$prototype.s_format=c.$$prototype.category_dice=c.$$prototype.row_dice=c.$$prototype.category_name=c.$$prototype.name=r,t.def(c,"$initialize",s=function(t,e,r,n,i){return this.category_name=t,this.name=e,this.category_dice=r,this.row_dice=n,this.s_format=i},s.$$arity=5),t.def(c,"$to_s",o=function(){return this.$format(this.s_format,a(["category_dice","row_dice","category_name","skill_name"],{category_dice:this.category_dice,row_dice:this.row_dice,category_name:this.category_name,skill_name:this.name}))},o.$$arity=0),c.$attr_reader("category_name","name","category_dice","row_dice")}(s[0],0,s)}(s[0],0,s)}(s[0],s)}(e[0],e)},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(t){var e=t.top,r=[],n=t.nil,i=t.$$$,a=t.$$,$=t.module,s=t.klass,o=t.hash2,c=t.send,u=t.truthy;return e.$require("bcdice/dice_table/sai_fic_skill_table/category"),e.$require("bcdice/dice_table/sai_fic_skill_table/skill"),function(e,r){var _=[$(e,"BCDice")].concat(r);!function(e,r){var _=[$(e,"DiceTable")].concat(r);!function(e,r,$){var _,l,d,f,h,p,m,y=s(e,null,"SaiFicSkillTable"),b=[y].concat($);y.$$prototype.rtt=y.$$prototype.rtt_format=y.$$prototype.rct=y.$$prototype.rct_format=y.$$prototype.rttn=y.$$prototype.rttn_format=y.$$prototype.categories=n,t.defs(y,"$from_i18n",_=function(e,r,i){var $,s,u,_,l,d=n;if(null==i)i=o([],{});else if(!i.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return null==($=i.$$smap.rtt)&&($=n),null==(s=i.$$smap.rct)&&(s=n),null==(u=i.$$smap.rttn)&&(u=n),l=(d=a(b,"I18n").$t("RTT",o(["locale","raise","default"],{locale:r,raise:!1,default:o([],{})})).$merge(a(b,"I18n").$t(e,o(["locale","raise"],{locale:r,raise:!0}))))["$[]"]("items"),d=c(d,"select",[],((_=function(t,e){return null==t&&(t=n),null==e&&(e=n),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](t)}).$$s=this,_.$$arity=2,_)),this.$new(l,t.to_hash(d).$merge(o(["rtt","rct","rttn"],{rtt:$,rct:s,rttn:u})))},_.$$arity=-3),t.const_set(b[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),t.const_set(b[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),t.const_set(b[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),t.const_set(b[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),t.def(y,"$initialize",l=function(e,r){var $,s,u,_,l,d,f,h;if(null==r)r=o([],{});else if(!r.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return null==($=r.$$smap.rtt)&&($=n),null==(s=r.$$smap.rct)&&(s=n),null==(u=r.$$smap.rttn)&&(u=n),null==(_=r.$$smap.rtt_format)&&(_=a(b,"DEFAULT_RTT")),null==(l=r.$$smap.rct_format)&&(l=a(b,"DEFAULT_RCT")),null==(d=r.$$smap.rttn_format)&&(d=a(b,"DEFAULT_RTTN")),null==(f=r.$$smap.s_format)&&(f=a(b,"DEFAULT_S")),this.categories=c(e.$map(),"with_index",[1],((h=function(e,r){var $,s,o;return null==e&&(e=n),null==r&&(r=n),s=null==($=t.to_ary(e))[0]?n:$[0],o=null==$[1]?n:$[1],i(a(b,"SaiFicSkillTable"),"Category").$new(s,o,r,f)}).$$s=this,h.$$arity=2,h.$$has_top_level_mlhs_arg=!0,h)),this.rtt=$,this.rct=s,this.rttn=u.$to_a(),this.rtt_format=_,this.rct_format=l,this.rttn_format=d},l.$$arity=-2),t.const_set(b[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),t.def(y,"$roll_command",d=function(t,e){var r,i=n,$=n,s=n;return u(["RTT",this.rtt]["$include?"](r=e))?this.$format_skill(this.rtt_format,this.$roll_skill(t)):u(["RCT",this.rct]["$include?"](r))?(i=this.$roll_category(t),this.$format(this.rct_format,o(["category_dice","category_name"],{category_dice:i.$dice(),category_name:i.$name()}))):u(u($=s=a(b,"RTTN").$index(r))?$:s=this.rttn.$index(r))?this.$format_skill(this.rttn_format,this.categories["$[]"](s).$roll(t)):n},d.$$arity=2),t.def(y,"$roll_category",f=function(t){var e;return this.categories["$[]"]("number"==typeof(e=t.$roll_once(6))?e-1:e["$-"](1))},f.$$arity=1),t.def(y,"$roll_skill",h=function(t){return this.$roll_category(t).$roll(t)},h.$$arity=1),t.def(y,"$prefixes",p=function(){var t,e;return(t=["RTT[1-6]?","RCT",this.rtt,this.rct],e=this.rttn,"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)).$compact()},p.$$arity=0),y.$private(),t.def(y,"$format_skill",m=function(t,e){return this.$format(t,o(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:e.$category_dice(),row_dice:e.$row_dice(),category_name:e.$category_name(),skill_name:e.$name(),text:e.$to_s()}))},m.$$arity=2)}(_[0],0,_)}(_[0],_)}(r[0],r)},Opal.modules["bcdice/dice_table/table"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.hash2,s=t.truthy;return function(e,o){var c=[i(e,"BCDice")].concat(o);!function(e,o){var c=[i(e,"DiceTable")].concat(o);!function(e,i,o){var c,u,_,l,d=a(e,null,"Table"),f=[d].concat(o);d.$$prototype.times=d.$$prototype.sides=d.$$prototype.name=d.$$prototype.items=r,t.defs(d,"$from_i18n",c=function(t,e){var i=r;return i=n(f,"I18n").$t(t,$(["locale"],{locale:e})),this.$new(i["$[]"]("name"),i["$[]"]("type"),i["$[]"]("items"))},c.$$arity=2),t.def(d,"$initialize",u=function(t,e,i){var a=r;return this.name=t,this.items=i.$freeze(),a=/(\d+)D(\d+)/i.$match(e),s(a)||this.$raise(n(f,"ArgumentError"),"Unexpected table type: "+e),this.times=a["$[]"](1).$to_i(),this.sides=a["$[]"](2).$to_i()},u.$$arity=3),t.def(d,"$roll",_=function(t){var e;return e=t.$roll_sum(this.times,this.sides),this.$choice(e)},_.$$arity=1),t.def(d,"$choice",l=function(t){var e,r,i;return r=this.times,i="number"==typeof(e=t)&&"number"==typeof r?e-r:e["$-"](r),n(f,"RollResult").$new(this.name,t,this.items["$[]"](i))},l.$$arity=1)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table"]=function(t){var e=t.top;return e.$require("bcdice/dice_table/roll_result"),e.$require("bcdice/dice_table/chain_table"),e.$require("bcdice/dice_table/d66_grid_table"),e.$require("bcdice/dice_table/d66_half_grid_table"),e.$require("bcdice/dice_table/d66_one_third_table"),e.$require("bcdice/dice_table/d66_left_range_table"),e.$require("bcdice/dice_table/d66_parity_table"),e.$require("bcdice/dice_table/d66_range_table"),e.$require("bcdice/dice_table/d66_table"),e.$require("bcdice/dice_table/range_table"),e.$require("bcdice/dice_table/sai_fic_skill_table"),e.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(t){var e=[],r=t.module;return function(e,n){var i=[r(e,"BCDice")].concat(n);!function(e,n){var i=[r(e,"D66SortType")].concat(n);t.const_set(i[0],"NO_SORT","no_sort"),t.const_set(i[0],"ASC","asc"),t.const_set(i[0],"DESC","desc")}(i[0],i),function(e,n){var i=[r(e,"RoundType")].concat(n);t.const_set(i[0],"CEIL","ceil"),t.const_set(i[0],"FLOOR","floor"),t.const_set(i[0],"ROUND","round")}(i[0],i)}(e[0],e)},Opal.modules["bcdice/translate"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.hash2;return function(e,$){var s=[i(e,"BCDice")].concat($);!function(e,$){var s,o=i(e,"Translate"),c=[o].concat($);t.def(o,"$translate",s=function(e,i){var $;if(null==this.locale&&(this.locale=r),null==i)i=a([],{});else if(!i.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return $=t.kwrestargs(i,{}),n(c,"I18n").$translate(e,a(["locale","raise"],{locale:this.locale,raise:!0}).$merge(t.to_hash($)))},s.$$arity=-2)}(s[0],s)}(e[0],e)},Opal.modules["bcdice/result"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r=[],n=t.nil,i=t.module,a=t.klass,$=t.send;return function(r,s){var o=[i(r,"BCDice")].concat(s);!function(r,i,s){var o,c,u,_,l,d,f,h=a(r,null,"Result"),p=[h].concat(s);h.$$prototype.secret=h.$$prototype.success=h.$$prototype.failure=h.$$prototype.critical=h.$$prototype.fumble=n,function(r,i){var a,s,o,c,u;[r].concat(i),t.def(r,"$success",a=function(r){var i;return $(this.$new(),"tap",[],((i=function(i){var a=n;return null==i&&(i=n),$(i,"text=",t.to_a(a=[r])),e(a.length,1),$(i,"success=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,i.$$arity=1,i))},a.$$arity=1),t.def(r,"$failure",s=function(r){var i;return $(this.$new(),"tap",[],((i=function(i){var a=n;return null==i&&(i=n),$(i,"text=",t.to_a(a=[r])),e(a.length,1),$(i,"failure=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,i.$$arity=1,i))},s.$$arity=1),t.def(r,"$critical",o=function(r){var i;return $(this.$new(),"tap",[],((i=function(i){var a=n;return null==i&&(i=n),$(i,"text=",t.to_a(a=[r])),e(a.length,1),$(i,"critical=",t.to_a(a=[!0])),e(a.length,1),$(i,"success=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,i.$$arity=1,i))},o.$$arity=1),t.def(r,"$fumble",c=function(r){var i;return $(this.$new(),"tap",[],((i=function(i){var a=n;return null==i&&(i=n),$(i,"text=",t.to_a(a=[r])),e(a.length,1),$(i,"fumble=",t.to_a(a=[!0])),e(a.length,1),$(i,"failure=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,i.$$arity=1,i))},c.$$arity=1),t.def(r,"$nothing",u=function(){return"nothing"},u.$$arity=0)}(t.get_singleton_class(h),p),t.def(h,"$initialize",o=function(t){return null==t&&(t=n),this.text=t,this.rands=n,this.detailed_rands=n,this.secret=!1,this.success=!1,this.failure=!1,this.critical=!1,this.fumble=!1},o.$$arity=-1),h.$attr_accessor("text","rands","detailed_rands"),h.$attr_writer("secret","success","failure","critical","fumble"),t.def(h,"$secret?",c=function(){return this.secret},c.$$arity=0),t.def(h,"$success?",u=function(){return this.success},u.$$arity=0),t.def(h,"$failure?",_=function(){return this.failure},_.$$arity=0),t.def(h,"$critical?",l=function(){return this.critical},l.$$arity=0),t.def(h,"$fumble?",d=function(){return this.fumble},d.$$arity=0),t.def(h,"$condition=",f=function(t){return this.success=t,this.failure=t["$!"]()},f.$$arity=1)}(o[0],0,o)}(r[0],r)},Opal.modules["racc/parser"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t<e:t["$<"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:t["$>="](e)}function a(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}var $=[],s=t.nil,o=t.$$$,c=t.$$,u=t.module,_=t.klass,l=t.truthy,d=t.gvars,f=t.send;return function(t,e){var r=[u(t,"Racc")].concat(e);!function(t,e,r){[_(t,e,"ParseError")].concat(r)}(r[0],c(r,"StandardError"),r)}($[0],$),l(o("::","ParseError","skip_raise")?"constant":s)||t.const_set($[0],"ParseError",o(c($,"Racc"),"ParseError")),function($,h){var p=[u($,"Racc")].concat(h);l(c(p,"Racc_No_Extensions","skip_raise")?"constant":s)||t.const_set(p[0],"Racc_No_Extensions",!1),function($,u,h){var p,m,y,b,v,g,R,x,k,w,T,D,E,S,A,N,P,O,z,C,I,L,B,q,M=_($,null,"Parser"),U=[M].concat(h);M.$$prototype.yydebug=M.$$prototype.racc_debug_out=M.$$prototype.racc_error_status=M.$$prototype.racc_t=M.$$prototype.racc_vstack=M.$$prototype.racc_val=M.$$prototype.racc_state=M.$$prototype.racc_tstack=s,t.const_set(U[0],"Racc_Runtime_Version","1.4.6"),t.const_set(U[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),t.const_set(U[0],"Racc_Runtime_Core_Version_R","1.4.6"),t.const_set(U[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),t.const_set(U[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),t.const_set(U[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),t.const_set(U[0],"Racc_Runtime_Core_Version",c(U,"Racc_Runtime_Core_Version_R")),t.const_set(U[0],"Racc_Runtime_Core_Revision",c(U,"Racc_Runtime_Core_Revision_R")),t.const_set(U[0],"Racc_Runtime_Type","ruby"),t.defs(c(U,"Parser"),"$racc_runtime_type",p=function(){return c(U,"Racc_Runtime_Type")},p.$$arity=0),t.def(M,"$_racc_setup",m=function(){var n,i,a=s,$=s,c=s;return null==d.stderr&&(d.stderr=s),l(o(this.$class(),"Racc_debug_parser"))||(this.yydebug=!1),l(null!=(n=this.yydebug)&&n!==s?"instance-variable":s)||(this.yydebug=!1),l(this.yydebug)&&(l(null!=(i=this.racc_debug_out)&&i!==s?"instance-variable":s)||(this.racc_debug_out=d.stderr),this.racc_debug_out=l(a=this.racc_debug_out)?a:d.stderr),$=o(this.$class(),"Racc_arg"),l(e($.$size(),14))&&(f($,"[]=",t.to_a(c=[13,!0])),r(c.length,1)),$},m.$$arity=0),t.def(M,"$_racc_init_sysvars",y=function(){return this.racc_state=[0],this.racc_tstack=[],this.racc_vstack=[],this.racc_t=s,this.racc_val=s,this.racc_read_next=!0,this.racc_user_yyerror=!1,this.racc_error_status=0},y.$$arity=0),t.def(M,"$do_parse",b=function(){return this.$__send__(c(U,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},b.$$arity=0),t.def(M,"$next_token",v=function(){return this.$raise(c(U,"NotImplementedError"),this.$class()+"#next_token is not defined")},v.$$arity=0),t.def(M,"$_racc_do_parse_rb",g=function(e,r){var a,$,o=s,c=s,u=s,_=s,d=s,h=s,p=s,m=s;return a=t.to_ary(e),o=null==a[0]?s:a[0],c=null==a[1]?s:a[1],u=null==a[2]?s:a[2],_=null==a[3]?s:a[3],d=null==a[10]?s:a[10],this.$_racc_init_sysvars(),h=p=m=s,f(this,"catch",["racc_end_parse"],(($=function(){var r,a,f=null==$.$$s?this:$.$$s,y=s,b=s,v=s;for(null==f.racc_state&&(f.racc_state=s),null==f.racc_read_next&&(f.racc_read_next=s),null==f.racc_t&&(f.racc_t=s),null==f.yydebug&&(f.yydebug=s),null==f.racc_val&&(f.racc_val=s);l(!0);)for(l(m=_["$[]"](f.racc_state["$[]"](-1)))?(l(f.racc_read_next)&&l(f.racc_t["$!="](0))&&(a=f.$next_token(),r=t.to_ary(a),h=null==r[0]?s:r[0],f.racc_val=null==r[1]?s:r[1],f.racc_t=l(h)?l(y=d["$[]"](h))?y:1:0,l(f.yydebug)&&f.$racc_read_token(f.racc_t,h,f.racc_val),f.racc_read_next=!1),m=n(m,f.racc_t),l(l(b=l(v=i(m,0))?p=o["$[]"](m):v)?c["$[]"](m)["$=="](f.racc_state["$[]"](-1)):b)||(p=u["$[]"](f.racc_state["$[]"](-1)))):p=u["$[]"](f.racc_state["$[]"](-1));l(p=f.$_racc_evalact(p,e)););}).$$s=this,$.$$arity=0,$))},g.$$arity=2),t.def(M,"$yyparse",R=function(t,e){return this.$__send__(c(U,"Racc_YY_Parse_Method"),t,e,this.$_racc_setup(),!0)},R.$$arity=2),t.def(M,"$_racc_yyparse_rb",x=function(e,r,a,$){var o,c,u=s,_=s,d=s,h=s,p=s,m=s,y=s;return o=t.to_ary(a),u=null==o[0]?s:o[0],_=null==o[1]?s:o[1],d=null==o[2]?s:o[2],h=null==o[3]?s:o[3],p=null==o[10]?s:o[10],this.$_racc_init_sysvars(),m=s,y=s,f(this,"catch",["racc_end_parse"],((c=function(){var t,$=null==c.$$s?this:c.$$s;for(null==$.racc_state&&($.racc_state=s);!l(y=h["$[]"]($.racc_state["$[]"](-1)));)for(;l(m=$.$_racc_evalact(d["$[]"]($.racc_state["$[]"](-1)),a)););return f(e,"__send__",[r],((t=function(e,r){var $,o,c=null==t.$$s?this:t.$$s,f=s,b=s,v=s,g=s,R=s,x=s,k=s;for(null==c.racc_t&&(c.racc_t=s),null==c.racc_state&&(c.racc_state=s),null==c.racc_read_next&&(c.racc_read_next=s),null==e&&(e=s),null==r&&(r=s),c.racc_t=l(e)?l(f=p["$[]"](e))?f:1:0,c.racc_val=r,c.racc_read_next=!1,y=n(y,c.racc_t),l(l($=l(o=i(y,0))?m=u["$[]"](y):o)?_["$[]"](y)["$=="](c.racc_state["$[]"](-1)):$)||(m=d["$[]"](c.racc_state["$[]"](-1)));l(m=c.$_racc_evalact(m,a)););for(;l(l(b=l(v=(y=h["$[]"](c.racc_state["$[]"](-1)))["$!"]())?v:c.racc_read_next["$!"]())?b:c.racc_t["$=="](0));)for(l(l(g=l(R=l(x=l(k=y)?y=n(y,c.racc_t):k)?i(y,0):x)?m=u["$[]"](y):R)?_["$[]"](y)["$=="](c.racc_state["$[]"](-1)):g)||(m=d["$[]"](c.racc_state["$[]"](-1)));l(m=c.$_racc_evalact(m,a)););}).$$s=$,t.$$arity=2,t))}).$$s=this,c.$$arity=0,c))},x.$$arity=4),t.def(M,"$_racc_evalact",k=function($,o){var c,u,_,d,h,p=s,m=s,y=s,b=s,v=s,g=s,R=s,x=s,k=s,w=s;if(p=null==(c=t.to_ary(o))[0]?s:c[0],m=null==c[1]?s:c[1],y=null==c[3]?s:c[3],_=null==c[11]?s:c[11],b=null==c[12]?s:c[12],l(l(h=a($,0))?e($,_):h))l(a(this.racc_error_status,0))&&(this.racc_t["$=="](1)||(this.racc_error_status=r(this.racc_error_status,1))),this.racc_vstack.$push(this.racc_val),this.racc_state.$push($),this.racc_read_next=!0,l(this.yydebug)&&(this.racc_tstack.$push(this.racc_t),this.$racc_shift(this.racc_t,this.racc_tstack,this.racc_vstack));else if(l(l(v=e($,0))?a($,b["$-@"]()):v)){if(g=f(this,"catch",["racc_jump"],((u=function(){var t=null==u.$$s?this:u.$$s;return null==t.racc_state&&(t.racc_state=s),t.racc_state.$push(t.$_racc_do_reduce(o,$)),!1}).$$s=this,u.$$arity=0,u)),l(g)){if(1["$==="](R=g))return this.racc_user_yyerror=!0,b["$-@"]();if(2["$==="](R))return _;this.$raise("[Racc Bug] unknown jump code")}}else if($["$=="](_))l(this.yydebug)&&this.$racc_accept(),this.$throw("racc_end_parse",this.racc_vstack["$[]"](0));else{if($["$=="](b["$-@"]())){for((0)["$==="](R=this.racc_error_status)?l(o["$[]"](21))||this.$on_error(this.racc_t,this.racc_val,this.racc_vstack):3["$==="](R)&&(this.racc_t["$=="](0)&&this.$throw("racc_end_parse",s),this.racc_read_next=!0),this.racc_user_yyerror=!1,this.racc_error_status=3;l(!0)&&(!l(x=y["$[]"](this.racc_state["$[]"](-1)))||(x=n(x,1),!l(l(k=l(w=i(x,0))?$=p["$[]"](x):w)?m["$[]"](x)["$=="](this.racc_state["$[]"](-1)):k)));)l("number"==typeof(d=this.racc_state.$size())?d<=1:d["$<="](1))&&this.$throw("racc_end_parse",s),this.racc_state.$pop(),this.racc_vstack.$pop(),l(this.yydebug)&&(this.racc_tstack.$pop(),this.$racc_e_pop(this.racc_state,this.racc_tstack,this.racc_vstack));return $}this.$raise("[Racc Bug] unknown action "+$.$inspect())}return l(this.yydebug)&&this.$racc_next_state(this.racc_state["$[]"](-1),this.racc_state),s},k.$$arity=2),t.def(M,"$_racc_do_reduce",w=function(e,a){var $,o,c,u,_,d,h,p,m=s,y=s,b=s,v=s,g=s,R=s,x=s,k=s,w=s,T=s,D=s,E=s,S=s,A=s,N=s,P=s;return m=null==($=t.to_ary(e))[4]?s:$[4],y=null==$[5]?s:$[5],b=null==$[6]?s:$[6],v=null==$[7]?s:$[7],o=null==$[8]?s:$[8],g=null==$[9]?s:$[9],c=null==$[13]?s:$[13],R=this.racc_state,x=this.racc_vstack,k=this.racc_tstack,w="number"==typeof(p=a)?-3*p:p["$*"](-3),T=g["$[]"](w),u=g["$[]"](n(w,1)),_=g["$[]"](n(w,2)),d=[],l(this.yydebug)&&(D=k["$[]"](T["$-@"](),T)),E=x["$[]"](T["$-@"](),T),l(this.yydebug)&&(S=[T["$-@"](),T,d],f(k,"[]=",t.to_a(S)),r(S.length,1)),S=[T["$-@"](),T,d],f(x,"[]=",t.to_a(S)),r(S.length,1),S=[T["$-@"](),T,d],f(R,"[]=",t.to_a(S)),r(S.length,1),l(c)?x.$push(this.$__send__(_,E,x,E["$[]"](0))):x.$push(this.$__send__(_,E,x)),k.$push(u),l(this.yydebug)&&this.$racc_reduce(D,u,k,x),h=r(u,o),l(w=v["$[]"](h))&&(w=n(w,R["$[]"](-1)),l(l(A=l(N=i(w,0))?P=m["$[]"](w):N)?y["$[]"](w)["$=="](h):A))?P:b["$[]"](h)},w.$$arity=2),t.def(M,"$on_error",T=function(t,e,r){var n;return this.$raise(c(U,"ParseError"),this.$sprintf("\nparse error on value %s (%s)",e.$inspect(),l(n=this.$token_to_str(t))?n:"?"))},T.$$arity=3),t.def(M,"$yyerror",D=function(){return this.$throw("racc_jump",1)},D.$$arity=0),t.def(M,"$yyaccept",E=function(){return this.$throw("racc_jump",2)},E.$$arity=0),t.def(M,"$yyerrok",S=function(){return this.racc_error_status=0},S.$$arity=0),t.def(M,"$racc_read_token",A=function(t,e,r){return this.racc_debug_out.$print("read    "),this.racc_debug_out.$print(e.$inspect(),"(",this.$racc_token2str(t),") "),this.racc_debug_out.$puts(r.$inspect()),this.racc_debug_out.$puts()},A.$$arity=3),t.def(M,"$racc_shift",N=function(t,e,r){return this.racc_debug_out.$puts("shift   "+this.$racc_token2str(t)),this.$racc_print_stacks(e,r),this.racc_debug_out.$puts()},N.$$arity=3),t.def(M,"$racc_reduce",P=function(t,e,r,n){var i,a=s;return(a=this.racc_debug_out).$print("reduce "),l(t["$empty?"]())?a.$print(" <none>"):f(t,"each",[],((i=function(t){return null==t&&(t=s),a.$print(" ",(null==i.$$s?this:i.$$s).$racc_token2str(t))}).$$s=this,i.$$arity=1,i)),a.$puts(" --\x3e "+this.$racc_token2str(e)),this.$racc_print_stacks(r,n),this.racc_debug_out.$puts()},P.$$arity=4),t.def(M,"$racc_accept",O=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},O.$$arity=0),t.def(M,"$racc_e_pop",z=function(t,e,r){return this.racc_debug_out.$puts("error recovering mode: pop token"),this.$racc_print_states(t),this.$racc_print_stacks(e,r),this.racc_debug_out.$puts()},z.$$arity=3),t.def(M,"$racc_next_state",C=function(t,e){return this.racc_debug_out.$puts("goto    "+t),this.$racc_print_states(e),this.racc_debug_out.$puts()},C.$$arity=2),t.def(M,"$racc_print_stacks",I=function(t,e){var r,n=s;return(n=this.racc_debug_out).$print("        ["),f(t,"each_index",[],((r=function(i){return null==i&&(i=s),n.$print(" (",(null==r.$$s?this:r.$$s).$racc_token2str(t["$[]"](i))," ",e["$[]"](i).$inspect(),")")}).$$s=this,r.$$arity=1,r)),n.$puts(" ]")},I.$$arity=2),t.def(M,"$racc_print_states",L=function(t){var e,r=s;return(r=this.racc_debug_out).$print("        ["),f(t,"each",[],((e=function(t){return null==t&&(t=s),r.$print(" ",t)}).$$s=this,e.$$arity=1,e)),r.$puts(" ]")},L.$$arity=1),t.def(M,"$racc_token2str",B=function(t){var e;return l(e=o(this.$class(),"Racc_token_to_s_table")["$[]"](t))?e:this.$raise("[Racc Bug] can't convert token "+t+" to string")},B.$$arity=1),t.def(M,"$token_to_str",q=function(t){return o(this.$class(),"Racc_token_to_s_table")["$[]"](t)},q.$$arity=1)}(p[0],0,p)}($[0],$)},Opal.modules["bcdice/arithmetic/node"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t/e:t["$/"](e)}var r=[],n=t.nil,i=t.$$$,a=t.$$,$=t.module,s=t.klass,o=t.send2;return function(r,c){var u=[$(r,"BCDice")].concat(c);!function(r,c){var u=[$(r,"Arithmetic")].concat(c);!function(r,c){var u=[$(r,"Node")].concat(c);!function(e,r,i){var a,$,o,c,u,_=s(e,null,"BinaryOp");[_].concat(i),_.$$prototype.lhs=_.$$prototype.rhs=_.$$prototype.op=n,t.def(_,"$initialize",a=function(t,e,r){return this.lhs=t,this.op=e,this.rhs=r},a.$$arity=3),t.def(_,"$eval",$=function(t){var e,r=n;return r=this.lhs.$eval(t),e=this.rhs.$eval(t),r.$send(this.op,e)},$.$$arity=1),t.def(_,"$output",o=function(){return""+this.lhs.$output()+this.op+this.rhs.$output()},o.$$arity=0),t.def(_,"$s_exp",c=function(){return"("+this.$op_for_s_exp()+" "+this.lhs.$s_exp()+" "+this.rhs.$s_exp()+")"},c.$$arity=0),t.def(_,"$op_for_s_exp",u=function(){return this.op},u.$$arity=0)}(u[0],0,u),function(e,r,$){var c,u,_,l,d,f,h=s(e,r,"DivideBase"),p=[h].concat($);h.$$prototype.lhs=h.$$prototype.rhs=h.$$prototype.op=n,t.def(h,"$initialize",c=function(e,r){return c.$$p&&(c.$$p=null),o(this,t.find_super_dispatcher(this,"initialize",c,!1,!0),"initialize",[e,"/",r],null)},c.$$arity=2),t.def(h,"$eval",u=function(t){var e,r=n;return e=this.lhs.$eval(t),(r=this.rhs.$eval(t))["$=="](0)&&this.$raise(a(p,"ZeroDivisionError")),this.$divide_and_round(e,r,t)},u.$$arity=1),t.def(h,"$output",_=function(){var e=_.$$p,r=this,i=n,a=n,$=n;for(e&&(_.$$p=null),a=0,$=arguments.length,i=new Array($);a<$;a++)i[a]=arguments[a];return""+o(r,t.find_super_dispatcher(r,"output",_,!1,!0),"output",i,e)+r.$rounding_method()},_.$$arity=0),h.$private(),t.def(h,"$rounding_method",l=function(){return i(this.$class(),"ROUNDING_METHOD")},l.$$arity=0),t.def(h,"$op_for_s_exp",d=function(){return""+this.op+this.$rounding_method()},d.$$arity=0),t.def(h,"$divide_and_round",f=function(t,e,r){return this.$raise(a(p,"NotImplementedError"))},f.$$arity=3)}(u[0],a(u,"BinaryOp"),u),function(r,n,$){var o,c=s(r,n,"DivideWithGameSystemDefault"),u=[c].concat($);t.const_set(u[0],"ROUNDING_METHOD",""),c.$private(),t.def(c,"$divide_and_round",o=function(t,r,n){var $;return $=n,i(a(u,"RoundType"),"CEIL")["$==="]($)?e(t.$to_f(),r).$ceil():i(a(u,"RoundType"),"ROUND")["$==="]($)?e(t.$to_f(),r).$round():e(t,r).$to_i()},o.$$arity=3)}(u[0],a(u,"DivideBase"),u),function(r,n,i){var a,$=s(r,n,"DivideWithCeil"),o=[$].concat(i);t.const_set(o[0],"ROUNDING_METHOD","C"),$.$private(),t.def($,"$divide_and_round",a=function(t,r,n){return e(t.$to_f(),r).$ceil()},a.$$arity=3)}(u[0],a(u,"DivideBase"),u),function(r,n,i){var a,$=s(r,n,"DivideWithRound"),o=[$].concat(i);t.const_set(o[0],"ROUNDING_METHOD","R"),$.$private(),t.def($,"$divide_and_round",a=function(t,r,n){return e(t.$to_f(),r).$round()},a.$$arity=3)}(u[0],a(u,"DivideBase"),u),function(r,n,i){var a,$=s(r,n,"DivideWithFloor"),o=[$].concat(i);t.const_set(o[0],"ROUNDING_METHOD","F"),$.$private(),t.def($,"$divide_and_round",a=function(t,r,n){return e(t,r).$to_i()},a.$$arity=3)}(u[0],a(u,"DivideBase"),u),function(e,r,i){var a,$,o,c,u=s(e,null,"Negative");[u].concat(i),u.$$prototype.body=n,t.def(u,"$initialize",a=function(t){return this.body=t},a.$$arity=1),t.def(u,"$eval",$=function(t){return this.body.$eval(t)["$-@"]()},$.$$arity=1),t.def(u,"$output",o=function(){return"-"+this.body.$output()},o.$$arity=0),t.def(u,"$s_exp",c=function(){return"(- "+this.body.$s_exp()+")"},c.$$arity=0)}(u[0],0,u),function(e,r,i){var a,$,o,c,u=s(e,null,"Parenthesis");[u].concat(i),u.$$prototype.expr=n,t.def(u,"$initialize",a=function(t){return this.expr=t},a.$$arity=1),t.def(u,"$eval",$=function(t){return this.expr.$eval(t)},$.$$arity=1),t.def(u,"$output",o=function(){return"("+this.expr.$output()+")"},o.$$arity=0),t.def(u,"$s_exp",c=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},c.$$arity=0)}(u[0],0,u),function(e,r,i){var a,$,o,c=s(e,null,"Number");[c].concat(i),c.$$prototype.value=n,t.def(c,"$initialize",a=function(t){return this.value=t},a.$$arity=1),t.def(c,"$eval",$=function(t){return this.value},$.$$arity=1),t.def(c,"$output",o=function(){return this.value.$to_s()},o.$$arity=0),t.alias(c,"s_exp","output")}(u[0],0,u)}(u[0],u)}(u[0],u)}(r[0],r)},Opal.modules.strscan=function(t){var e=[],r=t.nil,n=t.$$,i=t.klass,a=t.truthy,$=t.send;return function(e,s,o){var c,u,_,l,d,f,h,p,m,y,b,v,g,R,x,k,w,T,D,E,S,A,N,P,O,z=i(e,null,"StringScanner"),C=[z].concat(o);return z.$$prototype.pos=z.$$prototype.string=z.$$prototype.working=z.$$prototype.matched=z.$$prototype.prev_pos=z.$$prototype.match=r,z.$attr_reader("pos"),z.$attr_reader("matched"),t.def(z,"$initialize",c=function(t){return this.string=t,this.pos=0,this.matched=r,this.working=t,this.match=[]},c.$$arity=1),z.$attr_reader("string"),t.def(z,"$beginning_of_line?",u=function(){return 0===this.pos||"\n"===this.string.charAt(this.pos-1)},u.$$arity=0),t.alias(z,"bol?","beginning_of_line?"),t.def(z,"$scan",_=function(t){var e=(t=this.$anchor(t)).exec(this.working);return null==e?this.matched=r:"object"==typeof e?(this.prev_pos=this.pos,this.pos+=e[0].length,this.working=this.working.substring(e[0].length),this.matched=e[0],this.match=e,e[0]):"string"==typeof e?(this.pos+=e.length,this.working=this.working.substring(e.length),e):r},_.$$arity=1),t.def(z,"$scan_until",l=function(t){t=this.$anchor(t);for(var e,n=this.pos,i=this.working;;){if(e=t.exec(i),n+=1,i=i.substr(1),null!=e)return this.matched=this.string.substr(this.pos,n-this.pos-1+e[0].length),this.match=e,this.prev_pos=n-1,this.pos=n,this.working=i.substr(e[0].length),this.matched;if(0===i.length)return this.match=[],this.matched=r}},l.$$arity=1),t.def(z,"$[]",d=function(t){var e;if(a(this.match["$empty?"]()))return r;e=t,n(C,"Symbol")["$==="](e)?t=t.$to_s():n(C,"String")["$==="](e)||(t=n(C,"Opal")["$coerce_to!"](t,n(C,"Integer"),"to_int"));var i=this.match;return t<0&&(t+=i.length),t<0||t>=i.length||null==i[t]?r:i[t]},d.$$arity=1),t.def(z,"$check",f=function(t){var e=(t=this.$anchor(t)).exec(this.working);return this.matched=null==e?r:e[0]},f.$$arity=1),t.def(z,"$check_until",h=function(t){var e=this.prev_pos,n=this.pos,i=this.$scan_until(t);return i!==r&&(this.matched=i.substr(-1),this.working=this.string.substr(n)),this.prev_pos=e,this.pos=n,i},h.$$arity=1),t.def(z,"$peek",p=function(t){return this.working.substring(0,t)},p.$$arity=1),t.def(z,"$eos?",m=function(){return 0===this.working.length},m.$$arity=0),t.def(z,"$exist?",y=function(t){var e=t.exec(this.working);return null==e?r:0==e.index?0:e.index+1},y.$$arity=1),t.def(z,"$skip",b=function(t){var e=(t=this.$anchor(t)).exec(this.working);if(null==e)return this.match=[],this.matched=r;var n=e[0],i=n.length;return this.matched=n,this.match=e,this.prev_pos=this.pos,this.pos+=i,this.working=this.working.substring(i),i},b.$$arity=1),t.def(z,"$skip_until",v=function(t){var e=this.$scan_until(t);return e===r?r:(this.matched=e.substr(-1),e.length)},v.$$arity=1),t.def(z,"$get_byte",g=function(){var t=r;return this.pos<this.string.length?(this.prev_pos=this.pos,this.pos+=1,t=this.matched=this.working.substring(0,1),this.working=this.working.substring(1)):this.matched=r,t},g.$$arity=0),t.alias(z,"getch","get_byte"),t.def(z,"$match?",R=function(t){var e=(t=this.$anchor(t)).exec(this.working);return null==e?r:(this.prev_pos=this.pos,e[0].length)},R.$$arity=1),t.def(z,"$pos=",x=function(t){return t<0&&(t+=this.string.$length()),this.pos=t,this.working=this.string.slice(t)},x.$$arity=1),t.def(z,"$matched_size",k=function(){return this.matched===r?r:this.matched.length},k.$$arity=0),t.def(z,"$post_match",w=function(){return this.matched===r?r:this.string.substr(this.pos)},w.$$arity=0),t.def(z,"$pre_match",T=function(){return this.matched===r?r:this.string.substr(0,this.prev_pos)},T.$$arity=0),t.def(z,"$reset",D=function(){return this.working=this.string,this.matched=r,this.pos=0},D.$$arity=0),t.def(z,"$rest",E=function(){return this.working},E.$$arity=0),t.def(z,"$rest?",S=function(){return 0!==this.working.length},S.$$arity=0),t.def(z,"$rest_size",A=function(){return this.$rest().$size()},A.$$arity=0),t.def(z,"$terminate",N=function(){var e,n;return this.match=r,e=[this.string.$length()],$(this,"pos=",t.to_a(e)),e[(n=e.length,"number"==typeof n?n-1:n["$-"](1))]},N.$$arity=0),t.def(z,"$unscan",P=function(){return this.pos=this.prev_pos,this.prev_pos=r,this.match=r,this},P.$$arity=0),z.$private(),t.def(z,"$anchor",O=function(t){var e=t.toString().match(/\/([^\/]+)$/);return e=e?e[1]:void 0,new RegExp("^(?:"+t.source+")",e)},O.$$arity=1),r&&"anchor"}(e[0],0,e)},Opal.modules["bcdice/normalize"]=function(t){var e=[],r=t.nil,n=t.module;return function(e,i){var a=[n(e,"BCDice")].concat(i);!function(e,i){var a,$,s=n(e,"Normalize");[s].concat(i),s.$module_function(),t.def(s,"$comparison_operator",a=function(t){var e;return/<=|=</["$==="](e=t)?"<=":/>=|=>/["$==="](e)?">=":/<>|!=|=!/["$==="](e)?"!=":/</["$==="](e)?"<":/>/["$==="](e)?">":/=/["$==="](e)?"==":r},a.$$arity=1),t.def(s,"$target_number",$=function(t){return t["$=="]("?")?t:t.$to_i()},$.$$arity=1)}(a[0],a)}(e[0],e)},Opal.modules["bcdice/command/lexer"]=function(t){var e=t.top,r=[],n=t.nil,i=t.$$,a=t.module,$=t.klass,s=t.hash2,o=t.truthy,c=t.send;return e.$require("strscan"),e.$require("bcdice/normalize"),function(e,r){var u=[a(e,"BCDice")].concat(r);!function(e,r){var u=[a(e,"Command")].concat(r);!function(e,r,a){var u,_,l,d=$(e,null,"Lexer"),f=[d].concat(a);d.$$prototype.scanner=d.$$prototype.notations=n,t.const_set(f[0],"SYMBOLS",s(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),t.def(d,"$initialize",u=function(t,e){var r,a,$,s;return t=o(s=(a=(r=t)===n||null==r?n:c(r,"split",[" ",2]))===n||null==a?n:c(a,"first",[]))?s:"",this.scanner=i(f,"StringScanner").$new(t),this.notations=c(e,"map",[],(($=function(t){return null==t&&(t=n),o(t["$is_a?"](i(f,"String")))?i(f,"Regexp").$new(t):t}).$$s=this,$.$$arity=1,$))},u.$$arity=2),t.def(d,"$next_token",_=function(){try{var e,r=n,a=n,$=n,s=n;return o(this.scanner["$eos?"]())?[!1,"$"]:(c(this.notations,"each",[],((e=function(r){var i,a=null==e.$$s?this:e.$$s;if(null==a.scanner&&(a.scanner=n),null==r&&(r=n),i=a.scanner.$scan(r),!o(i))return n;t.ret(["NOTATION",i])}).$$s=this,e.$$arity=1,e)),o(r=this.scanner.$scan(/\d+/))?["NUMBER",r.$to_i()]:o(a=this.scanner.$scan(/[<>!=]+/))?(a=i(f,"Normalize").$comparison_operator(a),[o(a)?"CMP_OP":"ILLEGAL",a]):($=this.scanner.$getch().$upcase(),[o(s=i(f,"SYMBOLS")["$[]"]($))?s:$.$to_sym(),$]))}catch(u){if(u===t.returner)return u.$v;throw u}},_.$$arity=0),t.def(d,"$source",l=function(){return this.scanner.$string()},l.$$arity=0)}(u[0],0,u)}(u[0],u)}(r[0],r)},Opal.modules["bcdice/command/parsed"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.truthy;return function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"Command")].concat(s);!function(e,i,s){var o,c,u,_=a(e,null,"Parsed"),l=[_].concat(s);_.$$prototype.question_target=_.$$prototype.critical=_.$$prototype.fumble=_.$$prototype.dollar=_.$$prototype.modify_number=_.$$prototype.target_number=_.$$prototype.prefix_number=_.$$prototype.command=_.$$prototype.suffix_number=_.$$prototype.cmp_op=r,_.$attr_accessor("command"),_.$attr_accessor("prefix_number"),_.$attr_accessor("suffix_number"),_.$attr_accessor("critical"),_.$attr_accessor("fumble"),_.$attr_accessor("dollar"),_.$attr_accessor("modify_number"),_.$attr_accessor("cmp_op"),_.$attr_accessor("target_number"),_.$attr_writer("question_target"),t.def(_,"$initialize",o=function(){return this.prefix_number=r,this.suffix_number=r,this.critical=r,this.fumble=r,this.dollar=r,this.cmp_op=r,this.target_number=r,this.question_target=!1},o.$$arity=0),t.def(_,"$question_target?",c=function(){return this.question_target},c.$$arity=0),t.def(_,"$to_s",u=function(t){var e,i=r,a=r,s=r,o=r,c=r;return null==t&&(t="after_command"),i=$(this.critical)?"@"+this.critical:r,a=$(this.fumble)?"#"+this.fumble:r,s=$(this.dollar)?"$"+this.dollar:r,o=n(l,"Format").$modifier(this.modify_number),c=$(this.question_target)?"?":this.target_number,"after_command"["$==="](e=t)?[this.prefix_number,this.command,this.suffix_number,i,a,s,o,this.cmp_op,c].$join():"after_modify_number"["$==="](e)?[this.prefix_number,this.command,this.suffix_number,o,i,a,s,this.cmp_op,c].$join():"after_target_number"["$==="](e)?[this.prefix_number,this.command,this.suffix_number,o,this.cmp_op,c,i,a,s].$join():r},u.$$arity=-1)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/command/parser"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r,n,i,a=t.top,$=[],s=t.nil,o=t.$$$,c=t.$$,u=t.klass,_=t.module,l=t.hash2,d=t.send2,f=t.send,h=t.hash,p=t.truthy;return a.$require("racc/parser.rb"),a.$require("bcdice/arithmetic/node"),a.$require("bcdice/command/lexer"),a.$require("bcdice/command/parsed"),r=o(c($,"BCDice"),"Command"),n=o(c($,"Racc"),"Parser"),i=$,[u(r,n,"Parser")].concat(i),function(r,n){var i=[_(r,"BCDice")].concat(n);!function(r,n){var i=[_(r,"Command")].concat(n);!function(r,n,i){var a,$,_,m,y,b,v,g,R,x,k,w,T,D,E,S,A,N,P,O,z,C,I,L,B,q,M,U,K,F,H,G,j,W,Y,V,Q,Z,J,X,tt,et,rt,nt,it,at,$t,st,ot,ct,ut,_t,lt,dt,ft,ht,pt=u(r,n,"Parser"),mt=[pt].concat(i);pt.$$prototype.notations=pt.$$prototype.lexer=pt.$$prototype.modifier=pt.$$prototype.prefix_number=pt.$$prototype.suffix_number=pt.$$prototype.need_suffix_number=pt.$$prototype.need_prefix_number=pt.$$prototype.critical=pt.$$prototype.fumble=pt.$$prototype.dollar=pt.$$prototype.allowed_cmp_op=pt.$$prototype.question_target=s,t.def(pt,"$initialize",a=function(e,r){var n,i,$,o,c=a.$$p,u=this;if(c&&(a.$$p=null),n=t.slice.call(arguments,0,arguments.length),null==(i=t.extract_kwargs(n)))i=l([],{});else if(!i.$$is_hash)throw t.ArgumentError.$new("expected kwargs");if($=n,!t.hasOwnProperty.call(i.$$smap,"round_type"))throw t.ArgumentError.$new("missing keyword: round_type");return o=i.$$smap.round_type,d(u,t.find_super_dispatcher(u,"initialize",a,!1,!0),"initialize",[],null),u.notations=$,u.round_type=o,u.prefix_number=!1,u.suffix_number=!1,u.need_prefix_number=!1,u.need_suffix_number=!1,u.modifier=!0,u.critical=!1,u.fumble=!1,u.dollar=!1,u.allowed_cmp_op=[s,">=",">","<=","<","==","!="],u.question_target=!1},a.$$arity=-2),t.def(pt,"$disable_modifier",$=function(){return this.modifier=!1,this},$.$$arity=0),t.def(pt,"$enable_prefix_number",_=function(){return this.prefix_number=!0,this},_.$$arity=0),t.def(pt,"$enable_suffix_number",m=function(){return this.suffix_number=!0,this},m.$$arity=0),t.def(pt,"$has_prefix_number",y=function(){return this.prefix_number=!0,this.need_prefix_number=!0,this},y.$$arity=0),t.def(pt,"$has_suffix_number",b=function(){return this.suffix_number=!0,this.need_suffix_number=!0,this},b.$$arity=0),t.def(pt,"$enable_critical",v=function(){return this.critical=!0,this},v.$$arity=0),t.def(pt,"$enable_fumble",g=function(){return this.fumble=!0,this},g.$$arity=0),t.def(pt,"$enable_dollar",R=function(){return this.dollar=!0,this},R.$$arity=0),t.def(pt,"$restrict_cmp_op_to",x=function(e){var r,n=this;return r=t.slice.call(arguments,0,arguments.length),n.allowed_cmp_op=r,n},x.$$arity=-1),t.def(pt,"$enable_question_target",k=function(){return this.question_target=!0,this},k.$$arity=0),t.def(pt,"$parse",w=function(e){try{return this.lexer=c(mt,"Lexer").$new(e,this.notations),this.$do_parse()}catch(r){if(!t.rescue(r,[c(mt,"ParseError"),c(mt,"ZeroDivisionError")]))throw r;try{return s}finally{t.pop_exception()}}},w.$$arity=1),pt.$private(),t.def(pt,"$parsed",T=function(r,n,i,a){var $;return f(c(mt,"Parsed").$new(),"tap",[],(($=function(o){var c,u,_,l,d,h,p=null==$.$$s?this:$.$$s,m=s;return null==p.round_type&&(p.round_type=s),null==o&&(o=s),m=[r["$[]"]("command")],f(o,"command=",t.to_a(m)),e(m.length,1),m=[(c=r["$[]"]("prefix"),c===s||null==c?s:f(c,"eval",[p.round_type]))],f(o,"prefix_number=",t.to_a(m)),e(m.length,1),m=[(u=r["$[]"]("suffix"),u===s||null==u?s:f(u,"eval",[p.round_type]))],f(o,"suffix_number=",t.to_a(m)),e(m.length,1),m=[(_=n["$[]"]("critical"),_===s||null==_?s:f(_,"eval",[p.round_type]))],f(o,"critical=",t.to_a(m)),e(m.length,1),m=[(l=n["$[]"]("fumble"),l===s||null==l?s:f(l,"eval",[p.round_type]))],f(o,"fumble=",t.to_a(m)),e(m.length,1),m=[(d=n["$[]"]("dollar"),d===s||null==d?s:f(d,"eval",[p.round_type]))],f(o,"dollar=",t.to_a(m)),e(m.length,1),m=[i.$eval(p.round_type)],f(o,"modify_number=",t.to_a(m)),e(m.length,1),m=[a["$[]"]("cmp_op")],f(o,"cmp_op=",t.to_a(m)),e(m.length,1),a["$[]"]("target")["$=="]("?")?(f(o,"question_target=",t.to_a(m=[!0])),e(m.length,1),f(o,"target_number=",t.to_a(m=[0])),m[e(m.length,1)]):(f(o,"question_target=",t.to_a(m=[!1])),e(m.length,1),m=[(h=a["$[]"]("target"),h===s||null==h?s:f(h,"eval",[p.round_type]))],f(o,"target_number=",t.to_a(m)),m[e(m.length,1)])}).$$s=this,$.$$arity=1,$))},T.$$arity=4),t.def(pt,"$next_token",D=function(){return this.lexer.$next_token()},D.$$arity=0),$t=[6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,s,5,36,37,17,18,6,s,5,36,37,17,18,6,s,5,36,37,17,18,6,s,5,33,34,17,18,6,s,5,36,37,17,18,6,s,5,36,37,17,18,6,s,5,36,37,17,18,6,s,5,36,37,17,18,6,s,5,s,s,17,18,6,s,5,s,s,17,18,s,s,5,23,24,25,26,56,54,55,57],st=[0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,s,17,15,15,18,18,23,s,18,30,30,23,23,24,s,23,31,31,24,24,25,s,24,44,44,25,25,28,s,25,47,47,28,28,29,s,28,48,48,29,29,33,s,29,49,49,33,33,34,s,33,50,50,34,34,36,s,34,s,s,36,36,37,s,36,s,s,37,37,s,s,37,27,27,27,27,52,52,52,52],ot=[-2,4,16,-3,-1,11,s,33,13,35,23,30,1,s,28,40,s,37,44,s,s,-2,s,51,58,65,0,106,72,79,47,54,s,86,93,s,100,107,s,s,s,s,s,s,63,s,s,68,75,82,89,s,120,s,s,s,s,s],ct=[-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29],ut=[30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,s,s,21,47,48,40,51,52,49,50,44,46,3,s,s,s,13,s,s,s,s,s,s,s,32],_t=[8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,s,s,4,8,8,5,7,7,8,8,9,5,6,s,s,s,6,s,s,s,s,s,s,s,6],lt=[s,6,13,3,9,-1,27,-15,-10,-1,-38],dt=[s,s,s,s,s,s,19,16,15,s,s],ft=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",3,21,"_reduce_4",2,21,"_reduce_5",2,21,"_reduce_6",1,21,"_reduce_7",0,22,"_reduce_8",3,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",2,23,"_reduce_12",2,23,"_reduce_13",3,23,"_reduce_14",3,23,"_reduce_15",0,24,"_reduce_16",2,24,"_reduce_17",2,24,"_reduce_18",3,28,"_reduce_19",3,28,"_reduce_20",1,28,"_reduce_none",3,27,"_reduce_22",4,27,"_reduce_23",1,27,"_reduce_none",0,29,"_reduce_25",1,29,"_reduce_26",1,29,"_reduce_27",1,29,"_reduce_28",1,29,"_reduce_29",2,26,"_reduce_30",2,26,"_reduce_31",1,26,"_reduce_none",3,25,"_reduce_33",1,25,"_reduce_34"],ht=h(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),t.const_set(mt[0],"Racc_arg",[$t,st,ct,ot,ut,_t,dt,lt,19,ft,ht,58,35,!0]),t.const_set(mt[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),t.const_set(mt[0],"Racc_debug_parser",!1),t.def(pt,"$_reduce_1",E=function(e,r,n){var i;return p(this.modifier)||this.$raise(c(mt,"ParseError")),i=t.to_ary(e),this.$parsed(null==i[0]?s:i[0],null==i[1]?s:i[1],null==i[2]?s:i[2],null==i[3]?s:i[3])},E.$$arity=3),t.def(pt,"$_reduce_2",S=function(e,r,n){var i;return p(this.modifier)||this.$raise(c(mt,"ParseError")),i=t.to_ary(e),this.$parsed(null==i[0]?s:i[0],null==i[2]?s:i[2],null==i[1]?s:i[1],null==i[3]?s:i[3])},S.$$arity=3),t.def(pt,"$_reduce_3",A=function(e,r,n){var i,a;return a=null==(i=t.to_ary(e))[2]?s:i[2],this.$parsed(null==i[0]?s:i[0],null==i[1]?s:i[1],o(o(c(mt,"Arithmetic"),"Node"),"Number").$new(0),a)},A.$$arity=3),t.def(pt,"$_reduce_4",N=function(t,e,r){var n;return p(p(n=this.prefix_number)?this.suffix_number:n)||this.$raise(c(mt,"ParseError")),l(["command","prefix","suffix"],{command:t["$[]"](1),prefix:t["$[]"](0),suffix:t["$[]"](2)})},N.$$arity=3),t.def(pt,"$_reduce_5",P=function(t,e,r){return p(this.prefix_number)||this.$raise(c(mt,"ParseError")),p(this.need_suffix_number)&&this.$raise(c(mt,"ParseError")),l(["command","prefix"],{command:t["$[]"](1),prefix:t["$[]"](0)})},P.$$arity=3),t.def(pt,"$_reduce_6",O=function(t,e,r){return p(this.suffix_number)||this.$raise(c(mt,"ParseError")),p(this.need_prefix_number)&&this.$raise(c(mt,"ParseError")),l(["command","suffix"],{command:t["$[]"](0),suffix:t["$[]"](1)})},O.$$arity=3),t.def(pt,"$_reduce_7",z=function(t,e,r){var n;return p(p(n=this.need_prefix_number)?n:this.need_suffix_number)&&this.$raise(c(mt,"ParseError")),l(["command"],{command:t["$[]"](0)})},z.$$arity=3),t.def(pt,"$_reduce_8",C=function(t,e,r){return l([],{})},C.$$arity=3),t.def(pt,"$_reduce_9",I=function(r,n,i){var a,$,o,u,_=s;return _=null==(a=t.to_ary(r))[0]?s:a[0],$=null==a[2]?s:a[2],p(p(u=this.critical)?_["$[]"]("critical")["$nil?"]():u)||this.$raise(c(mt,"ParseError")),f(_,"[]=",t.to_a(o=["critical",$])),e(o.length,1),_},I.$$arity=3),t.def(pt,"$_reduce_10",L=function(r,n,i){var a,$,o,u,_=s;return _=null==(a=t.to_ary(r))[0]?s:a[0],$=null==a[2]?s:a[2],p(p(u=this.fumble)?_["$[]"]("fumble")["$nil?"]():u)||this.$raise(c(mt,"ParseError")),f(_,"[]=",t.to_a(o=["fumble",$])),e(o.length,1),_},L.$$arity=3),t.def(pt,"$_reduce_11",B=function(r,n,i){var a,$,o,u,_=s;return _=null==(a=t.to_ary(r))[0]?s:a[0],$=null==a[2]?s:a[2],p(p(u=this.dollar)?_["$[]"]("dollar")["$nil?"]():u)||this.$raise(c(mt,"ParseError")),f(_,"[]=",t.to_a(o=["dollar",$])),e(o.length,1),_},B.$$arity=3),t.def(pt,"$_reduce_12",q=function(t,e,r){return t["$[]"](1)},q.$$arity=3),t.def(pt,"$_reduce_13",M=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"Negative").$new(t["$[]"](1))},M.$$arity=3),t.def(pt,"$_reduce_14",U=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"+",t["$[]"](2))},U.$$arity=3),t.def(pt,"$_reduce_15",K=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"-",t["$[]"](2))},K.$$arity=3),t.def(pt,"$_reduce_16",F=function(t,e,r){return p(this.allowed_cmp_op["$include?"](s))||this.$raise(c(mt,"ParseError")),l([],{})},F.$$arity=3),t.def(pt,"$_reduce_17",H=function(e,r,n){var i,a,$;return $=null==(i=t.to_ary(e))[1]?s:i[1],p(this.allowed_cmp_op["$include?"](a=null==i[0]?s:i[0]))||this.$raise(c(mt,"ParseError")),l(["cmp_op","target"],{cmp_op:a,target:$})},H.$$arity=3),t.def(pt,"$_reduce_18",G=function(t,e,r){var n;return n=t["$[]"](0),p(this.question_target)||this.$raise(c(mt,"ParseError")),p(this.allowed_cmp_op["$include?"](n))||this.$raise(c(mt,"ParseError")),l(["cmp_op","target"],{cmp_op:n,target:"?"})},G.$$arity=3),t.def(pt,"$_reduce_19",j=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"+",t["$[]"](2))},j.$$arity=3),t.def(pt,"$_reduce_20",W=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"-",t["$[]"](2))},W.$$arity=3),t.def(pt,"$_reduce_22",Y=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"*",t["$[]"](2))},Y.$$arity=3),t.def(pt,"$_reduce_23",V=function(t,e,r){return t["$[]"](3).$new(t["$[]"](0),t["$[]"](2))},V.$$arity=3),t.def(pt,"$_reduce_25",Q=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},Q.$$arity=3),t.def(pt,"$_reduce_26",Z=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"DivideWithCeil")},Z.$$arity=3),t.def(pt,"$_reduce_27",J=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"DivideWithCeil")},J.$$arity=3),t.def(pt,"$_reduce_28",X=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"DivideWithRound")},X.$$arity=3),t.def(pt,"$_reduce_29",tt=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"DivideWithFloor")},tt.$$arity=3),t.def(pt,"$_reduce_30",et=function(t,e,r){return t["$[]"](1)},et.$$arity=3),t.def(pt,"$_reduce_31",rt=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"Negative").$new(t["$[]"](1))},rt.$$arity=3),t.def(pt,"$_reduce_33",nt=function(t,e,r){return t["$[]"](1)},nt.$$arity=3),t.def(pt,"$_reduce_34",it=function(t,e,r){return o(o(c(mt,"Arithmetic"),"Node"),"Number").$new(t["$[]"](0))},it.$$arity=3),t.def(pt,"$_reduce_none",at=function(t,e,r){return t["$[]"](0)},at.$$arity=3)}(i[0],o(c(i,"Racc"),"Parser"),i)}(i[0],i)}($[0],$)},Opal.modules["bcdice/deprecated/checker"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.send,$=t.truthy;return function(e,s){var o=[i(e,"BCDice")].concat(s);!function(e,s){var o=[i(e,"Deprecated")].concat(s);!function(e,s){var o,c,u,_,l,d,f=i(e,"Checker"),h=[f].concat(s);f.$private(),t.def(f,"$check_result_legacy",o=function(t,e,i,s){var o,c,u=r,_=r,l=r,d=r,f=r;return u=a(e,"map",[],"sides".$to_proc()),o=(_=a(e,"map",[],"value".$to_proc())).$sum(),l=[100]["$==="](d=u)?this.$check_1D100(t,o,i,s):[20]["$==="](d)?this.$check_1D20(t,o,i,s):[6,6]["$==="](d)?this.$check_2D6(t,o,_,i,s):r,$($(c=l["$nil?"]())?c:l["$empty?"]())?(d=u.$uniq(),l=[10]["$==="](d)?this.$check_nD10(t,o,_,i,s):[6]["$==="](d)?this.$check_nD6(t,o,_,i,s):r,$($(f=l["$nil?"]())?f:l["$empty?"]())?r:n(h,"Result").$new(l.$delete_prefix(" \uff1e "))):n(h,"Result").$new(l.$delete_prefix(" \uff1e "))},o.$$arity=4),t.def(f,"$check_1D100",c=function(t,e,n,i){return r},c.$$arity=4),t.def(f,"$check_1D20",u=function(t,e,n,i){return r},u.$$arity=4),t.def(f,"$check_nD10",_=function(t,e,n,i,a){return r},_.$$arity=5),t.def(f,"$check_2D6",l=function(t,e,n,i,a){return r},l.$$arity=5),t.def(f,"$check_nD6",d=function(t,e,n,i,a){return r},d.$$arity=5)}(o[0],o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/base"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var n=t.top,i=[],a=t.nil,$=t.$$$,s=t.$$,o=t.module,c=t.klass,u=t.truthy,_=t.send,l=t.range,d=a;return n.$require("i18n"),n.$require("i18n/backend/fallbacks"),n.$require("bcdice/randomizer"),n.$require("bcdice/dice_table"),n.$require("bcdice/enum"),n.$require("bcdice/translate"),n.$require("bcdice/result"),n.$require("bcdice/command/parser"),n.$require("bcdice/deprecated/checker"),function(n,i){var d=[o(n,"BCDice")].concat(i);!function(n,i,o){var d,f,h,p,m,y,b,v,g,R,x,k,w,T,D,E,S,A,N,P,O,z,C,I,L,B,q,M,U,K=c(n,null,"Base"),F=[K].concat(o);K.$$prototype.sort_add_dice=K.$$prototype.sort_barabara_dice=K.$$prototype.enabled_d9=K.$$prototype.raw_input=K.$$prototype.randomizer=K.$$prototype.enabled_upcase_input=K.$$prototype.debug=a,function(r,n){var i,o,c,l,d,f=[r].concat(n);r.$attr_reader("prefixes"),t.def(r,"$register_prefix",i=function(e){var r,n=this,i=a;return null==n.prefixes&&(n.prefixes=a),r=t.slice.call(arguments,0,arguments.length),n.prefixes=u(i=n.prefixes)?i:[],n.prefixes.$concat(r.$flatten())},i.$$arity=-1),t.def(r,"$register_prefix_from_super_class",o=function(){return this.$register_prefix(this.$superclass().$prefixes())},o.$$arity=0),t.def(r,"$prefixes_pattern",c=function(){var e,r=a;return null==this.prefixes_pattern&&(this.prefixes_pattern=a),null==this.prefixes&&(this.prefixes=a),this.prefixes_pattern=u(e=this.prefixes_pattern)?e:a,u(this.prefixes_pattern)?this.prefixes_pattern:(this.prefixes=u(r=this.prefixes)?r:[],this.prefixes.$freeze(),this.prefixes_pattern=(u(this.prefixes["$empty?"]())?/(?!)/:t.regexp(["^(S)?(",this.prefixes.$join("|"),")"],"i")).$freeze())},c.$$arity=0),t.def(r,"$command_pattern",l=function(){var r,n,i=a,o=a;return null==this.command_pattern&&(this.command_pattern=a),null==this.prefixes&&(this.prefixes=a),this.command_pattern=u(n=this.command_pattern)?n:a,u(this.command_pattern)?this.command_pattern:(this.prefixes=u(i=this.prefixes)?i:[],this.prefixes.$freeze(),o=e(_($(s(f,"CommonCommand"),"COMMANDS"),"map",[],((r=function(t){return null==t&&(t=a),$(t,"PREFIX_PATTERN").$source()}).$$s=this,r.$$arity=1,r)),this.prefixes),this.command_pattern=t.regexp(["^S?(",o.$join("|"),")"],"i").$freeze())},l.$$arity=0),t.def(r,"$eval",d=function(t){return this.$new(t).$eval()},d.$$arity=1)}(t.get_singleton_class(K),F),K.$include(s(F,"Translate")),K.$include($(s(F,"Deprecated"),"Checker")),t.def(K,"$initialize",d=function(t){return this.raw_input=t,this.sort_add_dice=!1,this.sort_barabara_dice=!1,this.d66_sort_type=$(s(F,"D66SortType"),"NO_SORT"),this.enabled_d9=!1,this.round_type=$(s(F,"RoundType"),"FLOOR"),this.sides_implicit_d=6,this.upper_dice_reroll_threshold=a,this.reroll_dice_reroll_threshold=a,this.default_cmp_op=a,this.default_target_number=a,this.enabled_upcase_input=!0,this.locale="ja_jp",this.randomizer=$(s(F,"BCDice"),"Randomizer").$new(),this.debug=!1},d.$$arity=1),K.$attr_accessor("randomizer"),K.$attr_reader("d66_sort_type"),K.$attr_reader("round_type"),K.$attr_reader("sides_implicit_d"),K.$attr_reader("upper_dice_reroll_threshold"),K.$attr_reader("reroll_dice_reroll_threshold"),K.$attr_reader("default_cmp_op"),K.$attr_reader("default_target_number"),t.def(K,"$sort_add_dice?",f=function(){return this.sort_add_dice},f.$$arity=0),t.def(K,"$sort_barabara_dice?",h=function(){return this.sort_barabara_dice},h.$$arity=0),t.def(K,"$enabled_d9?",p=function(){return this.enabled_d9},p.$$arity=0),t.def(K,"$enable_debug",m=function(){return this.debug=!0},m.$$arity=0),t.def(K,"$eval",y=function(){var e,n,i,o=a;return e=$(s(F,"BCDice"),"Preprocessor").$process(this.raw_input,this),n=u(i=this.$dice_command(e))?i:this.$eval_common_command(this.raw_input),u(n)?(o=[this.randomizer.$rand_results()],_(n,"rands=",t.to_a(o)),r(o.length,1),o=[this.randomizer.$detailed_rand_results()],_(n,"detailed_rands=",t.to_a(o)),r(o.length,1),n):a},y.$$arity=0),t.def(K,"$change_text",b=function(t){return t},b.$$arity=1),t.def(K,"$check_result",v=function(t,e,r,n){var i,$=a,o=a,c=a,l=a;return $=this.$check_result_legacy(t,e,r,n),u($)?$:(o=_(e,"map",[],"sides".$to_proc()),i=(c=_(e,"map",[],"value".$to_proc())).$sum(),($=[100]["$==="](l=o)?this.$result_1d100(t,i,r,n):[20]["$==="](l)?this.$result_1d20(t,i,r,n):[6,6]["$==="](l)?this.$result_2d6(t,i,c,r,n):a)["$=="](s(F,"Result").$nothing())?a:u($)?$:(l=o.$uniq(),($=[10]["$==="](l)?this.$result_nd10(t,i,c,r,n):[6]["$==="](l)?this.$result_nd6(t,i,c,r,n):a)["$=="](s(F,"Result").$nothing())?a:u($)?$:this.$result_ndx(t,r,n)))},v.$$arity=4),t.def(K,"$grich_text",g=function(t,e,r){return a},g.$$arity=3),K.$private(),t.def(K,"$eval_common_command",R=function(e){try{var r;return e=this.$change_text(e),_($(s(F,"CommonCommand"),"COMMANDS"),"each",[],((r=function(n){var i,$=null==r.$$s?this:r.$$s;if(null==$.randomizer&&($.randomizer=a),null==n&&(n=a),i=n.$eval(e,$,$.randomizer),!u(i))return a;t.ret(i)}).$$s=this,r.$$arity=1,r)),a}catch(n){if(n===t.returner)return n.$v;throw n}},R.$$arity=1),t.def(K,"$dice_command",x=function(e){var n,i,$=a,o=a,c=a,d=a,f=a,h=a;return u(this.enabled_upcase_input)&&(e=e.$upcase()),$=this.$class().$prefixes_pattern().$match(e),u($)?(i=$["$[]"](1)["$nil?"]()["$!"](),u(i)&&(e=e["$[]"](l(1,-1,!1))),o=this.$eval_game_system_specific_command(e),u(o["$is_a?"](s(F,"Result")))?(c=[u(d=o["$secret?"]())?d:i],_(o,"secret=",t.to_a(c)),r(c.length,1),o):u(u(f=u(h=o["$nil?"]())?h:o["$empty?"]())?f:o["$=="]("1"))?a:_(s(F,"Result").$new(),"tap",[],((n=function(e){return null==e&&(e=a),c=[o.$to_s()],_(e,"text=",t.to_a(c)),r(c.length,1),_(e,"secret=",t.to_a(c=[i])),c[r(c.length,1)]}).$$s=this,n.$$arity=1,n))):a},x.$$arity=1),t.def(K,"$eval_game_system_specific_command",k=function(t){return a},k.$$arity=1),t.def(K,"$result_ndx",w=function(t,e,r){return u(r["$is_a?"](s(F,"String")))?a:u(t.$send(e,r))?s(F,"Result").$success(this.$translate("success")):s(F,"Result").$failure(this.$translate("failure"))},w.$$arity=3),t.def(K,"$result_1d100",T=function(t,e,r,n){return a},T.$$arity=4),t.def(K,"$result_1d20",D=function(t,e,r,n){return a},D.$$arity=4),t.def(K,"$result_nd10",E=function(t,e,r,n,i){return a},E.$$arity=5),t.def(K,"$result_2d6",S=function(t,e,r,n,i){return a},S.$$arity=5),t.def(K,"$result_nd6",A=function(t,e,r,n,i){return a},A.$$arity=5),t.def(K,"$get_table_by_2d6",N=function(t){return this.$get_table_by_nD6(t,2)},N.$$arity=1),t.def(K,"$get_table_by_1d6",P=function(t){return this.$get_table_by_nD6(t,1)},P.$$arity=1),t.def(K,"$get_table_by_nD6",O=function(t,e){return this.$get_table_by_nDx(t,e,6)},O.$$arity=2),t.def(K,"$get_table_by_nDx",z=function(t,e,n){var i,$=a;return i=this.randomizer.$roll_sum(e,n),$=this.$get_table_value(t["$[]"](r(i,e))),u($["$nil?"]())?["1",0]:[$,i]},z.$$arity=3),t.def(K,"$get_table_by_1d3",C=function(t){var e,n,i,$=a;return this.$debug("get_table_by_1d3"),e=this.randomizer.$roll_sum(1,6),this.$debug("num",e),n=(i=r(e,1),"number"==typeof i?i/2:i["$/"](2)).$to_i(),this.$debug("index",n),$=t["$[]"](n),u($["$nil?"]())?["1",0]:[$,e]},C.$$arity=1),t.def(K,"$get_table_by_d66_swap",I=function(t){var e;return e=this.randomizer.$roll_d66($(s(F,"D66SortType"),"ASC")),[this.$get_table_by_number(e,t),e]},I.$$arity=1),t.def(K,"$get_table_by_d66",L=function(t){var n,i,$,s,o,c=a;return n=this.randomizer.$roll_once(6),i=this.randomizer.$roll_once(6),$=e("number"==typeof(o=r(n,1))?6*o:o["$*"](6),r(i,1)),c=t["$[]"]($),s=""+n+i,u(c["$nil?"]())?["1",s]:[c,s]},L.$$arity=1),t.def(K,"$get_table_by_number",B=function(e,r,n){try{var i;return null==n&&(n="1"),_(r,"each",[],((i=function(r){var n,$,s,o=null==i.$$s?this:i.$$s;if(null==r&&(r=a),n=r["$[]"](0),!u(($=n,s=e,"number"==typeof $&&"number"==typeof s?$>=s:$["$>="](s))))return a;t.ret(o.$get_table_value(r["$[]"](1)))}).$$s=this,i.$$arity=1,i)),this.$get_table_value(n)}catch($){if($===t.returner)return $.$v;throw $}},B.$$arity=-3),t.def(K,"$get_table_value",q=function(t){return u(t["$is_a?"](s(F,"Proc")))?t.$call():t},q.$$arity=1),t.def(K,"$roll_tables",M=function(t,e){var r=a;return r=e["$[]"](t),u(r)?r.$roll(this.randomizer).$to_s():a},M.$$arity=2),t.def(K,"$debug",U=function(e,r){var n,i,$=this,o=a,c=a;return n=t.slice.call(arguments,1,arguments.length),u($.debug)?(o=u(e["$is_a?"](s(F,"String")))?e:e.$inspect(),u(n["$empty?"]())?$.$warn(o):(c=_(n,"map",[],((i=function(t){return null==t&&(t=a),u(t["$is_a?"](s(F,"String")))?'"'+t+'"':t.$inspect()}).$$s=$,i.$$arity=1,i)),$.$warn(o+": "+c.$join(", ")))):a},U.$$arity=-2)}(d[0],0,d)}(i[0],i),$($(s(i,"I18n"),"Backend"),"Simple").$include($($(s(i,"I18n"),"Backend"),"Fallbacks")),s(i,"I18n").$load_path()["$<<"](s(i,"Dir")["$[]"](s(i,"File").$join(n.$__dir__(),"../../i18n/**/*.yml"))),d=["ja_jp"],_(s(i,"I18n"),"default_locale=",t.to_a(d)),r(d.length,1),d=[["ja_jp"]],_(s(i,"I18n").$fallbacks(),"defaults=",t.to_a(d)),d[r(d.length,1)]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(t){var e=[],r=t.nil,n=t.$$,i=t.module,a=t.klass,$=t.hash2,s=t.truthy,o=t.send;return t.top.$require("strscan"),function(e,c){var u=[i(e,"BCDice")].concat(c);!function(e,c){var u=[i(e,"GameSystem")].concat(c);!function(e,i,c){var u=[a(e,i,"SwordWorld")].concat(c);!function(e,i,c){var u,_,l,d=a(e,null,"RatingLexer"),f=[d].concat(c);d.$$prototype.scanner=r,t.const_set(f[0],"SYMBOLS",$(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),t.def(d,"$initialize",u=function(t){var e,i,a;return t=s(a=(i=(e=t)===r||null==e?r:o(e,"split",[" ",2]))===r||null==i?r:o(i,"first",[]))?a:"",this.scanner=n(f,"StringScanner").$new(t)},u.$$arity=1),t.def(d,"$next_token",_=function(){var t=r,e=r,i=r;return s(this.scanner["$eos?"]())?[!1,"$"]:s(t=this.scanner.$scan(/\d+/))?["NUMBER",t.$to_i()]:(e=this.scanner.$getch().$upcase(),[s(i=n(f,"SYMBOLS")["$[]"](e))?i:e.$to_sym(),e])},_.$$arity=0),t.def(d,"$source",l=function(){return this.scanner.$string()},l.$$arity=0)}(u[0],0,u)}(u[0],n(u,"Base"),u)}(u[0],u)}(e[0],e)},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t<e:t["$<"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}var n=[],i=t.nil,a=t.$$,$=t.module,s=t.klass,o=t.truthy;return function(n,c){var u=[$(n,"BCDice")].concat(c);!function(n,c){var u=[$(n,"GameSystem")].concat(c);!function(n,$,c){var u=[s(n,$,"SwordWorld")].concat(c);!function(n,$,c){var u,_,l,d,f,h,p,m,y,b=s(n,null,"RatingParsed"),v=[b].concat(c);b.$$prototype.modifier_after_half=b.$$prototype.critical=b.$$prototype.first_modify=b.$$prototype.first_to=b.$$prototype.rateup=b.$$prototype.kept_modify=b.$$prototype.rate=b.$$prototype.greatest_fortune=b.$$prototype.modifier=i,b.$attr_accessor("rate"),b.$attr_writer("critical"),b.$attr_writer("kept_modify"),b.$attr_writer("first_to"),b.$attr_writer("first_modify"),b.$attr_writer("rateup"),b.$attr_accessor("greatest_fortune"),b.$attr_accessor("modifier"),b.$attr_writer("modifier_after_half"),t.def(b,"$initialize",u=function(){return this.critical=i,this.kept_modify=i,this.first_to=i,this.first_modify=i,this.greatest_fortune=!1,this.rateup=i},u.$$arity=0),t.def(b,"$half",_=function(){return this.modifier_after_half["$nil?"]()["$!"]()},_.$$arity=0),t.def(b,"$critical",l=function(){var t,r=i;return r=o(t=this.critical)?t:o(this.$half())?13:10,o(e(r,3))&&(r=3),r},l.$$arity=0),t.def(b,"$first_modify",d=function(){var t;return o(t=this.first_modify)?t:0},d.$$arity=0),t.def(b,"$first_to",f=function(){var t;return o(t=this.first_to)?t:0},f.$$arity=0),t.def(b,"$rateup",h=function(){var t;return o(t=this.rateup)?t:0},h.$$arity=0),t.def(b,"$kept_modify",p=function(){var t;return o(t=this.kept_modify)?t:0},p.$$arity=0),t.def(b,"$modifier_after_half",m=function(){var t;return o(t=this.modifier_after_half)?t:0},m.$$arity=0),t.def(b,"$to_s",y=function(){var t=i;return t="KeyNo."+this.rate,o(e(this.$critical(),13))&&(t=r(t,"c["+this.$critical()+"]")),o(this.$first_modify()["$!="](0))&&(t=r(t,"m["+a(v,"Format").$modifier(this.$first_modify())+"]")),o(this.$first_to()["$!="](0))&&(t=r(t,"m["+this.$first_to()+"]")),o(this.$rateup()["$!="](0))&&(t=r(t,"r["+this.$rateup()+"]")),o(this.greatest_fortune)&&(t=r(t,"gf")),o(this.$kept_modify()["$!="](0))&&(t=r(t,"a["+a(v,"Format").$modifier(this.$kept_modify())+"]")),o(this.modifier["$!="](0))&&(t=r(t,a(v,"Format").$modifier(this.modifier))),t},y.$$arity=0)}(u[0],0,u)}(u[0],a(u,"Base"),u)}(u[0],u)}(n[0],n)},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r=t.top,n=[],i=t.nil,a=t.$$$,$=t.$$,s=t.module,o=t.klass,c=t.hash2,u=t.send2,_=t.send,l=t.hash,d=t.truthy;return r.$require("racc/parser.rb"),r.$require("bcdice/arithmetic/node"),r.$require("bcdice/enum"),r.$require("bcdice/game_system/sword_world/rating_lexer"),r.$require("bcdice/game_system/sword_world/rating_parsed"),function(r,n){var f=[s(r,"BCDice")].concat(n);!function(r,n){var f=[s(r,"GameSystem")].concat(n);!function(r,n,s){var f=[o(r,n,"SwordWorld")].concat(s);!function(r,n,s){var f,h,p,m,y,b,v,g,R,x,k,w,T,D,E,S,A,N,P,O,z,C,I,L,B,q,M,U,K,F,H,G,j,W,Y,V,Q,Z,J,X,tt,et,rt,nt=o(r,n,"RatingParser"),it=[nt].concat(s);nt.$$prototype.lexer=nt.$$prototype.version=i,t.def(nt,"$initialize",f=function(e){var r,n;if(f.$$p&&(f.$$p=null),null==e)e=c([],{});else if(!e.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return null==(r=e.$$smap.version)&&(r="v1_0"),null==(n=e.$$smap.round_type)&&(n=a($(it,"RoundType"),"CEIL")),u(this,t.find_super_dispatcher(this,"initialize",f,!1,!0),"initialize",[],null),this.version=r,this.round_type=n},f.$$arity=-1),t.def(nt,"$set_debug",h=function(){return this.yydebug=!0,this},h.$$arity=0),t.def(nt,"$parse",p=function(e){try{return this.lexer=$(it,"RatingLexer").$new(e),this.$do_parse()}catch(r){if(!t.rescue(r,[$(it,"ParseError"),$(it,"ZeroDivisionError")]))throw r;try{return i}finally{t.pop_exception()}}},p.$$arity=1),nt.$private(),t.def(nt,"$parsed",m=function(r,n,a){var s;return _($(it,"RatingParsed").$new(),"tap",[],((s=function($){var o,c,u,l,d=null==s.$$s?this:s.$$s,f=i;return null==d.round_type&&(d.round_type=i),null==$&&($=i),_($,"rate=",t.to_a(f=[r])),e(f.length,1),f=[(o=a["$[]"]("critical"),o===i||null==o?i:_(o,"eval",[d.round_type]))],_($,"critical=",t.to_a(f)),e(f.length,1),f=[(c=a["$[]"]("kept_modify"),c===i||null==c?i:_(c,"eval",[d.round_type]))],_($,"kept_modify=",t.to_a(f)),e(f.length,1),f=[a["$[]"]("first_to")],_($,"first_to=",t.to_a(f)),e(f.length,1),f=[a["$[]"]("first_modify")],_($,"first_modify=",t.to_a(f)),e(f.length,1),f=[(u=a["$[]"]("rateup"),u===i||null==u?i:_(u,"eval",[d.round_type]))],_($,"rateup=",t.to_a(f)),e(f.length,1),f=[a.$fetch("greatest_fortune",!1)],_($,"greatest_fortune=",t.to_a(f)),e(f.length,1),f=[n.$eval(d.round_type)],_($,"modifier=",t.to_a(f)),e(f.length,1),f=[(l=a["$[]"]("modifier_after_half"),l===i||null==l?i:_(l,"eval",[d.round_type]))],_($,"modifier_after_half=",t.to_a(f)),f[e(f.length,1)]}).$$s=this,s.$$arity=1,s))},m.$$arity=3),t.def(nt,"$next_token",y=function(){return this.lexer.$next_token()},y.$$arity=0),W=[15,14,16,5,18,19,51,52,21,22,11,53,12,17,13,15,14,16,4,18,19,4,8,3,28,11,28,12,17,13,24,25,24,25,27,28,27,28,49,50,9,24,25,24,25,27,28,27,28,49,50,35,24,25,24,25,27,28,27,28,49,50,42,24,25,24,25,27,28,27,28,49,50,47,24,25,24,25,27,28,27,28,49,50,48,24,25,24,25,27,28,27,28,49,50,i,24,25,24,25,27,28,27,28,49,50,i,24,25,24,25,27,30,27,i,i,i,i,31,32],Y=[6,6,6,1,6,6,45,45,10,10,6,45,6,6,6,20,20,20,3,20,20,0,4,0,11,20,12,20,20,20,11,11,12,12,11,14,12,15,37,37,5,14,14,15,15,14,17,15,18,39,39,16,17,17,18,18,17,19,18,21,40,40,23,19,19,21,21,19,22,21,24,41,41,31,22,22,24,24,22,25,24,27,46,46,32,25,25,27,27,25,49,27,50,56,56,i,49,49,50,50,49,51,50,52,57,57,i,51,51,52,52,51,13,52,i,i,i,i,13,13],V=[18,3,i,15,20,40,-4,i,i,i,0,22,24,110,33,35,44,44,46,55,11,57,66,47,68,77,i,79,i,i,i,71,82,i,i,i,i,28,i,39,50,61,i,i,i,-2,72,i,i,88,90,99,101,i,i,i,83,94],Q=[-31,-31,-4,-31,-31,-31,-1,-4,-3,58,-5,-31,-31,-31,-11,-31,-31,-31,-31,-31,-2,-31,-31,-31,-31,-31,-28,-31,-30,-7,-8,-31,-31,-12,-13,-14,-15,-16,-25,-17,-18,-19,-6,-26,-27,-31,-22,-9,-10,-31,-31,-31,-31,-29,-23,-24,-20,-21],Z=[23,29,2,33,34,7,36,37,39,1,40,41,6,43,44,45,46,20,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,54,55,56,57],J=[5,5,2,5,5,2,5,6,6,1,6,6,3,5,5,7,6,3,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,5,5,6,6],X=[i,9,2,10,i,-11,-11,-12,i],tt=[i,i,i,i,10,38,i,i,26],et=[0,0,"racc_error",2,20,"_reduce_1",3,20,"_reduce_2",2,21,"_reduce_3",0,22,"_reduce_4",2,22,"_reduce_5",4,22,"_reduce_6",3,22,"_reduce_7",3,22,"_reduce_8",4,22,"_reduce_9",4,22,"_reduce_10",2,22,"_reduce_11",3,22,"_reduce_12",3,22,"_reduce_13",3,22,"_reduce_14",3,22,"_reduce_15",2,23,"_reduce_16",2,23,"_reduce_17",3,23,"_reduce_18",3,23,"_reduce_19",3,26,"_reduce_20",3,26,"_reduce_21",1,26,"_reduce_none",3,25,"_reduce_23",3,25,"_reduce_24",1,25,"_reduce_none",2,24,"_reduce_26",2,24,"_reduce_27",1,24,"_reduce_none",3,27,"_reduce_29",1,27,"_reduce_30"],rt=l(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"G",6,"F",7,"PLUS",8,"MINUS",9,"ASTERISK",10,"SLASH",11,"PARENL",12,"PARENR",13,"BRACKETL",14,"BRACKETR",15,"AT",16,"SHARP",17,"DOLLAR",18),t.const_set(it[0],"Racc_arg",[W,Y,Q,V,Z,J,tt,X,19,et,rt,58,31,!0]),t.const_set(it[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","G","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),t.const_set(it[0],"Racc_debug_parser",!1),t.def(nt,"$_reduce_1",b=function(e,r,n){var s,o,c,u,_=i;return o=null==(s=t.to_ary(e))[0]?i:s[0],c=d(u=(_=null==s[1]?i:s[1])["$[]"]("modifier"))?u:a(a($(it,"Arithmetic"),"Node"),"Number").$new(0),this.$parsed(o,c,_)},b.$$arity=3),t.def(nt,"$_reduce_2",v=function(r,n,s){var o,c,u,l,f=i,h=i;return c=null==(o=t.to_ary(r))[1]?i:o[1],d((f=null==o[2]?i:o[2])["$[]"]("modifier_after_half"))||(h=["modifier_after_half",a(a($(it,"Arithmetic"),"Node"),"Number").$new(0)],_(f,"[]=",t.to_a(h)),e(h.length,1)),u=d(l=f["$[]"]("modifier"))?l:a(a($(it,"Arithmetic"),"Node"),"Number").$new(0),this.$parsed(c,u,f)},v.$$arity=3),t.def(nt,"$_reduce_3",g=function(t,e,r){return t["$[]"](1).$to_i()},g.$$arity=3),t.def(nt,"$_reduce_4",R=function(t,e,r){return c([],{})},R.$$arity=3),t.def(nt,"$_reduce_5",x=function(r,n,a){var s,o,c,u=i;return o=null==(s=t.to_ary(r))[1]?i:s[1],d((u=null==s[0]?i:s[0])["$[]"]("modifier")["$nil?"]())||this.$raise($(it,"ParseError")),_(u,"[]=",t.to_a(c=["modifier",o])),e(c.length,1),u},x.$$arity=3),t.def(nt,"$_reduce_6",k=function(r,n,a){var s,o,c,u=i;return o=null==(s=t.to_ary(r))[2]?i:s[2],d((u=null==s[0]?i:s[0])["$[]"]("critical")["$nil?"]())||this.$raise($(it,"ParseError")),_(u,"[]=",t.to_a(c=["critical",o])),e(c.length,1),u},k.$$arity=3),t.def(nt,"$_reduce_7",w=function(r,n,a){var s,o,c,u=i;return o=null==(s=t.to_ary(r))[2]?i:s[2],d((u=null==s[0]?i:s[0])["$[]"]("critical")["$nil?"]())||this.$raise($(it,"ParseError")),_(u,"[]=",t.to_a(c=["critical",o])),e(c.length,1),u},w.$$arity=3),t.def(nt,"$_reduce_8",T=function(r,n,a){var s,o,c,u=i,l=i;return l=null==(s=t.to_ary(r))[2]?i:s[2],d(d(c=(u=null==s[0]?i:s[0])["$[]"]("first_to")["$nil?"]())?u["$[]"]("first_modify")["$nil?"]():c)||this.$raise($(it,"ParseError")),o=["first_to",l.$to_i()],_(u,"[]=",t.to_a(o)),e(o.length,1),u},T.$$arity=3),t.def(nt,"$_reduce_9",D=function(r,n,a){var s,o,c,u=i,l=i;return l=null==(s=t.to_ary(r))[3]?i:s[3],d(d(c=(u=null==s[0]?i:s[0])["$[]"]("first_to")["$nil?"]())?u["$[]"]("first_modify")["$nil?"]():c)||this.$raise($(it,"ParseError")),o=["first_modify",l.$to_i()],_(u,"[]=",t.to_a(o)),e(o.length,1),u},D.$$arity=3),t.def(nt,"$_reduce_10",E=function(r,n,a){var s,o,c,u=i,l=i;return l=null==(s=t.to_ary(r))[3]?i:s[3],d(d(c=(u=null==s[0]?i:s[0])["$[]"]("first_to")["$nil?"]())?u["$[]"]("first_modify")["$nil?"]():c)||this.$raise($(it,"ParseError")),o=["first_modify",l.$to_i()["$-@"]()],_(u,"[]=",t.to_a(o)),e(o.length,1),u},E.$$arity=3),t.def(nt,"$_reduce_11",S=function(r,n,s){var o,c,u=i;return o=t.to_ary(r),d((u=null==o[0]?i:o[0])["$[]"]("modifier_after_half")["$nil?"]())||this.$raise($(it,"ParseError")),c=["modifier_after_half",a(a($(it,"Arithmetic"),"Node"),"Number").$new(0)],_(u,"[]=",t.to_a(c)),e(c.length,1),u},S.$$arity=3),t.def(nt,"$_reduce_12",A=function(r,n,a){var s,o,c,u=i;return o=null==(s=t.to_ary(r))[2]?i:s[2],d((u=null==s[0]?i:s[0])["$[]"]("modifier_after_half")["$nil?"]())||this.$raise($(it,"ParseError")),_(u,"[]=",t.to_a(c=["modifier_after_half",o])),e(c.length,1),u},A.$$arity=3),t.def(nt,"$_reduce_13",N=function(r,n,a){var s,o,c,u,l=i;return l=null==(s=t.to_ary(r))[0]?i:s[0],o=null==s[2]?i:s[2],d(d(u=["v2_5","v2_0"]["$include?"](this.version))?l["$[]"]("rateup")["$nil?"]():u)||this.$raise($(it,"ParseError")),_(l,"[]=",t.to_a(c=["rateup",o])),e(c.length,1),l},N.$$arity=3),t.def(nt,"$_reduce_14",P=function(r,n,a){var s,o,c,u=i;return u=null==(s=t.to_ary(r))[0]?i:s[0],d(d(c=["v2_5","v2_0"]["$include?"](this.version))?u["$[]"]("greatest_fortune")["$nil?"]():c)||this.$raise($(it,"ParseError")),_(u,"[]=",t.to_a(o=["greatest_fortune",!0])),e(o.length,1),u},P.$$arity=3),t.def(nt,"$_reduce_15",O=function(r,n,a){var s,o,c,u,l=i;return l=null==(s=t.to_ary(r))[0]?i:s[0],o=null==s[2]?i:s[2],d(d(u=this.version["$=="]("v2_5"))?l["$[]"]("kept_modify")["$nil?"]():u)||this.$raise($(it,"ParseError")),_(l,"[]=",t.to_a(c=["kept_modify",o])),e(c.length,1),l},O.$$arity=3),t.def(nt,"$_reduce_16",z=function(t,e,r){return t["$[]"](1)},z.$$arity=3),t.def(nt,"$_reduce_17",C=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"Negative").$new(t["$[]"](1))},C.$$arity=3),t.def(nt,"$_reduce_18",I=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"+",t["$[]"](2))},I.$$arity=3),t.def(nt,"$_reduce_19",L=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"-",t["$[]"](2))},L.$$arity=3),t.def(nt,"$_reduce_20",B=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"+",t["$[]"](2))},B.$$arity=3),t.def(nt,"$_reduce_21",q=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"-",t["$[]"](2))},q.$$arity=3),t.def(nt,"$_reduce_23",M=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"*",t["$[]"](2))},M.$$arity=3),t.def(nt,"$_reduce_24",U=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(t["$[]"](0),t["$[]"](2))},U.$$arity=3),t.def(nt,"$_reduce_26",K=function(t,e,r){return t["$[]"](1)},K.$$arity=3),t.def(nt,"$_reduce_27",F=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"Negative").$new(t["$[]"](1))},F.$$arity=3),t.def(nt,"$_reduce_29",H=function(t,e,r){return t["$[]"](1)},H.$$arity=3),t.def(nt,"$_reduce_30",G=function(t,e,r){return a(a($(it,"Arithmetic"),"Node"),"Number").$new(t["$[]"](0))},G.$$arity=3),t.def(nt,"$_reduce_none",j=function(t,e,r){return t["$[]"](0)},j.$$arity=3)}(f[0],a($(f,"Racc"),"Parser"),f)}(f[0],$(f,"Base"),f)}(f[0],f)}(n[0],n)},Opal.modules["bcdice/game_system/SwordWorld"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:t["$>="](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t<=e:t["$<="](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}function a(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function $(t,e){return"number"==typeof t&&"number"==typeof e?t*e:t["$*"](e)}var s=t.top,o=[],c=t.nil,u=t.$$,_=t.module,l=t.klass,d=t.send2,f=t.truthy,h=t.send;return s.$require("bcdice/base"),s.$require("bcdice/game_system/sword_world/rating_parser"),function(s,o){var p=[_(s,"BCDice")].concat(o);!function(s,o){var p=[_(s,"GameSystem")].concat(o);!function(s,o,_){var p,m,y,b,v,g,R,x,k,w=l(s,o,"SwordWorld"),T=[w].concat(_);w.$$prototype.rating_table=w.$$prototype.randomizer=c,t.const_set(T[0],"ID","SwordWorld"),t.const_set(T[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),t.const_set(T[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),t.const_set(T[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),w.$register_prefix("H?K"),t.def(w,"$initialize",p=function(e){return p.$$p&&(p.$$p=null),d(this,t.find_super_dispatcher(this,"initialize",p,!1,!0),"initialize",[e],null),this.rating_table=0},p.$$arity=1),t.def(w,"$result_2d6",m=function(t,n,i,a,$){var s=c;return f(e(n,12))?u(T,"Result").$critical("\u81ea\u52d5\u7684\u6210\u529f"):f(r(n,2))?u(T,"Result").$fumble("\u81ea\u52d5\u7684\u5931\u6557"):f(f(s=a["$!="](">="))?s:$["$=="]("?"))?c:f(e(t,$))?u(T,"Result").$success("\u6210\u529f"):u(T,"Result").$failure("\u5931\u6557")},m.$$arity=5),t.def(w,"$eval_game_system_specific_command",y=function(t){return this.$rating(t)},y.$$arity=1),w.$private(),t.def(w,"$rating_parser",b=function(){return u(T,"RatingParser").$new()},b.$$arity=0),t.def(w,"$rating",v=function(s){var o,_,l,d,p,m,y=this,b=c,v=c,g=c,R=c,x=c,k=c,w=c,D=c,E=c,S=c,A=c,N=c,P=c,O=c;return y.$debug("rating string",s),b=y.$rating_parser().$parse(s),f(b)?(v=y.$getSW2_0_RatingTable(),g=n(v.$length(),1),y.$debug("keyMax",g),f(i(b.$rate(),g))?"\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc\u306f"+g+"\u307e\u3067\u3067\u3059":(R=y.$getNewRates(v),x=b+" \uff1e ",k=[],w=[],D=[],E=0,S=0,A=0,N=0,P=b.$first_to(),O=b.$first_modify(),function(){var n=t.new_brk();try{h(y,"loop",[],((o=function(){var s,u,_,l,d,h,p=null==o.$$s?this:o.$$s,m=c,y=c;if(u=p.$rollDice(b),y=null==(s=t.to_ary(u))[1]?c:s[1],E=m=null==s[0]?c:s[0],f(P["$!="](0))?(E=m=P,P=0):f(O["$!="](0))&&(E=a(E,O),O=0),f(r(m,2))&&(k["$<<"](m.$to_s()),w["$<<"](y.$to_s()),D["$<<"]("**"),N=a(N,1),t.brk(c,n)),f(f(h=b.$kept_modify()["$!="](0))?E["$!="](2):h)&&(E=a(E,b.$kept_modify())),f("number"==typeof(d=E)?d<2:d["$<"](2))&&(E=2),f(i(E,12))&&(E=12),_=[a(b.$rate(),$(N,b.$rateup())),g].$min(),p.$debug("currentKey",_),l=R["$[]"](E)["$[]"](_),p.$debug("rateValue",l),A=a(A,l),S=a(S,E),k["$<<"](E.$to_s()),w["$<<"](y.$to_s()),D["$<<"](f(i(E,2))?l:"**"),N=a(N,1),f(e(E,b.$critical())))return c;t.brk(c,n)}).$$s=y,o.$$brk=n,o.$$arity=0,o))}catch(s){if(s===n)return s.$v;throw s}}(),l=y.$getResultText(A,b,w,k,D,S,N),_=t.to_ary(l),p=null==_[1]?c:_[1],m=null==_[2]?c:_[2],x=a(x,null==_[0]?c:_[0]),h(u(T,"Result").$new(),"tap",[],((d=function(e){var r=c;return null==e&&(e=c),h(e,"text=",t.to_a(r=[x])),n(r.length,1),h(e,"critical=",t.to_a(r=[p])),n(r.length,1),h(e,"fumble=",t.to_a(r=[m])),r[n(r.length,1)]}).$$s=y,d.$$arity=1,d)))):(y.$debug("not matched"),"1")},v.$$arity=1),t.def(w,"$getSW2_0_RatingTable",g=function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]},g.$$arity=0),t.def(w,"$getNewRates",R=function(e){var r,i=c,a=c,$=c,s=c,o=c,u=c,_=c,l=c,d=c,f=c,p=c,m=c;return i=[],a=[],$=[],s=[],o=[],u=[],_=[],l=[],d=[],f=[],p=[],h(e,"each",[],((r=function(t){var e=c;return null==t&&(t=c),e=t.$split(/,/),p.$push(0),i.$push(e["$[]"](1).$to_i()),a.$push(e["$[]"](2).$to_i()),$.$push(e["$[]"](3).$to_i()),s.$push(e["$[]"](4).$to_i()),o.$push(e["$[]"](5).$to_i()),u.$push(e["$[]"](6).$to_i()),_.$push(e["$[]"](7).$to_i()),l.$push(e["$[]"](8).$to_i()),d.$push(e["$[]"](9).$to_i()),f.$push(e["$[]"](10).$to_i())}).$$s=this,r.$$arity=1,r)),this.rating_table["$=="](1)&&(m=[31,(m=[32,(m=[33,10],h(f,"[]=",t.to_a(m)),m[n(m.length,1)])],h(f,"[]=",t.to_a(m)),m[n(m.length,1)])],h(f,"[]=",t.to_a(m)),n(m.length,1)),[p,p,p,i,a,$,s,o,u,_,l,d,f]},R.$$arity=1),t.def(w,"$rollDice",x=function(t){var e=c;return[(e=this.randomizer.$roll_barabara(2,6)).$sum(),e.$join(",")]},x.$$arity=1),t.def(w,"$getResultText",k=function(t,e,$,s,o,_,l){var d,h,p=c,m=c,y=c,b=c,v=c;return(p=[]).$push("2D:["+$.$join(" ")+"]="+s.$join(",")),f(r(_,2))?(p.$push(o.$join(",")),p.$push("\u81ea\u52d5\u7684\u5931\u6557"),[p.$join(" \uff1e "),!1,!0]):(f(f(m=i(o.$size(),1))?m:e.$modifier()["$!="](0))?(y=a(o.$join(","),u(T,"Format").$modifier(e.$modifier())),f(e.$half())&&(y="("+y+")/2",f(e.$modifier_after_half()["$!="](0))&&(y=a(y,u(T,"Format").$modifier(e.$modifier_after_half())))),p.$push(y)):f(e.$half())&&(y=o.$first()+"/2",f(e.$modifier_after_half()["$!="](0))&&(y=a(y,u(T,"Format").$modifier(e.$modifier_after_half()))),p.$push(y)),f(i(l,1))&&(b=n(l,1)+"\u56de\u8ee2",p.$push(b)),v=a(t,e.$modifier()),f(e.$half())&&(v=(h=v,"number"==typeof h?h/2:h["$/"](2)).$ceil(),f(e.$modifier_after_half()["$!="](0))&&(v=a(v,e.$modifier_after_half()))),d=v.$to_s(),p.$push(d),[p.$join(" \uff1e "),i(l,1),!1])},k.$$arity=7)}(p[0],u(p,"Base"),p)}(p[0],p)}(o[0],o)},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:t["$>="](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var n=[],i=t.nil,a=t.$$,$=t.module,s=t.klass,o=t.hash2,c=t.truthy,u=t.send;return t.top.$require("bcdice/result"),function(n,_){var l=[$(n,"BCDice")].concat(_);!function(n,_){var l=[$(n,"GameSystem")].concat(_);!function(n,$,_){var l=[s(n,$,"SwordWorld2_0")].concat(_);!function(n,$,_){var l,d,f,h,p,m,y=s(n,null,"TranscendentTest"),b=[y].concat(_);y.$$prototype.modifier=y.$$prototype.critical_value=y.$$prototype.expression=y.$$prototype.modifier_str=y.$$prototype.target=y.$$prototype.cmp_op=i,t.const_set(b[0],"RESULT_STR",o(["success","failure","super_success","critical","fumble"],{success:"\u6210\u529f",failure:"\u5931\u6557",super_success:"\u8d85\u6210\u529f",critical:"\u81ea\u52d5\u7684\u6210\u529f",fumble:"\u81ea\u52d5\u7684\u5931\u6557"}).$freeze()),t.def(y,"$initialize",l=function(t,e,r,n){return this.critical_value=t,this.modifier=e,this.cmp_op=r,this.target=n,this.modifier_str=a(b,"Format").$modifier(this.modifier),this.expression=this.$node_expression()},l.$$arity=4),t.def(y,"$execute",d=function(n){var $,s,o,_,l=i,d=i,f=i,h=i,p=i,m=i,y=i;if(c("number"==typeof(o=this.critical_value)?o<3:o["$<"](3)))return"("+this.expression+") \uff1e \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u304c\u5c0f\u3055\u3059\u304e\u307e\u3059\u30023\u4ee5\u4e0a\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002";if(d=[l=n.$roll_barabara(2,6)],f=l["$=="]([1,1]),h=l["$=="]([6,6]),c(c(_=f["$!"]())?h["$!"]():_))for(;c(e(this.$sum_of_dice(d.$last()),this.critical_value));)d.$push(n.$roll_barabara(2,6));return p=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}(s=this.$sum_of_dice(d),this.modifier),m=this.$result_status(p,d.$length(),f,h),y=["("+this.expression+")",""+this.$dice_str(d,s)+this.modifier_str,p,a(b,"RESULT_STR")["$[]"](m)].$compact(),u(a(b,"Result").$new(),"tap",[],(($=function(e){var n=i;return null==e&&(e=i),n=[y.$join(" \uff1e ")],u(e,"text=",t.to_a(n)),r(n.length,1),n=[m["$=="]("fumble")],u(e,"fumble=",t.to_a(n)),r(n.length,1),n=[m["$=="]("critical")],u(e,"critical=",t.to_a(n)),r(n.length,1),n=[["success","super_success","critical"]["$include?"](m)],u(e,"success=",t.to_a(n)),r(n.length,1),n=[["failure","fumble"]["$include?"](m)],u(e,"failure=",t.to_a(n)),n[r(n.length,1)]}).$$s=this,$.$$arity=1,$))},d.$$arity=1),y.$private(),t.def(y,"$node_expression",f=function(){var t;return t="2D6@"+this.critical_value+this.modifier_str,c(this.target)?""+t+this.cmp_op+this.target:t},f.$$arity=0),t.def(y,"$sum_of_dice",h=function(t){return t.$flatten().$sum()},h.$$arity=1),t.def(y,"$dice_str",p=function(t,e){var r;return""+e+u(t,"map",[],(r=function(t){return null==t&&(t=i),"["+t.$join(",")+"]"},r.$$s=this,r.$$arity=1,r)).$join()},p.$$arity=2),t.def(y,"$result_status",m=function(t,r,n,a){var $=i;return c(this.target)?c(n)?"fumble":c(a)?"critical":c(t.$send(this.cmp_op,this.target))?c(c($=e(r,2))?e(t,41):$)?"super_success":"success":"failure":"no_target"},m.$$arity=4)}(l[0],0,l)}(l[0],a(l,"SwordWorld"),l)}(l[0],l)}(n[0],n)},function(t){var e=t.top,r=[],n=t.nil,i=t.$$$,a=t.$$,$=t.module,s=t.klass,o=t.send2,c=t.truthy,u=t.hash2,_=t.send;e.$require("bcdice/arithmetic_evaluator"),e.$require("bcdice/game_system/SwordWorld"),e.$require("bcdice/game_system/sword_world/transcendent_test"),function(e,r){var l=[$(e,"BCDice")].concat(r);!function(e,r){var l=[$(e,"GameSystem")].concat(r);!function(e,r,$){var l,d,f,h,p,m,y,b,v,g=s(e,r,"SwordWorld2_0"),R=[g].concat($);g.$$prototype.randomizer=n,t.const_set(R[0],"ID","SwordWorld2.0"),t.const_set(R[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),t.const_set(R[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),t.const_set(R[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),g.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),t.def(g,"$initialize",l=function(e){return l.$$p&&(l.$$p=null),o(this,t.find_super_dispatcher(this,"initialize",l,!1,!0),"initialize",[e],null),this.rating_table=2},l.$$arity=1),t.def(g,"$eval_game_system_specific_command",d=function(e){var r,$=n;return d.$$p&&(d.$$p=null),/^Gr(\d+)?/i["$==="](r=e)?c(e["$=~"](/^Gr(\d+)/i))?this.$growth(a(R,"Regexp").$last_match(1).$to_i()):this.$growth():/^2D6?@\d+/i["$==="](r)?($=i(a(R,"Command"),"Parser").$new(/2D6?/i,u(["round_type"],{round_type:i(i(a(R,"BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(n,">=",">").$parse(e),c($)?a(R,"TranscendentTest").$new($.$critical(),$.$modify_number(),$.$cmp_op(),$.$target_number()).$execute(this.randomizer):n):"FT"["$==="](r)?this.$get_fumble_table():"TT"["$==="](r)?this.$get_tangle_table():o(this,t.find_super_dispatcher(this,"eval_game_system_specific_command",d,!1,!0),"eval_game_system_specific_command",[e],null)},d.$$arity=1),t.def(g,"$rating_parser",f=function(){return a(R,"RatingParser").$new(u(["version"],{version:"v2_0"}))},f.$$arity=0),t.def(g,"$rollDice",h=function(e){var r,n;return h.$$p&&(h.$$p=null),c(e.$greatest_fortune())?[(n=r=this.randomizer.$roll_once(6),"number"==typeof n?2*n:n["$*"](2)),r+","+r]:o(this,t.find_super_dispatcher(this,"rollDice",h,!1,!0),"rollDice",[e],null)},h.$$arity=1),t.def(g,"$growth",p=function(e){var r;return null==e&&(e=1),_(t.Range.$new(1,e,!1),"map",[],(r=function(){return(null==r.$$s?this:r.$$s).$growth_step()},r.$$s=this,r.$$arity=0,r)).$join(" | ")},p.$$arity=-1),t.def(g,"$growth_step",m=function(){var t,e,r,i=n;return t=this.randomizer.$roll_once(6),e=this.randomizer.$roll_once(6),i=this.$get_ability_by_dice(t),r=this.$get_ability_by_dice(e),c(i["$!="](r))?"["+t+","+e+"]->("+i+" or "+r+")":"["+t+","+e+"]->("+i+")"},m.$$arity=0),t.def(g,"$get_ability_by_dice",y=function(t){var e;return["\u5668\u7528\u5ea6","\u654f\u6377\u5ea6","\u7b4b\u529b","\u751f\u547d\u529b","\u77e5\u529b","\u7cbe\u795e\u529b"]["$[]"]("number"==typeof(e=t)?e-1:e["$-"](1))},y.$$arity=1),t.def(g,"$get_fumble_table",b=function(){var e,r;return r=this.$get_table_by_1d6(["\u3053\u306e\u8868\u30922\u56de\u632f\u308a\u3001\u305d\u306e\u4e21\u65b9\u3092\u9069\u7528\u3059\u308b\u3002\uff08\u540c\u3058\u51fa\u76ee\u306b\u3088\u308b\u5f71\u97ff\u306f\u7d2f\u7a4d\u3057\u306a\u3044\uff09\u3002\u3053\u306e\u81ea\u52d5\u5931\u6557\u306b\u3088\u308a\u5f97\u3089\u308c\u308b\u7d4c\u9a13\u70b9\u306f\u3001+50\u70b9\u3055\u308c\u308b","\u30c0\u30e1\u30fc\u30b8\u306b\u3001\u653b\u6483\u8005\u3092\u5f37\u5316\u3057\u3066\u3044\u308b\u300c\u5263\u306e\u304b\u3051\u3089\u300d\u306e\u6570\u304c\u8ffd\u52a0\u3055\u308c\u308b","\u30c0\u30e1\u30fc\u30b8\u306b\u3001\u653b\u6483\u8005\u306e\u300c\u30ec\u30d9\u30eb\u300d\u304c\u8ffd\u52a0\u3055\u308c\u308b","\u30c0\u30e1\u30fc\u30b8\u6c7a\u5b9a\u30922\u56de\u884c\u3044\u3001\u3088\u308a\u9ad8\u3044\u65b9\u3092\u63a1\u7528\u3059\u308b","\u5408\u7b97\u30c0\u30e1\u30fc\u30b8\u30922\u500d\u3059\u308b","\u9632\u8b77\u70b9\u7121\u52b9"]),"\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868("+(null==(e=t.to_ary(r))[1]?n:e[1])+") \u2192 "+(null==e[0]?n:e[0])},b.$$arity=0),t.def(g,"$get_tangle_table",v=function(){var e,r;return r=this.$get_table_by_1d6(["\u982d\u3084\u9854\uff1a\u7259\u3084\u565b\u307f\u3064\u304d\u306a\u3069\u306b\u304a\u3051\u308b\u547d\u4e2d\u529b\u5224\u5b9a\u53ca\u3073\u3001\u9b54\u6cd5\u306e\u884c\u4f7f\u3084\u30d6\u30ec\u30b9\u306b-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3092\u53d7\u3051\u308b","\u6b66\u5668\u3084\u76fe\uff1a\u6b66\u5668\u306e\u4f7f\u7528\u4e0d\u53ef\u3001\u53c8\u306f\u76fe\u306e\u56de\u907f\u529b\u4fee\u6b63\u53ca\u3073\u9632\u8b77\u70b9\u3092\u7121\u52b9\u5316\u3059\u308b","\u8155\u3084\u624b\uff1a\u6b66\u5668\u3084\u722a\u306a\u3069\u306b\u304a\u3051\u308b\u547d\u4e2d\u529b\u5224\u5b9a\u306b-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3001\u76fe\u3092\u6301\u3064\u8155\u65b9\u306e\u8155\u306a\u3089\u305d\u306e\u76fe\u306e\u56de\u907f\u529b\u4fee\u6b63\u53ca\u3073\u9632\u8b77\u70b9\u3092\u7121\u52b9\u5316\u3059\u308b","\u811a\u3084\u8db3\uff1a\u79fb\u52d5\u4e0d\u53ef\u3001\u66f4\u306b\u56de\u907f\u529b\u5224\u5b9a\u306b-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3092\u53d7\u3051\u308b \u203b\u4e21\u8db3\u306b\u7d61\u3093\u3067\u3082\u7d2f\u7a4d\u3057\u306a\u3044","\u80f4\u4f53\uff1a\u751f\u547d\u30fb\u7cbe\u795e\u62b5\u6297\u529b\u3092\u57fa\u6e96\u5024\u306b\u7528\u3044\u308b\u5224\u5b9a\u3092\u9664\u304d\u3001\u3042\u3089\u3086\u308b\u884c\u70ba\u5224\u5b9a\u306b-1\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3092\u53d7\u3051\u308b","\u7279\u6b8a\uff1a\u5c3b\u5c3e\u3084\u7ffc\u306a\u3069\u306b\u547d\u4e2d\u3002\u7d61\u3081\u3089\u308c\u305f\u90e8\u4f4d\u3092\u4f7f\u7528\u3059\u308b\u5224\u5b9a\u306b\u304a\u3044\u3066-2\u306e\u30da\u30ca\u30eb\u30c6\u30a3\u4fee\u6b63\u3001\u307e\u305f\u306f\u305d\u3053\u304c\u4f7f\u3048\u3066\u3044\u305f\u3053\u3068\u306b\u3088\u308b\u30dc\u30fc\u30ca\u30b9\u4fee\u6b63\u3092\u5931\u3046 \u203b\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u6c7a\u3081\u76f4\u3057"]),"\u7d61\u307f\u52b9\u679c\u8868("+(null==(e=t.to_ary(r))[1]?n:e[1])+") \u2192 "+(null==e[0]?n:e[0])},v.$$arity=0)}(l[0],a(l,"SwordWorld"),l)}(l[0],l)}(r[0],r)}(Opal)}}]);