(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[4579],{6899:(xe,Re,ke)=>{ke(5151),Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var M,j,$,l,p,A,z,V,Y=e.module,G=e.ensure_kwargs,c=e.truthy,I=e.thrower,P=e.def,f=[],H=e.nil,h=e.$$$;return M=f,j=V=[Y(f[0],"BCDice")].concat(M),z=[A=Y(V[0],"ArithmeticEvaluator")].concat(j),l=[$=e.get_singleton_class(A)].concat(z),p=e.$r(l),P($,"$eval",function(K,t){try{I("eval_return");var k,L=H;return null==(k=(t=G(t)).$$smap.round_type)&&(k=h(p("RoundType"),"FLOOR")),c(K)&&c(L=p("Arithmetic").$eval(K,k))?L:0}catch(C){if(C===e.t_eval_return)return C.$v;throw C}},-2)},Opal.modules["i18n/backend/fallbacks"]=function(e){var B,u,t,i,l,p,Y=e.module,G=e.class_variable_set,c=e.truthy,I=e.class_variable_get,P=e.def,f=e.send,H=e.send2,h=e.find_super,N=e.hash2,M=e.find_block_super,E=e.neqeq,V=e.thrower,Q=e.return_val,j=[],A=e.nil,z=e.$$$;return B=j,p=[l=Y(j[0],"I18n")].concat(B),G(p[0],"@@fallbacks",A),u=e.get_singleton_class(l),t=[u].concat(p),i=e.$r(t),P(u,"$fallbacks",function(){var C=A;return G(t[1],"@@fallbacks",c(null!=t[1].$$cvars["@@fallbacks"]?"class variable":A)&&c(C=I(t[1],"@@fallbacks",!1))?C:z(z(i("I18n"),"Locale"),"Fallbacks").$new()),c(C=i("Thread").$current()["$[]"]("i18n_fallbacks"))?C:I(t[1],"@@fallbacks",!1)}),P(u,"$fallbacks=",function(L){var C;return G(t[1],"@@fallbacks",c(L["$is_a?"](i("Array")))?z(z(i("I18n"),"Locale"),"Fallbacks").$new(L):L),C=["i18n_fallbacks",I(t[1],"@@fallbacks",!1)],f(i("Thread").$current(),"[]=",C),C[C.length-1]}),function(u,K){var L,C,x,y,i=[Y(u,"Backend")].concat(K);return L=i,x=[C=Y(i[0],"Fallbacks")].concat(L),y=e.$r(x),P(C,"$translate",function S(g,b,s){try{var o=V("return"),_=S.$$p||A,T=this,d=A,m=A;return S.$$p=null,null==s&&(s=y("EMPTY_HASH")),c(s.$fetch("fallback",!0))?c(s["$[]"]("fallback_in_progress"))?H(T,h(T,"translate",S,!1,!0),"translate",[g,b,s],_):(c(s["$[]"]("default"))&&(d=T["$extract_non_symbol_default!"](s)),m=s.$merge(N(["fallback_in_progress"],{fallback_in_progress:!0})),f(y("I18n").$fallbacks()["$[]"](g),"each",[],function n(w){var r=null==n.$$s?this:n.$$s;null==w&&(w=A);try{return f(r,"catch",["exception"],function v(){var a=null==v.$$s?this:v.$$s,O=A;if(O=H(a,M(a,"translate",v.$$def||n.$$def||S,!1,!1),"translate",[w,b,m],null),c(O["$nil?"]()))return A;E(g.$to_s(),w.$to_s())&&a.$on_fallback(g,w,b,s),o.$throw(O)},{$$s:r,$$ret:o})}catch(v){if(!e.rescue(v,[z(y("I18n"),"InvalidLocale")]))throw v;try{return A}finally{e.pop_exception()}}},{$$s:T}),c(s["$key?"]("default"))&&c(s["$[]"]("default")["$nil?"]())?A:c(d)?H(T,h(T,"translate",S,!1,!0),"translate",[g,A,s.$merge(N(["default"],{default:d}))],null):T.$throw("exception",z(y("I18n"),"MissingTranslation").$new(g,b,s))):H(T,h(T,"translate",S,!1,!0),"translate",[g,b,s],_)}catch(n){if(n===o)return n.$v;throw n}},-3),P(C,"$extract_non_symbol_default!",function(g){var s,b=A;return b=[g["$[]"]("default")].$flatten(),s=f(b,"detect",[],function(_){return null==_&&(_=A),_["$is_a?"](y("Symbol"))["$!"]()}),c(s)&&g["$[]="]("default",b["$[]"](0,b.$index(s))),s}),P(C,"$exists?",function S(g,b,s){try{var o=V("return"),_=S.$$p||A,T=this;return S.$$p=null,null==s&&(s=y("EMPTY_HASH")),c(s.$fetch("fallback",!0))?(f(y("I18n").$fallbacks()["$[]"](g),"each",[],function d(m){var n=null==d.$$s?this:d.$$s;null==m&&(m=A);try{if(!c(H(n,M(n,"exists?",d.$$def||S,!1,!1),"exists?",[m,b],null)))return A;o.$throw(!0)}catch(w){if(!e.rescue(w,[z(y("I18n"),"InvalidLocale")]))throw w;try{return A}finally{e.pop_exception()}}},{$$s:T,$$ret:o}),!1):H(T,h(T,"exists?",S,!1,!0),"exists?",[g,b,s],_)}catch(d){if(d===o)return d.$v;throw d}},-3),C.$private(),P(C,"$on_fallback",Q(A))}(p[0],p)},Opal.modules["bcdice/randomizer"]=function(e){var l,k,L,C,x,y,u,K,G=e.klass,c=e.const_set,I=e.def,P=e.truthy,f=e.rb_gt,H=e.rb_plus,h=e.rb_le,N=e.send,M=e.rb_minus,E=e.eqeq,V=e.rb_times,Q=e.eqeqeq,j=e.rb_ge,A=[],z=e.nil,$=e.$$$;return l=A,u=[(0,e.module)(A[0],"BCDice")].concat(l),K=e.$r(u),k=u,C=[L=G(u[0],null,"Randomizer")].concat(k),x=e.$r(C),(y=L.$$prototype).rand_results=y.detailed_rand_results=z,c(C[0],"UPPER_LIMIT_DICE_TIMES",200),c(C[0],"UPPER_LIMIT_DICE_SIDES",1e4),c(C[0],"UPPER_LIMIT_RANDS",1e4),I(L,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),L.$attr_reader("rand_results"),L.$attr_reader("detailed_rand_results"),c(C[0],"DetailedRandResult",x("Struct").$new("kind","sides","value")),I(L,"$roll_barabara",function(g,b){var s=this;return P(f(H(s.rand_results.$size(),g),x("UPPER_LIMIT_RANDS")))&&s.$raise(x("TooManyRandsError")),P(h(g,0))||P(f(g,x("UPPER_LIMIT_DICE_TIMES")))?[]:N(x("Array"),"new",[g],function o(){return(null==o.$$s?this:o.$$s).$roll_once(b)},{$$s:s})}),I(L,"$roll_sum",function(g,b){return this.$roll_barabara(g,b).$sum()}),I(L,"$roll_once",function(g){var s=z;return P(h(g,0))||P(f(g,x("UPPER_LIMIT_DICE_SIDES")))?0:(s=this.$rand_inner(g),this.$push_to_detail("normal",g,s),s)}),I(L,"$roll_index",function(g){return M(this.$roll_once(g),1)}),I(L,"$roll_tens_d10",function(){var s,b=z;return b=this.$rand_inner(10),E(b,10)&&(b=0),s=V(b,10),this.$push_to_detail("tens_d10",10,s),s}),I(L,"$roll_d9",function(){var b;return b=M(this.$rand_inner(10),1),this.$push_to_detail("d9",10,b),b}),I(L,"$roll_d66",function(g){var o,s=z;return s=N(x("Array"),"new",[2],function _(){return(null==_.$$s?this:_.$$s).$roll_once(6)},{$$s:this}),Q($(x("D66SortType"),"ASC"),o=g)?s["$sort!"]():Q($(x("D66SortType"),"DESC"),o)&&s["$sort!"]()["$reverse!"](),H(V(s["$[]"](0),10),s["$[]"](1))}),L.$private(),I(L,"$rand_inner",function(g){var s,b=this;return P(j(b.rand_results.$size(),x("UPPER_LIMIT_RANDS")))&&b.$raise(x("TooManyRandsError")),s=b.$random(g),b.rand_results["$<<"]([s,g]),s}),I(L,"$random",function(g){return H(x("Kernel").$rand(g),1)}),I(L,"$push_to_detail",function(g,b,s){var _;return _=x("DetailedRandResult").$new(g,b,s),this.detailed_rand_results.$push(_)}),G(u[0],K("StandardError"),"TooManyRandsError"),z},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var N,Q,B,l,p,u,K,A,E,Y=e.module,G=e.klass,c=e.def,I=e.truthy,P=e.return_val,f=[],H=e.nil;return N=f,Q=E=[Y(f[0],"BCDice")].concat(N),B=A=[Y(E[0],"DiceTable")].concat(Q),p=[l=G(A[0],null,"RollResult")].concat(B),u=e.$r(p),(K=l.$$prototype).table_name=K.value=K.body=H,c(l,"$initialize",function(i,k,L){var C=this;return C.table_name=i,C.value=k,C.body=L}),l.$attr_reader("table_name"),l.$attr_reader("value"),l.$attr_reader("body"),c(l,"$to_s",function(){var i=this;return i.table_name+"("+i.value+") \uff1e "+i.body}),c(l,"$last_body",function(){var i=this;return I(i.body["$is_a?"](u("RollResult")))?i.body.$last_body():i.body}),c(l,"$empty?",P(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var N,Q,B,l,p,u,K,A,E,Y=e.module,G=e.klass,c=e.truthy,I=e.def,P=e.rb_minus,f=[],H=e.nil;return N=f,Q=E=[Y(f[0],"BCDice")].concat(N),B=A=[Y(E[0],"DiceTable")].concat(Q),p=[l=G(A[0],null,"ChainTable")].concat(B),u=e.$r(p),(K=l.$$prototype).times=K.sides=K.items=K.name=H,I(l,"$initialize",function(i,k,L){var C=this,x=H;return C.name=i,C.items=L.$freeze(),x=/(\d+)D(\d+)/i.$match(k),c(x)||C.$raise(u("ArgumentError"),"Unexpected table type: "+k),C.times=x["$[]"](1).$to_i(),C.sides=x["$[]"](2).$to_i()}),I(l,"$roll",function(i){var L,C,k=this,x=H;return L=i.$roll_sum(k.times,k.sides),C=P(L,k.times),x=k.items["$[]"](C),c(x["$respond_to?"]("roll"))&&(x=x.$roll(i)),u("RollResult").$new(k.name,L,x)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var V,z,u,K,t,i,k,B,j,Y=e.module,G=e.klass,c=e.hash2,I=e.defs,P=e.def,f=e.rb_plus,H=e.rb_times,h=e.rb_minus,N=[],M=e.nil;return V=N,z=j=[Y(N[0],"BCDice")].concat(V),u=B=[Y(j[0],"DiceTable")].concat(z),t=[K=G(B[0],null,"D66GridTable")].concat(u),i=e.$r(t),(k=K.$$prototype).name=k.items=M,I(K,"$from_i18n",function(C,x){var S=M;return S=i("I18n").$t(C,c(["locale","raise"],{locale:x,raise:!0})),this.$new(S["$[]"]("name"),S["$[]"]("items"))}),P(K,"$initialize",function(C,x){return this.name=C,this.items=x.$freeze()}),P(K,"$roll",function(C){var y,S,g,b,s;return y=C.$roll_once(6),S=C.$roll_once(6),g=f(H(y,10),S),b=h(y,1),s=h(S,1),i("RollResult").$new(this.name,g,this.items["$[]"](b)["$[]"](s))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var M,j,p,u,K,t,z,$,V,Y=e.module,G=e.klass,c=e.hash2,I=e.defs,P=e.def,H=[],h=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=H,j=V=[Y(H[0],"BCDice")].concat(M),z=[Y(V[0],"DiceTable")].concat(j),$=e.$r(z),p=z,K=[u=G(z[0],$("D66GridTable"),"D66HalfGridTable")].concat(p),t=e.$r(K),I(u,"$from_i18n",function(k,L){var x=h;return x=t("I18n").$t(k,c(["locale","raise"],{locale:L,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2_3"),x["$[]"]("items_4_5_6"))}),P(u,"$initialize",function(k,L,C){return this.name=k,this.items=[L,L,L,C,C,C].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var M,j,p,u,K,t,z,$,V,Y=e.module,G=e.klass,c=e.hash2,I=e.defs,P=e.def,H=[],h=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),M=H,j=V=[Y(H[0],"BCDice")].concat(M),z=[Y(V[0],"DiceTable")].concat(j),$=e.$r(z),p=z,K=[u=G(z[0],$("D66GridTable"),"D66OneThirdTable")].concat(p),t=e.$r(K),I(u,"$from_i18n",function(k,L){var x=h;return x=t("I18n").$t(k,c(["locale","raise"],{locale:L,raise:!0})),this.$new(x["$[]"]("name"),x["$[]"]("items_1_2"),x["$[]"]("items_3_4"),x["$[]"]("items_5_6"))}),P(u,"$initialize",function(k,L,C,x){return this.name=k,this.items=[L,L,C,C,x,x].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var j,B,t,i,k,L,C,p,z,Y=e.module,G=e.klass,c=e.hash2,I=e.defs,P=e.def,f=e.eqeqeq,H=e.rb_plus,h=e.rb_times,N=e.truthy,M=[],E=e.nil,V=e.$$$;return j=M,B=z=[Y(M[0],"BCDice")].concat(j),t=p=[Y(z[0],"DiceTable")].concat(B),k=[i=G(p[0],null,"D66Table")].concat(t),L=e.$r(k),(C=i.$$prototype).sort_type=C.items=C.name=E,I(i,"$from_i18n",function(y,S){var s,b=E;return b=L("I18n").$t(y,c(["locale"],{locale:S})),s=L("D66SortType").$const_get(b["$[]"]("d66_sort_type")),this.$new(b["$[]"]("name"),s,b["$[]"]("items"))}),P(i,"$initialize",function(y,S,g){var b=this;return b.name=y,b.sort_type=S,b.items=g.$freeze()}),P(i,"$roll",function(y){var S=this,g=E,b=E,s=E,o=E;return g=y.$roll_barabara(2,6),f(V(L("D66SortType"),"ASC"),b=S.sort_type)?g["$sort!"]():f(V(L("D66SortType"),"DESC"),b)&&g["$sort!"]()["$reverse!"](),s=H(h(g["$[]"](0),10),g["$[]"](1)),o=N(b=S.items["$[]"](s))?b:S.items["$[]"](s.$to_s()),N(o["$respond_to?"]("roll"))&&(o=o.$roll(y)),L("RollResult").$new(S.name,s,o)}),P(i,"$choice",function(y){return L("RollResult").$new(this.name,y,this.items["$[]"](y))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var A,l,u,K,$,Y=e.module,G=e.klass,c=e.hash2,I=e.send,P=e.to_ary,f=e.rb_plus,H=e.rb_times,h=e.send2,N=e.find_super,M=e.def,V=[],Q=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),A=V,l=$=[Y(V[0],"BCDice")].concat(A),u=[Y($[0],"DiceTable")].concat(l),K=e.$r(u),M(G(u[0],K("D66Table"),"D66LeftRangeTable"),"$initialize",function L(C,x,y){var b;return L.$$p=null,b=c([],{}),I(y,"each",[],function(o){var _,m;return null==o&&(o=Q),_=P(o),m=null==_[1]?Q:_[1],I(null==_[0]?Q:_[0],"each",[],function(w){return null==w&&(w=Q),I(m,"each_with_index",[],function(v,a){var O,re;return null==v&&(v=Q),null==a&&(a=Q),re=f(H(w,10),f(a,1)),I(b,"[]=",O=[re,v]),O[O.length-1]})})}),h(this,N(this,"initialize",L,!1,!0),"initialize",[C,x,b],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var Q,$,K,t,i,k,L,l,A,Y=e.module,G=e.klass,c=e.hash2,I=e.defs,P=e.def,f=e.truthy,H=e.rb_minus,h=e.rb_plus,N=e.rb_times,M=[],E=e.nil;return Q=M,$=A=[Y(M[0],"BCDice")].concat(Q),K=l=[Y(A[0],"DiceTable")].concat($),i=[t=G(l[0],null,"D66ParityTable")].concat(K),k=e.$r(i),(L=t.$$prototype).odd=L.even=L.name=E,I(t,"$from_i18n",function(x,y){var g=E;return g=k("I18n").$t(x,c(["locale","raise"],{locale:y,raise:!0})),this.$new(g["$[]"]("name"),g["$[]"]("odd"),g["$[]"]("even"))}),P(t,"$initialize",function(x,y,S){var g=this;return g.name=x,g.odd=y.$freeze(),g.even=S.$freeze()}),P(t,"$roll",function(x){var g,s,o,y=this,S=E;return S=x.$roll_once(6),g=x.$roll_once(6),s=(f(S["$odd?"]())?y.odd:y.even)["$[]"](H(g,1)),o=h(N(S,10),g),k("RollResult").$new(y.name,o,s)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var M,j,l,p,u,K,t,z,V,Y=e.module,G=e.klass,c=e.def,I=e.rb_plus,P=e.rb_times,f=e.send,H=[],h=e.nil;return M=H,j=V=[Y(H[0],"BCDice")].concat(M),l=z=[Y(V[0],"DiceTable")].concat(j),u=[p=G(z[0],null,"D66RangeTable")].concat(l),K=e.$r(u),(t=p.$$prototype).items=t.name=h,c(p,"$initialize",function(k,L){return this.name=k,this.items=L.$freeze()}),c(p,"$roll",function(k){var C,x,y,S=h;return C=k.$roll_once(6),x=k.$roll_once(6),y=I(P(C,10),x),S=f(this.items,"find",[],function(b){return null==b&&(b=h),b["$[]"](0)["$include?"](y)}),K("RollResult").$new(this.name,y,S["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var Q,$,K,t,i,k,L,l,A,Y=e.module,G=e.klass,c=e.const_set,I=e.send,P=e.truthy,f=e.def,H=e.eqeqeq,h=e.rb_times,N=e.rb_plus,M=[],E=e.nil;return Q=M,$=A=[Y(M[0],"BCDice")].concat(Q),K=l=[Y(A[0],"DiceTable")].concat($),i=[t=G(l[0],null,"RangeTable")].concat(K),k=e.$r(i),(L=t.$$prototype).name=L.items=L.num_of_dice=L.num_of_sides=L.formatter=E,c(i[0],"RollResult",I(k("Struct"),"new",["sum","values","content","formatted"],function C(){return(null==C.$$s?this:C.$$s).$alias_method("to_s","formatted")},{$$s:t})),c(i[0],"Item",k("Struct").$new("range","content")),c(i[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),c(i[0],"DEFAULT_FORMATTER",I(t,"lambda",[],function(x,y){return null==x&&(x=E),null==y&&(y=E),x.$name()+"("+y.$sum()+") \uff1e "+y.$content()})),t.$attr_reader("name"),t.$attr_reader("num_of_dice"),t.$attr_reader("num_of_sides"),f(t,"$initialize",function C(x,y,S){var s,g=C.$$p||E,b=this,o=E;return C.$$p=null,b.name=x.$freeze(),b.formatter=P(s=g)?s:k("DEFAULT_FORMATTER"),o=k("DICE_ROLL_METHOD_RE").$match(y),P(o)||b.$raise(k("ArgumentError"),b.name+": invalid dice roll method: "+y),b.num_of_dice=o["$[]"](1).$to_i(),b.num_of_sides=o["$[]"](2).$to_i(),b.$store(S)}),f(t,"$fetch",function(x){var S,y=this;return S=I(y.items,"find",[],function(b){return null==b&&(b=E),b.$range()["$include?"](x)}),P(S)||y.$raise(k("RangeError"),y.name+": value is out of range: "+x),S}),f(t,"$roll",function(x){var g,y=this,S=E,b=E;return g=(S=x.$roll_barabara(y.num_of_dice,y.num_of_sides)).$sum(),(b=k("RollResult").$new(g,S,y.$fetch(g).$content()))["$formatted="](y.formatter["$[]"](y,b)),b}),t.$private(),f(t,"$store",function(x){var S,g,y=this;return S=I(x,"map",[],function b(s,o){return null==s&&(s=E),null==o&&(o=E),[(null==b.$$s?this:b.$$s).$coerce_to_int_range(s),o]},{$$s:y}),g=I(S,"sort_by",[],function(s,o){return null==s&&(s=E),null==o&&(o=E),s.$min()}),y.$assert_min_sum_is_covered(g),y.$assert_max_sum_is_covered(g),y.$assert_no_gap_or_overlap_in_ranges(g),y.items=I(g,"map",[],function(s,o){return null==s&&(s=E),null==o&&(o=E),k("Item").$new(s,o.$freeze()).$freeze()}).$freeze(),y}),f(t,"$coerce_to_int_range",function(x){var S;return H(k("Integer"),S=x)?k("Range").$new(x,x):H(k("Range"),S)&&P(x.$begin()["$is_a?"](k("Integer")))&&P(x.$end()["$is_a?"](k("Integer")))?x:this.$raise(k("TypeError"),this.name+": "+x+" ("+x.$class()+") must be an Integer or a Range with Integers ")}),f(t,"$assert_min_sum_is_covered",function(x){var S,y=this,g=E;return S=y.num_of_dice,g=x.$first()["$[]"](0),P(g["$include?"](S))||y.$raise(k("RangeError"),y.name+": min value ("+S+") is not covered: "+g),y}),f(t,"$assert_max_sum_is_covered",function(x){var S,y=this,g=E;return S=h(y.num_of_dice,y.num_of_sides),g=x.$last()["$[]"](0),P(g["$include?"](S))||y.$raise(k("RangeError"),y.name+": max value ("+S+") is not covered: "+g),y}),f(t,"$assert_no_gap_or_overlap_in_ranges",function(x){return I(x,"each_cons",[2],function S(g,b){var T,d,s=null==S.$$s?this:S.$$s,o=E,_=E;return null==s.name&&(s.name=E),null==g&&(g=E),null==b&&(b=E),o=g["$[]"](0),_=b["$[]"](0),T=o.$max(),d=N(T,1),P(_["$include?"](T))&&s.$raise(k("RangeError"),s.name+": Range overlap: "+o+" and "+_),P(_["$include?"](d))?E:s.$raise(k("RangeError"),s.name+": Range gap: "+o+" and "+_)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var E,A,p,k,L,C,x,K,$,Q,Y=e.module,G=e.klass,c=e.send,I=e.def,P=e.rb_minus,f=e.return_ivar,H=[],h=e.nil,N=e.$$$;return E=H,A=Q=[Y(H[0],"BCDice")].concat(E),p=$=[Y(Q[0],"DiceTable")].concat(A),k=K=[G($[0],null,"SaiFicSkillTable")].concat(p),C=[L=G(K[0],null,"Category")].concat(k),x=e.$r(C),I(L,"$initialize",function(S,g,b,s){var o=this;return o.name=S,o.skills=c(g.$map(),"with_index",[2],function(T,d){return null==T&&(T=h),null==d&&(d=h),N(x("SaiFicSkillTable"),"Skill").$new(S,T,b,d,s)}),o.dice=b}),I(L,"$roll",function(S){return this.$skills()["$[]"](P(S.$roll_sum(2,6),2))}),I(L,"$to_s",f("name")),L.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var h,V,$,K,t,l,j,M,Y=e.module,G=e.klass,c=e.def,I=e.hash2,P=[],f=e.nil;return h=P,V=M=[Y(P[0],"BCDice")].concat(h),$=j=[Y(M[0],"DiceTable")].concat(V),l=[G(j[0],null,"SaiFicSkillTable")].concat($),(t=(K=G(l[0],null,"Skill")).$$prototype).s_format=t.category_dice=t.row_dice=t.category_name=t.name=f,c(K,"$initialize",function(k,L,C,x,y){var S=this;return S.category_name=k,S.name=L,S.category_dice=C,S.row_dice=x,S.s_format=y}),c(K,"$to_s",function(){var k=this;return k.$format(k.s_format,I(["category_dice","row_dice","category_name","skill_name"],{category_dice:k.category_dice,row_dice:k.row_dice,category_name:k.category_name,skill_name:k.name}))}),K.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var l,t,x,y,S,g,b,k,u,Y=e.module,G=e.klass,c=e.ensure_kwargs,I=e.hash2,P=e.send,H=e.defs,h=e.const_set,N=e.to_ary,M=e.def,E=e.truthy,V=e.rb_minus,Q=e.rb_plus,j=e.top,A=[],z=e.nil,$=e.$$$;return j.$require("bcdice/dice_table/sai_fic_skill_table/category"),j.$require("bcdice/dice_table/sai_fic_skill_table/skill"),l=A,t=u=[Y(A[0],"BCDice")].concat(l),x=k=[Y(u[0],"DiceTable")].concat(t),S=[y=G(k[0],null,"SaiFicSkillTable")].concat(x),g=e.$r(S),(b=y.$$prototype).rtt=b.rtt_format=b.rct=b.rct_format=b.rttn=b.rttn_format=b.categories=z,H(y,"$from_i18n",function(o,_,T){var d,m,n,a,v=z;return null==(d=(T=c(T)).$$smap.rtt)&&(d=z),null==(m=T.$$smap.rct)&&(m=z),null==(n=T.$$smap.rttn)&&(n=z),a=(v=g("I18n").$t("RTT",I(["locale","raise","default"],{locale:_,raise:!1,default:I([],{})})).$merge(g("I18n").$t(o,I(["locale","raise"],{locale:_,raise:!0}))))["$[]"]("items"),v=P(v,"select",[],function(re,ee){return null==re&&(re=z),null==ee&&(ee=z),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](re)}),this.$new(a,e.to_hash(v).$merge(I(["rtt","rct","rttn"],{rtt:d,rct:m,rttn:n})))},-3),h(S[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),h(S[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),h(S[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),h(S[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),M(y,"$initialize",function(o,_){var T,d,m,n,w,r,v,a=this;return null==(T=(_=c(_)).$$smap.rtt)&&(T=z),null==(d=_.$$smap.rct)&&(d=z),null==(m=_.$$smap.rttn)&&(m=z),null==(n=_.$$smap.rtt_format)&&(n=g("DEFAULT_RTT")),null==(w=_.$$smap.rct_format)&&(w=g("DEFAULT_RCT")),null==(r=_.$$smap.rttn_format)&&(r=g("DEFAULT_RTTN")),null==(v=_.$$smap.s_format)&&(v=g("DEFAULT_S")),a.categories=P(o.$map(),"with_index",[1],function(re,ee){var ie,oe,ue;return null==re&&(re=z),null==ee&&(ee=z),oe=null==(ie=N(re))[0]?z:ie[0],ue=null==ie[1]?z:ie[1],$(g("SaiFicSkillTable"),"Category").$new(oe,ue,ee,v)},{$$has_top_level_mlhs_arg:!0}),a.rtt=T,a.rct=d,a.rttn=m.$to_a(),a.rtt_format=n,a.rct_format=w,a.rttn_format=r},-2),h(S[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),M(y,"$roll_command",function(o,_){var d,T=this,m=z,n=z;return E(["RTT",T.rtt]["$include?"](d=_))?T.$format_skill(T.rtt_format,T.$roll_skill(o)):E(["RCT",T.rct]["$include?"](d))?(m=T.$roll_category(o),T.$format(T.rct_format,I(["category_dice","category_name"],{category_dice:m.$dice(),category_name:m.$name()}))):E(n=g("RTTN").$index(d))||E(n=T.rttn.$index(d))?T.$format_skill(T.rttn_format,T.categories["$[]"](n).$roll(o)):z}),M(y,"$roll_category",function(o){return this.categories["$[]"](V(o.$roll_once(6),1))}),M(y,"$roll_skill",function(o){return this.$roll_category(o).$roll(o)}),M(y,"$prefixes",function(){var o=this;return Q(["RTT[1-6]?","RCT",o.rtt,o.rct],o.rttn).$compact()}),y.$private(),M(y,"$format_skill",function(o,_){return this.$format(o,I(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:_.$category_dice(),row_dice:_.$row_dice(),category_name:_.$category_name(),skill_name:_.$name(),text:_.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var E,A,p,u,K,t,i,$,Q,Y=e.module,G=e.klass,c=e.hash2,I=e.defs,P=e.truthy,f=e.def,H=e.rb_minus,h=[],N=e.nil;return E=h,A=Q=[Y(h[0],"BCDice")].concat(E),p=$=[Y(Q[0],"DiceTable")].concat(A),K=[u=G($[0],null,"Table")].concat(p),t=e.$r(K),(i=u.$$prototype).times=i.sides=i.name=i.items=N,I(u,"$from_i18n",function(L,C){var y=N;return y=t("I18n").$t(L,c(["locale"],{locale:C})),this.$new(y["$[]"]("name"),y["$[]"]("type"),y["$[]"]("items"))}),f(u,"$initialize",function(L,C,x){var y=this,S=N;return y.name=L,y.items=x.$freeze(),S=/(\d+)D(\d+)/i.$match(C),P(S)||y.$raise(t("ArgumentError"),"Unexpected table type: "+C),y.times=S["$[]"](1).$to_i(),y.sides=S["$[]"](2).$to_i()}),f(u,"$roll",function(L){var x,C=this;return x=L.$roll_sum(C.times,C.sides),C.$choice(x)}),f(u,"$choice",function(L){var x,C=this;return x=H(L,C.times),t("RollResult").$new(C.name,L,C.items["$[]"](x))})},Opal.modules["bcdice/dice_table"]=function(e){var Y=e.top;return Y.$require("bcdice/dice_table/roll_result"),Y.$require("bcdice/dice_table/chain_table"),Y.$require("bcdice/dice_table/d66_grid_table"),Y.$require("bcdice/dice_table/d66_half_grid_table"),Y.$require("bcdice/dice_table/d66_one_third_table"),Y.$require("bcdice/dice_table/d66_left_range_table"),Y.$require("bcdice/dice_table/d66_parity_table"),Y.$require("bcdice/dice_table/d66_range_table"),Y.$require("bcdice/dice_table/d66_table"),Y.$require("bcdice/dice_table/range_table"),Y.$require("bcdice/dice_table/sai_fic_skill_table"),Y.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var f,M,V,h,Y=e.module,G=e.const_set,c=[];return f=c,M=h=[Y(c[0],"BCDice")].concat(f),V=[Y(h[0],"D66SortType")].concat(M),G(V[0],"NO_SORT","no_sort"),G(V[0],"ASC","asc"),G(V[0],"DESC","desc"),function(N,M){var V=[Y(N,"RoundType")].concat(M);return G(V[0],"CEIL","ceil"),G(V[0],"FLOOR","floor"),G(V[0],"ROUND","round")}(h[0],h)},Opal.modules["bcdice/translate"]=function(e){var M,j,A,z,$,V,Y=e.module,G=e.ensure_kwargs,c=e.kwrestargs,P=e.hash2,f=e.def,H=[],h=e.nil;return M=H,j=V=[Y(H[0],"BCDice")].concat(M),z=[A=Y(V[0],"Translate")].concat(j),$=e.$r(z),f(A,"$translate",function(l,p){var u,K=this;return null==K.locale&&(K.locale=h),p=G(p),u=c(p,{}),$("I18n").$translate(l,P(["locale","raise"],{locale:K.locale,raise:!0}).$merge(e.to_hash(u)))},-2)},Opal.modules["bcdice/result"]=function(e){var A,B,z,M,V,G=e.klass,c=e.send,I=e.def,P=e.return_val,f=e.return_ivar,H=[],h=e.nil;return M=H,A=V=[(0,e.module)(H[0],"BCDice")].concat(M),[z=G(V[0],null,"Result")].concat(A),I(B=e.get_singleton_class(z),"$success",function(u){return c(this.$new(),"tap",[],function(i){var k;return null==i&&(i=h),i["$text="](u),c(i,"success=",k=[!0]),k[k.length-1]})}),I(B,"$failure",function(u){return c(this.$new(),"tap",[],function(i){var k;return null==i&&(i=h),i["$text="](u),c(i,"failure=",k=[!0]),k[k.length-1]})}),I(B,"$critical",function(u){return c(this.$new(),"tap",[],function(i){var k;return null==i&&(i=h),i["$text="](u),i["$critical="](!0),c(i,"success=",k=[!0]),k[k.length-1]})}),I(B,"$fumble",function(u){return c(this.$new(),"tap",[],function(i){var k;return null==i&&(i=h),i["$text="](u),i["$fumble="](!0),c(i,"failure=",k=[!0]),k[k.length-1]})}),I(B,"$nothing",P("nothing")),I(z,"$initialize",function(l){var p=this;return null==l&&(l=h),p.text=l,p.rands=h,p.detailed_rands=h,p.secret=!1,p.success=!1,p.failure=!1,p.critical=!1,p.fumble=!1},-1),z.$attr_accessor("text","rands","detailed_rands"),z.$attr_writer("secret","success","failure","critical","fumble"),I(z,"$secret?",f("secret")),I(z,"$success?",f("success")),I(z,"$failure?",f("failure")),I(z,"$critical?",f("critical")),I(z,"$fumble?",f("fumble")),I(z,"$condition=",function(l){return this.success=l,this.failure=l["$!"]()})},Opal.modules["racc/parser"]=function(e){var L,x,y,Y=e.module,G=e.klass,c=e.truthy,I=e.const_set,P=e.defs,f=e.gvars,H=e.rb_lt,h=e.def,N=e.to_ary,M=e.send,E=e.neqeq,V=e.rb_plus,Q=e.eqeq,j=e.rb_ge,A=e.rb_gt,z=e.rb_minus,$=e.rb_le,B=e.rb_times,l=e.assign_ivar_val,u=[],K=e.$r(u),t=e.nil,i=e.$$$;return L=u,x=[Y(u[0],"Racc")].concat(L),y=e.$r(x),G(x[0],y("StandardError"),"ParseError"),c(i("::","ParseError","skip_raise")?"constant":t)||I(u[0],"ParseError",i(K("Racc"),"ParseError")),function(k,L){var s,o,_,T,d,y=[Y(k,"Racc")].concat(L),S=e.$r(y);return c(S("Racc_No_Extensions","skip_raise")?"constant":t)||I(y[0],"Racc_No_Extensions",!1),s=y,_=[o=G(y[0],null,"Parser")].concat(s),T=e.$r(_),(d=o.$$prototype).yydebug=d.racc_debug_out=d.racc_error_status=d.racc_t=d.racc_vstack=d.racc_val=d.racc_state=d.racc_tstack=t,I(_[0],"Racc_Runtime_Version","1.4.6"),I(_[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),I(_[0],"Racc_Runtime_Core_Version_R","1.4.6"),I(_[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),I(_[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),I(_[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),I(_[0],"Racc_Runtime_Core_Version",T("Racc_Runtime_Core_Version_R")),I(_[0],"Racc_Runtime_Core_Revision",T("Racc_Runtime_Core_Revision_R")),I(_[0],"Racc_Runtime_Type","ruby"),P(T("Parser"),"$racc_runtime_type",function(){return T("Racc_Runtime_Type")}),h(o,"$_racc_setup",function(){var n,w,r=this,v=t,a=t;return null==f.stderr&&(f.stderr=t),c(i(r.$class(),"Racc_debug_parser"))||(r.yydebug=!1),c(null!=(n=r.yydebug)&&n!==t?"instance-variable":t)||(r.yydebug=!1),c(r.yydebug)&&(c(null!=(w=r.racc_debug_out)&&w!==t?"instance-variable":t)||(r.racc_debug_out=f.stderr),r.racc_debug_out=c(v=r.racc_debug_out)?v:f.stderr),a=i(r.$class(),"Racc_arg"),c(H(a.$size(),14))&&a["$[]="](13,!0),a}),h(o,"$_racc_init_sysvars",function(){var n=this;return n.racc_state=[0],n.racc_tstack=[],n.racc_vstack=[],n.racc_t=t,n.racc_val=t,n.racc_read_next=!0,n.racc_user_yyerror=!1,n.racc_error_status=0}),h(o,"$do_parse",function(){return this.$__send__(T("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),h(o,"$next_token",function(){return this.$raise(T("NotImplementedError"),this.$class()+"#next_token is not defined")}),h(o,"$_racc_do_parse_rb",function(n,w){var r,a=this,O=t,re=t,ee=t,ie=t,oe=t,ue=t,_e=t,le=t;return r=N(n),O=null==r[0]?t:r[0],re=null==r[1]?t:r[1],ee=null==r[2]?t:r[2],ie=null==r[3]?t:r[3],oe=null==r[10]?t:r[10],a.$_racc_init_sysvars(),ue=_e=le=t,M(a,"catch",["racc_end_parse"],function $e(){var se,te,q=null==$e.$$s?this:$e.$$s,X=t;for(null==q.racc_state&&(q.racc_state=t),null==q.racc_read_next&&(q.racc_read_next=t),null==q.racc_t&&(q.racc_t=t),null==q.yydebug&&(q.yydebug=t),null==q.racc_val&&(q.racc_val=t);c(!0);)for(c(le=ie["$[]"](q.racc_state["$[]"](-1)))?(c(q.racc_read_next)&&E(q.racc_t,0)&&(te=q.$next_token(),se=N(te),ue=null==se[0]?t:se[0],q.racc_val=null==se[1]?t:se[1],q.racc_t=c(ue)?c(X=oe["$[]"](ue))?X:1:0,c(q.yydebug)&&q.$racc_read_token(q.racc_t,ue,q.racc_val),q.racc_read_next=!1),le=V(le,q.racc_t),c(j(le,0))&&c(_e=O["$[]"](le))&&Q(re["$[]"](le),q.racc_state["$[]"](-1))||(_e=ee["$[]"](q.racc_state["$[]"](-1)))):_e=ee["$[]"](q.racc_state["$[]"](-1));c(_e=q.$_racc_evalact(_e,n)););},{$$s:a})}),h(o,"$yyparse",function(n,w){return this.$__send__(T("Racc_YY_Parse_Method"),n,w,this.$_racc_setup(),!0)}),h(o,"$_racc_yyparse_rb",function(n,w,r,v){var a,ee=t,ie=t,ce=t,oe=t,_e=t,le=t,$e=t;return a=N(r),ee=null==a[0]?t:a[0],ie=null==a[1]?t:a[1],ce=null==a[2]?t:a[2],oe=null==a[3]?t:a[3],_e=null==a[10]?t:a[10],this.$_racc_init_sysvars(),le=t,$e=t,M(this,"catch",["racc_end_parse"],function se(){var te=null==se.$$s?this:se.$$s;for(null==te.racc_state&&(te.racc_state=t);!c($e=oe["$[]"](te.racc_state["$[]"](-1)));)for(;c(le=te.$_racc_evalact(ce["$[]"](te.racc_state["$[]"](-1)),r)););return M(n,"__send__",[w],function q(X,F){var R=null==q.$$s?this:q.$$s,Z=t,D=t;for(null==R.racc_t&&(R.racc_t=t),null==R.racc_state&&(R.racc_state=t),null==R.racc_read_next&&(R.racc_read_next=t),null==X&&(X=t),null==F&&(F=t),R.racc_t=c(X)?c(Z=_e["$[]"](X))?Z:1:0,R.racc_val=F,R.racc_read_next=!1,$e=V($e,R.racc_t),c(j($e,0))&&c(le=ee["$[]"]($e))&&Q(ie["$[]"]($e),R.racc_state["$[]"](-1))||(le=ce["$[]"](R.racc_state["$[]"](-1)));c(le=R.$_racc_evalact(le,r)););for(;c(c(Z=c(D=($e=oe["$[]"](R.racc_state["$[]"](-1)))["$!"]())?D:R.racc_read_next["$!"]())?Z:R.racc_t["$=="](0));)for(c($e)&&c($e=V($e,R.racc_t))&&c(j($e,0))&&c(le=ee["$[]"]($e))&&Q(ie["$[]"]($e),R.racc_state["$[]"](-1))||(le=ce["$[]"](R.racc_state["$[]"](-1)));c(le=R.$_racc_evalact(le,r)););},{$$s:te})},{$$s:this})}),h(o,"$_racc_evalact",function(n,w){var r,ce,a=this,O=t,re=t,ie=t,oe=t,ue=t,_e=t;if(O=null==(r=N(w))[0]?t:r[0],re=null==r[1]?t:r[1],ie=null==r[3]?t:r[3],ce=null==r[11]?t:r[11],oe=null==r[12]?t:r[12],c(A(n,0))&&c(H(n,ce)))c(A(a.racc_error_status,0))&&(Q(a.racc_t,1)||(a.racc_error_status=z(a.racc_error_status,1))),a.racc_vstack.$push(a.racc_val),a.racc_state.$push(n),a.racc_read_next=!0,c(a.yydebug)&&(a.racc_tstack.$push(a.racc_t),a.$racc_shift(a.racc_t,a.racc_tstack,a.racc_vstack));else if(c(H(n,0))&&c(A(n,oe["$-@"]()))){if(ue=M(a,"catch",["racc_jump"],function le(){var $e=null==le.$$s?this:le.$$s;return null==$e.racc_state&&($e.racc_state=t),$e.racc_state.$push($e.$_racc_do_reduce(w,n)),!1},{$$s:a}),c(ue))switch(ue.valueOf()){case 1:return a.racc_user_yyerror=!0,oe["$-@"]();case 2:return ce;default:a.$raise("[Racc Bug] unknown jump code")}}else if(Q(n,ce))c(a.yydebug)&&a.$racc_accept(),a.$throw("racc_end_parse",a.racc_vstack["$[]"](0));else{if(Q(n,oe["$-@"]())){switch(a.racc_error_status.valueOf()){case 0:c(w["$[]"](21))||a.$on_error(a.racc_t,a.racc_val,a.racc_vstack);break;case 3:Q(a.racc_t,0)&&a.$throw("racc_end_parse",t),a.racc_read_next=!0}for(a.racc_user_yyerror=!1,a.racc_error_status=3;c(!0)&&!(c(_e=ie["$[]"](a.racc_state["$[]"](-1)))&&(_e=V(_e,1),c(j(_e,0))&&c(n=O["$[]"](_e))&&Q(re["$[]"](_e),a.racc_state["$[]"](-1))));)c($(a.racc_state.$size(),1))&&a.$throw("racc_end_parse",t),a.racc_state.$pop(),a.racc_vstack.$pop(),c(a.yydebug)&&(a.racc_tstack.$pop(),a.$racc_e_pop(a.racc_state,a.racc_tstack,a.racc_vstack));return n}a.$raise("[Racc Bug] unknown action "+n.$inspect())}return c(a.yydebug)&&a.$racc_next_state(a.racc_state["$[]"](-1),a.racc_state),t}),h(o,"$_racc_do_reduce",function(n,w){var r,oe,_e,X,F,R,W,a=this,re=t,ee=t,ie=t,ce=t,ue=t,le=t,$e=t,se=t,te=t,q=t,Z=t,D=t,J=t;return re=null==(r=N(n))[4]?t:r[4],ee=null==r[5]?t:r[5],ie=null==r[6]?t:r[6],ce=null==r[7]?t:r[7],oe=null==r[8]?t:r[8],ue=null==r[9]?t:r[9],_e=null==r[13]?t:r[13],le=a.racc_state,$e=a.racc_vstack,se=a.racc_tstack,te=B(w,-3),q=ue["$[]"](te),X=ue["$[]"](V(te,1)),F=ue["$[]"](V(te,2)),R=[],c(a.yydebug)&&(Z=se["$[]"](q["$-@"](),q)),D=$e["$[]"](q["$-@"](),q),c(a.yydebug)&&se["$[]="](q["$-@"](),q,R),$e["$[]="](q["$-@"](),q,R),le["$[]="](q["$-@"](),q,R),c(_e)?$e.$push(a.$__send__(F,D,$e,D["$[]"](0))):$e.$push(a.$__send__(F,D,$e)),se.$push(X),c(a.yydebug)&&a.$racc_reduce(Z,X,se,$e),W=z(X,oe),c(te=ce["$[]"](W))&&(te=V(te,le["$[]"](-1)),c(j(te,0))&&c(J=re["$[]"](te))&&Q(ee["$[]"](te),W))?J:ie["$[]"](W)}),h(o,"$on_error",function(n,w,r){var a,v=this;return v.$raise(T("ParseError"),v.$sprintf("\nparse error on value %s (%s)",w.$inspect(),c(a=v.$token_to_str(n))?a:"?"))}),h(o,"$yyerror",function(){return this.$throw("racc_jump",1)}),h(o,"$yyaccept",function(){return this.$throw("racc_jump",2)}),h(o,"$yyerrok",l("racc_error_status",0)),h(o,"$racc_read_token",function(n,w,r){var v=this;return v.racc_debug_out.$print("read    "),v.racc_debug_out.$print(w.$inspect(),"(",v.$racc_token2str(n),") "),v.racc_debug_out.$puts(r.$inspect()),v.racc_debug_out.$puts()}),h(o,"$racc_shift",function(n,w,r){var v=this;return v.racc_debug_out.$puts("shift   "+v.$racc_token2str(n)),v.$racc_print_stacks(w,r),v.racc_debug_out.$puts()}),h(o,"$racc_reduce",function(n,w,r,v){var a=this,O=t;return(O=a.racc_debug_out).$print("reduce "),c(n["$empty?"]())?O.$print(" <none>"):M(n,"each",[],function re(ee){return null==ee&&(ee=t),O.$print(" ",(null==re.$$s?this:re.$$s).$racc_token2str(ee))},{$$s:a}),O.$puts(" --\x3e "+a.$racc_token2str(w)),a.$racc_print_stacks(r,v),a.racc_debug_out.$puts()}),h(o,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),h(o,"$racc_e_pop",function(n,w,r){var v=this;return v.racc_debug_out.$puts("error recovering mode: pop token"),v.$racc_print_states(n),v.$racc_print_stacks(w,r),v.racc_debug_out.$puts()}),h(o,"$racc_next_state",function(n,w){var r=this;return r.racc_debug_out.$puts("goto    "+n),r.$racc_print_states(w),r.racc_debug_out.$puts()}),h(o,"$racc_print_stacks",function(n,w){var v=t;return(v=this.racc_debug_out).$print("        ["),M(n,"each_index",[],function a(O){return null==O&&(O=t),v.$print(" (",(null==a.$$s?this:a.$$s).$racc_token2str(n["$[]"](O))," ",w["$[]"](O).$inspect(),")")},{$$s:this}),v.$puts(" ]")}),h(o,"$racc_print_states",function(n){var r=t;return(r=this.racc_debug_out).$print("        ["),M(n,"each",[],function(a){return null==a&&(a=t),r.$print(" ",a)}),r.$puts(" ]")}),h(o,"$racc_token2str",function(n){var r;return c(r=i(this.$class(),"Racc_token_to_s_table")["$[]"](n))?r:this.$raise("[Racc Bug] can't convert token "+n+" to string")}),h(o,"$token_to_str",function(n){return i(this.$class(),"Racc_token_to_s_table")["$[]"](n)})}(u[0],u)},Opal.modules["bcdice/arithmetic/node"]=function(e){var l,t,C,s,o,y,S,k,u,Y=e.module,G=e.klass,c=e.def,I=e.thrower,P=e.return_ivar,f=e.send2,H=e.find_super,h=e.eqeq,N=e.const_set,M=e.eqeqeq,E=e.rb_divide,V=e.truthy,Q=e.assign_ivar,j=e.alias,A=[],z=e.nil,$=e.$$$;return l=A,t=u=[Y(A[0],"BCDice")].concat(l),C=k=[Y(u[0],"Arithmetic")].concat(t),y=[Y(k[0],"Node")].concat(C),S=e.$r(y),(o=(s=G(y[0],null,"BinaryOp")).$$prototype).lhs=o.rhs=o.op=z,c(s,"$initialize",function(T,d,m){var n=this;return n.lhs=T,n.op=d,n.rhs=m}),c(s,"$eval",function(T){try{I("eval_return");var w,m=this,n=z;return n=m.lhs.$eval(T),w=m.rhs.$eval(T),n.$send(m.op,w)}catch(r){if(r===e.t_eval_return)return r.$v;throw r}}),c(s,"$output",function(){var T=this;return""+T.lhs.$output()+T.op+T.rhs.$output()}),c(s,"$s_exp",function(){var T=this;return"("+T.$op_for_s_exp()+" "+T.lhs.$s_exp()+" "+T.rhs.$s_exp()+")"}),c(s,"$op_for_s_exp",P("op")),function(g,b,s){var o=G(g,b,"DivideBase"),_=[o].concat(s),T=e.$r(_),d=o.$$prototype;d.lhs=d.rhs=d.op=z,c(o,"$initialize",function m(n,w){return m.$$p=null,f(this,H(this,"initialize",m,!1,!0),"initialize",[n,"/",w],null)}),c(o,"$eval",function(n){try{I("eval_return");var v,a,r=this;return v=r.lhs.$eval(n),a=r.rhs.$eval(n),h(a,0)&&r.$raise(T("ZeroDivisionError")),r.$divide_and_round(v,a,n)}catch(O){if(O===e.t_eval_return)return O.$v;throw O}}),c(o,"$output",function m(){var n=m.$$p||z,w=this;return m.$$p=null,""+f(w,H(w,"output",m,!1,!0),"output",[],n)+w.$rounding_method()}),o.$private(),c(o,"$rounding_method",function(){return $(this.$class(),"ROUNDING_METHOD")}),c(o,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),c(o,"$divide_and_round",function(n,w,r){return this.$raise(T("NotImplementedError"))})}(y[0],S("BinaryOp"),y),function(g,b,s){var o=G(g,b,"DivideWithGameSystemDefault"),_=[o].concat(s),T=e.$r(_);N(_[0],"ROUNDING_METHOD",""),o.$private(),c(o,"$divide_and_round",function(m,n,w){var r,v=z;return M($(T("RoundType"),"CEIL"),r=w)?E(m.$to_f(),n).$ceil():M($(T("RoundType"),"ROUND"),r)?(v=E(m.$to_f(),n),V(v["$negative?"]())?v.$abs().$round()["$-@"]():v.$round()):E(m,n).$floor()})}(y[0],S("DivideBase"),y),function(g,b,s){var o=G(g,b,"DivideWithCeil"),_=[o].concat(s);N(_[0],"ROUNDING_METHOD","C"),o.$private(),c(o,"$divide_and_round",function(d,m,n){return E(d.$to_f(),m).$ceil()})}(y[0],S("DivideBase"),y),function(g,b,s){var o=G(g,b,"DivideWithRound"),_=[o].concat(s);N(_[0],"ROUNDING_METHOD","R"),o.$private(),c(o,"$divide_and_round",function(d,m,n){var w=z;return w=E(d.$to_f(),m),V(w["$negative?"]())?w.$abs().$round()["$-@"]():w.$round()})}(y[0],S("DivideBase"),y),function(g,b,s){var o=G(g,b,"DivideWithFloor"),_=[o].concat(s);N(_[0],"ROUNDING_METHOD","F"),o.$private(),c(o,"$divide_and_round",function(d,m,n){return E(d,m).$floor()})}(y[0],S("DivideBase"),y),function(g,b){var s=G(g,null,"Negative");s.$$prototype.body=z,c(s,"$initialize",Q("body")),c(s,"$eval",function(T){try{return I("eval_return"),this.body.$eval(T)["$-@"]()}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),c(s,"$output",function(){return"-"+this.body.$output()}),c(s,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(y[0]),function(g,b){var s=G(g,null,"Parenthesis");s.$$prototype.expr=z,c(s,"$initialize",Q("expr")),c(s,"$eval",function(T){try{return I("eval_return"),this.expr.$eval(T)}catch(n){if(n===e.t_eval_return)return n.$v;throw n}}),c(s,"$output",function(){return"("+this.expr.$output()+")"}),c(s,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(y[0]),function(g,b){var s=G(g,null,"Number");return s.$$prototype.value=z,c(s,"$initialize",Q("value")),c(s,"$eval",P("value")),c(s,"$output",function(){return this.value.$to_s()}),j(s,"s_exp","output")}(y[0])},Opal.modules.strscan=function(e){var Q,j,A,z,$,G=e.def,c=e.truthy,I=e.eqeqeq,P=e.Opal,f=e.return_ivar,H=e.send,h=e.alias,N=[],M=e.nil;return Q=N,A=[j=(0,e.klass)(N[0],null,"StringScanner")].concat(Q),z=e.$r(A),($=j.$$prototype).pos=$.string=$.working=$.matched=$.prev_pos=$.match=M,j.$attr_reader("pos","matched"),G(j,"$initialize",function(l){var p=this;return p.string=l,p.pos=0,p.matched=M,p.working=l,p.match=[]}),j.$attr_reader("string"),G(j,"$beginning_of_line?",function(){var l=this;return 0===l.pos||"\n"===l.string.charAt(l.pos-1)}),G(j,"$scan",function(l){var p=this,u=(l=p.$anchor(l)).exec(p.working);return null==u?p.matched=M:(p.prev_pos=p.pos,p.pos+=u[0].length,p.working=p.working.substring(u[0].length),p.matched=u[0],p.match=u,u[0])}),G(j,"$scan_until",function(l){var p=this;l=p.$anchor(l);for(var u=p.working,K=0;u.length!=K;++K){var t=l.exec(u.substr(K));if(null!==t){var i=K+t[0].length,k=u.substr(0,i);return p.matched=t[0],p.match=t,p.prev_pos=p.pos+K,p.pos+=i,p.working=u.substr(i),k}}return p.matched=M}),G(j,"$[]",function(l){var u;if(c(this.match["$empty?"]()))return M;I(z("Symbol"),u=l)?l=l.$to_s():I(z("String"),u)||(l=P["$coerce_to!"](l,z("Integer"),"to_int"));var K=this.match;return l<0&&(l+=K.length),l<0||l>=K.length||null==K[l]?M:K[l]}),G(j,"$check",function(l){var p=this,u=(l=p.$anchor(l)).exec(p.working);return p.matched=null==u?M:u[0]}),G(j,"$check_until",function(l){var p=this,u=p.prev_pos,K=p.pos,t=p.working,i=p.$scan_until(l);return p.prev_pos=u,p.pos=K,p.working=t,i}),G(j,"$peek",function(l){return this.working.substring(0,l)}),G(j,"$eos?",function(){return 0===this.working.length}),G(j,"$exist?",function(l){var u=l.exec(this.working);return null==u?M:0==u.index?0:u.index+1}),G(j,"$skip",function(l){var p=this,u=(l=p.$anchor(l)).exec(p.working);if(null==u)return p.match=[],p.matched=M;var K=u[0],t=K.length;return p.matched=K,p.match=u,p.prev_pos=p.pos,p.pos+=t,p.working=p.working.substring(t),t}),G(j,"$skip_until",function(l){var u=this.$scan_until(l);return u===M?M:(this.matched=u.substr(-1),u.length)}),G(j,"$get_byte",function(){var l=this,p=M;return l.pos<l.string.length?(l.prev_pos=l.pos,l.pos+=1,p=l.matched=l.working.substring(0,1),l.working=l.working.substring(1)):l.matched=M,p}),G(j,"$match?",function(l){var p=this,u=(l=p.$anchor(l)).exec(p.working);return null==u?M:(p.prev_pos=p.pos,u[0].length)}),G(j,"$pos=",function(l){var p=this;return l<0&&(l+=p.string.$length()),p.pos=l,p.working=p.string.slice(l)}),G(j,"$matched_size",function(){return this.matched===M?M:this.matched.length}),G(j,"$post_match",function(){var l=this;return l.matched===M?M:l.string.substr(l.pos)}),G(j,"$pre_match",function(){var l=this;return l.matched===M?M:l.string.substr(0,l.prev_pos)}),G(j,"$reset",function(){var l=this;return l.working=l.string,l.matched=M,l.pos=0}),G(j,"$rest",f("working")),G(j,"$rest?",function(){return 0!==this.working.length}),G(j,"$rest_size",function(){return this.$rest().$size()}),G(j,"$terminate",function(){var l,p=this;return p.match=M,l=[p.string.$length()],H(p,"pos=",l),l[l.length-1]}),G(j,"$unscan",function(){var l=this;return l.pos=l.prev_pos,l.prev_pos=M,l.match=M,l}),h(j,"bol?","beginning_of_line?"),h(j,"getch","get_byte"),j.$private(),G(j,"$anchor",function(l){var p=l.toString().match(/\/([^\/]+)$/);return p=p?p[1]:void 0,new RegExp("^(?:"+l.source+")",p)})},Opal.modules["bcdice/normalize"]=function(e){var h,V,M,Y=e.module,G=e.eqeqeq,c=e.def,I=e.eqeq,P=[],f=e.nil;return h=P,M=[Y(P[0],"BCDice")].concat(h),(V=Y(M[0],"Normalize")).$module_function(),c(V,"$comparison_operator",function(j){var A;return G(/<=|=</,A=j)?"<=":G(/>=|=>/,A)?">=":G(/<>|!=|=!/,A)?"!=":G(/</,A)?"<":G(/>/,A)?">":G(/=/,A)?"==":f}),c(V,"$target_number",function(j){return I(j,"?")?j:j.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var Q,$,K,t,i,k,L,l,A,Y=e.module,G=e.klass,c=e.const_set,I=e.hash2,P=e.truthy,f=e.send,H=e.def,h=e.thrower,N=e.top,M=[],E=e.nil;return N.$require("strscan"),N.$require("bcdice/normalize"),Q=M,$=A=[Y(M[0],"BCDice")].concat(Q),K=l=[Y(A[0],"Command")].concat($),i=[t=G(l[0],null,"Lexer")].concat(K),k=e.$r(i),(L=t.$$prototype).scanner=L.notations=E,c(i[0],"SYMBOLS",I(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),H(t,"$initialize",function(x,y){var S,g,s;return x=P(s=(S=(g=x)===E||null==g?E:g.$split(" ",2))===E||null==S?E:S.$first())?s:"",this.scanner=k("StringScanner").$new(x),this.notations=f(y,"map",[],function(_){return null==_&&(_=E),P(_["$is_a?"](k("String")))?k("Regexp").$new(_):_})}),H(t,"$next_token",function(){try{var x=h("return"),y=this,S=E,g=E,s=E,o=E;return P(y.scanner["$eos?"]())?[!1,"$"]:(f(y.notations,"each",[],function _(T){var m,d=null==_.$$s?this:_.$$s;if(null==d.scanner&&(d.scanner=E),null==T&&(T=E),m=d.scanner.$scan(T),!P(m))return E;x.$throw(["NOTATION",m])},{$$s:y,$$ret:x}),P(S=y.scanner.$scan(/\d+/))?["NUMBER",S.$to_i()]:P(g=y.scanner.$scan(/[<>!=]+/))?(g=k("Normalize").$comparison_operator(g),[P(g)?"CMP_OP":"ILLEGAL",g]):(s=y.scanner.$getch().$upcase(),[P(o=k("SYMBOLS")["$[]"](s))?o:s.$to_sym(),s]))}catch(_){if(_===x)return _.$v;throw _}}),H(t,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var N,Q,B,l,p,u,K,A,E,Y=e.module,G=e.klass,c=e.def,I=e.return_ivar,P=e.truthy,f=[],H=e.nil;return N=f,Q=E=[Y(f[0],"BCDice")].concat(N),B=A=[Y(E[0],"Command")].concat(Q),p=[l=G(A[0],null,"Parsed")].concat(B),u=e.$r(p),(K=l.$$prototype).critical=K.fumble=K.dollar=K.modify_number=K.question_target=K.target_number=K.prefix_number=K.command=K.suffix_number=K.cmp_op=H,l.$attr_accessor("command"),l.$attr_accessor("prefix_number"),l.$attr_accessor("suffix_number"),l.$attr_accessor("critical"),l.$attr_accessor("fumble"),l.$attr_accessor("dollar"),l.$attr_accessor("modify_number"),l.$attr_accessor("cmp_op"),l.$attr_accessor("target_number"),l.$attr_writer("question_target"),c(l,"$initialize",function(){var i=this;return i.prefix_number=H,i.suffix_number=H,i.critical=H,i.fumble=H,i.dollar=H,i.cmp_op=H,i.target_number=H,i.question_target=!1}),c(l,"$question_target?",I("question_target")),c(l,"$to_s",function(i){var k=this,L=H,C=H,x=H,y=H,S=H;switch(null==i&&(i="after_command"),L=P(k.critical)?"@"+k.critical:H,C=P(k.fumble)?"#"+k.fumble:H,x=P(k.dollar)?"$"+k.dollar:H,y=u("Format").$modifier(k.modify_number),S=P(k.question_target)?"?":k.target_number,i.valueOf()){case"after_command":return[k.prefix_number,k.command,k.suffix_number,L,C,x,y,k.cmp_op,S].$join();case"after_modify_number":return[k.prefix_number,k.command,k.suffix_number,y,L,C,x,k.cmp_op,S].$join();case"after_target_number":return[k.prefix_number,k.command,k.suffix_number,y,k.cmp_op,S,L,C,x].$join();default:return H}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var i,x,o,w,r,v,a,O,re,ee,ie,ce,_e,_,m,n,se,S,g,L,Y=e.klass,G=e.module,c=e.slice,I=e.extract_kwargs,P=e.ensure_kwargs,f=e.get_kwarg,H=e.send2,h=e.find_super,N=e.def,M=e.send,E=e.eqeq,V=e.thrower,Q=e.hash,j=e.const_set,A=e.truthy,z=e.to_ary,$=e.hash2,B=e.top,l=[],p=e.$r(l),u=e.nil,K=e.$$$;return B.$require("racc/parser.rb"),B.$require("bcdice/arithmetic/node"),B.$require("bcdice/command/lexer"),B.$require("bcdice/command/parsed"),Y(K(p("BCDice"),"Command"),K(p("Racc"),"Parser"),"Parser"),i=l,x=L=[G(l[0],"BCDice")].concat(i),S=[G(L[0],"Command")].concat(x),g=e.$r(S),o=S,m=[_=Y(S[0],K(g("Racc"),"Parser"),"Parser")].concat(o),n=e.$r(m),(se=_.$$prototype).notations=se.lexer=se.modifier=se.suffix_number=se.prefix_number=se.need_suffix_number=se.need_prefix_number=se.critical=se.fumble=se.dollar=se.allowed_cmp_op=se.question_target=u,N(_,"$initialize",function te(q,X){var F,R,Z,D,J=this;return te.$$p=null,F=c(arguments),R=I(F),R=P(R),Z=F,D=f(R,"round_type"),H(J,h(J,"initialize",te,!1,!0),"initialize",[],null),J.notations=Z,J.round_type=D,J.prefix_number=!1,J.suffix_number=!1,J.need_prefix_number=!1,J.need_suffix_number=!1,J.modifier=!0,J.critical=!1,J.fumble=!1,J.dollar=!1,J.allowed_cmp_op=[u,">=",">","<=","<","==","!="],J.question_target=!1},-2),N(_,"$disable_modifier",function(){return this.modifier=!1,this}),N(_,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),N(_,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),N(_,"$has_prefix_number",function(){var q=this;return q.prefix_number=!0,q.need_prefix_number=!0,q}),N(_,"$has_suffix_number",function(){var q=this;return q.suffix_number=!0,q.need_suffix_number=!0,q}),N(_,"$enable_critical",function(){return this.critical=!0,this}),N(_,"$enable_fumble",function(){return this.fumble=!0,this}),N(_,"$enable_dollar",function(){return this.dollar=!0,this}),N(_,"$restrict_cmp_op_to",function(q){var X;return X=c(arguments),this.allowed_cmp_op=X,this},-1),N(_,"$enable_question_target",function(){return this.question_target=!0,this}),N(_,"$parse",function(q){var X=this;try{return X.lexer=n("Lexer").$new(q,X.notations),X.$do_parse()}catch(F){if(!e.rescue(F,[n("ParseError"),n("ZeroDivisionError")]))throw F;try{return u}finally{e.pop_exception()}}}),_.$private(),N(_,"$parsed",function(q,X,F,R){try{return V("eval_return"),M(n("Parsed").$new(),"tap",[],function W(J){var U,ne,ae,fe,de,me,ve,he=null==W.$$s?this:W.$$s;return null==he.round_type&&(he.round_type=u),null==J&&(J=u),J["$command="](q["$[]"]("command")),J["$prefix_number="]((U=q["$[]"]("prefix"))===u||null==U?u:U.$eval(he.round_type)),J["$suffix_number="]((ne=q["$[]"]("suffix"))===u||null==ne?u:ne.$eval(he.round_type)),J["$critical="]((ae=X["$[]"]("critical"))===u||null==ae?u:ae.$eval(he.round_type)),J["$fumble="]((fe=X["$[]"]("fumble"))===u||null==fe?u:fe.$eval(he.round_type)),J["$dollar="]((de=X["$[]"]("dollar"))===u||null==de?u:de.$eval(he.round_type)),J["$modify_number="](F.$eval(he.round_type)),J["$cmp_op="](R["$[]"]("cmp_op")),E(R["$[]"]("target"),"?")?(J["$question_target="](!0),M(J,"target_number=",me=[0]),me[me.length-1]):(J["$question_target="](!1),me=[(ve=R["$[]"]("target"),ve===u||null==ve?u:ve.$eval(he.round_type))],M(J,"target_number=",me),me[me.length-1])},{$$s:this})}catch(W){if(W===e.t_eval_return)return W.$v;throw W}}),N(_,"$next_token",function(){return this.lexer.$next_token()}),w=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),r=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),v=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),a=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),O=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),re=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),ee=[u,6,13,3,9,-1,27,-15,-10,-1,-38],ie=[u,u,u,u,u,u,19,16,15,u,u],ce=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),_e=Q(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),j(m[0],"Racc_arg",[w,r,a,v,O,re,ie,ee,19,ce,_e,58,35,!0]),A(n("Ractor","skip_raise")?"constant":u)&&n("Ractor").$make_shareable(n("Racc_arg")),j(m[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),A(n("Ractor","skip_raise")?"constant":u)&&n("Ractor").$make_shareable(n("Racc_token_to_s_table")),j(m[0],"Racc_debug_parser",!1),N(_,"$_reduce_1",function(q,X,F){var R,D=this;return A(D.modifier)||D.$raise(n("ParseError")),R=z(q),D.$parsed(null==R[0]?u:R[0],null==R[1]?u:R[1],null==R[2]?u:R[2],null==R[3]?u:R[3])}),N(_,"$_reduce_2",function(q,X,F){var R,D=this;return A(D.modifier)||D.$raise(n("ParseError")),R=z(q),D.$parsed(null==R[0]?u:R[0],null==R[2]?u:R[2],null==R[1]?u:R[1],null==R[3]?u:R[3])}),N(_,"$_reduce_3",function(q,X,F){var R,U;return U=null==(R=z(q))[2]?u:R[2],this.$parsed(null==R[0]?u:R[0],null==R[1]?u:R[1],K(K(n("Arithmetic"),"Node"),"Number").$new(0),U)}),N(_,"$_reduce_4",function(q,X,F){var R=this;return A(R.prefix_number)&&A(R.suffix_number)||R.$raise(n("ParseError")),$(["command","prefix","suffix"],{command:q["$[]"](1),prefix:q["$[]"](0),suffix:q["$[]"](2)})}),N(_,"$_reduce_5",function(q,X,F){var R=this;return A(R.prefix_number)||R.$raise(n("ParseError")),A(R.need_suffix_number)&&R.$raise(n("ParseError")),$(["command","prefix"],{command:q["$[]"](1),prefix:q["$[]"](0)})}),N(_,"$_reduce_6",function(q,X,F){var R=this;return A(R.suffix_number)||R.$raise(n("ParseError")),A(R.need_prefix_number)&&R.$raise(n("ParseError")),$(["command","suffix"],{command:q["$[]"](0),suffix:q["$[]"](1)})}),N(_,"$_reduce_7",function(q,X,F){var R=this;return(A(R.need_prefix_number)||A(R.need_suffix_number))&&R.$raise(n("ParseError")),$(["command"],{command:q["$[]"](0)})}),N(_,"$_reduce_8",function(q,X,F){return $([],{})}),N(_,"$_reduce_9",function(q,X,F){var R,U,W=u;return W=null==(R=z(q))[0]?u:R[0],U=null==R[2]?u:R[2],A(this.critical)&&A(W["$[]"]("critical")["$nil?"]())||this.$raise(n("ParseError")),W["$[]="]("critical",U),W}),N(_,"$_reduce_10",function(q,X,F){var R,U,W=u;return W=null==(R=z(q))[0]?u:R[0],U=null==R[2]?u:R[2],A(this.fumble)&&A(W["$[]"]("fumble")["$nil?"]())||this.$raise(n("ParseError")),W["$[]="]("fumble",U),W}),N(_,"$_reduce_11",function(q,X,F){var R,U,W=u;return W=null==(R=z(q))[0]?u:R[0],U=null==R[2]?u:R[2],A(this.dollar)&&A(W["$[]"]("dollar")["$nil?"]())||this.$raise(n("ParseError")),W["$[]="]("dollar",U),W}),N(_,"$_reduce_12",function(q,X,F){return q["$[]"](1)}),N(_,"$_reduce_13",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"Negative").$new(q["$[]"](1))}),N(_,"$_reduce_14",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"+",q["$[]"](2))}),N(_,"$_reduce_15",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"-",q["$[]"](2))}),N(_,"$_reduce_16",function(q,X,F){return A(this.allowed_cmp_op["$include?"](u))||this.$raise(n("ParseError")),$([],{})}),N(_,"$_reduce_17",function(q,X,F){var R,W,J;return J=null==(R=z(q))[1]?u:R[1],A(this.allowed_cmp_op["$include?"](W=null==R[0]?u:R[0]))||this.$raise(n("ParseError")),$(["cmp_op","target"],{cmp_op:W,target:J})}),N(_,"$_reduce_18",function(q,X,F){var Z,R=this;return Z=q["$[]"](0),A(R.question_target)||R.$raise(n("ParseError")),A(R.allowed_cmp_op["$include?"](Z))||R.$raise(n("ParseError")),$(["cmp_op","target"],{cmp_op:Z,target:"?"})}),N(_,"$_reduce_19",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"+",q["$[]"](2))}),N(_,"$_reduce_20",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"-",q["$[]"](2))}),N(_,"$_reduce_22",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"BinaryOp").$new(q["$[]"](0),"*",q["$[]"](2))}),N(_,"$_reduce_23",function(q,X,F){return q["$[]"](3).$new(q["$[]"](0),q["$[]"](2))}),N(_,"$_reduce_25",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),N(_,"$_reduce_26",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"DivideWithCeil")}),N(_,"$_reduce_27",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"DivideWithCeil")}),N(_,"$_reduce_28",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"DivideWithRound")}),N(_,"$_reduce_29",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"DivideWithFloor")}),N(_,"$_reduce_30",function(q,X,F){return q["$[]"](1)}),N(_,"$_reduce_31",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"Negative").$new(q["$[]"](1))}),N(_,"$_reduce_33",function(q,X,F){return q["$[]"](1)}),N(_,"$_reduce_34",function(q,X,F){return K(K(n("Arithmetic"),"Node"),"Number").$new(q["$[]"](0))}),N(_,"$_reduce_none",function(q,X,F){return q["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var M,j,B,l,p,u,z,V,Y=e.module,G=e.send,c=e.eqeqeq,I=e.truthy,P=e.def,f=e.return_val,H=[],h=e.nil;return M=H,j=V=[Y(H[0],"BCDice")].concat(M),B=z=[Y(V[0],"Deprecated")].concat(j),p=[l=Y(z[0],"Checker")].concat(B),u=e.$r(p),l.$private(),P(l,"$check_result_legacy",function(t,i,k,L){var S,C=this,x=h,y=h,g=h,b=h;return x=G(i,"map",[],"sides".$to_proc()),S=(y=G(i,"map",[],"value".$to_proc())).$sum(),g=c([100],b=x)?C.$check_1D100(t,S,k,L):c([20],b)?C.$check_1D20(t,S,k,L):c([6,6],b)?C.$check_2D6(t,S,y,k,L):h,(I(g["$nil?"]())||I(g["$empty?"]()))&&(g=c([10],b=x.$uniq())?C.$check_nD10(t,S,y,k,L):c([6],b)?C.$check_nD6(t,S,y,k,L):h,I(g["$nil?"]())||I(g["$empty?"]()))?h:u("Result").$new(g.$delete_prefix(" \uff1e "))}),P(l,"$check_1D100",f(h)),P(l,"$check_1D20",f(h)),P(l,"$check_nD10",f(h)),P(l,"$check_2D6",f(h)),P(l,"$check_nD6",f(h))},Opal.modules["bcdice/base"]=function(e){var p,C,b,d,n,w,s,o,_,T,y,Y=e.module,G=e.klass,c=e.slice,I=e.rb_plus,P=e.truthy,f=e.def,H=e.regexp,h=e.send,N=e.thrower,M=e.return_ivar,E=e.assign_ivar_val,V=e.eqeqeq,Q=e.eqeq,j=e.return_val,A=e.range,z=e.rb_minus,$=e.rb_divide,B=e.rb_times,l=e.rb_ge,u=e.top,K=[],t=e.$r(K),i=e.nil,k=e.$$$;return u.$require("i18n"),u.$require("i18n/backend/fallbacks"),u.$require("bcdice/randomizer"),u.$require("bcdice/dice_table"),u.$require("bcdice/enum"),u.$require("bcdice/translate"),u.$require("bcdice/result"),u.$require("bcdice/command/parser"),u.$require("bcdice/deprecated/checker"),C=K,b=y=[Y(K[0],"BCDice")].concat(C),o=[s=G(y[0],null,"Base")].concat(b),_=e.$r(o),(T=s.$$prototype).raw_input=T.randomizer=T.enabled_upcase_input=T.debug=i,n=[d=e.get_singleton_class(s)].concat(o),w=e.$r(n),d.$attr_reader("prefixes"),f(d,"$register_prefix",function(v){var O,ee;return null==this.prefixes&&(this.prefixes=i),O=c(arguments),this.prefixes=I(P(ee=this.prefixes)?ee:[],O.$flatten())},-1),f(d,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),f(d,"$prefixes_pattern",function(){var v=this,a=i;return null==v.prefixes_pattern&&(v.prefixes_pattern=i),null==v.prefixes&&(v.prefixes=i),v.prefixes_pattern=P(a=v.prefixes_pattern)?a:i,P(v.prefixes_pattern)?v.prefixes_pattern:(v.prefixes=P(a=v.prefixes)?a:[],v.prefixes.$freeze(),v.prefixes_pattern=(P(v.prefixes["$empty?"]())?/(?!)/:H(["^(S)?(",v.prefixes.$join("|"),")"],"i")).$freeze())}),f(d,"$command_pattern",function(){var v=this,a=i,O=i;return null==v.command_pattern&&(v.command_pattern=i),null==v.prefixes&&(v.prefixes=i),v.command_pattern=P(a=v.command_pattern)?a:i,P(v.command_pattern)?v.command_pattern:(v.prefixes=P(a=v.prefixes)?a:[],v.prefixes.$freeze(),O=I(h(k(w("CommonCommand"),"COMMANDS"),"map",[],function(ee){return null==ee&&(ee=i),k(ee,"PREFIX_PATTERN").$source()}),v.prefixes),v.command_pattern=H(["^S?(",O.$join("|"),")"],"i").$freeze())}),f(d,"$eval",function(v){try{return N("eval_return"),this.$new(v).$eval()}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),s.$include(_("Translate")),s.$include(k(_("Deprecated"),"Checker")),f(s,"$initialize",function(m){var n=this;return n.raw_input=m,n.sort_add_dice=!1,n.sort_barabara_dice=!1,n.d66_sort_type=k(_("D66SortType"),"NO_SORT"),n.enabled_d9=!1,n.round_type=k(_("RoundType"),"FLOOR"),n.sides_implicit_d=6,n.upper_dice_reroll_threshold=i,n.reroll_dice_reroll_threshold=i,n.default_cmp_op=i,n.default_target_number=i,n.enabled_upcase_input=!0,n.locale="ja_jp",n.randomizer=k(_("BCDice"),"Randomizer").$new(),n.debug=!1}),s.$attr_accessor("randomizer"),s.$attr_reader("d66_sort_type"),s.$attr_reader("round_type"),s.$attr_reader("sides_implicit_d"),s.$attr_reader("upper_dice_reroll_threshold"),s.$attr_reader("reroll_dice_reroll_threshold"),s.$attr_reader("default_cmp_op"),s.$attr_reader("default_target_number"),f(s,"$sort_add_dice?",M("sort_add_dice")),f(s,"$sort_barabara_dice?",M("sort_barabara_dice")),f(s,"$enabled_d9?",M("enabled_d9")),f(s,"$enable_debug",E("debug",!0)),f(s,"$eval",function(){var n,r,m=this,w=i;return n=k(_("BCDice"),"Preprocessor").$process(m.raw_input,m),w=P(r=m.$dice_command(n))?r:m.$eval_common_command(m.raw_input),P(w)?(w["$rands="](m.randomizer.$rand_results()),w["$detailed_rands="](m.randomizer.$detailed_rand_results()),w):i}),f(s,"$change_text",function(m){return m}),f(s,"$check_result",function(m,n,w,r){var v=this,a=i,O=i,re=i,ee=i,ie=i;return a=v.$check_result_legacy(m,n,w,r),P(a)?a:(O=h(n,"map",[],"sides".$to_proc()),ee=(re=h(n,"map",[],"value".$to_proc())).$sum(),a=V([100],ie=O)?v.$result_1d100(m,ee,w,r):V([20],ie)?v.$result_1d20(m,ee,w,r):V([6,6],ie)?v.$result_2d6(m,ee,re,w,r):i,Q(a,_("Result").$nothing())?i:P(a)?a:(a=V([10],ie=O.$uniq())?v.$result_nd10(m,ee,re,w,r):V([6],ie)?v.$result_nd6(m,ee,re,w,r):i,Q(a,_("Result").$nothing())?i:P(a)?a:v.$result_ndx(m,w,r)))}),f(s,"$grich_text",j(i)),s.$private(),f(s,"$eval_common_command",function(m){try{N("eval_return");var w=N("return");return m=this.$change_text(m),h(k(_("CommonCommand"),"COMMANDS"),"each",[],function v(a){var re,O=null==v.$$s?this:v.$$s;if(null==O.randomizer&&(O.randomizer=i),null==a&&(a=i),re=a.$eval(m,O,O.randomizer),!P(re))return i;w.$throw(re)},{$$s:this,$$ret:w}),i}catch(v){if(v===e.t_eval_return||v===w)return v.$v;throw v}}),f(s,"$dice_command",function(m){var n=this,w=i,r=i,v=i,a=i;return P(n.enabled_upcase_input)&&(m=m.$upcase()),w=n.$class().$prefixes_pattern().$match(m),P(w)?(r=w["$[]"](1)["$nil?"]()["$!"](),P(r)&&(m=m["$[]"](A(1,-1,!1))),v=n.$eval_game_system_specific_command(m),P(v["$is_a?"](_("Result")))?(v["$secret="](P(a=v["$secret?"]())?a:r),v):P(v["$nil?"]())||P(v["$empty?"]())||Q(v,"1")?i:h(_("Result").$new(),"tap",[],function(re){var ee;return null==re&&(re=i),re["$text="](v.$to_s()),h(re,"secret=",ee=[r]),ee[ee.length-1]})):i}),f(s,"$eval_game_system_specific_command",j(i)),f(s,"$result_ndx",function(m,n,w){return P(w["$is_a?"](_("String")))?i:P(m.$send(n,w))?_("Result").$success(this.$translate("success")):_("Result").$failure(this.$translate("failure"))}),f(s,"$result_1d100",j(i)),f(s,"$result_1d20",j(i)),f(s,"$result_nd10",j(i)),f(s,"$result_2d6",j(i)),f(s,"$result_nd6",j(i)),f(s,"$get_table_by_2d6",function(m){return this.$get_table_by_nD6(m,2)}),f(s,"$get_table_by_1d6",function(m){return this.$get_table_by_nD6(m,1)}),f(s,"$get_table_by_nD6",function(m,n){return this.$get_table_by_nDx(m,n,6)}),f(s,"$get_table_by_nDx",function(m,n,w){var v,a=i;return v=this.randomizer.$roll_sum(n,w),a=this.$get_table_value(m["$[]"](z(v,n))),P(a["$nil?"]())?["1",0]:[a,v]}),f(s,"$get_table_by_1d3",function(m){var r,v,n=this,a=i;return n.$debug("get_table_by_1d3"),r=n.randomizer.$roll_sum(1,6),n.$debug("num",r),v=$(z(r,1),2).$to_i(),n.$debug("index",v),a=m["$[]"](v),P(a["$nil?"]())?["1",0]:[a,r]}),f(s,"$get_table_by_d66_swap",function(m){var w;return w=this.randomizer.$roll_d66(k(_("D66SortType"),"ASC")),[this.$get_table_by_number(w,m),w]}),f(s,"$get_table_by_d66",function(m){var w,r,v,O,a=i;return w=this.randomizer.$roll_once(6),r=this.randomizer.$roll_once(6),v=I(B(z(w,1),6),z(r,1)),a=m["$[]"](v),O=""+w+r,P(a["$nil?"]())?["1",O]:[a,O]}),f(s,"$get_table_by_number",function(m,n,w){try{var r=N("return");return null==w&&(w="1"),h(n,"each",[],function a(O){var ee,re=null==a.$$s?this:a.$$s;if(null==O&&(O=i),ee=O["$[]"](0),!P(l(ee,m)))return i;r.$throw(re.$get_table_value(O["$[]"](1)))},{$$s:this,$$ret:r}),this.$get_table_value(w)}catch(a){if(a===r)return a.$v;throw a}},-3),f(s,"$get_table_value",function(m){return P(m["$is_a?"](_("Proc")))?m.$call():m}),f(s,"$roll_tables",function(m,n){var r=i;return r=n["$[]"](m),P(r)?r.$roll(this.randomizer).$to_s():i}),f(s,"$debug",function(m,n){var r,v=this,a=i,O=i;return r=c(arguments,1),P(v.debug)?(a=P(m["$is_a?"](_("String")))?m:m.$inspect(),P(r["$empty?"]())?v.$warn(a):(O=h(r,"map",[],function(ee){return null==ee&&(ee=i),P(ee["$is_a?"](_("String")))?'"'+ee+'"':ee.$inspect()}),v.$warn(a+": "+O.$join(", ")))):i},-2),k(k(t("I18n"),"Backend"),"Simple").$include(k(k(t("I18n"),"Backend"),"Fallbacks")),t("I18n").$load_path()["$<<"](t("Dir")["$[]"](t("File").$join("bcdice","../../i18n/**/*.yml"))),t("I18n")["$default_locale="]("ja_jp"),p=[["ja_jp"]],h(t("I18n").$fallbacks(),"defaults=",p),p[p.length-1]},Opal.modules["bcdice/game_system/sword_world/rating_lexer"]=function(e){var E,A,u,L,C,x,y,t,$,B,Q,Y=e.module,G=e.klass,c=e.const_set,I=e.hash2,P=e.truthy,f=e.def,h=[],N=e.nil;return e.top.$require("strscan"),E=h,A=Q=[Y(h[0],"BCDice")].concat(E),$=[Y(Q[0],"GameSystem")].concat(A),B=e.$r($),u=$,L=t=[G($[0],B("Base"),"SwordWorld")].concat(u),x=[C=G(t[0],null,"RatingLexer")].concat(L),y=e.$r(x),C.$$prototype.scanner=N,c(x[0],"SYMBOLS",I(["+","-","*","/","(",")","[","]","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","[":"BRACKETL","]":"BRACKETR","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),f(C,"$initialize",function(b){var s,o,T;return b=P(T=(s=(o=b)===N||null==o?N:o.$split(" ",2))===N||null==s?N:s.$first())?T:"",this.scanner=y("StringScanner").$new(b)}),f(C,"$next_token",function(){var b=this,s=N,o=N,T=N;return P(b.scanner["$eos?"]())?[!1,"$"]:P(s=b.scanner.$scan(/\d+/))?["NUMBER",s.$to_i()]:(o=b.scanner.$getch().$upcase(),[P(T=y("SYMBOLS")["$[]"](o))?T:o.$to_sym(),o])}),f(C,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/game_system/sword_world/rating_parsed"]=function(e){var V,z,K,C,x,y,S,g,i,B,l,j,Y=e.module,G=e.klass,c=e.def,I=e.truthy,P=e.rb_le,f=e.rb_plus,H=e.rb_lt,h=e.neqeq,N=[],M=e.nil;return V=N,z=j=[Y(N[0],"BCDice")].concat(V),B=[Y(j[0],"GameSystem")].concat(z),l=e.$r(B),K=B,C=i=[G(B[0],l("Base"),"SwordWorld")].concat(K),y=[x=G(i[0],null,"RatingParsed")].concat(C),S=e.$r(y),(g=x.$$prototype).modifier_after_half=g.modifier_after_one_and_a_half=g.semi_fixed_val=g.kept_modify=g.rate=g.greatest_fortune=g.modifier=M,x.$attr_accessor("rate"),x.$attr_accessor("critical"),x.$attr_accessor("kept_modify"),x.$attr_accessor("first_to"),x.$attr_accessor("first_modify"),x.$attr_accessor("rateup"),x.$attr_accessor("greatest_fortune"),x.$attr_accessor("semi_fixed_val"),x.$attr_accessor("tmp_fixed_val"),x.$attr_accessor("modifier"),x.$attr_accessor("modifier_after_half"),x.$attr_accessor("modifier_after_one_and_a_half"),c(x,"$initialize",function(s,o){var _=this;return _.rate=s,_.modifier=o,_.critical=13,_.kept_modify=0,_.first_to=0,_.first_modify=0,_.greatest_fortune=!1,_.rateup=0,_.semi_fixed_val=0,_.tmp_fixed_val=0,_.modifier_after_half=M,_.modifier_after_one_and_a_half=M}),c(x,"$half",function(){return this.modifier_after_half["$nil?"]()["$!"]()}),c(x,"$one_and_a_half",function(){return this.modifier_after_one_and_a_half["$nil?"]()["$!"]()}),c(x,"$min_critical",function(){var s=this;return I(P(s.semi_fixed_val,1))?3:f(f(s.semi_fixed_val,s.kept_modify),2).$clamp(3,13)}),c(x,"$infinite_roll?",function(){return H(this.$critical(),this.$min_critical())}),c(x,"$to_s",function(){var s=this,o=M;return o="KeyNo."+s.rate,I(H(s.$critical(),13))&&(o=f(o,"c["+s.$critical()+"]")),h(s.$first_modify(),0)&&(o=f(o,"m["+S("Format").$modifier(s.$first_modify())+"]")),h(s.$first_to(),0)&&(o=f(o,"m["+s.$first_to()+"]")),h(s.$rateup(),0)&&(o=f(o,"r["+s.$rateup()+"]")),I(s.greatest_fortune)&&(o=f(o,"gf")),h(s.$semi_fixed_val(),0)&&(o=f(o,"sf["+s.$semi_fixed_val()+"]")),h(s.$tmp_fixed_val(),0)&&(o=f(o,"tf["+s.$tmp_fixed_val()+"]")),h(s.$kept_modify(),0)&&(o=f(o,"a["+S("Format").$modifier(s.$kept_modify())+"]")),h(s.modifier,0)&&(o=f(o,S("Format").$modifier(s.modifier))),o})},Opal.modules["bcdice/game_system/sword_world/rating_options"]=function(e){var h,V,B,t,p,j,A,M,Y=e.module,G=e.klass,c=e.truthy,I=e.def,P=[];return h=P,V=M=[Y(P[0],"BCDice")].concat(h),j=[Y(M[0],"GameSystem")].concat(V),A=e.$r(j),B=j,p=[G(j[0],A("Base"),"SwordWorld")].concat(B),(t=G(p[0],null,"RatingOptions")).$attr_accessor("critical"),t.$attr_accessor("kept_modify"),t.$attr_accessor("first_to"),t.$attr_accessor("first_modify"),t.$attr_accessor("rateup"),t.$attr_accessor("greatest_fortune"),t.$attr_accessor("semi_fixed_val"),t.$attr_accessor("tmp_fixed_val"),t.$attr_accessor("modifier"),t.$attr_accessor("modifier_after_half"),t.$attr_accessor("modifier_after_one_and_a_half"),I(t,"$settable_first_roll_adjust_option?",function(){var L;return c(L=this.$first_modify()["$nil?"]())?this.$first_to()["$nil?"]():L}),I(t,"$settable_non_2d_roll_option?",function(){var L,C,k=this;return c(L=c(C=k.$greatest_fortune()["$nil?"]())?k.$semi_fixed_val()["$nil?"]():C)?k.$tmp_fixed_val()["$nil?"]():L})},Opal.modules["bcdice/game_system/sword_world/rating_parser"]=function(e){var p,i,S,T,v,a,O,re,ee,ie,ce,oe,ue,$e,d,w,r,q,b,s,L,C,K,Y=e.module,G=e.klass,c=e.ensure_kwargs,I=e.send2,P=e.find_super,f=e.def,H=e.send,h=e.truthy,N=e.not,M=e.thrower,E=e.hash,V=e.const_set,Q=e.to_ary,j=e.eqeq,A=e.top,z=[],$=e.nil,B=e.$$$;return A.$require("racc/parser.rb"),A.$require("bcdice/arithmetic/node"),A.$require("bcdice/enum"),A.$require("bcdice/game_system/sword_world/rating_lexer"),A.$require("bcdice/game_system/sword_world/rating_parsed"),A.$require("bcdice/game_system/sword_world/rating_options"),p=z,i=K=[Y(z[0],"BCDice")].concat(p),L=[Y(K[0],"GameSystem")].concat(i),C=e.$r(L),S=L,b=[G(L[0],C("Base"),"SwordWorld")].concat(S),s=e.$r(b),T=b,w=[d=G(b[0],B(s("Racc"),"Parser"),"RatingParser")].concat(T),r=e.$r(w),(q=d.$$prototype).lexer=q.round_type=q.version=$,f(d,"$initialize",function X(F){var R,Z,W=this;return X.$$p=null,null==(R=(F=c(F)).$$smap.version)&&(R="v1_0"),null==(Z=F.$$smap.round_type)&&(Z=B(r("RoundType"),"CEIL")),I(W,P(W,"initialize",X,!1,!0),"initialize",[],null),W.version=R,W.round_type=Z},-1),f(d,"$set_debug",function(){return this.yydebug=!0,this}),f(d,"$parse",function(F){try{return this.lexer=r("RatingLexer").$new(F),this.$do_parse()}catch(Z){if(!e.rescue(Z,[r("ParseError"),r("ZeroDivisionError")]))throw Z;try{return $}finally{e.pop_exception()}}}),d.$private(),f(d,"$parsed",function(F,R,Z){try{return M("eval_return"),H(r("RatingParsed").$new(F,R),"tap",[],function J(U){var ne,ae,fe,de,me,ve,he,ye,pe,ge=null==J.$$s?this:J.$$s,be=$;return null==ge.round_type&&(ge.round_type=$),null==U&&(U=$),U["$kept_modify="](h(be=(ne=Z.$kept_modify())===$||null==ne?$:ne.$eval(ge.round_type))?be:0),U["$first_to="](h(be=Z.$first_to())?be:0),U["$first_modify="](h(be=Z.$first_modify())?be:0),U["$rateup="](h(be=(ae=Z.$rateup())===$||null==ae?$:ae.$eval(ge.round_type))?be:0),N(Z.$greatest_fortune()["$nil?"]())&&U["$greatest_fortune="](Z.$greatest_fortune()),U["$semi_fixed_val="](h(be=(fe=Z.$semi_fixed_val())===$||null==fe?$:fe.$clamp(1,6))?be:0),U["$tmp_fixed_val="](h(be=(de=Z.$tmp_fixed_val())===$||null==de?$:de.$clamp(1,6))?be:0),U["$modifier_after_half="]((me=Z.$modifier_after_half())===$||null==me?$:me.$eval(ge.round_type)),U["$modifier_after_one_and_a_half="]((ve=Z.$modifier_after_one_and_a_half())===$||null==ve?$:ve.$eval(ge.round_type)),he=[h((pe=Z.$critical(),ye=pe===$||null==pe?$:pe.$eval(ge.round_type),be=ye===$||null==ye?$:ye.$clamp(0,13)))?be:h(U.$half())||h(U.$one_and_a_half())?13:10],H(U,"critical=",he),he[he.length-1]},{$$s:this})}catch(J){if(J===e.t_eval_return)return J.$v;throw J}}),f(d,"$next_token",function(){return this.lexer.$next_token()}),v=e.large_array_unpack("18,16,17,19,6,20,21,23,24,64,65,27,28,13,66,14,22,15,18,16,17,19,5,20,21,23,24,5,9,3,4,13,10,14,22,15,18,16,17,19,11,20,21,23,24,34,5,34,40,13,42,14,22,15,30,31,30,31,33,34,33,34,62,63,62,63,34,43,30,31,30,31,33,34,33,30,31,44,34,33,34,52,30,31,57,34,33,30,31,30,31,33,34,33,30,31,58,34,33,34,60,30,31,61,34,33,30,31,30,31,33,34,33,30,31,,34,33,34,,30,31,,34,33,30,31,30,31,33,36,33,30,31,62,63,33,62,63,37,38,62,63,62,63,62,63"),a=e.large_array_unpack("7,7,7,7,1,7,7,7,7,55,55,12,12,7,55,7,7,7,25,25,25,25,3,25,25,25,25,0,4,0,0,25,5,25,25,25,49,49,49,49,6,49,49,49,49,13,9,14,17,49,19,49,49,49,13,13,14,14,13,16,14,18,46,46,48,48,22,20,16,16,18,18,16,23,18,22,22,21,24,22,27,29,23,23,37,28,23,24,24,27,27,24,30,27,28,28,38,31,28,33,43,30,30,44,40,30,31,31,33,33,31,62,33,40,40,,63,40,64,,62,62,,65,62,63,63,64,64,63,15,64,65,65,50,50,65,51,51,15,15,56,56,69,69,70,70"),O=e.large_array_unpack("24,4,,19,23,30,40,-4,,43,,,0,43,45,128,57,43,59,42,59,69,64,71,76,14,,78,83,63,90,95,,97,,,,82,94,,102,,,98,101,,49,,51,32,121,124,,,,-2,128,,,,,,109,114,116,121,,,,130,132"),re=e.large_array_unpack("-36,-36,-5,-36,-36,-36,-36,-1,-5,-36,-4,71,-6,-36,-36,-36,-12,-36,-36,-36,-36,-36,-36,-36,-36,-2,-5,-36,-36,-36,-36,-36,-33,-36,-35,-8,-9,-36,-36,-13,-14,-16,-17,-36,-36,-20,-21,-30,-22,-3,-23,-24,-7,-31,-32,-36,-27,-10,-11,-15,-18,-19,-36,-36,-36,-36,-34,-28,-29,-25,-26"),ee=e.large_array_unpack("29,35,7,39,1,41,46,48,25,45,50,51,2,55,,8,56,53,54,,,26,,,,,49,59,,,,,,,,,,,,,,,,,,,,69,70,67,68"),ie=e.large_array_unpack("5,5,3,5,1,5,6,6,3,5,6,6,2,7,,2,6,5,5,,,2,,,,,3,5,,,,,,,,,,,,,,,,,,,,6,6,5,5"),ce=[$,4,12,0,$,-13,-17,-20,$],oe=[$,$,$,$,12,47,$,$,32],ue=e.large_array_unpack("0,0,racc_error,2,23,_reduce_1,3,23,_reduce_2,4,23,_reduce_3,2,24,_reduce_4,0,25,_reduce_5,2,25,_reduce_6,4,25,_reduce_7,3,25,_reduce_8,3,25,_reduce_9,4,25,_reduce_10,4,25,_reduce_11,2,25,_reduce_12,3,25,_reduce_13,3,25,_reduce_14,4,25,_reduce_15,3,25,_reduce_16,3,25,_reduce_17,4,25,_reduce_18,4,25,_reduce_19,3,25,_reduce_20,2,26,_reduce_21,2,26,_reduce_22,3,26,_reduce_23,3,26,_reduce_24,3,29,_reduce_25,3,29,_reduce_26,1,29,_reduce_none,3,28,_reduce_28,3,28,_reduce_29,1,28,_reduce_none,2,27,_reduce_31,2,27,_reduce_32,1,27,_reduce_none,3,30,_reduce_34,1,30,_reduce_35"),$e=E(!1,0,"error",1,"NUMBER",2,"K",3,"R",4,"H",5,"O",6,"G",7,"F",8,"S",9,"T",10,"PLUS",11,"MINUS",12,"ASTERISK",13,"SLASH",14,"PARENL",15,"PARENR",16,"BRACKETL",17,"BRACKETR",18,"AT",19,"SHARP",20,"DOLLAR",21),V(w[0],"Racc_arg",[v,a,re,O,ee,ie,oe,ce,22,ue,$e,71,36,!0]),h(r("Ractor","skip_raise")?"constant":$)&&r("Ractor").$make_shareable(r("Racc_arg")),V(w[0],"Racc_token_to_s_table",["$end","error","NUMBER","K","R","H","O","G","F","S","T","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","BRACKETL","BRACKETR","AT","SHARP","DOLLAR","$start","expr","rate","option","modifier","unary","mul","add","term"]),h(r("Ractor","skip_raise")?"constant":$)&&r("Ractor").$make_shareable(r("Racc_token_to_s_table")),V(w[0],"Racc_debug_parser",!1),f(d,"$_reduce_1",function(F,R,Z){try{M("eval_return");var W,ne,de,ae=$,fe=$;return ne=null==(W=Q(F))[0]?$:W[0],fe=h(de=(ae=null==W[1]?$:W[1]).$modifier())?de:B(B(r("Arithmetic"),"Node"),"Number").$new(0),this.$parsed(ne,fe.$eval(this.round_type),ae)}catch(me){if(me===e.t_eval_return)return me.$v;throw me}}),f(d,"$_reduce_2",function(F,R,Z){try{M("eval_return");var W,ae,de,U=this,fe=$,me=$;return ae=null==(W=Q(F))[1]?$:W[1],h((fe=null==W[2]?$:W[2]).$modifier_after_one_and_a_half())&&U.$raise(r("ParseError")),h(fe.$modifier_after_half())||fe["$modifier_after_half="](B(B(r("Arithmetic"),"Node"),"Number").$new(0)),me=h(de=fe.$modifier())?de:B(B(r("Arithmetic"),"Node"),"Number").$new(0),U.$parsed(ae,me.$eval(U.round_type),fe)}catch(ve){if(ve===e.t_eval_return)return ve.$v;throw ve}}),f(d,"$_reduce_3",function(F,R,Z){try{M("eval_return");var W,ae,de,U=this,fe=$,me=$;return ae=null==(W=Q(F))[2]?$:W[2],h((fe=null==W[3]?$:W[3]).$modifier_after_half())&&U.$raise(r("ParseError")),h(fe.$modifier_after_one_and_a_half())||fe["$modifier_after_one_and_a_half="](B(B(r("Arithmetic"),"Node"),"Number").$new(0)),me=h(de=fe.$modifier())?de:B(B(r("Arithmetic"),"Node"),"Number").$new(0),U.$parsed(ae,me.$eval(U.round_type),fe)}catch(ve){if(ve===e.t_eval_return)return ve.$v;throw ve}}),f(d,"$_reduce_4",function(F,R,Z){return F["$[]"](1).$to_i()}),f(d,"$_reduce_5",function(F,R,Z){return r("RatingOptions").$new()}),f(d,"$_reduce_6",function(F,R,Z){var D,ne,U=$;return ne=null==(D=Q(F))[1]?$:D[1],h((U=null==D[0]?$:D[0]).$modifier()["$nil?"]())||this.$raise(r("ParseError")),U["$modifier="](ne),U}),f(d,"$_reduce_7",function(F,R,Z){var D,ae,U=$;return ae=null==(D=Q(F))[2]?$:D[2],h((U=null==D[0]?$:D[0]).$critical()["$nil?"]())||this.$raise(r("ParseError")),U["$critical="](ae),U}),f(d,"$_reduce_8",function(F,R,Z){var D,ae,U=$;return ae=null==(D=Q(F))[2]?$:D[2],h((U=null==D[0]?$:D[0]).$critical()["$nil?"]())||this.$raise(r("ParseError")),U["$critical="](ae),U}),f(d,"$_reduce_9",function(F,R,Z){var D,U=$,ae=$;return ae=null==(D=Q(F))[2]?$:D[2],h((U=null==D[0]?$:D[0])["$settable_first_roll_adjust_option?"]())||this.$raise(r("ParseError")),U["$first_to="](ae.$to_i()),U}),f(d,"$_reduce_10",function(F,R,Z){var D,U=$,ae=$;return ae=null==(D=Q(F))[3]?$:D[3],h((U=null==D[0]?$:D[0])["$settable_first_roll_adjust_option?"]())||this.$raise(r("ParseError")),U["$first_modify="](ae.$to_i()),U}),f(d,"$_reduce_11",function(F,R,Z){var D,U=$,ae=$;return ae=null==(D=Q(F))[3]?$:D[3],h((U=null==D[0]?$:D[0])["$settable_first_roll_adjust_option?"]())||this.$raise(r("ParseError")),U["$first_modify="](ae.$to_i()["$-@"]()),U}),f(d,"$_reduce_12",function(F,R,Z){var D,U=$;return D=Q(F),h((U=null==D[0]?$:D[0]).$modifier_after_half()["$nil?"]())||this.$raise(r("ParseError")),U["$modifier_after_half="](B(B(r("Arithmetic"),"Node"),"Number").$new(0)),U}),f(d,"$_reduce_13",function(F,R,Z){var D,ae,U=$;return ae=null==(D=Q(F))[2]?$:D[2],h((U=null==D[0]?$:D[0]).$modifier_after_half()["$nil?"]())||this.$raise(r("ParseError")),U["$modifier_after_half="](ae),U}),f(d,"$_reduce_14",function(F,R,Z){var D,U=$;return D=Q(F),h((U=null==D[0]?$:D[0]).$modifier_after_one_and_a_half())&&this.$raise(r("ParseError")),U["$modifier_after_one_and_a_half="](B(B(r("Arithmetic"),"Node"),"Number").$new(0)),U}),f(d,"$_reduce_15",function(F,R,Z){var D,ae,U=$;return ae=null==(D=Q(F))[3]?$:D[3],h((U=null==D[0]?$:D[0]).$modifier_after_one_and_a_half())&&this.$raise(r("ParseError")),U["$modifier_after_one_and_a_half="](ae),U}),f(d,"$_reduce_16",function(F,R,Z){var D,ae,U=$;return U=null==(D=Q(F))[0]?$:D[0],ae=null==D[2]?$:D[2],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U.$rateup()["$nil?"]())||this.$raise(r("ParseError")),U["$rateup="](ae),U}),f(d,"$_reduce_17",function(F,R,Z){var D,U=$;return U=null==(D=Q(F))[0]?$:D[0],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U["$settable_non_2d_roll_option?"]())||this.$raise(r("ParseError")),U["$greatest_fortune="](!0),U}),f(d,"$_reduce_18",function(F,R,Z){var D,U=$,ae=$;return U=null==(D=Q(F))[0]?$:D[0],ae=null==D[3]?$:D[3],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U["$settable_non_2d_roll_option?"]())||this.$raise(r("ParseError")),U["$semi_fixed_val="](ae.$to_i()),U}),f(d,"$_reduce_19",function(F,R,Z){var D,U=$,ae=$;return U=null==(D=Q(F))[0]?$:D[0],ae=null==D[3]?$:D[3],h(["v2_5","v2_0"]["$include?"](this.version))&&h(U["$settable_non_2d_roll_option?"]())||this.$raise(r("ParseError")),U["$tmp_fixed_val="](ae.$to_i()),U}),f(d,"$_reduce_20",function(F,R,Z){var D,ae,U=$;return U=null==(D=Q(F))[0]?$:D[0],ae=null==D[2]?$:D[2],j(this.version,"v2_5")&&h(U.$kept_modify()["$nil?"]())||this.$raise(r("ParseError")),U["$kept_modify="](ae),U}),f(d,"$_reduce_21",function(F,R,Z){return F["$[]"](1)}),f(d,"$_reduce_22",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"Negative").$new(F["$[]"](1))}),f(d,"$_reduce_23",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"+",F["$[]"](2))}),f(d,"$_reduce_24",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"-",F["$[]"](2))}),f(d,"$_reduce_25",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"+",F["$[]"](2))}),f(d,"$_reduce_26",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"-",F["$[]"](2))}),f(d,"$_reduce_28",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"BinaryOp").$new(F["$[]"](0),"*",F["$[]"](2))}),f(d,"$_reduce_29",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"DivideWithGameSystemDefault").$new(F["$[]"](0),F["$[]"](2))}),f(d,"$_reduce_31",function(F,R,Z){return F["$[]"](1)}),f(d,"$_reduce_32",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"Negative").$new(F["$[]"](1))}),f(d,"$_reduce_34",function(F,R,Z){return F["$[]"](1)}),f(d,"$_reduce_35",function(F,R,Z){return B(B(r("Arithmetic"),"Node"),"Number").$new(F["$[]"](0))}),f(d,"$_reduce_none",function(F,R,Z){return F["$[]"](0)})},Opal.modules["bcdice/game_system/SwordWorld"]=function(e){var L,S,T,d,m,n,w,b,s,x,Y=e.module,G=e.klass,c=e.const_set,I=e.send2,P=e.find_super,f=e.def,H=e.truthy,h=e.rb_ge,N=e.rb_le,M=e.eqeq,E=e.neqeq,V=e.rb_minus,Q=e.rb_gt,j=e.hash2,A=e.send,z=e.to_ary,$=e.rb_plus,B=e.rb_lt,l=e.rb_times,p=e.thrower,u=e.rb_divide,K=e.top,t=[],i=e.nil;return K.$require("bcdice/base"),K.$require("bcdice/game_system/sword_world/rating_parser"),L=t,S=x=[Y(t[0],"BCDice")].concat(L),b=[Y(x[0],"GameSystem")].concat(S),s=e.$r(b),T=b,m=[d=G(b[0],s("Base"),"SwordWorld")].concat(T),n=e.$r(m),(w=d.$$prototype).rating_table=w.randomizer=i,c(m[0],"ID","SwordWorld"),c(m[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c9RPG"),c(m[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u3068"),c(m[0],"HELP_MESSAGE","\u30fbSW\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx[c]+m$f) (x:\u30ad\u30fc, c:\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024, m:\u30dc\u30fc\u30ca\u30b9, f:\u51fa\u76ee\u4fee\u6b63)\n"),d.$register_prefix("H?K"),f(d,"$initialize",function r(v){var O=this;return r.$$p=null,I(O,P(O,"initialize",r,!1,!0),"initialize",[v],null),O.rating_table=0}),f(d,"$result_2d6",function(v,a,O,re,ee){return H(h(a,12))?n("Result").$critical(this.$translate("SwordWorld.critical")):H(N(a,2))?n("Result").$fumble(this.$translate("SwordWorld.fumble")):E(re,">=")||M(ee,"?")?i:H(h(v,ee))?n("Result").$success(this.$translate("success")):n("Result").$failure(this.$translate("failure"))}),f(d,"$eval_game_system_specific_command",function(v){return this.$rating(v)}),d.$private(),f(d,"$rating_parser",function(){return n("RatingParser").$new()}),f(d,"$rating",function(v){var a,O,re=this,ee=i,ie=i,ce=i,oe=i,ue=i,_e=i,le=i,$e=i,se=i,te=i,q=i,X=i,F=i,R=i,D=i,W=i;return re.$debug("rating string",v),ee=re.$rating_parser().$parse(v),H(ee)?(ie=re.$getSW2_0_RatingTable(),ce=V(ie.$length(),1),re.$debug("keyMax",ce),H(Q(ee.$rate(),ce))?n("Result").$new(re.$translate("SwordWorld.keynumber_exceeds",j(["keyMax"],{keyMax:ce}))):H(ee["$infinite_roll?"]())?n("Result").$new(re.$translate("SwordWorld.infinite_critical",j(["min_critical"],{min_critical:ee.$min_critical()}))):(oe=re.$getNewRates(ie),ue=ee+" \uff1e ",_e=[],le=[],$e=[],se=0,te=0,q=0,X=0,F=ee.$first_to(),R=ee.$first_modify(),function(){try{var J=p("break");return A(re,"loop",[],function U(){var ne,ae,ve,he,fe=null==U.$$s?this:U.$$s,de=i,me=i;if(ae=fe.$rollDice(ee,X),me=null==(ne=z(ae))[1]?i:ne[1],se=de=null==ne[0]?i:ne[0],E(F,0)?(se=de=F,F=0):E(R,0)&&(se=$(se,R),R=0),H(N(de,2))&&(_e["$<<"](de.$to_s()),le["$<<"](me.$to_s()),$e["$<<"]("**"),X=$(X,1),J.$throw()),E(ee.$kept_modify(),0)&&E(se,2)&&(se=$(se,ee.$kept_modify())),H(B(se,2))&&(se=2),H(Q(se,12))&&(se=12),ve=[$(ee.$rate(),l(X,ee.$rateup())),ce].$min(),fe.$debug("currentKey",ve),he=oe["$[]"](se)["$[]"](ve),fe.$debug("rateValue",he),q=$(q,he),te=$(te,se),_e["$<<"](se.$to_s()),le["$<<"](me.$to_s()),$e["$<<"](H(Q(se,2))?he:"**"),X=$(X,1),H(h(se,ee.$critical())))return i;J.$throw()},{$$s:re})}catch(U){if(U===J)return U.$v;throw U}}(),O=re.$getResultText(q,ee,le,_e,$e,te,X),a=z(O),D=null==a[1]?i:a[1],W=null==a[2]?i:a[2],ue=$(ue,null==a[0]?i:a[0]),A(n("Result").$new(),"tap",[],function(U){var ne;return null==U&&(U=i),U["$text="](ue),U["$critical="](D),A(U,"fumble=",ne=[W]),ne[ne.length-1]}))):(re.$debug("not matched"),"1")}),f(d,"$getSW2_0_RatingTable",function(){return["*,0,0,0,1,2,2,3,3,4,4","*,0,0,0,1,2,3,3,3,4,4","*,0,0,0,1,2,3,4,4,4,4","*,0,0,1,1,2,3,4,4,4,5","*,0,0,1,2,2,3,4,4,5,5","*,0,1,1,2,2,3,4,5,5,5","*,0,1,1,2,3,3,4,5,5,5","*,0,1,1,2,3,4,4,5,5,6","*,0,1,2,2,3,4,4,5,6,6","*,0,1,2,3,3,4,4,5,6,7","*,1,1,2,3,3,4,5,5,6,7","*,1,2,2,3,3,4,5,6,6,7","*,1,2,2,3,4,4,5,6,6,7","*,1,2,3,3,4,4,5,6,7,7","*,1,2,3,4,4,4,5,6,7,8","*,1,2,3,4,4,5,5,6,7,8","*,1,2,3,4,4,5,6,7,7,8","*,1,2,3,4,5,5,6,7,7,8","*,1,2,3,4,5,6,6,7,7,8","*,1,2,3,4,5,6,7,7,8,9","*,1,2,3,4,5,6,7,8,9,10","*,1,2,3,4,6,6,7,8,9,10","*,1,2,3,5,6,6,7,8,9,10","*,2,2,3,5,6,7,7,8,9,10","*,2,3,4,5,6,7,7,8,9,10","*,2,3,4,5,6,7,8,8,9,10","*,2,3,4,5,6,8,8,9,9,10","*,2,3,4,6,6,8,8,9,9,10","*,2,3,4,6,6,8,9,9,10,10","*,2,3,4,6,7,8,9,9,10,10","*,2,4,4,6,7,8,9,10,10,10","*,2,4,5,6,7,8,9,10,10,11","*,3,4,5,6,7,8,10,10,10,11","*,3,4,5,6,8,8,10,10,10,11","*,3,4,5,6,8,9,10,10,11,11","*,3,4,5,7,8,9,10,10,11,12","*,3,5,5,7,8,9,10,11,11,12","*,3,5,6,7,8,9,10,11,12,12","*,3,5,6,7,8,10,10,11,12,13","*,4,5,6,7,8,10,11,11,12,13","*,4,5,6,7,9,10,11,11,12,13","*,4,6,6,7,9,10,11,12,12,13","*,4,6,7,7,9,10,11,12,13,13","*,4,6,7,8,9,10,11,12,13,14","*,4,6,7,8,10,10,11,12,13,14","*,4,6,7,9,10,10,11,12,13,14","*,4,6,7,9,10,10,12,13,13,14","*,4,6,7,9,10,11,12,13,13,15","*,4,6,7,9,10,12,12,13,13,15","*,4,6,7,10,10,12,12,13,14,15","*,4,6,8,10,10,12,12,13,15,15","*,5,7,8,10,10,12,12,13,15,15","*,5,7,8,10,11,12,12,13,15,15","*,5,7,9,10,11,12,12,14,15,15","*,5,7,9,10,11,12,13,14,15,16","*,5,7,10,10,11,12,13,14,16,16","*,5,8,10,10,11,12,13,15,16,16","*,5,8,10,11,11,12,13,15,16,17","*,5,8,10,11,12,12,13,15,16,17","*,5,9,10,11,12,12,14,15,16,17","*,5,9,10,11,12,13,14,15,16,18","*,5,9,10,11,12,13,14,16,17,18","*,5,9,10,11,13,13,14,16,17,18","*,5,9,10,11,13,13,15,17,17,18","*,5,9,10,11,13,14,15,17,17,18","*,5,9,10,12,13,14,15,17,18,18","*,5,9,10,12,13,15,15,17,18,19","*,5,9,10,12,13,15,16,17,19,19","*,5,9,10,12,14,15,16,17,19,19","*,5,9,10,12,14,16,16,17,19,19","*,5,9,10,12,14,16,17,18,19,19","*,5,9,10,13,14,16,17,18,19,20","*,5,9,10,13,15,16,17,18,19,20","*,5,9,10,13,15,16,17,19,20,21","*,6,9,10,13,15,16,18,19,20,21","*,6,9,10,13,16,16,18,19,20,21","*,6,9,10,13,16,17,18,19,20,21","*,6,9,10,13,16,17,18,20,21,22","*,6,9,10,13,16,17,19,20,22,23","*,6,9,10,13,16,18,19,20,22,23","*,6,9,10,13,16,18,20,21,22,23","*,6,9,10,13,17,18,20,21,22,23","*,6,9,10,14,17,18,20,21,22,24","*,6,9,11,14,17,18,20,21,23,24","*,6,9,11,14,17,19,20,21,23,24","*,6,9,11,14,17,19,21,22,23,24","*,7,10,11,14,17,19,21,22,23,25","*,7,10,12,14,17,19,21,22,24,25","*,7,10,12,14,18,19,21,22,24,25","*,7,10,12,15,18,19,21,22,24,26","*,7,10,12,15,18,19,21,23,25,26","*,7,11,13,15,18,19,21,23,25,26","*,7,11,13,15,18,20,21,23,25,27","*,8,11,13,15,18,20,22,23,25,27","*,8,11,13,16,18,20,22,23,25,28","*,8,11,14,16,18,20,22,23,26,28","*,8,11,14,16,19,20,22,23,26,28","*,8,12,14,16,19,20,22,24,26,28","*,8,12,15,16,19,20,22,24,27,28","*,8,12,15,17,19,20,22,24,27,29","*,8,12,15,18,19,20,22,24,27,30"]}),f(d,"$getNewRates",function(v){var a,O,ee=i,ie=i,ce=i,oe=i,ue=i,_e=i,le=i,$e=i,se=i,te=i,q=i;return ee=[],ie=[],ce=[],oe=[],ue=[],_e=[],le=[],$e=[],se=[],te=[],q=[],A(v,"each",[],function(R){var Z=i;return null==R&&(R=i),Z=R.$split(/,/),q.$push(0),ee.$push(Z["$[]"](1).$to_i()),ie.$push(Z["$[]"](2).$to_i()),ce.$push(Z["$[]"](3).$to_i()),oe.$push(Z["$[]"](4).$to_i()),ue.$push(Z["$[]"](5).$to_i()),_e.$push(Z["$[]"](6).$to_i()),le.$push(Z["$[]"](7).$to_i()),$e.$push(Z["$[]"](8).$to_i()),se.$push(Z["$[]"](9).$to_i()),te.$push(Z["$[]"](10).$to_i())}),M(this.rating_table,1)&&te["$[]="](31,(a=[32,(O=[33,10],A(te,"[]=",O),O[O.length-1])],A(te,"[]=",a),a[a.length-1])),[q,q,q,ee,ie,ce,oe,ue,_e,le,$e,se,te]}),f(d,"$rollDice",function(v,a){var re=i;return[(re=this.randomizer.$roll_barabara(2,6)).$sum(),re.$join(",")]}),f(d,"$getResultText",function(v,a,O,re,ee,ie,ce){var ue=i,_e=i,le=i,$e=i,se=i;return(ue=[]).$push("2D:["+O.$join(" ")+"]="+re.$join(",")),H(N(ie,2))?(ue.$push(ee.$join(",")),ue.$push(this.$translate("SwordWorld.fumble")),[ue.$join(" \uff1e "),!1,!0]):(H(Q(ee.$size(),1))||E(a.$modifier(),0)?(_e=$(ee.$join(","),n("Format").$modifier(a.$modifier())),H(a.$half())?(_e="("+_e+")/2",E(a.$modifier_after_half(),0)&&(_e=$(_e,n("Format").$modifier(a.$modifier_after_half())))):H(a.$one_and_a_half())&&(_e="("+_e+")*1.5",E(a.$modifier_after_one_and_a_half(),0)&&(_e=$(_e,n("Format").$modifier(a.$modifier_after_one_and_a_half())))),ue.$push(_e)):H(a.$half())?(_e=ee.$first()+"/2",E(a.$modifier_after_half(),0)&&(_e=$(_e,n("Format").$modifier(a.$modifier_after_half()))),ue.$push(_e)):H(a.$one_and_a_half())&&(_e=ee.$first()+"*1.5",E(a.$modifier_after_one_and_a_half(),0)&&(_e=$(_e,n("Format").$modifier(a.$modifier_after_one_and_a_half()))),ue.$push(_e)),H(Q(ce,1))&&(le=this.$translate("SwordWorld.round_text",j(["reroll_count"],{reroll_count:V(ce,1)})),ue.$push(le)),$e=$(v,a.$modifier()),H(a.$half())?($e=u($e,2).$ceil(),E(a.$modifier_after_half(),0)&&($e=$($e,a.$modifier_after_half()))):H(a.$one_and_a_half())&&($e=l($e,1.5).$ceil(),E(a.$modifier_after_one_and_a_half(),0)&&($e=$($e,a.$modifier_after_one_and_a_half()))),se=$e.$to_s(),ue.$push(se),[ue.$join(" \uff1e "),Q(ce,1),!1])})},Opal.modules["bcdice/game_system/sword_world/transcendent_test"]=function(e){var j,B,i,y,S,g,b,s,L,p,u,z,Y=e.module,G=e.klass,c=e.def,I=e.truthy,P=e.rb_lt,f=e.hash2,H=e.rb_ge,h=e.rb_plus,N=e.send,M=e.top,E=[],V=e.nil;return M.$require("bcdice/result"),M.$require("bcdice/translate"),j=E,B=z=[Y(E[0],"BCDice")].concat(j),p=[Y(z[0],"GameSystem")].concat(B),u=e.$r(p),i=p,y=L=[G(p[0],u("SwordWorld"),"SwordWorld2_0")].concat(i),g=[S=G(L[0],null,"TranscendentTest")].concat(y),b=e.$r(g),(s=S.$$prototype).modifier=s.critical_value=s.expression=s.modifier_str=s.target=s.cmp_op=V,S.$include(b("Translate")),c(S,"$initialize",function(_,T,d,m,n){var w=this;return w.critical_value=_,w.modifier=T,w.cmp_op=d,w.target=m,w.locale=n,w.modifier_str=b("Format").$modifier(w.modifier),w.expression=w.$node_expression()}),c(S,"$execute",function(_){var n,w,r,T=this,d=V,m=V,v=V,a=V,O=V,re=V;if(I(P(T.critical_value,3)))return T.$translate("SwordWorld2_0.transcendent_critical_too_small",f(["expression"],{expression:T.expression}));if(m=[d=_.$roll_barabara(2,6)],n=d["$=="]([1,1]),w=d["$=="]([6,6]),!I(n))for(;I(H(T.$sum_of_dice(m.$last()),T.critical_value));)m.$push(_.$roll_barabara(2,6));return r=T.$sum_of_dice(m),v=h(r,T.modifier),a=T.$result_status(v,m.$length(),n,w),O=f(["success","failure","super_success","critical","fumble"],{success:T.$translate("success"),failure:T.$translate("failure"),super_success:T.$translate("SwordWorld2_0.super_success"),critical:T.$translate("SwordWorld.critical"),fumble:T.$translate("SwordWorld.fumble")}).$freeze()["$[]"](a),re=["("+T.expression+")",""+T.$dice_str(m,r)+T.modifier_str,v,O].$compact(),N(b("Result").$new(),"tap",[],function(ie){var ce;return null==ie&&(ie=V),ie["$text="](re.$join(" \uff1e ")),ie["$fumble="](a["$=="]("fumble")),ie["$critical="](a["$=="]("critical")),ie["$success="](["success","super_success","critical"]["$include?"](a)),ce=[["failure","fumble"]["$include?"](a)],N(ie,"failure=",ce),ce[ce.length-1]})}),S.$private(),c(S,"$node_expression",function(){var T,_=this;return T="2D6@"+_.critical_value+_.modifier_str,I(_.target)?""+T+_.cmp_op+_.target:T}),c(S,"$sum_of_dice",function(_){return _.$flatten().$sum()}),c(S,"$dice_str",function(_,T){return""+T+N(_,"map",[],function(n){return null==n&&(n=V),"["+n.$join(",")+"]"}).$join()}),c(S,"$result_status",function(_,T,d,m){var n=this;return I(n.target)?I(d)?"fumble":I(m)?"critical":I(_.$send(n.cmp_op,n.target))?I(H(T,2))&&I(H(_,41))?"super_success":"success":"failure":"no_target"})},Opal.modules["bcdice/game_system/SwordWorld2_0"]=function(e){var u,k,g,b,s,o,_,C,x,t,Y=e.module,G=e.klass,c=e.const_set,I=e.send2,P=e.find_super,f=e.def,H=e.eqeqeq,h=e.truthy,N=e.hash2,M=e.rb_gt,E=e.rb_plus,V=e.eqeq,Q=e.rb_times,j=e.send,A=e.neqeq,z=e.top,$=[],B=e.nil,l=e.$$$;return z.$require("bcdice/arithmetic_evaluator"),z.$require("bcdice/game_system/SwordWorld"),z.$require("bcdice/game_system/sword_world/transcendent_test"),u=$,k=t=[Y($[0],"BCDice")].concat(u),C=[Y(t[0],"GameSystem")].concat(k),x=e.$r(C),g=C,s=[b=G(C[0],x("SwordWorld"),"SwordWorld2_0")].concat(g),o=e.$r(s),(_=b.$$prototype).locale=_.randomizer=B,c(s[0],"ID","SwordWorld2.0"),c(s[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.0"),c(s[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.0"),c(s[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r10\n\u3000\u4f8b\uff09K20r10\u3000K30+24@8R10\u3000K40+24@8$12r10\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r10gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5SF4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5TF4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),b.$register_prefix("H?K","Gr","2D6?@\\d+","FT","TT"),f(b,"$initialize",function T(d){var n=this;return T.$$p=null,I(n,P(n,"initialize",T,!1,!0),"initialize",[d],null),n.rating_table=2}),f(b,"$eval_game_system_specific_command",function T(d){var w,n=this,v=B;return T.$$p=null,H(/^Gr(\d+)?/i,w=d)?h(d["$=~"](/^Gr(\d+)/i))?n.$growth(o("Regexp").$last_match(1).$to_i()):n.$growth():H(/^2D6?@\d+/i,w)?(v=l(o("Command"),"Parser").$new(/2D6?/i,N(["round_type"],{round_type:l(l(o("BCDice"),"RoundType"),"CEIL")})).$enable_critical().$restrict_cmp_op_to(B,">=",">").$parse(d),h(v)?o("TranscendentTest").$new(v.$critical(),v.$modify_number(),v.$cmp_op(),v.$target_number(),n.locale).$execute(n.randomizer):B):H("FT",w)?n.$get_fumble_table():H("TT",w)?n.$get_tangle_table():I(n,P(n,"eval_game_system_specific_command",T,!1,!0),"eval_game_system_specific_command",[d],null)}),f(b,"$rating_parser",function(){return o("RatingParser").$new(N(["version"],{version:"v2_0"}))}),f(b,"$rollDice",function T(d,m){var w=this,r=B;return T.$$p=null,h(M(d.$semi_fixed_val(),0))?(r=w.randomizer.$roll_once(6),[E(r,d.$semi_fixed_val()),r+","+d.$semi_fixed_val()]):V(m,0)&&h(M(d.$tmp_fixed_val(),0))?(r=w.randomizer.$roll_once(6),[E(r,d.$tmp_fixed_val()),r+","+d.$tmp_fixed_val()]):h(d.$greatest_fortune())?(r=w.randomizer.$roll_once(6),[Q(r,2),r+","+r]):I(w,P(w,"rollDice",T,!1,!0),"rollDice",[d,m],null)}),f(b,"$growth",function(d){return null==d&&(d=1),j(e.Range.$new(1,d,!1),"map",[],function n(){return(null==n.$$s?this:n.$$s).$growth_step()},{$$s:this}).$join(" | ")},-1),f(b,"$growth_step",function(){var d=this,m=B,n=B,w=B;return n=(m=l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.GrowthTable",d.locale)).$roll(d.randomizer),w=m.$roll(d.randomizer),A(n.$value(),w.$value())?"["+n.$value()+","+w.$value()+"]->("+n.$body()+" or "+w.$body()+")":"["+n.$value()+","+w.$value()+"]->("+n.$body()+")"}),f(b,"$get_fumble_table",function(){return l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.FumbleTable",this.locale).$roll(this.randomizer)}),f(b,"$get_tangle_table",function(){return l(o("DiceTable"),"Table").$from_i18n("SwordWorld2_0.TangleTable",this.locale).$roll(this.randomizer)})},Opal.queue(function(e){var B,K,x,y,S,g,b,i,k,p,Y=e.module,G=e.klass,c=e.const_set,I=e.eqeqeq,P=e.send,f=e.hash2,H=e.truthy,h=e.send2,N=e.find_super,M=e.def,E=e.range,V=e.rb_plus,j=[],A=e.nil,z=e.$$$;return e.top.$require("bcdice/game_system/SwordWorld2_0"),B=j,K=p=[Y(j[0],"BCDice")].concat(B),i=[Y(p[0],"GameSystem")].concat(K),k=e.$r(i),x=i,S=[y=G(i[0],k("SwordWorld2_0"),"SwordWorld2_5")].concat(x),g=e.$r(S),(b=y.$$prototype).randomizer=b.locale=A,c(S[0],"ID","SwordWorld2.5"),c(S[0],"NAME","\u30bd\u30fc\u30c9\u30fb\u30ef\u30fc\u30eb\u30c92.5"),c(S[0],"SORT_KEY","\u305d\u304a\u3068\u308f\u3042\u308b\u30682.5"),c(S[0],"HELP_MESSAGE",'\u81ea\u52d5\u7684\u6210\u529f\u3001\u6210\u529f\u3001\u5931\u6557\u3001\u81ea\u52d5\u7684\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3000(Kx)\n\u3000"K\u30ad\u30fc\u30ca\u30f3\u30d0\u30fc+\u30dc\u30fc\u30ca\u30b9"\u306e\u5f62\u3067\u8a18\u5165\u3057\u307e\u3059\u3002\n\u3000\u30dc\u30fc\u30ca\u30b9\u306e\u90e8\u5206\u306b\u300cK20+K30\u300d\u306e\u3088\u3046\u306b\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u53d6\u308b\u3053\u3068\u306f\u51fa\u6765\u307e\u305b\u3093\u3002\n\u3000\u307e\u305f\u3001\u30dc\u30fc\u30ca\u30b9\u306f\u8907\u6570\u53d6\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3082\u30c0\u30a4\u30b9\u30ed\u30fc\u30eb\u3068\u540c\u69d8\u306b\u3001\u4ed6\u306e\u30d7\u30ec\u30a4\u30e4\u30fc\u306b\u96a0\u308c\u3066\u30ed\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20\u3000\u3000\u3000K10+5\u3000\u3000\u3000k30\u3000\u3000\u3000k10+10\u3000\u3000\u3000Sk10-1\u3000\u3000\u3000k10+5+2\n\n\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u8a2d\u5b9a\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306f"[\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024]"\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502410\u3068\u3057\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u51e6\u7406\u304c\u5fc5\u8981\u306a\u3044\u3068\u304d\u306f13\u306a\u3069\u3068\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u9632\u5fa1\u6642\u306a\u3069\u306e\u5bfe\u5fdc)\n\u3000\u307e\u305f\u30bf\u30a4\u30d7\u306e\u8efd\u6e1b\u5316\u306e\u305f\u3081\u306b\u672b\u5c3e\u306b\u300c@\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u300d\u3067\u3082\u51e6\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u3000\u4f8b\uff09K20[10]\u3000\u3000\u3000K10+5[9]\u3000\u3000\u3000k30[10]\u3000\u3000\u3000k10[9]+10\u3000\u3000\u3000k10-5@9\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u534a\u6e1b (HKx, KxH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"H"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u3092\u534a\u6e1b\u3055\u305b\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u3001\u534a\u6e1b\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09HK20\u3000\u3000K20h\u3000\u3000HK10-5@9\u3000\u3000K10-5@9H\u3000\u3000K20gfH\u3000\u3000K20+8H+2\u3000\u3000K20+8H+(1+1)\n\n\u30fb\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e1.5\u500d (OHKx, KxOH+N)\n\u3000\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u306e\u5148\u982d\u307e\u305f\u306f\u672b\u5c3e\u306b"OH"\u3092\u3064\u3051\u308b\u3068\u3001\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u8868\u3092\u632f\u3063\u3066\u6700\u7d42\u7d50\u679c\u30921.5\u500d\u3057\u307e\u3059\u3002\n\u3000\u672b\u5c3e\u306b\u3064\u3051\u305f\u5834\u5408\u3001\u76f4\u5f8c\u306b\u4fee\u6b63\u3092\u3092\u3064\u3051\u308b\u3053\u3068\u3067\u30011.5\u500d\u5f8c\u306e\u52a0\u6e1b\u7b97\u3092\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u3053\u306e\u969b\u3001\u8907\u6570\u306e\u9805\u306b\u3088\u308b\u4fee\u6b63\u306b\u306f\u30ab\u30c3\u30b3\u3067\u56f2\u3046\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\uff08\u30ab\u30c3\u30b3\u304c\u306a\u3044\u3068\u30d1\u30fc\u30b9\u306b\u5931\u6557\u3057\u307e\u3059\uff09\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u306a\u3057\u3068\u6271\u308f\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09OHK20\u3000\u3000K20oh\u3000\u3000OHK10-5@9\u3000\u3000K20+8OH+2\u3000\u3000K20+8OH+(1+1)\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u904b\u547d\u5909\u8ee2\u3084\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u30ec\u30a4\u7528\uff09\n\u3000\u672b\u5c3e\u306b\u300c$\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000$\uff0b\uff11\u3068\u4fee\u6b63\u8868\u8a18\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u306b\uff0b\u4fee\u6b63\u3001\uff04\uff19\u306e\u3088\u3046\u306b\u56fa\u5b9a\u5024\u306a\u3089\u30c0\u30a4\u30b9\u76ee\u3092\u305d\u306e\u51fa\u76ee\u306b\u5dee\u3057\u66ff\u3048\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u56fa\u5b9a\u5024\u3084\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3059\u3002\n\u3000\u4f8b\uff09K20$+1\u3000\u3000\u3000K10+5$9\u3000\u3000\u3000k10-5@9$+2\u3000\u3000\u3000k10[9]+10$9\n\n\u30fb\u30c0\u30a4\u30b9\u76ee\u306e\u4fee\u6b63\uff08\u5fc5\u6bba\u653b\u6483\u7528\uff09\n\u3000\u300c\uff03\u4fee\u6b63\u5024\u300d\u3067\u30c0\u30a4\u30b9\u76ee\u306b\u4fee\u6b63\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3057\u305f\u5834\u5408\u3067\u3082\u4fee\u6b63\u5024\u306e\u9069\u7528\u306f\u7d99\u7d9a\u3055\u308c\u307e\u3059\u3002\n\u3000\u4f8b\uff09K20#1\u3000\u3000\u3000k10-5@9#2\n\n\u30fb\u9996\u5207\u308a\u5200\u7528\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u4e0a\u6607 r5\n\u3000\u4f8b\uff09K20r5\u3000K30+24@8R5\u3000K40+24@8$12r5\n\n\u30fb\u30b0\u30ec\u30a4\u30c6\u30b9\u30c8\u30d5\u30a9\u30fc\u30c1\u30e5\u30f3\u306f\u672b\u5c3e\u306b gf\n\u3000\u4f8b\uff09K20gf\u3000K30+24@8GF\u3000K40+24@8$12r5gf\n\n\u30fb\u5a01\u529b\u8868\u30921d+sf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u3082\u7d99\u7d9a sf4\n\u3000\u4f8b\uff09k10sf4\u3000k0+5sf4@13\u3000k70+26sf3@9\n\n\u30fb\u5a01\u529b\u8868\u30921d+tf\u3067\u53c2\u7167 \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5f8c\u306f2d\u3067\u53c2\u7167 tf3\n\u3000\u4f8b\uff09k10tf3\u3000k0+5tf4@13\u3000k70+26tf3@9\n\n\u30fb\u8d85\u8d8a\u5224\u5b9a\u7528\u306b2d6\u30ed\u30fc\u30eb\u306b 2D6@10 \u66f8\u5f0f\u3067\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u4ed8\u4e0e\u304c\u53ef\u80fd\u306b\u3002\n\u3000\u4f8b\uff092D6@10\u30002D6@10+11>=30\n\n\u30fb\u6210\u9577\u3000(Gr)\n\u3000\u672b\u5c3e\u306b\u6570\u5b57\u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u8907\u6570\u56de\u306e\u6210\u9577\u3092\u307e\u3068\u3081\u3066\u884c\u3048\u307e\u3059\u3002\n\u3000\u4f8b\uff09Gr3\n\n\u30fb\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000(FT)\n\u3000\u9632\u5fa1\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u7d61\u307f\u52b9\u679c\u8868\u3000(TT)\n\u3000\u7d61\u307f\u52b9\u679c\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30fb\u30c9\u30eb\u30a4\u30c9\u306e\u7269\u7406\u9b54\u6cd5\u7528\u8868\u3000(Dru[2-6\u306e\u5024,7-9\u306e\u5024,10-12\u306e\u5024])\n\u3000\u4f8b\uff09Dru[0,3,6]+10-3\n\n\u30fb\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3000(ABT)\n\u3000\u30a2\u30d3\u30b9\u30ab\u30fc\u30b9\u8868\u3092\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n'),y.$register_prefix("H?K","OHK","Gr","2D6?@\\d+","FT","TT","Dru","ABT"),M(y,"$eval_game_system_specific_command",function s(o){var d,T=this,m=A,w=A;return s.$$p=null,I(/^dru\[(\d+),(\d+),(\d+)\]/i,d=o)?(m=P(g("Regexp").$last_match().$captures(),"map",[],"to_i".$to_proc()),w=z(g("Command"),"Parser").$new(/dru\[\d+,\d+,\d+\]/i,f(["round_type"],{round_type:z(z(g("BCDice"),"RoundType"),"CEIL")})).$parse(o),H(w)?T.$druid_dice(w,m):A):I("ABT",d)?T.$get_abyss_curse_table():h(T,N(T,"eval_game_system_specific_command",s,!1,!0),"eval_game_system_specific_command",[o],null)}),M(y,"$rating_parser",function(){return g("RatingParser").$new(f(["version"],{version:"v2_5"}))}),M(y,"$druid_dice",function(o,_){var m,n,w,r,v,d=A;return m=(d=this.randomizer.$roll_barabara(2,6)).$sum(),n=I(E(2,6,!1),w=m)?0:I(E(7,9,!1),w)?1:I(E(10,12,!1),w)?2:A,r=_["$[]"](n),v=V(r,o.$modify_number()),["("+o.$command().$capitalize()+g("Format").$modifier(o.$modify_number())+")","2D["+d.$join(",")+"]="+m,""+r+g("Format").$modifier(o.$modify_number()),v].$join(" \uff1e ")}),M(y,"$get_abyss_curse_table",function(){var d,o=this,_=A,T=A;return _=z(g("DiceTable"),"D66GridTable").$from_i18n("SwordWorld2_5.AbyssCurseTable",o.locale).$roll(o.randomizer),T=I(14,d=_.$value())?z(g("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseCategoryTable",o.locale).$roll(o.randomizer).$to_s():I(25,d)?z(g("DiceTable"),"D66ParityTable").$from_i18n("SwordWorld2_5.AbyssCurseAttrTable",o.locale).$roll(o.randomizer).$to_s():A,[_.$to_s(),T].$compact().$join("\n")})})}}]);