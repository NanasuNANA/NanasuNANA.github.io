(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[1377],{5762:(X,Z,W)=>{W(9993),Opal.modules["bcdice/arithmetic_evaluator"]=function(s){var d,C,U,e,m,R,I,D,S=s.module,G=s.ensure_kwargs,h=s.truthy,M=s.thrower,g=s.def,$=[],T=s.nil,x=s.$$$;return d=$,C=D=[S($[0],"BCDice")].concat(d),I=[R=S(D[0],"ArithmeticEvaluator")].concat(C),e=[U=s.get_singleton_class(R)].concat(I),m=s.$r(e),g(U,"$eval",function(H,A){try{M("eval_return");var p,F=T;return null==(p=(A=G(A)).$$smap.round_type)&&(p=x(m("RoundType"),"FLOOR")),h(H)&&h(F=m("Arithmetic").$eval(H,p))?F:0}catch(w){if(w===s.t_eval_return)return w.$v;throw w}},-2)},Opal.queue(function(s){var H,F,Q,t,_,r,a,v,c,l,q,k,K,V,S=s.module,G=s.klass,h=s.const_set,M=s.slice,g=s.send,$=s.def,T=s.return_val,x=s.send2,y=s.find_super,d=s.truthy,L=s.eqeqeq,D=s.hash2,P=s.thrower,C=s.rb_plus,R=s.rb_ge,I=s.rb_le,b=[],e=s.nil,m=s.$$$;return s.top.$require("bcdice/arithmetic_evaluator"),H=b,F=V=[S(b[0],"BCDice")].concat(H),k=[S(V[0],"GameSystem")].concat(F),K=s.$r(k),Q=k,c=[v=G(k[0],K("Base"),"SRS")].concat(Q),l=s.$r(c),(q=v.$$prototype).round_type=q.randomizer=q.sort_add_dice=e,h(c[0],"ID","SRS"),h(c[0],"NAME","\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9RPG\u30b7\u30b9\u30c6\u30e0"),h(c[0],"SORT_KEY","\u3059\u305f\u3093\u305f\u3042\u3068RPG\u3057\u3059\u3066\u3080"),h(c[0],"HELP_MESSAGE_1","\u30fb\u5224\u5b9a\n\u3000\u30fb\u901a\u5e38\u5224\u5b9a\uff1a2D6+m>=t[c,f]\n\u3000\u3000\u4fee\u6b63\u5024m\u3001\u76ee\u6a19\u5024t\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024c\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024f\u3067\u5224\u5b9a\u30ed\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000\u4fee\u6b63\u5024\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306f\u7701\u7565\u53ef\u80fd\u3067\u3059\uff08[]\u3054\u3068\u7701\u7565\u53ef\uff09\u3002\n\u3000\u3000\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306e\u65e2\u5b9a\u5024\u306f\u3001\u305d\u308c\u305e\u308c12\u30012\u3067\u3059\u3002\n\u3000\u3000\u81ea\u52d5\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u3001\u6210\u529f\u3001\u5931\u6557\u3092\u81ea\u52d5\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u3000\u3000\u4f8b) 2d6>=10\u3000\u3000\u3000\u3000\u3000\u4fee\u6b63\u50240\u3001\u76ee\u6a19\u502410\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10\u3000\u3000\u3000\u3000\u4fee\u6b63\u5024+2\u3001\u76ee\u6a19\u502410\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10[11]\u3000\u3000\u2191\u3092\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502411\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2>=10[12,4]\u3000\u2191\u3092\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50244\u3067\u5224\u5b9a\n"),h(c[0],"HELP_MESSAGE_2","\u3000\u30fb\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u304a\u3088\u3073\u30d5\u30a1\u30f3\u30d6\u30eb\u306e\u307f\u306e\u5224\u5b9a\uff1a2D6+m[c,f]\n\u3000\u3000\u76ee\u6a19\u5024\u3092\u6307\u5b9a\u305b\u305a\u3001\u4fee\u6b63\u5024m\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024c\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024f\u3067\u5224\u5b9a\u30ed\u30fc\u30eb\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000\u3000\u4fee\u6b63\u5024\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306f\u7701\u7565\u53ef\u80fd\u3067\u3059\uff08[]\u306f\u7701\u7565\u4e0d\u53ef\uff09\u3002\n\u3000\u3000\u81ea\u52d5\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u3092\u81ea\u52d5\u8868\u793a\u3057\u307e\u3059\u3002\n\n\u3000\u3000\u4f8b) 2d6[]\u3000\u3000\u3000\u3000\u4fee\u6b63\u50240\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50242\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2[11]\u3000\u3000\u4fee\u6b63\u5024+2\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502411\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50242\u3067\u5224\u5b9a\n\u3000\u3000\u4f8b) 2d6+2[12,4]\u3000\u4fee\u6b63\u5024+2\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u502412\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u50244\u3067\u5224\u5b9a\n"),h(c[0],"HELP_MESSAGE_3","\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\uff08\u5165\u308c\u66ff\u3048\u306a\u3057)\n"),h(c[0],"DEFAULT_HELP_MESSAGE",l("HELP_MESSAGE_1")+"\n"+l("HELP_MESSAGE_2")+"\n"+l("HELP_MESSAGE_3")),h(c[0],"HELP_MESSAGE",l("DEFAULT_HELP_MESSAGE")),t=c,r=[_=S(c[0],"ClassMethods")].concat(t),a=s.$r(r),_.$attr_reader("help_message"),_.$attr_reader("aliases_re_for_srs_roll_with_target_value"),_.$attr_reader("aliases_re_for_srs_roll_without_target_value"),$(_,"$set_aliases_for_srs_roll",function(i){var f,o=this,z=e,B=e;return f=M(arguments),z=g(f,"map",[],"upcase".$to_proc()),B=g(z,"map",[],function(j){return null==j&&(j=e),a("Regexp").$escape(j)}).$join("|"),o.aliases_re_for_srs_roll_with_target_value=a("Regexp").$new("^(?:"+B+")((?:[-+][-+\\d]+)?>=\\d+(?:\\[\\d*(?:,\\d+)?\\])?)$"),o.aliases_re_for_srs_roll_without_target_value=a("Regexp").$new("^(?:"+B+")([-+][-+\\d]+)?(\\[\\d*(?:,\\d+)?\\])?$"),o.$prepare_help_msg_for_aliases_for_srs_roll(z),o.help_message=o.$concatenate_help_messages(),o},-1),$(_,"$clear_aliases_for_srs_roll",function(){var i=this;return i.aliases_re_for_srs_roll_with_target_value=e,i.aliases_re_for_srs_roll_without_target_value=e,i.help_message=m(a("SRS"),"DEFAULT_HELP_MESSAGE"),i}),_.$private(),$(_,"$prepare_help_msg_for_aliases_for_srs_roll",function(i){var f=this;return f.help_msg_for_aliases_for_srs_roll_with_target_value=g(i,"map",[],function(o){return null==o&&(o=e),"\u3000\u3000\u4f8b) "+o+"+2>=10\u3000\u3000\u3000\u3000 2d6+2>=10\u3068\u540c\u3058\uff08"+o+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n"}).$join(),f.help_msg_for_aliases_for_srs_roll_without_target_value=g(i,"map",[],function(o){return null==o&&(o=e),"\u3000\u3000\u4f8b) "+o+"\u3000\u3000\u3000\u3000\u3000 2d6[]\u3068\u540c\u3058\uff08"+o+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n\u3000\u3000\u4f8b) "+o+"+2[12,4]\u3000 2d6+2[12,4]\u3068\u540c\u3058\uff08"+o+"\u304c2D6\u306e\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30b3\u30de\u30f3\u30c9\uff09\n"}).$join(),f}),$(_,"$concatenate_help_messages",function(){var i=this;return null==i.help_msg_for_aliases_for_srs_roll_with_target_value&&(i.help_msg_for_aliases_for_srs_roll_with_target_value=e),null==i.help_msg_for_aliases_for_srs_roll_without_target_value&&(i.help_msg_for_aliases_for_srs_roll_without_target_value=e),m(a("SRS"),"HELP_MESSAGE_1")+(i.help_msg_for_aliases_for_srs_roll_with_target_value+"\n")+m(a("SRS"),"HELP_MESSAGE_2")+i.help_msg_for_aliases_for_srs_roll_without_target_value+"\n"+m(a("SRS"),"HELP_MESSAGE_3")}),function(n,t){var _=[n].concat(t),r=s.$r(_);$(n,"$inherited",function(u){return u.$extend(r("ClassMethods")).$clear_aliases_for_srs_roll()}),$(n,"$help_message",function(){return r("DEFAULT_HELP_MESSAGE")}),$(n,"$aliases_re_for_srs_roll_with_target_value",T(e)),$(n,"$aliases_re_for_srs_roll_without_target_value",T(e))}(s.get_singleton_class(v),c),v.$register_prefix("2D6"),$(v,"$initialize",function n(t){var r=this;return n.$$p=null,x(r,y(r,"initialize",n,!1,!0),"initialize",[t],null),r.sort_add_dice=!0,r.d66_sort_type=m(l("D66SortType"),"NO_SORT")}),$(v,"$help_message",function(){return this.$class().$help_message()}),h(c[0],"DEFAULT_CRITICAL_VALUE",12),h(c[0],"DEFAULT_FUMBLE_VALUE",2),h(c[0],"SRS_ROLL_WITH_TARGET_VALUE_RE",/^2D6([-+][-+\d]+)?>=(\d+)(?:\[(\d+)?(?:,(\d+))?\])?$/.$freeze()),h(c[0],"SRS_ROLL_WITHOUT_TARGET_VALUE_RE",/^2D6([-+][-+\d]+)?\[(\d+)?(?:,(\d+))?\]$/.$freeze()),h(c[0],"SRS_ROLL_DEFAULT_THRESHOLDS","["+l("DEFAULT_CRITICAL_VALUE")+","+l("DEFAULT_FUMBLE_VALUE")+"]"),h(c[0],"SRSRollNode",g(l("Struct"),"new",["modifier","critical_value","fumble_value","target_value"],function n(){return $(null==n.$$s?this:n.$$s,"$to_s",function(){var a,r=this;return a="2D6"+l("Format").$modifier(r.$modifier()),(d(r.$target_value())?a+">="+r.$target_value():a)+"["+r.$critical_value()+","+r.$fumble_value()+"]"})},{$$s:v})),$(v,"$eval_game_system_specific_command",function(t){var r,a,_=this;return r=_.$replace_alias_for_srs_roll_with_2d6(t),d(a=_.$parse(r))?_.$execute_srs_roll(a):e}),v.$private(),$(v,"$replace_alias_for_srs_roll_with_2d6",function(t){var r,i=e;return L(this.$class().$aliases_re_for_srs_roll_with_target_value(),r=t)?"2D6"+l("Regexp").$last_match(1):L(this.$class().$aliases_re_for_srs_roll_without_target_value(),r)?"2D6"+l("Regexp").$last_match(1)+(d(i=l("Regexp").$last_match(2))?i:l("SRS_ROLL_DEFAULT_THRESHOLDS")):t}),$(v,"$parse",function(t){var r;return L(l("SRS_ROLL_WITH_TARGET_VALUE_RE"),r=t)?this.$parse_srs_roll_with_target_value(l("Regexp").$last_match()):L(l("SRS_ROLL_WITHOUT_TARGET_VALUE_RE"),r)?this.$parse_srs_roll_without_target_value(l("Regexp").$last_match()):e}),$(v,"$eval_modifier",function(t){try{return P("eval_return"),d(t)?l("ArithmeticEvaluator").$eval(t,D(["round_type"],{round_type:this.round_type})):0}catch(a){if(a===s.t_eval_return)return a.$v;throw a}}),$(v,"$parse_srs_roll_with_target_value",function(t){var _,r,u,i,f,o,E=e;return u=this.$eval_modifier(t["$[]"](1)),i=t["$[]"](2).$to_i(),f=d(E=(_=t["$[]"](3))===e||null==_?e:_.$to_i())?E:l("DEFAULT_CRITICAL_VALUE"),o=d(E=(r=t["$[]"](4))===e||null==r?e:r.$to_i())?E:l("DEFAULT_FUMBLE_VALUE"),l("SRSRollNode").$new(u,f,o,i)}),$(v,"$parse_srs_roll_without_target_value",function(t){var _,r,u,i,E,f=e;return u=this.$eval_modifier(t["$[]"](1)),i=d(f=(_=t["$[]"](2))===e||null==_?e:_.$to_i())?f:l("DEFAULT_CRITICAL_VALUE"),E=d(f=(r=t["$[]"](3))===e||null==r?e:r.$to_i())?f:l("DEFAULT_FUMBLE_VALUE"),l("SRSRollNode").$new(u,i,E,e)}),$(v,"$execute_srs_roll",function(t){var a,u,i,_=this,r=e,f=e,E=e;return r=_.randomizer.$roll_barabara(2,6),d(_.sort_add_dice)&&r["$sort!"](),a=r.$sum(),u=r.$join(","),i=C(a,t.$modifier()),f=_.$compare_result(t,a,i),E=["("+t+")",a+"["+u+"]"+l("Format").$modifier(t.$modifier()),i,f.$text()],f["$text="](E.$compact().$join(" \uff1e ")),f}),$(v,"$compare_result",function(t,_,r){return d(R(_,t.$critical_value()))?l("Result").$critical("\u81ea\u52d5\u6210\u529f"):d(I(_,t.$fumble_value()))?l("Result").$fumble("\u81ea\u52d5\u5931\u6557"):d(t.$target_value()["$nil?"]())?l("Result").$new():d(R(r,t.$target_value()))?l("Result").$success("\u6210\u529f"):l("Result").$failure("\u5931\u6557")})})}}]);