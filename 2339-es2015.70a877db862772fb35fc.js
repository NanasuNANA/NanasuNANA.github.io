(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[2339],{84535:function(r,t,e){e(93683),Opal.modules["bcdice/format"]=function(r){var t,e,$,n,i,o,a,m=[],c=r.nil,u=r.$$,d=r.module,l=r.truthy;return t=m,e=a=[d(m[0],"BCDice")].concat(t),i=d(a[0],"Format"),o=[i].concat(e),i.$module_function(),r.def(i,"$comparison_operator",$=function(r){var t;return"=="["$==="](t=r)?"=":"!="["$==="](t)?"<>":u(o,"Symbol")["$==="](t)?r.$to_s():c},$.$$arity=1),void r.def(i,"$modifier",n=function(r){return l(r["$nil?"]())?c:r["$=="](0)?"":l("number"==typeof(t=r)?t>0:t["$>"](0))?"+"+r:r.$to_s();var t},n.$$arity=1)},function(r){function t(r,t){return"number"==typeof r&&"number"==typeof t?r-t:r["$-"](t)}function e(r,t){return"number"==typeof r&&"number"==typeof t?r+t:r["$+"](t)}function $(r,t){return"number"==typeof r&&"number"==typeof t?r>=t:r["$>="](t)}function n(r,t){return"number"==typeof r&&"number"==typeof t?r<t:r["$<"](t)}var i,o,a,m,c,u,d,l,_,f,p,s,b,y,h,x,g,v,z,C,k,j,L=[],D=r.nil,F=r.$$$,E=r.$$,R=r.module,w=r.klass,O=r.send2,S=r.hash2,P=r.truthy,B=r.send;r.top.$require("bcdice/format"),i=L,o=j=[R(L[0],"BCDice")].concat(i),a=k=[R(j[0],"GameSystem")].concat(o),z=w(k[0],E(k,"Base"),"OracleEngine"),C=[z].concat(a),z.$$prototype.cmd=z.$$prototype.max_shift=z.$$prototype.times=z.$$prototype.randomizer=z.$$prototype.break=z.$$prototype.critical=z.$$prototype.fumble=D,r.const_set(C[0],"ID","OracleEngine"),r.const_set(C[0],"NAME","\u30aa\u30e9\u30af\u30eb\u30a8\u30f3\u30b8\u30f3"),r.const_set(C[0],"SORT_KEY","\u304a\u3089\u304f\u308b\u3048\u3093\u3057\u3093"),r.const_set(C[0],"HELP_MESSAGE","  \u30fb\u30af\u30e9\u30c3\u30c1\u30ed\u30fc\u30eb \uff08xCL+y>=z)\n  \u30c0\u30a4\u30b9\u3092x\u500b\u632f\u308a\u30011\u500b\u4ee5\u4e0a\u76ee\u6a19\u30b7\u30d5\u30c8z\u306b\u5230\u9054\u3057\u305f\u304b\u5224\u5b9a\u3057\u307e\u3059\u3002\u4fee\u6b63y\u306f\u5168\u3066\u306e\u30c0\u30a4\u30b9\u306b\u304b\u304b\u308a\u307e\u3059\u3002\n  \u6210\u529f\u3057\u305f\u6642\u306f\u76ee\u6a19\u30b7\u30d5\u30c8\u3092\u3001\u5931\u6557\u3057\u305f\u6642\u306f\u30c0\u30a4\u30b9\u306e\u6700\u5927\u5024-1\u30b7\u30d5\u30c8\u3092\u8fd4\u3057\u307e\u3059\n  z\u304c\u6307\u5b9a\u3055\u308c\u306a\u3044\u3068\u304d\u306f\u3001\u30c0\u30a4\u30b9\u3092x\u500b\u3092\u632f\u308a\u3001\u305d\u308c\u306b\u4fee\u6b63y\u3057\u305f\u3082\u306e\u3092\u8fd4\u3057\u307e\u3059\u3002\n  \u901a\u5e38\u3001\u6700\u4f4e\u30b7\u30d5\u30c8\u306f1\u3001\u6700\u5927\u30b7\u30d5\u30c8\u306f6\u3067\u3059\u3002\u76ee\u6a19\u30b7\u30d5\u30c8\u3082\u305d\u308d\u3048\u3089\u308c\u307e\u3059\u3002\n  \u307e\u305f\u3001CL\u306e\u5f8c\u306b7\u3092\u5165\u308c\u3001(xCL7+y>=z)\u3068\u5165\u529b\u3059\u308b\u3068\u6700\u5927\u30b7\u30d5\u30c8\u304c7\u306b\u306a\u308a\u307e\u3059\u3002\n \u30fb\u5224\u5b9a (xR6+y@c#f$b>=z)\n  \u30c0\u30a4\u30b9\u3092x\u500b\u632f\u308a\u3001\u5927\u304d\u3044\u3082\u306e2\u3064\u3060\u3051\u3092\u898b\u3066\u9054\u6210\u5024\u3092\u7b97\u51fa\u3057\u3001\u6210\u5426\u3092\u5224\u5b9a\u3057\u307e\u3059\u3002\u4fee\u6b63y\u306f\u9054\u6210\u5024\u306b\u304b\u304b\u308a\u307e\u3059\u3002\n  \u30c0\u30a4\u30b9\u30d6\u30ec\u30a4\u30af\u3068\u3057\u3066b\u3092\u3001\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u3068\u3057\u3066c\u3092\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u3068\u3057\u3066f\u3092\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n  \u305d\u308c\u305e\u308c\u6307\u5b9a\u3055\u308c\u306a\u3044\u6642\u30010,12,2\u306b\u306a\u308a\u307e\u3059\u3002\n  \u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u5024\u306e\u4e0a\u9650\u306f\u306a\u3057\u3001\u4e0b\u9650\u306f2\u3002\u30d5\u30a1\u30f3\u30d6\u30eb\u5024\u306e\u4e0a\u9650\u306f12\u3001\u4e0b\u9650\u306f0\u3002\n  z\u304c\u6307\u5b9a\u3055\u308c\u306a\u3044\u3068\u304d\u3001\u9054\u6210\u5024\u306e\u7b97\u51fa\u306e\u307f\u884c\u3044\u307e\u3059\u3002\n \u30fb\u30c0\u30e1\u30fc\u30b8\u30ed\u30fc\u30eb\u306e\u30c0\u30a4\u30b9\u30d6\u30ec\u30a4\u30af (xD6+y$b)\n  \u30c0\u30a4\u30b9\u3092x\u500b\u632f\u308a\u3001\u5408\u8a08\u5024\u3092\u51fa\u3057\u307e\u3059\u3002\u4fee\u6b63y\u306f\u5408\u8a08\u5024\u306b\u304b\u304b\u308a\u307e\u3059\u3002\n  \u30c0\u30a4\u30b9\u30d6\u30ec\u30a4\u30af\u3068\u3057\u3066b\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u5408\u8a08\u5024\u306f0\u672a\u6e80\u306b\u306a\u308a\u307e\u305b\u3093\u3002\n"),z.$register_prefix("\\d+CL","\\d+R6","\\d+D6.*\\$[\\+\\-]?\\d+"),r.def(z,"$initialize",m=function(t){var e=this;return m.$$p&&(m.$$p=null),O(e,r.find_super_dispatcher(e,"initialize",m,!1,!0),"initialize",[t],null),e.sort_add_dice=!0,e.sort_barabara_dice=!0},m.$$arity=1),r.def(z,"$eval_game_system_specific_command",c=function(r){var t,e=this;return/\d+CL.*/i["$==="](t=r)?e.$clutch_roll(r):/\d+D6.*\$[+\-]?\d.*/["$==="](t)?e.$damage_roll(r):/\d+R6/["$==="](t)?e.$r_roll(r):D},c.$$arity=1),r.def(z,"$clutch_roll",u=function($){var n,i,o,a=this,m=D,c=D,u=D,d=D;return a.$debug("clutch_roll begin",$),m=F(E(C,"Command"),"Parser").$new(/\d+CL[67]?/,S(["round_type"],{round_type:a.$round_type()})).$restrict_cmp_op_to(D,">="),a.cmd=m.$parse($),!P(a.cmd)||(i=B(a.cmd.$command().$split("CL"),"map",[],"to_i".$to_proc()),n=r.to_ary(i),a.times=null==n[0]?D:n[0],a.max_shift=null==n[1]?D:n[1],a.max_shift=P(c=a.max_shift)?c:6,P(a.cmd.$cmp_op())&&(u=[a.$clamp(a.cmd.$target_number(),1,a.max_shift)],B(a.cmd,"target_number=",r.to_a(u)),t(u.length,1)),a.times["$=="](0))?D:(d=B(a.randomizer.$roll_barabara(a.times,6),"map",[],(o=function(r){var t=null==o.$$s?this:o.$$s;return null==t.cmd&&(t.cmd=D),null==t.max_shift&&(t.max_shift=D),null==r&&(r=D),t.$clamp(e(r,t.cmd.$modify_number()),1,t.max_shift)},o.$$s=a,o.$$arity=1,o)).$sort(),[a.$expr_clutch(),"["+d.$join(", ")+"]",a.$result_clutch(d.$last())].$join(" \uff1e "))},u.$$arity=1),r.def(z,"$expr_clutch",d=function(){var r,t,e,$=this;return r=$.max_shift["$=="](7)?7:D,t=E(C,"Format").$comparison_operator($.cmd.$cmp_op()),e=E(C,"Format").$modifier($.cmd.$modify_number()),"("+$.times+"CL"+r+e+t+$.cmd.$target_number()+")"},d.$$arity=0),r.def(z,"$result_clutch",l=function(r){var e=this;return P(e.cmd.$cmp_op()["$!="](">="))?"\u30b7\u30d5\u30c8"+r:P($(r,e.cmd.$target_number()))?"\u6210\u529f \u30b7\u30d5\u30c8"+e.cmd.$target_number():(r=t(r,1),P(n(r,1))&&(r=1),"\u5931\u6557 \u30b7\u30d5\u30c8"+r)},l.$$arity=1),r.def(z,"$clamp",_=function(r,t,e){return P(n(r,t))?t:P(function(r,t){return"number"==typeof r&&"number"==typeof t?r>t:r["$>"](t)}(r,e))?e:r},_.$$arity=3),r.def(z,"$r_roll",f=function(r){var t=this,$=D,n=D,i=D,o=D,a=D,m=D,c=D,u=D;return $=F(E(C,"Command"),"Parser").$new(/\d+R6/,S(["round_type"],{round_type:t.$round_type()})).$restrict_cmp_op_to(D,">=").$enable_critical().$enable_fumble().$enable_dollar(),t.cmd=$.$parse(r),!P(t.cmd)||(t.times=t.cmd.$command().$to_i(),t.times["$=="](0))?D:(t.critical=t.$normalize_critical(P(n=t.cmd.$critical())?n:12,r),t.fumble=t.$normalize_fumble(P(i=t.cmd.$fumble())?i:2,r),t.break=(P(o=t.cmd.$dollar())?o:0).$abs(),m=(a=t.randomizer.$roll_barabara(t.times,6).$sort()).$pop(t.break),u=e(c=a.$dup().$pop(2).$inject(0,"+"),t.cmd.$modify_number()),[t.$expr_r(),t.$dice_result_r(c,a,m),t.$result_r(c,u)].$join(" \uff1e "))},f.$$arity=1),r.def(z,"$expr_r",p=function(){var r,t,e,$,n,i=this;return r=E(C,"Format").$modifier(i.cmd.$modify_number()),t=i.critical["$=="](12)?"":"c["+i.critical+"]",e=i.fumble["$=="](2)?"":"f["+i.fumble+"]",$=i.break["$=="](0)?"":"b["+i.break+"]",n=E(C,"Format").$comparison_operator(i.cmd.$cmp_op()),"("+i.times+"R6"+r+t+e+$+n+i.cmd.$target_number()+")"},p.$$arity=0),r.def(z,"$dice_result_r",s=function(r,t,e){var $;return $=E(C,"Format").$modifier(this.cmd.$modify_number()),P(e["$empty?"]())?r+"["+t.$join(", ")+"]"+$:r+"["+t.$join(", ")+"]\xd7["+e.$join(", ")+"]"+$},s.$$arity=3),r.def(z,"$result_r",b=function(r,t){var e=this;return P(function(r,t){return"number"==typeof r&&"number"==typeof t?r<=t:r["$<="](t)}(r,e.fumble))?"\u30d5\u30a1\u30f3\u30d6\u30eb!":P($(r,e.critical))?"\u30af\u30ea\u30c6\u30a3\u30ab\u30eb!":e.cmd.$cmp_op()["$=="](">=")?P($(t,e.cmd.$target_number()))?t+" \u6210\u529f":t+" \u5931\u6557":t.$to_s()},b.$$arity=2),r.def(z,"$normalize_critical",y=function(r,t){return P(/@[+-]/.$match(t))&&(r=e(12,r)),P(n(r,2))&&(r=2),r},y.$$arity=2),r.def(z,"$normalize_fumble",h=function(r,t){return P(/#[+-]/.$match(t))&&(r=e(2,r)),this.$clamp(r,0,12)},h.$$arity=2),r.def(z,"$damage_roll",x=function(r){var t=this,$=D,i=D,o=D,a=D,m=D;return $=F(E(C,"Command"),"Parser").$new(/\d+D6/,S(["round_type"],{round_type:t.$round_type()})).$restrict_cmp_op_to(D).$enable_dollar(),t.cmd=$.$parse(r),!P(t.cmd)||(t.times=t.cmd.$command().$to_i(),t.break=(P(i=t.cmd.$dollar())?i:0).$abs(),t.times["$=="](0))?D:(a=(o=t.randomizer.$roll_barabara(t.times,6).$sort()).$pop(t.break),m=e(o.$inject(0,"+"),t.cmd.$modify_number()),P(n(m,0))&&(m=0),[t.$expr_damage(),t.$result_damage(o,a),m].$join(" \uff1e "))},x.$$arity=1),r.def(z,"$expr_damage",g=function(){var r,t,e=this;return r=E(C,"Format").$modifier(e.cmd.$modify_number()),t=e.break["$=="](0)?"":"b["+e.break+"]","("+e.times+"D6"+r+t+")"},g.$$arity=0),r.def(z,"$result_damage",v=function(r,t){var e,$;return e=r.$inject(0,"+"),$=E(C,"Format").$modifier(this.cmd.$modify_number()),P(t["$empty?"]())?e+"["+r.$join(", ")+"]"+$:e+"["+r.$join(", ")+"]\xd7["+t.$join(", ")+"]"+$},v.$$arity=2)}(Opal)}}]);