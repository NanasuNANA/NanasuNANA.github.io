(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[5564],{1903:(ge,pe,he)=>{he(5151),Opal.modules["i18n/backend/fallbacks"]=function(e){var Q,i,t,r,s,v,j=e.module,M=e.class_variable_set,l=e.truthy,B=e.class_variable_get,A=e.def,p=e.send,g=e.send2,C=e.find_super,S=e.hash2,H=e.find_block_super,z=e.neqeq,Y=e.thrower,J=e.return_val,F=[],I=e.nil,w=e.$$$;return Q=F,v=[s=j(F[0],"I18n")].concat(Q),M(v[0],"@@fallbacks",I),i=e.get_singleton_class(s),t=[i].concat(v),r=e.$r(t),A(i,"$fallbacks",function(){var L=I;return M(t[1],"@@fallbacks",l(null!=t[1].$$cvars["@@fallbacks"]?"class variable":I)&&l(L=B(t[1],"@@fallbacks",!1))?L:w(w(r("I18n"),"Locale"),"Fallbacks").$new()),l(L=r("Thread").$current()["$[]"]("i18n_fallbacks"))?L:B(t[1],"@@fallbacks",!1)}),A(i,"$fallbacks=",function(N){var L;return M(t[1],"@@fallbacks",l(N["$is_a?"](r("Array")))?w(w(r("I18n"),"Locale"),"Fallbacks").$new(N):N),L=["i18n_fallbacks",B(t[1],"@@fallbacks",!1)],p(r("Thread").$current(),"[]=",L),L[L.length-1]}),function(i,q){var N,L,k,d,r=[j(i,"Backend")].concat(q);return N=r,k=[L=j(r[0],"Fallbacks")].concat(N),d=e.$r(k),A(L,"$translate",function D(b,T,c){try{var R=Y("return"),o=D.$$p||I,G=this,W=I,_=I;return D.$$p=null,null==c&&(c=d("EMPTY_HASH")),l(c.$fetch("fallback",!0))?l(c["$[]"]("fallback_in_progress"))?g(G,C(G,"translate",D,!1,!0),"translate",[b,T,c],o):(l(c["$[]"]("default"))&&(W=G["$extract_non_symbol_default!"](c)),_=c.$merge(S(["fallback_in_progress"],{fallback_in_progress:!0})),p(d("I18n").$fallbacks()["$[]"](b),"each",[],function $(h){var a=null==$.$$s?this:$.$$s;null==h&&(h=I);try{return p(a,"catch",["exception"],function u(){var n=null==u.$$s?this:u.$$s,y=I;if(y=g(n,H(n,"translate",u.$$def||$.$$def||D,!1,!1),"translate",[h,T,_],null),l(y["$nil?"]()))return I;z(b.$to_s(),h.$to_s())&&n.$on_fallback(b,h,T,c),R.$throw(y)},{$$s:a,$$ret:R})}catch(u){if(!e.rescue(u,[w(d("I18n"),"InvalidLocale")]))throw u;try{return I}finally{e.pop_exception()}}},{$$s:G}),l(c["$key?"]("default"))&&l(c["$[]"]("default")["$nil?"]())?I:l(W)?g(G,C(G,"translate",D,!1,!0),"translate",[b,I,c.$merge(S(["default"],{default:W}))],null):G.$throw("exception",w(d("I18n"),"MissingTranslation").$new(b,T,c))):g(G,C(G,"translate",D,!1,!0),"translate",[b,T,c],o)}catch($){if($===R)return $.$v;throw $}},-3),A(L,"$extract_non_symbol_default!",function(b){var c,T=I;return T=[b["$[]"]("default")].$flatten(),c=p(T,"detect",[],function(o){return null==o&&(o=I),o["$is_a?"](d("Symbol"))["$!"]()}),l(c)&&b["$[]="]("default",T["$[]"](0,T.$index(c))),c}),A(L,"$exists?",function D(b,T,c){try{var R=Y("return"),o=D.$$p||I,G=this;return D.$$p=null,null==c&&(c=d("EMPTY_HASH")),l(c.$fetch("fallback",!0))?(p(d("I18n").$fallbacks()["$[]"](b),"each",[],function W(_){var $=null==W.$$s?this:W.$$s;null==_&&(_=I);try{if(!l(g($,H($,"exists?",W.$$def||D,!1,!1),"exists?",[_,T],null)))return I;R.$throw(!0)}catch(h){if(!e.rescue(h,[w(d("I18n"),"InvalidLocale")]))throw h;try{return I}finally{e.pop_exception()}}},{$$s:G,$$ret:R}),!1):g(G,C(G,"exists?",D,!1,!0),"exists?",[b,T,c],o)}catch(W){if(W===R)return W.$v;throw W}},-3),L.$private(),A(L,"$on_fallback",J(I))}(v[0],v)},Opal.modules["bcdice/randomizer"]=function(e){var s,f,N,L,k,d,i,q,M=e.klass,l=e.const_set,B=e.def,A=e.truthy,p=e.rb_gt,g=e.rb_plus,C=e.rb_le,S=e.send,H=e.rb_minus,z=e.eqeq,Y=e.rb_times,J=e.eqeqeq,F=e.rb_ge,I=[],w=e.nil,X=e.$$$;return s=I,i=[(0,e.module)(I[0],"BCDice")].concat(s),q=e.$r(i),f=i,L=[N=M(i[0],null,"Randomizer")].concat(f),k=e.$r(L),(d=N.$$prototype).rand_results=d.detailed_rand_results=w,l(L[0],"UPPER_LIMIT_DICE_TIMES",200),l(L[0],"UPPER_LIMIT_DICE_SIDES",1e4),l(L[0],"UPPER_LIMIT_RANDS",1e4),B(N,"$initialize",function(){return this.rand_results=[],this.detailed_rand_results=[]}),N.$attr_reader("rand_results"),N.$attr_reader("detailed_rand_results"),l(L[0],"DetailedRandResult",k("Struct").$new("kind","sides","value")),B(N,"$roll_barabara",function(b,T){var c=this;return A(p(g(c.rand_results.$size(),b),k("UPPER_LIMIT_RANDS")))&&c.$raise(k("TooManyRandsError")),A(C(b,0))||A(p(b,k("UPPER_LIMIT_DICE_TIMES")))?[]:S(k("Array"),"new",[b],function R(){return(null==R.$$s?this:R.$$s).$roll_once(T)},{$$s:c})}),B(N,"$roll_sum",function(b,T){return this.$roll_barabara(b,T).$sum()}),B(N,"$roll_once",function(b){var c=w;return A(C(b,0))||A(p(b,k("UPPER_LIMIT_DICE_SIDES")))?0:(c=this.$rand_inner(b),this.$push_to_detail("normal",b,c),c)}),B(N,"$roll_index",function(b){return H(this.$roll_once(b),1)}),B(N,"$roll_tens_d10",function(){var c,T=w;return T=this.$rand_inner(10),z(T,10)&&(T=0),c=Y(T,10),this.$push_to_detail("tens_d10",10,c),c}),B(N,"$roll_d9",function(){var T;return T=H(this.$rand_inner(10),1),this.$push_to_detail("d9",10,T),T}),B(N,"$roll_d66",function(b){var R,c=w;return c=S(k("Array"),"new",[2],function o(){return(null==o.$$s?this:o.$$s).$roll_once(6)},{$$s:this}),J(X(k("D66SortType"),"ASC"),R=b)?c["$sort!"]():J(X(k("D66SortType"),"DESC"),R)&&c["$sort!"]()["$reverse!"](),g(Y(c["$[]"](0),10),c["$[]"](1))}),N.$private(),B(N,"$rand_inner",function(b){var c,T=this;return A(F(T.rand_results.$size(),k("UPPER_LIMIT_RANDS")))&&T.$raise(k("TooManyRandsError")),c=T.$random(b),T.rand_results["$<<"]([c,b]),c}),B(N,"$random",function(b){return g(k("Kernel").$rand(b),1)}),B(N,"$push_to_detail",function(b,T,c){var o;return o=k("DetailedRandResult").$new(b,T,c),this.detailed_rand_results.$push(o)}),M(i[0],q("StandardError"),"TooManyRandsError"),w},Opal.modules["bcdice/dice_table/roll_result"]=function(e){var S,J,Q,s,v,i,q,I,z,j=e.module,M=e.klass,l=e.def,B=e.truthy,A=e.return_val,p=[],g=e.nil;return S=p,J=z=[j(p[0],"BCDice")].concat(S),Q=I=[j(z[0],"DiceTable")].concat(J),v=[s=M(I[0],null,"RollResult")].concat(Q),i=e.$r(v),(q=s.$$prototype).table_name=q.value=q.body=g,l(s,"$initialize",function(r,f,N){var L=this;return L.table_name=r,L.value=f,L.body=N}),s.$attr_reader("table_name"),s.$attr_reader("value"),s.$attr_reader("body"),l(s,"$to_s",function(){var r=this;return r.table_name+"("+r.value+") \uff1e "+r.body}),l(s,"$last_body",function(){var r=this;return B(r.body["$is_a?"](i("RollResult")))?r.body.$last_body():r.body}),l(s,"$empty?",A(!1))},Opal.modules["bcdice/dice_table/chain_table"]=function(e){var S,J,Q,s,v,i,q,I,z,j=e.module,M=e.klass,l=e.truthy,B=e.def,A=e.rb_minus,p=[],g=e.nil;return S=p,J=z=[j(p[0],"BCDice")].concat(S),Q=I=[j(z[0],"DiceTable")].concat(J),v=[s=M(I[0],null,"ChainTable")].concat(Q),i=e.$r(v),(q=s.$$prototype).times=q.sides=q.items=q.name=g,B(s,"$initialize",function(r,f,N){var L=this,k=g;return L.name=r,L.items=N.$freeze(),k=/(\d+)D(\d+)/i.$match(f),l(k)||L.$raise(i("ArgumentError"),"Unexpected table type: "+f),L.times=k["$[]"](1).$to_i(),L.sides=k["$[]"](2).$to_i()}),B(s,"$roll",function(r){var N,L,f=this,k=g;return N=r.$roll_sum(f.times,f.sides),L=A(N,f.times),k=f.items["$[]"](L),l(k["$respond_to?"]("roll"))&&(k=k.$roll(r)),i("RollResult").$new(f.name,N,k)})},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(e){var Y,w,i,q,t,r,f,Q,F,j=e.module,M=e.klass,l=e.hash2,B=e.defs,A=e.def,p=e.rb_plus,g=e.rb_times,C=e.rb_minus,S=[],H=e.nil;return Y=S,w=F=[j(S[0],"BCDice")].concat(Y),i=Q=[j(F[0],"DiceTable")].concat(w),t=[q=M(Q[0],null,"D66GridTable")].concat(i),r=e.$r(t),(f=q.$$prototype).name=f.items=H,B(q,"$from_i18n",function(L,k){var D=H;return D=r("I18n").$t(L,l(["locale","raise"],{locale:k,raise:!0})),this.$new(D["$[]"]("name"),D["$[]"]("items"))}),A(q,"$initialize",function(L,k){return this.name=L,this.items=k.$freeze()}),A(q,"$roll",function(L){var d,D,b,T,c;return d=L.$roll_once(6),D=L.$roll_once(6),b=p(g(d,10),D),T=C(d,1),c=C(D,1),r("RollResult").$new(this.name,b,this.items["$[]"](T)["$[]"](c))})},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(e){var H,F,v,i,q,t,w,X,Y,j=e.module,M=e.klass,l=e.hash2,B=e.defs,A=e.def,g=[],C=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),H=g,F=Y=[j(g[0],"BCDice")].concat(H),w=[j(Y[0],"DiceTable")].concat(F),X=e.$r(w),v=w,q=[i=M(w[0],X("D66GridTable"),"D66HalfGridTable")].concat(v),t=e.$r(q),B(i,"$from_i18n",function(f,N){var k=C;return k=t("I18n").$t(f,l(["locale","raise"],{locale:N,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2_3"),k["$[]"]("items_4_5_6"))}),A(i,"$initialize",function(f,N,L){return this.name=f,this.items=[N,N,N,L,L,L].$freeze()})},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(e){var H,F,v,i,q,t,w,X,Y,j=e.module,M=e.klass,l=e.hash2,B=e.defs,A=e.def,g=[],C=e.nil;return e.top.$require("bcdice/dice_table/d66_grid_table"),H=g,F=Y=[j(g[0],"BCDice")].concat(H),w=[j(Y[0],"DiceTable")].concat(F),X=e.$r(w),v=w,q=[i=M(w[0],X("D66GridTable"),"D66OneThirdTable")].concat(v),t=e.$r(q),B(i,"$from_i18n",function(f,N){var k=C;return k=t("I18n").$t(f,l(["locale","raise"],{locale:N,raise:!0})),this.$new(k["$[]"]("name"),k["$[]"]("items_1_2"),k["$[]"]("items_3_4"),k["$[]"]("items_5_6"))}),A(i,"$initialize",function(f,N,L,k){return this.name=f,this.items=[N,N,L,L,k,k].$freeze()})},Opal.modules["bcdice/dice_table/d66_table"]=function(e){var F,Q,t,r,f,N,L,v,w,j=e.module,M=e.klass,l=e.hash2,B=e.defs,A=e.def,p=e.eqeqeq,g=e.rb_plus,C=e.rb_times,S=e.truthy,H=[],z=e.nil,Y=e.$$$;return F=H,Q=w=[j(H[0],"BCDice")].concat(F),t=v=[j(w[0],"DiceTable")].concat(Q),f=[r=M(v[0],null,"D66Table")].concat(t),N=e.$r(f),(L=r.$$prototype).sort_type=L.items=L.name=z,B(r,"$from_i18n",function(d,D){var c,T=z;return T=N("I18n").$t(d,l(["locale"],{locale:D})),c=N("D66SortType").$const_get(T["$[]"]("d66_sort_type")),this.$new(T["$[]"]("name"),c,T["$[]"]("items"))}),A(r,"$initialize",function(d,D,b){var T=this;return T.name=d,T.sort_type=D,T.items=b.$freeze()}),A(r,"$roll",function(d){var D=this,b=z,T=z,c=z,R=z;return b=d.$roll_barabara(2,6),p(Y(N("D66SortType"),"ASC"),T=D.sort_type)?b["$sort!"]():p(Y(N("D66SortType"),"DESC"),T)&&b["$sort!"]()["$reverse!"](),c=g(C(b["$[]"](0),10),b["$[]"](1)),R=S(T=D.items["$[]"](c))?T:D.items["$[]"](c.$to_s()),S(R["$respond_to?"]("roll"))&&(R=R.$roll(d)),N("RollResult").$new(D.name,c,R)}),A(r,"$choice",function(d){return N("RollResult").$new(this.name,d,this.items["$[]"](d))})},Opal.modules["bcdice/dice_table/d66_left_range_table"]=function(e){var I,s,i,q,X,j=e.module,M=e.klass,l=e.hash2,B=e.send,A=e.to_ary,p=e.rb_plus,g=e.rb_times,C=e.send2,S=e.find_super,H=e.def,Y=[],J=e.nil;return e.top.$require("bcdice/dice_table/d66_table"),I=Y,s=X=[j(Y[0],"BCDice")].concat(I),i=[j(X[0],"DiceTable")].concat(s),q=e.$r(i),H(M(i[0],q("D66Table"),"D66LeftRangeTable"),"$initialize",function N(L,k,d){var T;return N.$$p=null,T=l([],{}),B(d,"each",[],function(R){var o,_;return null==R&&(R=J),o=A(R),_=null==o[1]?J:o[1],B(null==o[0]?J:o[0],"each",[],function(h){return null==h&&(h=J),B(_,"each_with_index",[],function(u,n){var y,E;return null==u&&(u=J),null==n&&(n=J),E=p(g(h,10),p(n,1)),B(T,"[]=",y=[E,u]),y[y.length-1]})})}),C(this,S(this,"initialize",N,!1,!0),"initialize",[L,k,T],null)})},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(e){var J,X,q,t,r,f,N,s,I,j=e.module,M=e.klass,l=e.hash2,B=e.defs,A=e.def,p=e.truthy,g=e.rb_minus,C=e.rb_plus,S=e.rb_times,H=[],z=e.nil;return J=H,X=I=[j(H[0],"BCDice")].concat(J),q=s=[j(I[0],"DiceTable")].concat(X),r=[t=M(s[0],null,"D66ParityTable")].concat(q),f=e.$r(r),(N=t.$$prototype).odd=N.even=N.name=z,B(t,"$from_i18n",function(k,d){var b=z;return b=f("I18n").$t(k,l(["locale","raise"],{locale:d,raise:!0})),this.$new(b["$[]"]("name"),b["$[]"]("odd"),b["$[]"]("even"))}),A(t,"$initialize",function(k,d,D){var b=this;return b.name=k,b.odd=d.$freeze(),b.even=D.$freeze()}),A(t,"$roll",function(k){var b,c,R,d=this,D=z;return D=k.$roll_once(6),b=k.$roll_once(6),c=(p(D["$odd?"]())?d.odd:d.even)["$[]"](g(b,1)),R=C(S(D,10),b),f("RollResult").$new(d.name,R,c)})},Opal.modules["bcdice/dice_table/d66_range_table"]=function(e){var H,F,s,v,i,q,t,w,Y,j=e.module,M=e.klass,l=e.def,B=e.rb_plus,A=e.rb_times,p=e.send,g=[],C=e.nil;return H=g,F=Y=[j(g[0],"BCDice")].concat(H),s=w=[j(Y[0],"DiceTable")].concat(F),i=[v=M(w[0],null,"D66RangeTable")].concat(s),q=e.$r(i),(t=v.$$prototype).items=t.name=C,l(v,"$initialize",function(f,N){return this.name=f,this.items=N.$freeze()}),l(v,"$roll",function(f){var L,k,d,D=C;return L=f.$roll_once(6),k=f.$roll_once(6),d=B(A(L,10),k),D=p(this.items,"find",[],function(T){return null==T&&(T=C),T["$[]"](0)["$include?"](d)}),q("RollResult").$new(this.name,d,D["$[]"](1))})},Opal.modules["bcdice/dice_table/range_table"]=function(e){var J,X,q,t,r,f,N,s,I,j=e.module,M=e.klass,l=e.const_set,B=e.send,A=e.truthy,p=e.def,g=e.eqeqeq,C=e.rb_times,S=e.rb_plus,H=[],z=e.nil;return J=H,X=I=[j(H[0],"BCDice")].concat(J),q=s=[j(I[0],"DiceTable")].concat(X),r=[t=M(s[0],null,"RangeTable")].concat(q),f=e.$r(r),(N=t.$$prototype).name=N.items=N.num_of_dice=N.num_of_sides=N.formatter=z,l(r[0],"RollResult",B(f("Struct"),"new",["sum","values","content","formatted"],function L(){return(null==L.$$s?this:L.$$s).$alias_method("to_s","formatted")},{$$s:t})),l(r[0],"Item",f("Struct").$new("range","content")),l(r[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),l(r[0],"DEFAULT_FORMATTER",B(t,"lambda",[],function(k,d){return null==k&&(k=z),null==d&&(d=z),k.$name()+"("+d.$sum()+") \uff1e "+d.$content()})),t.$attr_reader("name"),t.$attr_reader("num_of_dice"),t.$attr_reader("num_of_sides"),p(t,"$initialize",function L(k,d,D){var c,b=L.$$p||z,T=this,R=z;return L.$$p=null,T.name=k.$freeze(),T.formatter=A(c=b)?c:f("DEFAULT_FORMATTER"),R=f("DICE_ROLL_METHOD_RE").$match(d),A(R)||T.$raise(f("ArgumentError"),T.name+": invalid dice roll method: "+d),T.num_of_dice=R["$[]"](1).$to_i(),T.num_of_sides=R["$[]"](2).$to_i(),T.$store(D)}),p(t,"$fetch",function(k){var D,d=this;return D=B(d.items,"find",[],function(T){return null==T&&(T=z),T.$range()["$include?"](k)}),A(D)||d.$raise(f("RangeError"),d.name+": value is out of range: "+k),D}),p(t,"$roll",function(k){var b,d=this,D=z,T=z;return b=(D=k.$roll_barabara(d.num_of_dice,d.num_of_sides)).$sum(),(T=f("RollResult").$new(b,D,d.$fetch(b).$content()))["$formatted="](d.formatter["$[]"](d,T)),T}),t.$private(),p(t,"$store",function(k){var D,b,d=this;return D=B(k,"map",[],function T(c,R){return null==c&&(c=z),null==R&&(R=z),[(null==T.$$s?this:T.$$s).$coerce_to_int_range(c),R]},{$$s:d}),b=B(D,"sort_by",[],function(c,R){return null==c&&(c=z),null==R&&(R=z),c.$min()}),d.$assert_min_sum_is_covered(b),d.$assert_max_sum_is_covered(b),d.$assert_no_gap_or_overlap_in_ranges(b),d.items=B(b,"map",[],function(c,R){return null==c&&(c=z),null==R&&(R=z),f("Item").$new(c,R.$freeze()).$freeze()}).$freeze(),d}),p(t,"$coerce_to_int_range",function(k){var D;return g(f("Integer"),D=k)?f("Range").$new(k,k):g(f("Range"),D)&&A(k.$begin()["$is_a?"](f("Integer")))&&A(k.$end()["$is_a?"](f("Integer")))?k:this.$raise(f("TypeError"),this.name+": "+k+" ("+k.$class()+") must be an Integer or a Range with Integers ")}),p(t,"$assert_min_sum_is_covered",function(k){var D,d=this,b=z;return D=d.num_of_dice,b=k.$first()["$[]"](0),A(b["$include?"](D))||d.$raise(f("RangeError"),d.name+": min value ("+D+") is not covered: "+b),d}),p(t,"$assert_max_sum_is_covered",function(k){var D,d=this,b=z;return D=C(d.num_of_dice,d.num_of_sides),b=k.$last()["$[]"](0),A(b["$include?"](D))||d.$raise(f("RangeError"),d.name+": max value ("+D+") is not covered: "+b),d}),p(t,"$assert_no_gap_or_overlap_in_ranges",function(k){return B(k,"each_cons",[2],function D(b,T){var G,W,c=null==D.$$s?this:D.$$s,R=z,o=z;return null==c.name&&(c.name=z),null==b&&(b=z),null==T&&(T=z),R=b["$[]"](0),o=T["$[]"](0),G=R.$max(),W=S(G,1),A(o["$include?"](G))&&c.$raise(f("RangeError"),c.name+": Range overlap: "+R+" and "+o),A(o["$include?"](W))?z:c.$raise(f("RangeError"),c.name+": Range gap: "+R+" and "+o)},{$$s:this}),this})},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(e){var z,I,v,f,N,L,k,q,X,J,j=e.module,M=e.klass,l=e.send,B=e.def,A=e.rb_minus,p=e.return_ivar,g=[],C=e.nil,S=e.$$$;return z=g,I=J=[j(g[0],"BCDice")].concat(z),v=X=[j(J[0],"DiceTable")].concat(I),f=q=[M(X[0],null,"SaiFicSkillTable")].concat(v),L=[N=M(q[0],null,"Category")].concat(f),k=e.$r(L),B(N,"$initialize",function(D,b,T,c){var R=this;return R.name=D,R.skills=l(b.$map(),"with_index",[2],function(G,W){return null==G&&(G=C),null==W&&(W=C),S(k("SaiFicSkillTable"),"Skill").$new(D,G,T,W,c)}),R.dice=T}),B(N,"$roll",function(D){return this.$skills()["$[]"](A(D.$roll_sum(2,6),2))}),B(N,"$to_s",p("name")),N.$attr_reader("name","dice","skills")},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(e){var C,Y,X,q,t,s,F,H,j=e.module,M=e.klass,l=e.def,B=e.hash2,A=[],p=e.nil;return C=A,Y=H=[j(A[0],"BCDice")].concat(C),X=F=[j(H[0],"DiceTable")].concat(Y),s=[M(F[0],null,"SaiFicSkillTable")].concat(X),(t=(q=M(s[0],null,"Skill")).$$prototype).s_format=t.category_dice=t.row_dice=t.category_name=t.name=p,l(q,"$initialize",function(f,N,L,k,d){var D=this;return D.category_name=f,D.name=N,D.category_dice=L,D.row_dice=k,D.s_format=d}),l(q,"$to_s",function(){var f=this;return f.$format(f.s_format,B(["category_dice","row_dice","category_name","skill_name"],{category_dice:f.category_dice,row_dice:f.row_dice,category_name:f.category_name,skill_name:f.name}))}),q.$attr_reader("category_name","name","category_dice","row_dice")},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(e){var s,t,k,d,D,b,T,f,i,j=e.module,M=e.klass,l=e.ensure_kwargs,B=e.hash2,A=e.send,g=e.defs,C=e.const_set,S=e.to_ary,H=e.def,z=e.truthy,Y=e.rb_minus,J=e.rb_plus,F=e.top,I=[],w=e.nil,X=e.$$$;return F.$require("bcdice/dice_table/sai_fic_skill_table/category"),F.$require("bcdice/dice_table/sai_fic_skill_table/skill"),s=I,t=i=[j(I[0],"BCDice")].concat(s),k=f=[j(i[0],"DiceTable")].concat(t),D=[d=M(f[0],null,"SaiFicSkillTable")].concat(k),b=e.$r(D),(T=d.$$prototype).rtt=T.rtt_format=T.rct=T.rct_format=T.rttn=T.rttn_format=T.categories=w,g(d,"$from_i18n",function(R,o,G){var W,_,$,n,u=w;return null==(W=(G=l(G)).$$smap.rtt)&&(W=w),null==(_=G.$$smap.rct)&&(_=w),null==($=G.$$smap.rttn)&&($=w),n=(u=b("I18n").$t("RTT",B(["locale","raise","default"],{locale:o,raise:!1,default:B([],{})})).$merge(b("I18n").$t(R,B(["locale","raise"],{locale:o,raise:!0}))))["$[]"]("items"),u=A(u,"select",[],function(E,x){return null==E&&(E=w),null==x&&(x=w),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](E)}),this.$new(n,e.to_hash(u).$merge(B(["rtt","rct","rttn"],{rtt:W,rct:_,rttn:$})))},-3),C(D[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),C(D[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),C(D[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),C(D[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),H(d,"$initialize",function(R,o){var G,W,_,$,h,a,u,n=this;return null==(G=(o=l(o)).$$smap.rtt)&&(G=w),null==(W=o.$$smap.rct)&&(W=w),null==(_=o.$$smap.rttn)&&(_=w),null==($=o.$$smap.rtt_format)&&($=b("DEFAULT_RTT")),null==(h=o.$$smap.rct_format)&&(h=b("DEFAULT_RCT")),null==(a=o.$$smap.rttn_format)&&(a=b("DEFAULT_RTTN")),null==(u=o.$$smap.s_format)&&(u=b("DEFAULT_S")),n.categories=A(R.$map(),"with_index",[1],function(E,x){var U,ee,K;return null==E&&(E=w),null==x&&(x=w),ee=null==(U=S(E))[0]?w:U[0],K=null==U[1]?w:U[1],X(b("SaiFicSkillTable"),"Category").$new(ee,K,x,u)},{$$has_top_level_mlhs_arg:!0}),n.rtt=G,n.rct=W,n.rttn=_.$to_a(),n.rtt_format=$,n.rct_format=h,n.rttn_format=a},-2),C(D[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),d.$attr_reader("categories"),H(d,"$roll_command",function(R,o){var W,G=this,_=w,$=w;return z(["RTT",G.rtt]["$include?"](W=o))?G.$format_skill(G.rtt_format,G.$roll_skill(R)):z(["RCT",G.rct]["$include?"](W))?(_=G.$roll_category(R),G.$format(G.rct_format,B(["category_dice","category_name"],{category_dice:_.$dice(),category_name:_.$name()}))):z($=b("RTTN").$index(W))||z($=G.rttn.$index(W))?G.$format_skill(G.rttn_format,G.categories["$[]"]($).$roll(R)):w}),H(d,"$roll_category",function(R){return this.categories["$[]"](Y(R.$roll_once(6),1))}),H(d,"$roll_skill",function(R){return this.$roll_category(R).$roll(R)}),H(d,"$prefixes",function(){var R=this;return J(["RTT[1-6]?","RCT",R.rtt,R.rct],R.rttn).$compact()}),d.$private(),H(d,"$format_skill",function(R,o){return this.$format(R,B(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:o.$category_dice(),row_dice:o.$row_dice(),category_name:o.$category_name(),skill_name:o.$name(),text:o.$to_s()}))})},Opal.modules["bcdice/dice_table/table"]=function(e){var z,I,v,i,q,t,r,X,J,j=e.module,M=e.klass,l=e.hash2,B=e.defs,A=e.truthy,p=e.def,g=e.rb_minus,C=[],S=e.nil;return z=C,I=J=[j(C[0],"BCDice")].concat(z),v=X=[j(J[0],"DiceTable")].concat(I),q=[i=M(X[0],null,"Table")].concat(v),t=e.$r(q),(r=i.$$prototype).times=r.sides=r.name=r.items=S,B(i,"$from_i18n",function(N,L){var d=S;return d=t("I18n").$t(N,l(["locale"],{locale:L})),this.$new(d["$[]"]("name"),d["$[]"]("type"),d["$[]"]("items"))}),p(i,"$initialize",function(N,L,k){var d=this,D=S;return d.name=N,d.items=k.$freeze(),D=/(\d+)D(\d+)/i.$match(L),A(D)||d.$raise(t("ArgumentError"),"Unexpected table type: "+L),d.times=D["$[]"](1).$to_i(),d.sides=D["$[]"](2).$to_i()}),p(i,"$roll",function(N){var k,L=this;return k=N.$roll_sum(L.times,L.sides),L.$choice(k)}),p(i,"$choice",function(N){var k,L=this;return k=g(N,L.times),t("RollResult").$new(L.name,N,L.items["$[]"](k))})},Opal.modules["bcdice/dice_table"]=function(e){var j=e.top;return j.$require("bcdice/dice_table/roll_result"),j.$require("bcdice/dice_table/chain_table"),j.$require("bcdice/dice_table/d66_grid_table"),j.$require("bcdice/dice_table/d66_half_grid_table"),j.$require("bcdice/dice_table/d66_one_third_table"),j.$require("bcdice/dice_table/d66_left_range_table"),j.$require("bcdice/dice_table/d66_parity_table"),j.$require("bcdice/dice_table/d66_range_table"),j.$require("bcdice/dice_table/d66_table"),j.$require("bcdice/dice_table/range_table"),j.$require("bcdice/dice_table/sai_fic_skill_table"),j.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(e){var p,H,Y,C,j=e.module,M=e.const_set,l=[];return p=l,H=C=[j(l[0],"BCDice")].concat(p),Y=[j(C[0],"D66SortType")].concat(H),M(Y[0],"NO_SORT","no_sort"),M(Y[0],"ASC","asc"),M(Y[0],"DESC","desc"),function(S,H){var Y=[j(S,"RoundType")].concat(H);return M(Y[0],"CEIL","ceil"),M(Y[0],"FLOOR","floor"),M(Y[0],"ROUND","round")}(C[0],C)},Opal.modules["bcdice/translate"]=function(e){var H,F,I,w,X,Y,j=e.module,M=e.ensure_kwargs,l=e.kwrestargs,A=e.hash2,p=e.def,g=[],C=e.nil;return H=g,F=Y=[j(g[0],"BCDice")].concat(H),w=[I=j(Y[0],"Translate")].concat(F),X=e.$r(w),p(I,"$translate",function(s,v){var i,q=this;return null==q.locale&&(q.locale=C),v=M(v),i=l(v,{}),X("I18n").$translate(s,A(["locale","raise"],{locale:q.locale,raise:!0}).$merge(e.to_hash(i)))},-2)},Opal.modules["bcdice/result"]=function(e){var I,Q,w,H,Y,M=e.klass,l=e.send,B=e.def,A=e.return_val,p=e.return_ivar,g=[],C=e.nil;return H=g,I=Y=[(0,e.module)(g[0],"BCDice")].concat(H),[w=M(Y[0],null,"Result")].concat(I),B(Q=e.get_singleton_class(w),"$success",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),l(r,"success=",f=[!0]),f[f.length-1]})}),B(Q,"$failure",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),l(r,"failure=",f=[!0]),f[f.length-1]})}),B(Q,"$critical",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),r["$critical="](!0),l(r,"success=",f=[!0]),f[f.length-1]})}),B(Q,"$fumble",function(i){return l(this.$new(),"tap",[],function(r){var f;return null==r&&(r=C),r["$text="](i),r["$fumble="](!0),l(r,"failure=",f=[!0]),f[f.length-1]})}),B(Q,"$nothing",A("nothing")),B(w,"$initialize",function(s){var v=this;return null==s&&(s=C),v.text=s,v.rands=C,v.detailed_rands=C,v.secret=!1,v.success=!1,v.failure=!1,v.critical=!1,v.fumble=!1},-1),w.$attr_accessor("text","rands","detailed_rands"),w.$attr_writer("secret","success","failure","critical","fumble"),B(w,"$secret?",p("secret")),B(w,"$success?",p("success")),B(w,"$failure?",p("failure")),B(w,"$critical?",p("critical")),B(w,"$fumble?",p("fumble")),B(w,"$condition=",function(s){return this.success=s,this.failure=s["$!"]()})},Opal.modules["racc/parser"]=function(e){var N,k,d,j=e.module,M=e.klass,l=e.truthy,B=e.const_set,A=e.defs,p=e.gvars,g=e.rb_lt,C=e.def,S=e.to_ary,H=e.send,z=e.neqeq,Y=e.rb_plus,J=e.eqeq,F=e.rb_ge,I=e.rb_gt,w=e.rb_minus,X=e.rb_le,Q=e.rb_times,s=e.assign_ivar_val,i=[],q=e.$r(i),t=e.nil,r=e.$$$;return N=i,k=[j(i[0],"Racc")].concat(N),d=e.$r(k),M(k[0],d("StandardError"),"ParseError"),l(r("::","ParseError","skip_raise")?"constant":t)||B(i[0],"ParseError",r(q("Racc"),"ParseError")),function(f,N){var c,R,o,G,W,d=[j(f,"Racc")].concat(N),D=e.$r(d);return l(D("Racc_No_Extensions","skip_raise")?"constant":t)||B(d[0],"Racc_No_Extensions",!1),c=d,o=[R=M(d[0],null,"Parser")].concat(c),G=e.$r(o),(W=R.$$prototype).yydebug=W.racc_debug_out=W.racc_error_status=W.racc_t=W.racc_vstack=W.racc_val=W.racc_state=W.racc_tstack=t,B(o[0],"Racc_Runtime_Version","1.4.6"),B(o[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),B(o[0],"Racc_Runtime_Core_Version_R","1.4.6"),B(o[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),B(o[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),B(o[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),B(o[0],"Racc_Runtime_Core_Version",G("Racc_Runtime_Core_Version_R")),B(o[0],"Racc_Runtime_Core_Revision",G("Racc_Runtime_Core_Revision_R")),B(o[0],"Racc_Runtime_Type","ruby"),A(G("Parser"),"$racc_runtime_type",function(){return G("Racc_Runtime_Type")}),C(R,"$_racc_setup",function(){var $,h,a=this,u=t,n=t;return null==p.stderr&&(p.stderr=t),l(r(a.$class(),"Racc_debug_parser"))||(a.yydebug=!1),l(null!=($=a.yydebug)&&$!==t?"instance-variable":t)||(a.yydebug=!1),l(a.yydebug)&&(l(null!=(h=a.racc_debug_out)&&h!==t?"instance-variable":t)||(a.racc_debug_out=p.stderr),a.racc_debug_out=l(u=a.racc_debug_out)?u:p.stderr),n=r(a.$class(),"Racc_arg"),l(g(n.$size(),14))&&n["$[]="](13,!0),n}),C(R,"$_racc_init_sysvars",function(){var $=this;return $.racc_state=[0],$.racc_tstack=[],$.racc_vstack=[],$.racc_t=t,$.racc_val=t,$.racc_read_next=!0,$.racc_user_yyerror=!1,$.racc_error_status=0}),C(R,"$do_parse",function(){return this.$__send__(G("Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)}),C(R,"$next_token",function(){return this.$raise(G("NotImplementedError"),this.$class()+"#next_token is not defined")}),C(R,"$_racc_do_parse_rb",function($,h){var a,n=this,y=t,E=t,x=t,U=t,ee=t,K=t,O=t,te=t;return a=S($),y=null==a[0]?t:a[0],E=null==a[1]?t:a[1],x=null==a[2]?t:a[2],U=null==a[3]?t:a[3],ee=null==a[10]?t:a[10],n.$_racc_init_sysvars(),K=O=te=t,H(n,"catch",["racc_end_parse"],function ne(){var ie,V,m=null==ne.$$s?this:ne.$$s,re=t;for(null==m.racc_state&&(m.racc_state=t),null==m.racc_read_next&&(m.racc_read_next=t),null==m.racc_t&&(m.racc_t=t),null==m.yydebug&&(m.yydebug=t),null==m.racc_val&&(m.racc_val=t);l(!0);)for(l(te=U["$[]"](m.racc_state["$[]"](-1)))?(l(m.racc_read_next)&&z(m.racc_t,0)&&(V=m.$next_token(),ie=S(V),K=null==ie[0]?t:ie[0],m.racc_val=null==ie[1]?t:ie[1],m.racc_t=l(K)?l(re=ee["$[]"](K))?re:1:0,l(m.yydebug)&&m.$racc_read_token(m.racc_t,K,m.racc_val),m.racc_read_next=!1),te=Y(te,m.racc_t),l(F(te,0))&&l(O=y["$[]"](te))&&J(E["$[]"](te),m.racc_state["$[]"](-1))||(O=x["$[]"](m.racc_state["$[]"](-1)))):O=x["$[]"](m.racc_state["$[]"](-1));l(O=m.$_racc_evalact(O,$)););},{$$s:n})}),C(R,"$yyparse",function($,h){return this.$__send__(G("Racc_YY_Parse_Method"),$,h,this.$_racc_setup(),!0)}),C(R,"$_racc_yyparse_rb",function($,h,a,u){var n,E=this,x=t,U=t,Z=t,ee=t,O=t,te=t,ne=t;return n=S(a),x=null==n[0]?t:n[0],U=null==n[1]?t:n[1],Z=null==n[2]?t:n[2],ee=null==n[3]?t:n[3],O=null==n[10]?t:n[10],E.$_racc_init_sysvars(),te=t,ne=t,H(E,"catch",["racc_end_parse"],function ie(){var V=null==ie.$$s?this:ie.$$s;for(null==V.racc_state&&(V.racc_state=t);!l(ne=ee["$[]"](V.racc_state["$[]"](-1)));)for(;l(te=V.$_racc_evalact(Z["$[]"](V.racc_state["$[]"](-1)),a)););return H($,"__send__",[h],function m(re,$e){var P=null==m.$$s?this:m.$$s,se=t,ce=t;for(null==P.racc_t&&(P.racc_t=t),null==P.racc_state&&(P.racc_state=t),null==P.racc_read_next&&(P.racc_read_next=t),null==re&&(re=t),null==$e&&($e=t),P.racc_t=l(re)?l(se=O["$[]"](re))?se:1:0,P.racc_val=$e,P.racc_read_next=!1,ne=Y(ne,P.racc_t),l(F(ne,0))&&l(te=x["$[]"](ne))&&J(U["$[]"](ne),P.racc_state["$[]"](-1))||(te=Z["$[]"](P.racc_state["$[]"](-1)));l(te=P.$_racc_evalact(te,a)););for(;l(l(se=l(ce=(ne=ee["$[]"](P.racc_state["$[]"](-1)))["$!"]())?ce:P.racc_read_next["$!"]())?se:P.racc_t["$=="](0));)for(l(ne)&&l(ne=Y(ne,P.racc_t))&&l(F(ne,0))&&l(te=x["$[]"](ne))&&J(U["$[]"](ne),P.racc_state["$[]"](-1))||(te=Z["$[]"](P.racc_state["$[]"](-1)));l(te=P.$_racc_evalact(te,a)););},{$$s:V})},{$$s:E})}),C(R,"$_racc_evalact",function($,h){var a,Z,n=this,y=t,E=t,U=t,ee=t,K=t,O=t;if(y=null==(a=S(h))[0]?t:a[0],E=null==a[1]?t:a[1],U=null==a[3]?t:a[3],Z=null==a[11]?t:a[11],ee=null==a[12]?t:a[12],l(I($,0))&&l(g($,Z)))l(I(n.racc_error_status,0))&&(J(n.racc_t,1)||(n.racc_error_status=w(n.racc_error_status,1))),n.racc_vstack.$push(n.racc_val),n.racc_state.$push($),n.racc_read_next=!0,l(n.yydebug)&&(n.racc_tstack.$push(n.racc_t),n.$racc_shift(n.racc_t,n.racc_tstack,n.racc_vstack));else if(l(g($,0))&&l(I($,ee["$-@"]()))){if(K=H(n,"catch",["racc_jump"],function te(){var ne=null==te.$$s?this:te.$$s;return null==ne.racc_state&&(ne.racc_state=t),ne.racc_state.$push(ne.$_racc_do_reduce(h,$)),!1},{$$s:n}),l(K))switch(K.valueOf()){case 1:return n.racc_user_yyerror=!0,ee["$-@"]();case 2:return Z;default:n.$raise("[Racc Bug] unknown jump code")}}else if(J($,Z))l(n.yydebug)&&n.$racc_accept(),n.$throw("racc_end_parse",n.racc_vstack["$[]"](0));else{if(J($,ee["$-@"]())){switch(n.racc_error_status.valueOf()){case 0:l(h["$[]"](21))||n.$on_error(n.racc_t,n.racc_val,n.racc_vstack);break;case 3:J(n.racc_t,0)&&n.$throw("racc_end_parse",t),n.racc_read_next=!0}for(n.racc_user_yyerror=!1,n.racc_error_status=3;l(!0)&&!(l(O=U["$[]"](n.racc_state["$[]"](-1)))&&(O=Y(O,1),l(F(O,0))&&l($=y["$[]"](O))&&J(E["$[]"](O),n.racc_state["$[]"](-1))));)l(X(n.racc_state.$size(),1))&&n.$throw("racc_end_parse",t),n.racc_state.$pop(),n.racc_vstack.$pop(),l(n.yydebug)&&(n.racc_tstack.$pop(),n.$racc_e_pop(n.racc_state,n.racc_tstack,n.racc_vstack));return $}n.$raise("[Racc Bug] unknown action "+$.$inspect())}return l(n.yydebug)&&n.$racc_next_state(n.racc_state["$[]"](-1),n.racc_state),t}),C(R,"$_racc_do_reduce",function($,h){var a,ee,O,re,$e,P,ue,n=this,E=t,x=t,U=t,Z=t,K=t,te=t,ne=t,ie=t,V=t,m=t,se=t,ce=t,ae=t;return E=null==(a=S($))[4]?t:a[4],x=null==a[5]?t:a[5],U=null==a[6]?t:a[6],Z=null==a[7]?t:a[7],ee=null==a[8]?t:a[8],K=null==a[9]?t:a[9],O=null==a[13]?t:a[13],te=n.racc_state,ne=n.racc_vstack,ie=n.racc_tstack,V=Q(h,-3),m=K["$[]"](V),re=K["$[]"](Y(V,1)),$e=K["$[]"](Y(V,2)),P=[],l(n.yydebug)&&(se=ie["$[]"](m["$-@"](),m)),ce=ne["$[]"](m["$-@"](),m),l(n.yydebug)&&ie["$[]="](m["$-@"](),m,P),ne["$[]="](m["$-@"](),m,P),te["$[]="](m["$-@"](),m,P),l(O)?ne.$push(n.$__send__($e,ce,ne,ce["$[]"](0))):ne.$push(n.$__send__($e,ce,ne)),ie.$push(re),l(n.yydebug)&&n.$racc_reduce(se,re,ie,ne),ue=w(re,ee),l(V=Z["$[]"](ue))&&(V=Y(V,te["$[]"](-1)),l(F(V,0))&&l(ae=E["$[]"](V))&&J(x["$[]"](V),ue))?ae:U["$[]"](ue)}),C(R,"$on_error",function($,h,a){var n,u=this;return u.$raise(G("ParseError"),u.$sprintf("\nparse error on value %s (%s)",h.$inspect(),l(n=u.$token_to_str($))?n:"?"))}),C(R,"$yyerror",function(){return this.$throw("racc_jump",1)}),C(R,"$yyaccept",function(){return this.$throw("racc_jump",2)}),C(R,"$yyerrok",s("racc_error_status",0)),C(R,"$racc_read_token",function($,h,a){var u=this;return u.racc_debug_out.$print("read    "),u.racc_debug_out.$print(h.$inspect(),"(",u.$racc_token2str($),") "),u.racc_debug_out.$puts(a.$inspect()),u.racc_debug_out.$puts()}),C(R,"$racc_shift",function($,h,a){var u=this;return u.racc_debug_out.$puts("shift   "+u.$racc_token2str($)),u.$racc_print_stacks(h,a),u.racc_debug_out.$puts()}),C(R,"$racc_reduce",function($,h,a,u){var n=this,y=t;return(y=n.racc_debug_out).$print("reduce "),l($["$empty?"]())?y.$print(" <none>"):H($,"each",[],function E(x){return null==x&&(x=t),y.$print(" ",(null==E.$$s?this:E.$$s).$racc_token2str(x))},{$$s:n}),y.$puts(" --\x3e "+n.$racc_token2str(h)),n.$racc_print_stacks(a,u),n.racc_debug_out.$puts()}),C(R,"$racc_accept",function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()}),C(R,"$racc_e_pop",function($,h,a){var u=this;return u.racc_debug_out.$puts("error recovering mode: pop token"),u.$racc_print_states($),u.$racc_print_stacks(h,a),u.racc_debug_out.$puts()}),C(R,"$racc_next_state",function($,h){var a=this;return a.racc_debug_out.$puts("goto    "+$),a.$racc_print_states(h),a.racc_debug_out.$puts()}),C(R,"$racc_print_stacks",function($,h){var u=t;return(u=this.racc_debug_out).$print("        ["),H($,"each_index",[],function n(y){return null==y&&(y=t),u.$print(" (",(null==n.$$s?this:n.$$s).$racc_token2str($["$[]"](y))," ",h["$[]"](y).$inspect(),")")},{$$s:this}),u.$puts(" ]")}),C(R,"$racc_print_states",function($){var a=t;return(a=this.racc_debug_out).$print("        ["),H($,"each",[],function(n){return null==n&&(n=t),a.$print(" ",n)}),a.$puts(" ]")}),C(R,"$racc_token2str",function($){var a;return l(a=r(this.$class(),"Racc_token_to_s_table")["$[]"]($))?a:this.$raise("[Racc Bug] can't convert token "+$+" to string")}),C(R,"$token_to_str",function($){return r(this.$class(),"Racc_token_to_s_table")["$[]"]($)})}(i[0],i)},Opal.modules["bcdice/arithmetic/node"]=function(e){var s,t,L,c,R,d,D,f,i,j=e.module,M=e.klass,l=e.def,B=e.thrower,A=e.return_ivar,p=e.send2,g=e.find_super,C=e.eqeq,S=e.const_set,H=e.eqeqeq,z=e.rb_divide,Y=e.truthy,J=e.assign_ivar,F=e.alias,I=[],w=e.nil,X=e.$$$;return s=I,t=i=[j(I[0],"BCDice")].concat(s),L=f=[j(i[0],"Arithmetic")].concat(t),d=[j(f[0],"Node")].concat(L),D=e.$r(d),(R=(c=M(d[0],null,"BinaryOp")).$$prototype).lhs=R.rhs=R.op=w,l(c,"$initialize",function(G,W,_){var $=this;return $.lhs=G,$.op=W,$.rhs=_}),l(c,"$eval",function(G){try{B("eval_return");var h,_=this,$=w;return $=_.lhs.$eval(G),h=_.rhs.$eval(G),$.$send(_.op,h)}catch(a){if(a===e.t_eval_return)return a.$v;throw a}}),l(c,"$output",function(){var G=this;return""+G.lhs.$output()+G.op+G.rhs.$output()}),l(c,"$s_exp",function(){var G=this;return"("+G.$op_for_s_exp()+" "+G.lhs.$s_exp()+" "+G.rhs.$s_exp()+")"}),l(c,"$op_for_s_exp",A("op")),function(b,T,c){var R=M(b,T,"DivideBase"),o=[R].concat(c),G=e.$r(o),W=R.$$prototype;W.lhs=W.rhs=W.op=w,l(R,"$initialize",function _($,h){return _.$$p=null,p(this,g(this,"initialize",_,!1,!0),"initialize",[$,"/",h],null)}),l(R,"$eval",function($){try{B("eval_return");var u,n,a=this;return u=a.lhs.$eval($),n=a.rhs.$eval($),C(n,0)&&a.$raise(G("ZeroDivisionError")),a.$divide_and_round(u,n,$)}catch(y){if(y===e.t_eval_return)return y.$v;throw y}}),l(R,"$output",function _(){var $=_.$$p||w,h=this;return _.$$p=null,""+p(h,g(h,"output",_,!1,!0),"output",[],$)+h.$rounding_method()}),R.$private(),l(R,"$rounding_method",function(){return X(this.$class(),"ROUNDING_METHOD")}),l(R,"$op_for_s_exp",function(){return""+this.op+this.$rounding_method()}),l(R,"$divide_and_round",function($,h,a){return this.$raise(G("NotImplementedError"))})}(d[0],D("BinaryOp"),d),function(b,T,c){var R=M(b,T,"DivideWithGameSystemDefault"),o=[R].concat(c),G=e.$r(o);S(o[0],"ROUNDING_METHOD",""),R.$private(),l(R,"$divide_and_round",function(_,$,h){var a,u=w;return H(X(G("RoundType"),"CEIL"),a=h)?z(_.$to_f(),$).$ceil():H(X(G("RoundType"),"ROUND"),a)?(u=z(_.$to_f(),$),Y(u["$negative?"]())?u.$abs().$round()["$-@"]():u.$round()):z(_,$).$floor()})}(d[0],D("DivideBase"),d),function(b,T,c){var R=M(b,T,"DivideWithCeil"),o=[R].concat(c);S(o[0],"ROUNDING_METHOD","C"),R.$private(),l(R,"$divide_and_round",function(W,_,$){return z(W.$to_f(),_).$ceil()})}(d[0],D("DivideBase"),d),function(b,T,c){var R=M(b,T,"DivideWithRound"),o=[R].concat(c);S(o[0],"ROUNDING_METHOD","R"),R.$private(),l(R,"$divide_and_round",function(W,_,$){var h=w;return h=z(W.$to_f(),_),Y(h["$negative?"]())?h.$abs().$round()["$-@"]():h.$round()})}(d[0],D("DivideBase"),d),function(b,T,c){var R=M(b,T,"DivideWithFloor"),o=[R].concat(c);S(o[0],"ROUNDING_METHOD","F"),R.$private(),l(R,"$divide_and_round",function(W,_,$){return z(W,_).$floor()})}(d[0],D("DivideBase"),d),function(b,T){var c=M(b,null,"Negative");c.$$prototype.body=w,l(c,"$initialize",J("body")),l(c,"$eval",function(G){try{return B("eval_return"),this.body.$eval(G)["$-@"]()}catch($){if($===e.t_eval_return)return $.$v;throw $}}),l(c,"$output",function(){return"-"+this.body.$output()}),l(c,"$s_exp",function(){return"(- "+this.body.$s_exp()+")"})}(d[0]),function(b,T){var c=M(b,null,"Parenthesis");c.$$prototype.expr=w,l(c,"$initialize",J("expr")),l(c,"$eval",function(G){try{return B("eval_return"),this.expr.$eval(G)}catch($){if($===e.t_eval_return)return $.$v;throw $}}),l(c,"$output",function(){return"("+this.expr.$output()+")"}),l(c,"$s_exp",function(){return"(Parenthesis "+this.expr.$s_exp()+")"})}(d[0]),function(b,T){var c=M(b,null,"Number");return c.$$prototype.value=w,l(c,"$initialize",J("value")),l(c,"$eval",A("value")),l(c,"$output",function(){return this.value.$to_s()}),F(c,"s_exp","output")}(d[0])},Opal.modules.strscan=function(e){var J,F,I,w,X,M=e.def,l=e.truthy,B=e.eqeqeq,A=e.Opal,p=e.return_ivar,g=e.send,C=e.alias,S=[],H=e.nil;return J=S,I=[F=(0,e.klass)(S[0],null,"StringScanner")].concat(J),w=e.$r(I),(X=F.$$prototype).pos=X.string=X.working=X.matched=X.prev_pos=X.match=H,F.$attr_reader("pos","matched"),M(F,"$initialize",function(s){var v=this;return v.string=s,v.pos=0,v.matched=H,v.working=s,v.match=[]}),F.$attr_reader("string"),M(F,"$beginning_of_line?",function(){var s=this;return 0===s.pos||"\n"===s.string.charAt(s.pos-1)}),M(F,"$scan",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);return null==i?v.matched=H:(v.prev_pos=v.pos,v.pos+=i[0].length,v.working=v.working.substring(i[0].length),v.matched=i[0],v.match=i,i[0])}),M(F,"$scan_until",function(s){var v=this;s=v.$anchor(s);for(var i=v.working,q=0;i.length!=q;++q){var t=s.exec(i.substr(q));if(null!==t){var r=q+t[0].length,f=i.substr(0,r);return v.matched=t[0],v.match=t,v.prev_pos=v.pos+q,v.pos+=r,v.working=i.substr(r),f}}return v.matched=H}),M(F,"$[]",function(s){var i;if(l(this.match["$empty?"]()))return H;B(w("Symbol"),i=s)?s=s.$to_s():B(w("String"),i)||(s=A["$coerce_to!"](s,w("Integer"),"to_int"));var q=this.match;return s<0&&(s+=q.length),s<0||s>=q.length||null==q[s]?H:q[s]}),M(F,"$check",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);return v.matched=null==i?H:i[0]}),M(F,"$check_until",function(s){var v=this,i=v.prev_pos,q=v.pos,t=v.working,r=v.$scan_until(s);return v.prev_pos=i,v.pos=q,v.working=t,r}),M(F,"$peek",function(s){return this.working.substring(0,s)}),M(F,"$eos?",function(){return 0===this.working.length}),M(F,"$exist?",function(s){var i=s.exec(this.working);return null==i?H:0==i.index?0:i.index+1}),M(F,"$skip",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);if(null==i)return v.match=[],v.matched=H;var q=i[0],t=q.length;return v.matched=q,v.match=i,v.prev_pos=v.pos,v.pos+=t,v.working=v.working.substring(t),t}),M(F,"$skip_until",function(s){var i=this.$scan_until(s);return i===H?H:(this.matched=i.substr(-1),i.length)}),M(F,"$get_byte",function(){var s=this,v=H;return s.pos<s.string.length?(s.prev_pos=s.pos,s.pos+=1,v=s.matched=s.working.substring(0,1),s.working=s.working.substring(1)):s.matched=H,v}),M(F,"$match?",function(s){var v=this,i=(s=v.$anchor(s)).exec(v.working);return null==i?H:(v.prev_pos=v.pos,i[0].length)}),M(F,"$pos=",function(s){var v=this;return s<0&&(s+=v.string.$length()),v.pos=s,v.working=v.string.slice(s)}),M(F,"$matched_size",function(){return this.matched===H?H:this.matched.length}),M(F,"$post_match",function(){var s=this;return s.matched===H?H:s.string.substr(s.pos)}),M(F,"$pre_match",function(){var s=this;return s.matched===H?H:s.string.substr(0,s.prev_pos)}),M(F,"$reset",function(){var s=this;return s.working=s.string,s.matched=H,s.pos=0}),M(F,"$rest",p("working")),M(F,"$rest?",function(){return 0!==this.working.length}),M(F,"$rest_size",function(){return this.$rest().$size()}),M(F,"$terminate",function(){var s,v=this;return v.match=H,s=[v.string.$length()],g(v,"pos=",s),s[s.length-1]}),M(F,"$unscan",function(){var s=this;return s.pos=s.prev_pos,s.prev_pos=H,s.match=H,s}),C(F,"bol?","beginning_of_line?"),C(F,"getch","get_byte"),F.$private(),M(F,"$anchor",function(s){var v=s.toString().match(/\/([^\/]+)$/);return v=v?v[1]:void 0,new RegExp("^(?:"+s.source+")",v)})},Opal.modules["bcdice/normalize"]=function(e){var C,Y,H,j=e.module,M=e.eqeqeq,l=e.def,B=e.eqeq,A=[],p=e.nil;return C=A,H=[j(A[0],"BCDice")].concat(C),(Y=j(H[0],"Normalize")).$module_function(),l(Y,"$comparison_operator",function(F){var I;return M(/<=|=</,I=F)?"<=":M(/>=|=>/,I)?">=":M(/<>|!=|=!/,I)?"!=":M(/</,I)?"<":M(/>/,I)?">":M(/=/,I)?"==":p}),l(Y,"$target_number",function(F){return B(F,"?")?F:F.$to_i()})},Opal.modules["bcdice/command/lexer"]=function(e){var J,X,q,t,r,f,N,s,I,j=e.module,M=e.klass,l=e.const_set,B=e.hash2,A=e.truthy,p=e.send,g=e.def,C=e.thrower,S=e.top,H=[],z=e.nil;return S.$require("strscan"),S.$require("bcdice/normalize"),J=H,X=I=[j(H[0],"BCDice")].concat(J),q=s=[j(I[0],"Command")].concat(X),r=[t=M(s[0],null,"Lexer")].concat(q),f=e.$r(r),(N=t.$$prototype).scanner=N.notations=z,l(r[0],"SYMBOLS",B(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),g(t,"$initialize",function(k,d){var D,b,c;return k=A(c=(D=(b=k)===z||null==b?z:b.$split(" ",2))===z||null==D?z:D.$first())?c:"",this.scanner=f("StringScanner").$new(k),this.notations=p(d,"map",[],function(o){return null==o&&(o=z),A(o["$is_a?"](f("String")))?f("Regexp").$new(o):o})}),g(t,"$next_token",function(){try{var k=C("return"),d=this,D=z,b=z,c=z,R=z;return A(d.scanner["$eos?"]())?[!1,"$"]:(p(d.notations,"each",[],function o(G){var _,W=null==o.$$s?this:o.$$s;if(null==W.scanner&&(W.scanner=z),null==G&&(G=z),_=W.scanner.$scan(G),!A(_))return z;k.$throw(["NOTATION",_])},{$$s:d,$$ret:k}),A(D=d.scanner.$scan(/\d+/))?["NUMBER",D.$to_i()]:A(b=d.scanner.$scan(/[<>!=]+/))?(b=f("Normalize").$comparison_operator(b),[A(b)?"CMP_OP":"ILLEGAL",b]):(c=d.scanner.$getch().$upcase(),[A(R=f("SYMBOLS")["$[]"](c))?R:c.$to_sym(),c]))}catch(o){if(o===k)return o.$v;throw o}}),g(t,"$source",function(){return this.scanner.$string()})},Opal.modules["bcdice/command/parsed"]=function(e){var S,J,Q,s,v,i,q,I,z,j=e.module,M=e.klass,l=e.def,B=e.return_ivar,A=e.truthy,p=[],g=e.nil;return S=p,J=z=[j(p[0],"BCDice")].concat(S),Q=I=[j(z[0],"Command")].concat(J),v=[s=M(I[0],null,"Parsed")].concat(Q),i=e.$r(v),(q=s.$$prototype).critical=q.fumble=q.dollar=q.modify_number=q.question_target=q.target_number=q.prefix_number=q.command=q.suffix_number=q.cmp_op=g,s.$attr_accessor("command"),s.$attr_accessor("prefix_number"),s.$attr_accessor("suffix_number"),s.$attr_accessor("critical"),s.$attr_accessor("fumble"),s.$attr_accessor("dollar"),s.$attr_accessor("modify_number"),s.$attr_accessor("cmp_op"),s.$attr_accessor("target_number"),s.$attr_writer("question_target"),l(s,"$initialize",function(){var r=this;return r.prefix_number=g,r.suffix_number=g,r.critical=g,r.fumble=g,r.dollar=g,r.cmp_op=g,r.target_number=g,r.question_target=!1}),l(s,"$question_target?",B("question_target")),l(s,"$to_s",function(r){var f=this,N=g,L=g,k=g,d=g,D=g;switch(null==r&&(r="after_command"),N=A(f.critical)?"@"+f.critical:g,L=A(f.fumble)?"#"+f.fumble:g,k=A(f.dollar)?"$"+f.dollar:g,d=i("Format").$modifier(f.modify_number),D=A(f.question_target)?"?":f.target_number,r.valueOf()){case"after_command":return[f.prefix_number,f.command,f.suffix_number,N,L,k,d,f.cmp_op,D].$join();case"after_modify_number":return[f.prefix_number,f.command,f.suffix_number,d,N,L,k,f.cmp_op,D].$join();case"after_target_number":return[f.prefix_number,f.command,f.suffix_number,d,f.cmp_op,D,N,L,k].$join();default:return g}},-1)},Opal.modules["bcdice/command/parser"]=function(e){var r,k,R,h,a,u,n,y,E,x,U,Z,O,o,_,$,ie,D,b,N,j=e.klass,M=e.module,l=e.slice,B=e.extract_kwargs,A=e.ensure_kwargs,p=e.get_kwarg,g=e.send2,C=e.find_super,S=e.def,H=e.send,z=e.eqeq,Y=e.thrower,J=e.hash,F=e.const_set,I=e.truthy,w=e.to_ary,X=e.hash2,Q=e.top,s=[],v=e.$r(s),i=e.nil,q=e.$$$;return Q.$require("racc/parser.rb"),Q.$require("bcdice/arithmetic/node"),Q.$require("bcdice/command/lexer"),Q.$require("bcdice/command/parsed"),j(q(v("BCDice"),"Command"),q(v("Racc"),"Parser"),"Parser"),r=s,k=N=[M(s[0],"BCDice")].concat(r),D=[M(N[0],"Command")].concat(k),b=e.$r(D),R=D,_=[o=j(D[0],q(b("Racc"),"Parser"),"Parser")].concat(R),$=e.$r(_),(ie=o.$$prototype).notations=ie.lexer=ie.modifier=ie.suffix_number=ie.prefix_number=ie.need_suffix_number=ie.need_prefix_number=ie.critical=ie.fumble=ie.dollar=ie.allowed_cmp_op=ie.question_target=i,S(o,"$initialize",function V(m,re){var $e,P,se,ce,ae=this;return V.$$p=null,$e=l(arguments),P=B($e),P=A(P),se=$e,ce=p(P,"round_type"),g(ae,C(ae,"initialize",V,!1,!0),"initialize",[],null),ae.notations=se,ae.round_type=ce,ae.prefix_number=!1,ae.suffix_number=!1,ae.need_prefix_number=!1,ae.need_suffix_number=!1,ae.modifier=!0,ae.critical=!1,ae.fumble=!1,ae.dollar=!1,ae.allowed_cmp_op=[i,">=",">","<=","<","==","!="],ae.question_target=!1},-2),S(o,"$disable_modifier",function(){return this.modifier=!1,this}),S(o,"$enable_prefix_number",function(){return this.prefix_number=!0,this}),S(o,"$enable_suffix_number",function(){return this.suffix_number=!0,this}),S(o,"$has_prefix_number",function(){var m=this;return m.prefix_number=!0,m.need_prefix_number=!0,m}),S(o,"$has_suffix_number",function(){var m=this;return m.suffix_number=!0,m.need_suffix_number=!0,m}),S(o,"$enable_critical",function(){return this.critical=!0,this}),S(o,"$enable_fumble",function(){return this.fumble=!0,this}),S(o,"$enable_dollar",function(){return this.dollar=!0,this}),S(o,"$restrict_cmp_op_to",function(m){var re;return re=l(arguments),this.allowed_cmp_op=re,this},-1),S(o,"$enable_question_target",function(){return this.question_target=!0,this}),S(o,"$parse",function(m){try{return this.lexer=$("Lexer").$new(m,this.notations),this.$do_parse()}catch($e){if(!e.rescue($e,[$("ParseError"),$("ZeroDivisionError")]))throw $e;try{return i}finally{e.pop_exception()}}}),o.$private(),S(o,"$parsed",function(m,re,$e,P){try{return Y("eval_return"),H($("Parsed").$new(),"tap",[],function ue(ae){var le,_e,de,ve,me,fe,be,oe=null==ue.$$s?this:ue.$$s;return null==oe.round_type&&(oe.round_type=i),null==ae&&(ae=i),ae["$command="](m["$[]"]("command")),ae["$prefix_number="]((le=m["$[]"]("prefix"))===i||null==le?i:le.$eval(oe.round_type)),ae["$suffix_number="]((_e=m["$[]"]("suffix"))===i||null==_e?i:_e.$eval(oe.round_type)),ae["$critical="]((de=re["$[]"]("critical"))===i||null==de?i:de.$eval(oe.round_type)),ae["$fumble="]((ve=re["$[]"]("fumble"))===i||null==ve?i:ve.$eval(oe.round_type)),ae["$dollar="]((me=re["$[]"]("dollar"))===i||null==me?i:me.$eval(oe.round_type)),ae["$modify_number="]($e.$eval(oe.round_type)),ae["$cmp_op="](P["$[]"]("cmp_op")),z(P["$[]"]("target"),"?")?(ae["$question_target="](!0),H(ae,"target_number=",fe=[0]),fe[fe.length-1]):(ae["$question_target="](!1),fe=[(be=P["$[]"]("target"),be===i||null==be?i:be.$eval(oe.round_type))],H(ae,"target_number=",fe),fe[fe.length-1])},{$$s:this})}catch(ue){if(ue===e.t_eval_return)return ue.$v;throw ue}}),S(o,"$next_token",function(){return this.lexer.$next_token()}),h=e.large_array_unpack("6,6,6,6,7,28,29,17,18,5,5,5,5,6,26,12,4,45,17,18,10,11,5,10,11,6,23,24,25,26,17,18,6,20,5,33,34,17,18,6,35,5,28,29,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,33,34,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,36,37,17,18,6,,5,,,17,18,6,,5,,,17,18,,,5,23,24,25,26,56,54,55,57"),a=e.large_array_unpack("0,4,26,12,1,21,21,26,26,0,4,26,12,5,21,3,0,26,5,5,8,8,5,2,2,10,8,8,8,8,10,10,11,7,10,14,14,11,11,17,14,11,9,9,17,17,18,,17,15,15,18,18,23,,18,30,30,23,23,24,,23,31,31,24,24,25,,24,44,44,25,25,28,,25,47,47,28,28,29,,28,48,48,29,29,33,,29,49,49,33,33,34,,33,50,50,34,34,36,,34,,,36,36,37,,36,,,37,37,,,37,27,27,27,27,52,52,52,52"),u=e.large_array_unpack("-2,4,16,-3,-1,11,,33,13,35,23,30,1,,28,40,,37,44,,,-2,,51,58,65,0,106,72,79,47,54,,86,93,,100,107,,,,,,,63,,,68,75,82,89,,120,,,,,"),n=e.large_array_unpack("-35,-35,-8,-35,-7,-35,-34,-35,-16,-8,-35,-35,-5,-6,-35,-21,-24,-35,-35,-32,58,-16,-3,-35,-35,-35,-35,-16,-35,-35,-12,-13,-4,-35,-35,-33,-35,-35,-30,-31,-1,-9,-10,-11,-17,-18,-2,-14,-15,-19,-20,-22,-25,-23,-26,-27,-28,-29"),y=e.large_array_unpack("30,31,38,39,14,8,1,22,41,42,43,9,27,2,53,,,21,47,48,40,51,52,49,50,44,46,3,,,,13,,,,,,,,32"),E=e.large_array_unpack("8,8,7,7,9,3,1,5,7,7,7,4,3,2,10,,,4,8,8,5,7,7,8,8,9,5,6,,,,6,,,,,,,,6"),x=[i,6,13,3,9,-1,27,-15,-10,-1,-38],U=[i,i,i,i,i,i,19,16,15,i,i],Z=e.large_array_unpack("0,0,racc_error,4,20,_reduce_1,4,20,_reduce_2,3,20,_reduce_3,3,21,_reduce_4,2,21,_reduce_5,2,21,_reduce_6,1,21,_reduce_7,0,22,_reduce_8,3,22,_reduce_9,3,22,_reduce_10,3,22,_reduce_11,2,23,_reduce_12,2,23,_reduce_13,3,23,_reduce_14,3,23,_reduce_15,0,24,_reduce_16,2,24,_reduce_17,2,24,_reduce_18,3,28,_reduce_19,3,28,_reduce_20,1,28,_reduce_none,3,27,_reduce_22,4,27,_reduce_23,1,27,_reduce_none,0,29,_reduce_25,1,29,_reduce_26,1,29,_reduce_27,1,29,_reduce_28,1,29,_reduce_29,2,26,_reduce_30,2,26,_reduce_31,1,26,_reduce_none,3,25,_reduce_33,1,25,_reduce_34"),O=J(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),F(_[0],"Racc_arg",[h,a,n,u,y,E,U,x,19,Z,O,58,35,!0]),I($("Ractor","skip_raise")?"constant":i)&&$("Ractor").$make_shareable($("Racc_arg")),F(_[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","notation","option","modifier","target","term","unary","mul","add","round_type"]),I($("Ractor","skip_raise")?"constant":i)&&$("Ractor").$make_shareable($("Racc_token_to_s_table")),F(_[0],"Racc_debug_parser",!1),S(o,"$_reduce_1",function(m,re,$e){var P;return I(this.modifier)||this.$raise($("ParseError")),P=w(m),this.$parsed(null==P[0]?i:P[0],null==P[1]?i:P[1],null==P[2]?i:P[2],null==P[3]?i:P[3])}),S(o,"$_reduce_2",function(m,re,$e){var P;return I(this.modifier)||this.$raise($("ParseError")),P=w(m),this.$parsed(null==P[0]?i:P[0],null==P[2]?i:P[2],null==P[1]?i:P[1],null==P[3]?i:P[3])}),S(o,"$_reduce_3",function(m,re,$e){var P,le;return le=null==(P=w(m))[2]?i:P[2],this.$parsed(null==P[0]?i:P[0],null==P[1]?i:P[1],q(q($("Arithmetic"),"Node"),"Number").$new(0),le)}),S(o,"$_reduce_4",function(m,re,$e){var P=this;return I(P.prefix_number)&&I(P.suffix_number)||P.$raise($("ParseError")),X(["command","prefix","suffix"],{command:m["$[]"](1),prefix:m["$[]"](0),suffix:m["$[]"](2)})}),S(o,"$_reduce_5",function(m,re,$e){var P=this;return I(P.prefix_number)||P.$raise($("ParseError")),I(P.need_suffix_number)&&P.$raise($("ParseError")),X(["command","prefix"],{command:m["$[]"](1),prefix:m["$[]"](0)})}),S(o,"$_reduce_6",function(m,re,$e){var P=this;return I(P.suffix_number)||P.$raise($("ParseError")),I(P.need_prefix_number)&&P.$raise($("ParseError")),X(["command","suffix"],{command:m["$[]"](0),suffix:m["$[]"](1)})}),S(o,"$_reduce_7",function(m,re,$e){var P=this;return(I(P.need_prefix_number)||I(P.need_suffix_number))&&P.$raise($("ParseError")),X(["command"],{command:m["$[]"](0)})}),S(o,"$_reduce_8",function(m,re,$e){return X([],{})}),S(o,"$_reduce_9",function(m,re,$e){var P,le,ue=i;return ue=null==(P=w(m))[0]?i:P[0],le=null==P[2]?i:P[2],I(this.critical)&&I(ue["$[]"]("critical")["$nil?"]())||this.$raise($("ParseError")),ue["$[]="]("critical",le),ue}),S(o,"$_reduce_10",function(m,re,$e){var P,le,ue=i;return ue=null==(P=w(m))[0]?i:P[0],le=null==P[2]?i:P[2],I(this.fumble)&&I(ue["$[]"]("fumble")["$nil?"]())||this.$raise($("ParseError")),ue["$[]="]("fumble",le),ue}),S(o,"$_reduce_11",function(m,re,$e){var P,le,ue=i;return ue=null==(P=w(m))[0]?i:P[0],le=null==P[2]?i:P[2],I(this.dollar)&&I(ue["$[]"]("dollar")["$nil?"]())||this.$raise($("ParseError")),ue["$[]="]("dollar",le),ue}),S(o,"$_reduce_12",function(m,re,$e){return m["$[]"](1)}),S(o,"$_reduce_13",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"Negative").$new(m["$[]"](1))}),S(o,"$_reduce_14",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"+",m["$[]"](2))}),S(o,"$_reduce_15",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"-",m["$[]"](2))}),S(o,"$_reduce_16",function(m,re,$e){return I(this.allowed_cmp_op["$include?"](i))||this.$raise($("ParseError")),X([],{})}),S(o,"$_reduce_17",function(m,re,$e){var P,ue,ae;return ae=null==(P=w(m))[1]?i:P[1],I(this.allowed_cmp_op["$include?"](ue=null==P[0]?i:P[0]))||this.$raise($("ParseError")),X(["cmp_op","target"],{cmp_op:ue,target:ae})}),S(o,"$_reduce_18",function(m,re,$e){var se,P=this;return se=m["$[]"](0),I(P.question_target)||P.$raise($("ParseError")),I(P.allowed_cmp_op["$include?"](se))||P.$raise($("ParseError")),X(["cmp_op","target"],{cmp_op:se,target:"?"})}),S(o,"$_reduce_19",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"+",m["$[]"](2))}),S(o,"$_reduce_20",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"-",m["$[]"](2))}),S(o,"$_reduce_22",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"BinaryOp").$new(m["$[]"](0),"*",m["$[]"](2))}),S(o,"$_reduce_23",function(m,re,$e){return m["$[]"](3).$new(m["$[]"](0),m["$[]"](2))}),S(o,"$_reduce_25",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"DivideWithGameSystemDefault")}),S(o,"$_reduce_26",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"DivideWithCeil")}),S(o,"$_reduce_27",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"DivideWithCeil")}),S(o,"$_reduce_28",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"DivideWithRound")}),S(o,"$_reduce_29",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"DivideWithFloor")}),S(o,"$_reduce_30",function(m,re,$e){return m["$[]"](1)}),S(o,"$_reduce_31",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"Negative").$new(m["$[]"](1))}),S(o,"$_reduce_33",function(m,re,$e){return m["$[]"](1)}),S(o,"$_reduce_34",function(m,re,$e){return q(q($("Arithmetic"),"Node"),"Number").$new(m["$[]"](0))}),S(o,"$_reduce_none",function(m,re,$e){return m["$[]"](0)})},Opal.modules["bcdice/deprecated/checker"]=function(e){var H,F,Q,s,v,i,w,Y,j=e.module,M=e.send,l=e.eqeqeq,B=e.truthy,A=e.def,p=e.return_val,g=[],C=e.nil;return H=g,F=Y=[j(g[0],"BCDice")].concat(H),Q=w=[j(Y[0],"Deprecated")].concat(F),v=[s=j(w[0],"Checker")].concat(Q),i=e.$r(v),s.$private(),A(s,"$check_result_legacy",function(t,r,f,N){var D,L=this,k=C,d=C,b=C,T=C;return k=M(r,"map",[],"sides".$to_proc()),D=(d=M(r,"map",[],"value".$to_proc())).$sum(),b=l([100],T=k)?L.$check_1D100(t,D,f,N):l([20],T)?L.$check_1D20(t,D,f,N):l([6,6],T)?L.$check_2D6(t,D,d,f,N):C,(B(b["$nil?"]())||B(b["$empty?"]()))&&(b=l([10],T=k.$uniq())?L.$check_nD10(t,D,d,f,N):l([6],T)?L.$check_nD6(t,D,d,f,N):C,B(b["$nil?"]())||B(b["$empty?"]()))?C:i("Result").$new(b.$delete_prefix(" \uff1e "))}),A(s,"$check_1D100",p(C)),A(s,"$check_1D20",p(C)),A(s,"$check_nD10",p(C)),A(s,"$check_2D6",p(C)),A(s,"$check_nD6",p(C))},Opal.modules["bcdice/base"]=function(e){var v,L,T,W,$,h,c,R,o,G,d,j=e.module,M=e.klass,l=e.slice,B=e.rb_plus,A=e.truthy,p=e.def,g=e.regexp,C=e.send,S=e.thrower,H=e.return_ivar,z=e.assign_ivar_val,Y=e.eqeqeq,J=e.eqeq,F=e.return_val,I=e.range,w=e.rb_minus,X=e.rb_divide,Q=e.rb_times,s=e.rb_ge,i=e.top,q=[],t=e.$r(q),r=e.nil,f=e.$$$;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),L=q,T=d=[j(q[0],"BCDice")].concat(L),R=[c=M(d[0],null,"Base")].concat(T),o=e.$r(R),(G=c.$$prototype).raw_input=G.randomizer=G.enabled_upcase_input=G.debug=r,$=[W=e.get_singleton_class(c)].concat(R),h=e.$r($),W.$attr_reader("prefixes"),p(W,"$register_prefix",function(u){var y,x,E=this;return null==E.prefixes&&(E.prefixes=r),y=l(arguments),E.prefixes=B(A(x=E.prefixes)?x:[],y.$flatten())},-1),p(W,"$register_prefix_from_super_class",function(){return this.$register_prefix(this.$superclass().$prefixes())}),p(W,"$prefixes_pattern",function(){var u=this,n=r;return null==u.prefixes_pattern&&(u.prefixes_pattern=r),null==u.prefixes&&(u.prefixes=r),u.prefixes_pattern=A(n=u.prefixes_pattern)?n:r,A(u.prefixes_pattern)?u.prefixes_pattern:(u.prefixes=A(n=u.prefixes)?n:[],u.prefixes.$freeze(),u.prefixes_pattern=(A(u.prefixes["$empty?"]())?/(?!)/:g(["^(S)?(",u.prefixes.$join("|"),")"],"i")).$freeze())}),p(W,"$command_pattern",function(){var u=this,n=r,y=r;return null==u.command_pattern&&(u.command_pattern=r),null==u.prefixes&&(u.prefixes=r),u.command_pattern=A(n=u.command_pattern)?n:r,A(u.command_pattern)?u.command_pattern:(u.prefixes=A(n=u.prefixes)?n:[],u.prefixes.$freeze(),y=B(C(f(h("CommonCommand"),"COMMANDS"),"map",[],function(x){return null==x&&(x=r),f(x,"PREFIX_PATTERN").$source()}),u.prefixes),u.command_pattern=g(["^S?(",y.$join("|"),")"],"i").$freeze())}),p(W,"$eval",function(u){try{return S("eval_return"),this.$new(u).$eval()}catch(E){if(E===e.t_eval_return)return E.$v;throw E}}),c.$include(o("Translate")),c.$include(f(o("Deprecated"),"Checker")),p(c,"$initialize",function(_){var $=this;return $.raw_input=_,$.sort_add_dice=!1,$.sort_barabara_dice=!1,$.d66_sort_type=f(o("D66SortType"),"NO_SORT"),$.enabled_d9=!1,$.round_type=f(o("RoundType"),"FLOOR"),$.sides_implicit_d=6,$.upper_dice_reroll_threshold=r,$.reroll_dice_reroll_threshold=r,$.default_cmp_op=r,$.default_target_number=r,$.enabled_upcase_input=!0,$.locale="ja_jp",$.randomizer=f(o("BCDice"),"Randomizer").$new(),$.debug=!1}),c.$attr_accessor("randomizer"),c.$attr_reader("d66_sort_type"),c.$attr_reader("round_type"),c.$attr_reader("sides_implicit_d"),c.$attr_reader("upper_dice_reroll_threshold"),c.$attr_reader("reroll_dice_reroll_threshold"),c.$attr_reader("default_cmp_op"),c.$attr_reader("default_target_number"),p(c,"$sort_add_dice?",H("sort_add_dice")),p(c,"$sort_barabara_dice?",H("sort_barabara_dice")),p(c,"$enabled_d9?",H("enabled_d9")),p(c,"$enable_debug",z("debug",!0)),p(c,"$eval",function(){var $,a,_=this,h=r;return $=f(o("BCDice"),"Preprocessor").$process(_.raw_input,_),h=A(a=_.$dice_command($))?a:_.$eval_common_command(_.raw_input),A(h)?(h["$rands="](_.randomizer.$rand_results()),h["$detailed_rands="](_.randomizer.$detailed_rand_results()),h):r}),p(c,"$change_text",function(_){return _}),p(c,"$check_result",function(_,$,h,a){var u=this,n=r,y=r,E=r,x=r,U=r;return n=u.$check_result_legacy(_,$,h,a),A(n)?n:(y=C($,"map",[],"sides".$to_proc()),x=(E=C($,"map",[],"value".$to_proc())).$sum(),n=Y([100],U=y)?u.$result_1d100(_,x,h,a):Y([20],U)?u.$result_1d20(_,x,h,a):Y([6,6],U)?u.$result_2d6(_,x,E,h,a):r,J(n,o("Result").$nothing())?r:A(n)?n:(n=Y([10],U=y.$uniq())?u.$result_nd10(_,x,E,h,a):Y([6],U)?u.$result_nd6(_,x,E,h,a):r,J(n,o("Result").$nothing())?r:A(n)?n:u.$result_ndx(_,h,a)))}),p(c,"$grich_text",F(r)),c.$private(),p(c,"$eval_common_command",function(_){try{S("eval_return");var h=S("return");return _=this.$change_text(_),C(f(o("CommonCommand"),"COMMANDS"),"each",[],function u(n){var E,y=null==u.$$s?this:u.$$s;if(null==y.randomizer&&(y.randomizer=r),null==n&&(n=r),E=n.$eval(_,y,y.randomizer),!A(E))return r;h.$throw(E)},{$$s:this,$$ret:h}),r}catch(u){if(u===e.t_eval_return||u===h)return u.$v;throw u}}),p(c,"$dice_command",function(_){var $=this,h=r,a=r,u=r,n=r;return A($.enabled_upcase_input)&&(_=_.$upcase()),h=$.$class().$prefixes_pattern().$match(_),A(h)?(a=h["$[]"](1)["$nil?"]()["$!"](),A(a)&&(_=_["$[]"](I(1,-1,!1))),u=$.$eval_game_system_specific_command(_),A(u["$is_a?"](o("Result")))?(u["$secret="](A(n=u["$secret?"]())?n:a),u):A(u["$nil?"]())||A(u["$empty?"]())||J(u,"1")?r:C(o("Result").$new(),"tap",[],function(E){var x;return null==E&&(E=r),E["$text="](u.$to_s()),C(E,"secret=",x=[a]),x[x.length-1]})):r}),p(c,"$eval_game_system_specific_command",F(r)),p(c,"$result_ndx",function(_,$,h){return A(h["$is_a?"](o("String")))?r:A(_.$send($,h))?o("Result").$success(this.$translate("success")):o("Result").$failure(this.$translate("failure"))}),p(c,"$result_1d100",F(r)),p(c,"$result_1d20",F(r)),p(c,"$result_nd10",F(r)),p(c,"$result_2d6",F(r)),p(c,"$result_nd6",F(r)),p(c,"$get_table_by_2d6",function(_){return this.$get_table_by_nD6(_,2)}),p(c,"$get_table_by_1d6",function(_){return this.$get_table_by_nD6(_,1)}),p(c,"$get_table_by_nD6",function(_,$){return this.$get_table_by_nDx(_,$,6)}),p(c,"$get_table_by_nDx",function(_,$,h){var u,n=r;return u=this.randomizer.$roll_sum($,h),n=this.$get_table_value(_["$[]"](w(u,$))),A(n["$nil?"]())?["1",0]:[n,u]}),p(c,"$get_table_by_1d3",function(_){var a,u,$=this,n=r;return $.$debug("get_table_by_1d3"),a=$.randomizer.$roll_sum(1,6),$.$debug("num",a),u=X(w(a,1),2).$to_i(),$.$debug("index",u),n=_["$[]"](u),A(n["$nil?"]())?["1",0]:[n,a]}),p(c,"$get_table_by_d66_swap",function(_){var h;return h=this.randomizer.$roll_d66(f(o("D66SortType"),"ASC")),[this.$get_table_by_number(h,_),h]}),p(c,"$get_table_by_d66",function(_){var h,a,u,y,n=r;return h=this.randomizer.$roll_once(6),a=this.randomizer.$roll_once(6),u=B(Q(w(h,1),6),w(a,1)),n=_["$[]"](u),y=""+h+a,A(n["$nil?"]())?["1",y]:[n,y]}),p(c,"$get_table_by_number",function(_,$,h){try{var a=S("return");return null==h&&(h="1"),C($,"each",[],function n(y){var x,E=null==n.$$s?this:n.$$s;if(null==y&&(y=r),x=y["$[]"](0),!A(s(x,_)))return r;a.$throw(E.$get_table_value(y["$[]"](1)))},{$$s:this,$$ret:a}),this.$get_table_value(h)}catch(n){if(n===a)return n.$v;throw n}},-3),p(c,"$get_table_value",function(_){return A(_["$is_a?"](o("Proc")))?_.$call():_}),p(c,"$roll_tables",function(_,$){var a=r;return a=$["$[]"](_),A(a)?a.$roll(this.randomizer).$to_s():r}),p(c,"$debug",function(_,$){var a,u=this,n=r,y=r;return a=l(arguments,1),A(u.debug)?(n=A(_["$is_a?"](o("String")))?_:_.$inspect(),A(a["$empty?"]())?u.$warn(n):(y=C(a,"map",[],function(x){return null==x&&(x=r),A(x["$is_a?"](o("String")))?'"'+x+'"':x.$inspect()}),u.$warn(n+": "+y.$join(", ")))):r},-2),f(f(t("I18n"),"Backend"),"Simple").$include(f(f(t("I18n"),"Backend"),"Fallbacks")),t("I18n").$load_path()["$<<"](t("Dir")["$[]"](t("File").$join("bcdice","../../i18n/**/*.yml"))),t("I18n")["$default_locale="]("ja_jp"),v=[["ja_jp"]],C(t("I18n").$fallbacks(),"defaults=",v),v[v.length-1]},Opal.modules["bcdice/arithmetic_evaluator"]=function(e){var H,F,X,s,v,I,w,Y,j=e.module,M=e.ensure_kwargs,l=e.truthy,B=e.thrower,A=e.def,p=[],g=e.nil,C=e.$$$;return H=p,F=Y=[j(p[0],"BCDice")].concat(H),w=[I=j(Y[0],"ArithmeticEvaluator")].concat(F),s=[X=e.get_singleton_class(I)].concat(w),v=e.$r(s),A(X,"$eval",function(q,t){try{B("eval_return");var f,N=g;return null==(f=(t=M(t)).$$smap.round_type)&&(f=C(v("RoundType"),"FLOOR")),l(q)&&l(N=v("Arithmetic").$eval(q,f))?N:0}catch(L){if(L===e.t_eval_return)return L.$v;throw L}},-2)},Opal.queue(function(e){var L,b,o,G,W,y,E,_,$,h,a,c,R,d,j=e.module,M=e.klass,l=e.const_set,B=e.send2,A=e.find_super,p=e.def,g=e.truthy,C=e.hash2,S=e.rb_plus,H=e.rb_ge,z=e.thrower,Y=e.eqeqeq,J=e.assign_ivar,F=e.rb_divide,I=e.rb_minus,w=e.rb_times,X=e.eqeq,Q=e.neqeq,s=e.rb_le,v=e.send,i=e.rb_lt,q=e.top,t=[],r=e.nil,f=e.$$$;return q.$require("bcdice/base"),q.$require("bcdice/arithmetic_evaluator"),L=t,b=d=[j(t[0],"BCDice")].concat(L),c=[j(d[0],"GameSystem")].concat(b),R=e.$r(c),o=c[0],G=R("Base"),W=c,$=[_=M(o,G,"LogHorizon")].concat(W),h=e.$r($),(a=_.$$prototype).randomizer=a.locale=r,l($[0],"ID","LogHorizon"),l($[0],"NAME","\u30ed\u30b0\u30fb\u30db\u30e9\u30a4\u30ba\u30f3TRPG"),l($[0],"SORT_KEY","\u308d\u304f\u307b\u3089\u3044\u3059\u3093TRPG"),l($[0],"HELP_MESSAGE","\u25a0 \u5224\u5b9a (xLH\xb1y>=z)\n\u3000xD6\u306e\u5224\u5b9a\u3002\u30af\u30ea\u30c6\u30a3\u30ab\u30eb\u3001\u30d5\u30a1\u30f3\u30d6\u30eb\u306e\u81ea\u52d5\u5224\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u3000x\uff1ax\u306b\u632f\u308b\u30c0\u30a4\u30b9\u6570\u3092\u5165\u529b\u3002\n\u3000\xb1y\uff1ay\u306b\u4fee\u6b63\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000>=z\uff1az\u306b\u76ee\u6a19\u5024\u3092\u5165\u529b\u3002\xb1\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 3LH\u30002LH>=8\u30003LH+1>=10\n\n\u25a0 \u6d88\u8017\u8868 (tCTx\xb1y$z)\n\u3000PCT \u4f53\u529b\uff0fECT \u6c17\u529b\uff0fGCT \u7269\u54c1\uff0fCCT \u91d1\u92ad\n\u3000x:CR\u3092\u6307\u5b9a\u3002\n\u3000\xb1y:\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u8868\u306e\u7279\u5b9a\u306e\u5024\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 PCT1\u3000ECT2+1\u3000GCT3-1\u3000CCT3$5\n\n\u25a0 \u6d88\u8017\u8868\u30ed\u30fc\u30eb (CTx\xb1y)\n\u3000\u6d88\u8017\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u6307\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001\u7121\u8996\u3055\u308c\u307e\u3059\u3002\u7701\u7565\u53ef\u80fd\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u8ca1\u5b9d\u8868 (tTRSx\xb1y$)\n\u3000LHZB1\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRS \u91d1\u92ad\uff0fMTRS \u9b54\u6cd5\u7d20\u6750\uff0fITRS \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0f\u203bHTRS \u30d2\u30ed\u30a4\u30f3\uff0fGTRS \u30b4\u30d6\u30ea\u30f3\u8ca1\u5b9d\u8868\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\u300a\u30b4\u30fc\u30eb\u30c9\u30d5\u30a3\u30f3\u30ac\u30fc\u300b\u4f7f\u7528\u6642\u306a\u3069\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u8ca1\u5b9d\u8868\u306e\u30c0\u30a4\u30b9\u76ee\u30927\u56fa\u5b9a\uff081\u56de\u5206\u306e\u30d7\u30e9\u30a4\u30ba\u7528\uff09\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 CTRS1\u3000MTRS2+1\u3000ITRS3-1\u3000ITRS+27\u3000CTRS3$\n\n\u25a0 \u8ca1\u5b9d\u8868\uff08\u62e1\u5f35\u30eb\u30fc\u30eb\u30d6\u30c3\u30af\uff09 (tTRSEx\xb1y$)\n\u3000LHZB2\u8a18\u8f09\u306e\u8ca1\u5b9d\u8868\n\u3000CTRSE \u91d1\u92ad\uff0fMTRSE \u9b54\u6cd5\u7d20\u6750\uff0fITRSE \u63db\u91d1\u30a2\u30a4\u30c6\u30e0\uff0fOTRSE \u305d\u306e\u307b\u304b\n\u3000\u8a18\u6cd5\u306f\u8ca1\u5b9d\u8868\u3068\u540c\u69d8\n\n\u25a0 \u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb (TRSx\xb1y)\n\u3000\u8ca1\u5b9d\u8868\u30ed\u30fc\u30eb\u3092\u884c\u3044\u3001\u51fa\u76ee\u3092\u6c7a\u5b9a\u3059\u308b\u3002\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306fCR 0\u3068\u3057\u3066\u6271\u3046\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\n\u25a0 \u30a4\u30fc\u30b9\u30bf\u30eb\u63a2\u7d22\u8868 (ESTLx\xb1y$z)\n\u3000x\uff1aCR\u3092\u6307\u5b9a\u3002\u7701\u7565\u6642\u306f\u30c0\u30a4\u30b9\u5024 0 \u56fa\u5b9a\u3067\u4fee\u6b63\u5024\u306e\u8868\u53c2\u7167\u3002\n\u3000\xb1y\uff1a\u4fee\u6b63\u5024\u3002\uff0b\u3068\uff0d\u306e\u8a08\u7b97\u306b\u5bfe\u5fdc\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000$z\uff1a\uff04\u3092\u4ed8\u3051\u308b\u3068\u30c0\u30a4\u30b9\u76ee\u3092 z \u56fa\u5b9a\u3002\u7279\u5b9aCR\u306e\u8868\u53c2\u7167\u7528\u306b\u3002\u7701\u7565\u53ef\u80fd\u3002\n\u3000\u4f8b\uff09 ESTL1\u3000ESTL+15\u3000ESTL2+1$5\u3000ESTL2-1$5\n\n\u25a0 \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u30c9\u30de\u30b8\u30c3\u30af\u30a2\u30a4\u30c6\u30e0\u52b9\u679c\u8868 (MGRx)\n\u3000x\u306fMG\u3092\u6307\u5b9a\u3002(LHZB1\u7528)\n\n\u25a0 \u697d\u5668\u7a2e\u5225\u8868\u2020 (MIIx)\n\u3000x\u306f\u697d\u5668\u306e\u7a2e\u985e(1\uff5e6\u3092\u6307\u5b9a)\u3001\u7701\u7565\u53ef\u80fd\n\u30001 \u6253\u697d\u5668\uff11\uff0f2 \u9375\u76e4\u697d\u5668\uff0f3 \u5f26\u697d\u5668\uff11\uff0f4 \u5f26\u697d\u5668\uff12\uff0f5 \u7ba1\u697d\u5668\uff11\uff0f6 \u7ba1\u697d\u5668\uff12\n\n\u25a0 \u7279\u6b8a\u6d88\u8017\u8868\u2606 (tSCTx\xb1y$z)\n\u3000\u6d88\u8017\u8868\u3068\u540c\u69d8\u3001\u305f\u3060\u3057CR\u306f\u7701\u7565\u53ef\u80fd\u3002\n\u3000ESCT \u30ed\u30c7\u7814\u306f\u7206\u767a\u3060\uff01\uff0fCSCT \u30a2\u30eb\u30f4\u306e\u546a\u3044\u3058\u3083\uff01\n\n\u25a0 \u30ed\u30c7\u7814\u306e\u65b0\u767a\u660e\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (IATt)\n\u3000IATA \u7279\u5fb4A(\u30e1\u30ea\u30c3\u30c8)\uff0fIATB \u7279\u5fb4B(\u30c7\u30e1\u30ea\u30c3\u30c8)\uff0fIATL \u898b\u305f\u76ee\uff0fIATT \u7a2e\u985e\n\u3000t\u3092\u7701\u7565\u3059\u308b\u3068\u5168\u3066\u8868\u793a\u3002t\u306bA/B/L/T\u3092\u4efb\u610f\u306e\u9806\u3067\u9023\u7d50\u53ef\u80fd\n\u3000\u4f8b\uff09IAT\u3000IATALT  IATABBLT  IATABL\n\n\u25a0 \u8868\n\u3000\u30fb\u30d1\u30fc\u30bd\u30ca\u30ea\u30c6\u30a3\u30bf\u30b0\u8868 (PTAG)\n\u3000\u30fb\u4ea4\u53cb\u8868 (KOYU)\n\u3000\u30fb\u653b\u6483\u547d\u4e2d\u7b87\u6240\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (HLOC)\n\u3000\u30fbPC\u540d\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (PCNM)\n\u3000\u30fb\u30a2\u30ad\u30d0\u306e\u8857\u3067\u906d\u9047\u3059\u308b\u30c8\u30e9\u30d6\u30eb\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (TIAS)\n\u3000\u30fb\u5ec3\u68c4\u5150\u30e9\u30f3\u30c0\u30e0\u6c7a\u5b9a\u8868\u203b (ABDC)\n\n\u2020\u5370\u306f\u2606\u5370\u306f\u300c\u30a4\u30f3\u30c8\u30a5\u30fb\u30b6\u30fb\u30bb\u30eb\u30c7\u30b7\u30a2 \u3055\u3089\u306a\u308b\u30d3\u30eb\u30c9\u306e\u7fbd\u3070\u305f\u304d\uff08\uff11\uff09\u300d\u3088\u308a\u3001\n\u2606\u5370\u306f\u30bb\u30eb\u30c7\u30b7\u30a2\u30fb\u30ac\u30bc\u30c3\u30c8\u300c\u3067\u304d\u308b\u304b\u306a66\u300dVol.1\u3088\u308a\u3001\n\u203b\u5370\u306f\u300c\u5b9f\u9332\u30fb\u4e03\u9762\u4f53\u5de5\u623f\u30b9\u30bf\u30c3\u30d5\u5ea7\u8ac7\u4f1a(\u590f\u306e\u9663)\u300d\u3088\u308a\u3002\u5229\u7528\u6cd5\u306a\u3069\u306f\u305d\u3061\u3089\u53c2\u7167\u3002\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n"),_.$register_prefix("\\d+LH","\\w+CT","CT","\\w+TRS","TRS","IAT","TIAS","ABDC","MII","ESTL"),p(_,"$initialize",function u(n){var E=this;return u.$$p=null,B(E,A(E,"initialize",u,!1,!0),"initialize",[n],null),E.d66_sort_type=f(h("D66SortType"),"NO_SORT")}),p(_,"$eval_game_system_specific_command",function(n){var E,x,U,Z,ee,K,O,te,ne,ie,V,y=this;return g(E=g(x=g(U=g(Z=g(ee=g(K=g(O=g(te=g(ne=g(ie=g(V=y.$getCheckRollDiceCommandResult(n))?V:y.$roll_consumption(n))?ie:y.$roll_consumption_table(n))?ne:y.$roll_treasure(n))?te:y.$roll_treasure_table(n))?O:y.$roll_treasure_table_b2(n))?K:y.$getInventionAttributeTextDiceCommandResult(n))?ee:y.$getTroubleInAkibaStreetDiceCommandResult(n))?Z:y.$getAbandonedChildDiceCommandResult(n))?U:y.$getMusicalInstrumentTypeDiceCommandResult(n))?x:y.$roll_eastal_exploration_table(n))?E:y.$roll_tables(n,f(y.$class(),"TABLES"))}),_.$private(),p(_,"$getCheckRollDiceCommandResult",function(n){var y=this,x=r,U=r,Z=r,ee=r,K=r,O=r,te=r;return x=f(h("Command"),"Parser").$new(/\d+LH/,C(["round_type"],{round_type:y.$round_type()})).$restrict_cmp_op_to(r,">=").$parse(n),g(x)?(U=x.$command().$to_i(),ee=(Z=y.randomizer.$roll_barabara(U,6)).$sum(),K=S(ee,x.$modify_number()),O=y.$result_text(U,Z,K,x),te=["("+x+")",ee+"["+Z.$join(",")+"]"+h("Format").$modifier(x.$modify_number()),K,O.$text()].$compact(),O["$text="](te.$join(" \uff1e ")),O):r}),p(_,"$result_text",function(n,y,E,x){var U=this;return g(H(y.$count(6),2))?h("Result").$critical(U.$translate("LogHorizon.LH.critical")):g(H(y.$count(1),n))?h("Result").$fumble(U.$translate("LogHorizon.LH.fumble")):g(x.$cmp_op()["$nil?"]())?h("Result").$new():g(H(E,x.$target_number()))?h("Result").$success(U.$translate("success")):h("Result").$failure(U.$translate("failure"))}),p(_,"$getValue",function(n,y){try{return z("eval_return"),g(n["$nil?"]())||g(n["$empty?"]())?y:h("ArithmeticEvaluator").$eval(n)}catch(x){if(x===e.t_eval_return)return x.$v;throw x}}),p(_,"$roll_consumption",function(n){try{z("eval_return");var x=r,U=r,Z=r,ee=r,K=r;return x=/^CT\d*([+\-\d]+)?$/.$match(n),g(x)?(U=h("ArithmeticEvaluator").$eval(x["$[]"](1)),Z=h("Format").$modifier(U),ee=this.randomizer.$roll_once(6),g(Z["$empty?"]())||(K=S(ee.$to_s(),Z)),["(1D6"+Z+")",K,S(ee,U)].$compact().$join(" \uff1e ")):r}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),p(_,"$roll_consumption_table",function(n){try{z("eval_return");var x=r,U=r,Z=r,ee=r;return x=/(P|E|G|C|ES|CS)CT(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(n),g(x)?(U=this.$construct_consumption_table(x["$[]"](1)),Z=x["$[]"](2).$to_i(),ee=h("ArithmeticEvaluator").$eval(x["$[]"](3)),g(x["$[]"](4))&&U.$fix_dice_value(x["$[]"](4).$to_i()),U.$roll(Z,ee,this.randomizer)):r}catch(K){if(K===e.t_eval_return)return K.$v;throw K}}),p(_,"$construct_consumption_table",function(n){var x,y=this,E=r;return E=Y("P",x=n)?y.$translate("LogHorizon.CT.PCT"):Y("E",x)?y.$translate("LogHorizon.CT.ECT"):Y("G",x)?y.$translate("LogHorizon.CT.GCT"):Y("C",x)?y.$translate("LogHorizon.CT.CCT"):Y("ES",x)?y.$translate("LogHorizon.CT.ESCT"):Y("CS",x)?y.$translate("LogHorizon.CT.CSCT"):r,h("ConsumptionTable").$new(E["$[]"]("name"),E["$[]"]("items"))}),(E=(y=M($[0],null,"ConsumptionTable")).$$prototype).tables=E.dice_value=E.name=r,p(y,"$initialize",function(U,Z){return this.name=U,this.tables=Z,this.dice_value=r}),p(y,"$fix_dice_value",J("dice_value")),p(y,"$roll",function(U,Z,ee){var O,ne,V,K=this,te=r,ie=r;return O=F(I(U,1),5).$clamp(0,I(K.tables.$size(),1)),te=K.tables["$[]"](O),K.dice_value=g(ne=K.dice_value)?ne:ee.$roll_once(6),ie=S(K.dice_value,Z),V=te["$[]"](ie.$clamp(0,7)),K.name+"("+ie+"["+K.dice_value+"]) \uff1e "+V}),p(_,"$roll_treasure",function(n){try{z("eval_return");var x=r,U=r,Z=r,ee=r,K=r,O=r;return x=/^TRS(\d+)?([+\-\d]+)?$/.$match(n),g(x)?(U=x["$[]"](1).$to_i(),Z=h("ArithmeticEvaluator").$eval(x["$[]"](2)),K=(ee=this.randomizer.$roll_barabara(2,6)).$sum(),O=S(S(K,w(U,5)),Z),"(2D6+"+U+"*5"+h("Format").$modifier(Z)+") \uff1e "+K+"["+ee.$join(",")+"]"+h("Format").$modifier(S(w(U,5),Z))+" \uff1e "+O):r}catch(te){if(te===e.t_eval_return)return te.$v;throw te}}),p(_,"$roll_treasure_table",function(n){try{z("eval_return");var E=this,x=r,U=r,Z=r,ee=r,K=r;return x=/^([CMIHG]TRS)(\d+)?([+\-\d]+)?(\$)?$/.$match(n),g(x)?(U=x["$[]"](1),Z=E.$construct_treasure_table(U),ee=x["$[]"](2).$to_i(),K=h("ArithmeticEvaluator").$eval(x["$[]"](3)),X(ee,0)&&X(K,0)?E.$translate("LogHorizon.TRS.need_cr",C(["command"],{command:n})):(g(x["$[]"](4))&&Z.$fix_dice_value(7),Z.$roll(ee,K,E.randomizer))):r}catch(O){if(O===e.t_eval_return)return O.$v;throw O}}),p(_,"$construct_treasure_table",function(n){return X(n,"HTRS")?h("HeroineTreasureTable").$from_i18n("LogHorizon.TRS.HTRS",this.locale):h("TreasureTable").$from_i18n("LogHorizon.TRS."+n,this.locale)}),p(_,"$roll_treasure_table_b2",function(n){try{z("eval_return");var E=this,x=r,U=r,Z=r,ee=r,K=r;return x=/^([CMIO]TRSE)(\d+)?([+\-\d]+)?(\$)?$/.$match(n),g(x)?(U=x["$[]"](1),Z=h("ExpansionTreasureTable").$from_i18n("LogHorizon.TRSE."+U,E.locale),ee=x["$[]"](2).$to_i(),K=h("ArithmeticEvaluator").$eval(x["$[]"](3)),X(ee,0)&&X(K,0)?E.$translate("LogHorizon.TRS.need_cr",C(["command"],{command:n})):(g(x["$[]"](4))&&Z.$fix_dice_value(7),Z.$roll(ee,K,E.randomizer))):r}catch(O){if(O===e.t_eval_return)return O.$v;throw O}}),function(u,n,y){var ee,O,te,E=M(u,null,"TreasureTable"),x=[E].concat(y),U=e.$r(x),Z=E.$$prototype;Z.dice_list=Z.name=Z.items=r,E.$include(U("Translate")),O=[ee=e.get_singleton_class(E)].concat(x),te=e.$r(O),p(ee,"$from_i18n",function(ie,V){var re=r;return re=te("I18n").$translate(ie,C(["raise","locale"],{raise:!0,locale:V})),this.$new(re["$[]"]("name"),re["$[]"]("items"),V)}),p(E,"$initialize",function(K,O,te){return this.name=K,this.items=O,this.locale=te,this.dice_list=r}),p(E,"$fix_dice_value",function(K){return this.dice_list=[K]}),p(E,"$roll",function(K,O,te){var ne,ie=this,V=r,m=r,re=r,$e=r;return X(K,0)&&X(O,0)?r:(V=X(K,0)&&Q(O,0)?O:(ie.dice_list=g(m=ie.dice_list)?m:te.$roll_barabara(2,6),S(S(ie.dice_list.$sum(),w(5,K)),O)),re=ie.$pick_item(V),g(ie.dice_list)&&($e="["+((ne=ie.dice_list)===r||null==ne?r:ne.$join(","))+"]"),ie.name+"("+V+$e+") \uff1e "+re)}),E.$private(),p(E,"$pick_item",function(K){var O=this;return g(s(K,6))?O.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):g(s(K,62))?O.items["$[]"](K.$to_s()):g(s(K,72))?O.items["$[]"](I(K,10).$to_s())+"&80G":g(s(K,82))?O.items["$[]"](I(K,20).$to_s())+"&160G":g(s(K,87))?O.items["$[]"](I(K,30).$to_s())+"&260G":O.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:88}))})}($[0],0,$),function(u,n){var y=M(u,n,"HeroineTreasureTable");y.$$prototype.items=r,p(y,"$pick_item",function(U){var Z=this;return g(s(U,6))?Z.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):g(s(U,53))?Z.items["$[]"](U.$to_s()):Z.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:54}))})}($[0],h("TreasureTable")),function(u,n){var y=M(u,n,"ExpansionTreasureTable");y.$$prototype.items=r,p(y,"$pick_item",function(U){var Z=this;return g(s(U,6))?Z.$translate("LogHorizon.TRS.below_lower_limit",C(["value"],{value:6})):g(s(U,162))?Z.items["$[]"](U.$to_s()):g(s(U,172))?Z.items["$[]"](I(U,10).$to_s())+"&200G":g(s(U,182))?Z.items["$[]"](I(U,20).$to_s())+"&400G":g(s(U,187))?Z.items["$[]"](I(U,30).$to_s())+"&600G":Z.$translate("LogHorizon.TRS.exceed_upper_limit",C(["value"],{value:188}))})}($[0],h("TreasureTable")),p(_,"$getInventionAttributeTextDiceCommandResult",function(n){var E=r,x=r,U=r,Z=r,ee=r;return g(n["$=~"](/IAT([ABMDLT]*)/))?(E=this.$translate("LogHorizon.IAT.name"),x=g(h("Regexp").$last_match(1))&&Q(h("Regexp").$last_match(1),"")?h("Regexp").$last_match(1):"MDLT",U=x.$length()["$=="](1),Z=[],ee=[],v(x.$split(/(?:)/),"each",[],function K(O){var V,te=null==K.$$s?this:K.$$s,ne=r,ie=r,m=r;return null==te.randomizer&&(te.randomizer=r),null==O&&(O=r),ne=te.randomizer.$roll_once(6),ee["$<<"](ne.$to_s()),m=(ie=Y("A",V=O)||Y("M",V)?te.$translate("LogHorizon.IAT.A"):Y("B",V)||Y("D",V)?te.$translate("LogHorizon.IAT.B"):Y("L",V)?te.$translate("LogHorizon.IAT.L"):Y("T",V)?te.$translate("LogHorizon.IAT.T"):r)["$[]"]("items")["$[]"](I(ne,1)),g(U)&&(m=ie["$[]"]("name")+"\uff1a"+m),Z.$push(m)},{$$s:this}),E+"(["+ee.$join(",")+"]) \uff1e "+Z.$join(" ")):r}),p(_,"$getTroubleInAkibaStreetDiceCommandResult",function(n){return X(n,"TIAS")?this.$roll_random_table("LogHorizon.TIAS"):r}),p(_,"$getAbandonedChildDiceCommandResult",function(n){return X(n,"ABDC")?this.$roll_random_table("LogHorizon.ABDC"):r}),p(_,"$roll_random_table",function(n){var E=r,x=r,U=r,Z=r;return E=this.$translate(n),x=E["$[]"]("tables"),U=this.randomizer.$roll_barabara(x.$size(),6),Z=v(U.$map(),"with_index",[],function(K,O){return null==K&&(K=r),null==O&&(O=r),x["$[]"](O)["$[]"](I(K,1))}),E["$[]"]("name")+"(["+U.$join(",")+"]) \uff1e "+Z.$join(" ")}),p(_,"$getMusicalInstrumentTypeDiceCommandResult",function(n){var y=this,E=r,x=r,U=r,Z=r,ee=r,K=r,O=r;return!g(n["$=~"](/MII(\d?)/))||(E=(g(x=h("Regexp").$last_match(1))?h("Regexp").$last_match(1)["$!="](""):x)["$!"](),U=g(E)?y.randomizer.$roll_once(6):h("Regexp").$last_match(1).$to_i(),g(i(U,1))||i(6,U))?r:(Z=y.$translate("LogHorizon.MII.name"),ee=y.$translate("LogHorizon.MII.type_list")["$[]"](I(U,1)),K=y.randomizer.$roll_once(6),O=y.$translate("LogHorizon.MII.items")["$[]"](I(U,1))["$[]"](I(K,1)),S(S(Z.$to_s(),g(E)?"("+U+")":"")," \uff1e "+ee+"("+K+") \uff1e "+O))}),p(_,"$roll_eastal_exploration_table",function(n){try{z("eval_return");var E,x=this,U=r,Z=r,ee=r,K=r,O=r,te=r,ne=r,ie=r,m=r;return U=/ESTL(\d+)?([+\-\d]+)?(?:\$(\d+))?/.$match(n),!g(U)||g(U["$[]"](1)["$nil?"]())&&g(U["$[]"](2)["$nil?"]())&&g(U["$[]"](3)["$nil?"]())?r:(Z=U["$[]"](1).$to_i(),ee=h("ArithmeticEvaluator").$eval(U["$[]"](2)),K=(E=U["$[]"](3))===r||null==E?r:E.$to_i(),O=g(K)?[K]:X(Z,0)?[]:x.randomizer.$roll_barabara(2,6),g(O["$empty?"]())||(te="["+O.$join(",")+"]"),ne=S(S(O.$sum(),w(Z,5)),ee).$clamp(7,162),ie=x.$translate("LogHorizon.ESTL.name"),m=x.$translate("LogHorizon.ESTL.items")["$[]"](ne.$to_s()).$chomp(),ie+"("+ne+te+")\n"+m)}catch(re){if(re===e.t_eval_return)return re.$v;throw re}}),function(u,n){var y=[u].concat(n),E=e.$r(y);u.$private(),p(u,"$translate_tables",function(U){return C(["PTAG","KOYU","MGR1","MGR2","MGR3","HLOC","PCNM"],{PTAG:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PTAG",U),KOYU:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.KOYU",U),MGR1:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR1",U),MGR2:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR2",U),MGR3:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.MGR3",U),HLOC:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.HLOC",U),PCNM:f(E("DiceTable"),"D66Table").$from_i18n("LogHorizon.table.PCNM",U)})})}(e.get_singleton_class(_),$),l($[0],"TABLES",_.$translate_tables("ja_jp")),_.$register_prefix(h("TABLES").$keys())})}}]);