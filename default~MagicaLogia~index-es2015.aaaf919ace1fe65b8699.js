(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{ETtC:function(t,e,r){r("pQ1d"),Opal.modules["i18n/backend/fallbacks"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r=[],i=t.nil,n=t.$$$,a=t.$$,$=t.module,s=t.truthy,c=t.send,o=t.send2,l=t.hash2;return function(r,u){var _=$(r,"I18n"),d=[_].concat(u);t.class_variable_set(d[0],"@@fallbacks",i),function(r,$){var o,l,u=[r].concat($);t.def(r,"$fallbacks",o=function(){var e,r,$;return t.class_variable_set(u[1],"@@fallbacks",s($=null==(e=u[1].$$cvars["@@fallbacks"])?i:e)?$:n(n(a(u,"I18n"),"Locale"),"Fallbacks").$new()),s(r=a(u,"Thread").$current()["$[]"]("i18n_fallbacks"))?r:null==(e=u[1].$$cvars["@@fallbacks"])?i:e},o.$$arity=0),t.def(r,"$fallbacks=",l=function(r){var $,o;return t.class_variable_set(u[1],"@@fallbacks",s(r["$is_a?"](a(u,"Array")))?n(n(a(u,"I18n"),"Locale"),"Fallbacks").$new(r):r),o=["i18n_fallbacks",null==($=u[1].$$cvars["@@fallbacks"])?i:$],c(a(u,"Thread").$current(),"[]=",t.to_a(o)),o[e(o.length,1)]},l.$$arity=1)}(t.get_singleton_class(_),d),function(r,u){var _=[$(r,"Backend")].concat(u);!function(r,u){var _,d,f,h,p=$(r,"Fallbacks"),m=[p].concat(u);t.def(p,"$translate",_=function(e,r,$){try{var u,d=_.$$p,f=this,h=i,p=i,y=i,b=i,g=i,T=i;for(d&&(_.$$p=null),g=0,T=arguments.length,b=new Array(T);g<T;g++)b[g]=arguments[g];return null==$&&($=a(m,"EMPTY_HASH")),s($.$fetch("fallback",!0))?s($["$[]"]("fallback_in_progress"))?o(f,t.find_super_dispatcher(f,"translate",_,!1,!0),"translate",b,d):(s($["$[]"]("default"))&&(h=f["$extract_non_symbol_default!"]($)),p=$.$merge(l(["fallback_in_progress"],{fallback_in_progress:!0})),c(a(m,"I18n").$fallbacks()["$[]"](e),"each",[],((u=function(l){var d,f=null==u.$$s?this:u.$$s;null==l&&(l=i);try{return c(f,"catch",["exception"],((d=function(){var n=null==d.$$s?this:d.$$s,a=i;if(a=o(n,t.find_iter_super_dispatcher(n,"translate",d.$$def||u.$$def||_,!1,!1),"translate",[l,r,p],null),s(a["$nil?"]()))return i;s(e.$to_s()["$!="](l.$to_s()))&&n.$on_fallback(e,l,r,$),t.ret(a)}).$$s=f,d.$$arity=0,d))}catch(h){if(!t.rescue(h,[n(a(m,"I18n"),"InvalidLocale")]))throw h;try{return i}finally{t.pop_exception()}}}).$$s=f,u.$$arity=1,u)),s(s(y=$["$key?"]("default"))?$["$[]"]("default")["$nil?"]():y)?i:s(h)?o(f,t.find_super_dispatcher(f,"translate",_,!1,!0),"translate",[e,i,$.$merge(l(["default"],{default:h}))],null):f.$throw("exception",n(a(m,"I18n"),"MissingTranslation").$new(e,r,$))):o(f,t.find_super_dispatcher(f,"translate",_,!1,!0),"translate",b,d)}catch(v){if(v===t.returner)return v.$v;throw v}},_.$$arity=-3),t.def(p,"$extract_non_symbol_default!",d=function(r){var n,$,o=i,l=i;return o=[r["$[]"]("default")].$flatten(),$=c(o,"detect",[],((n=function(t){return null==t&&(t=i),t["$is_a?"](a(m,"Symbol"))["$!"]()}).$$s=this,n.$$arity=1,n)),s($)&&(l=["default",o["$[]"](0,o.$index($))],c(r,"[]=",t.to_a(l)),e(l.length,1)),$},d.$$arity=1),t.def(p,"$exists?",f=function(e,r,$){try{var l,u=f.$$p,_=this,d=i,h=i,p=i;for(u&&(f.$$p=null),h=0,p=arguments.length,d=new Array(p);h<p;h++)d[h]=arguments[h];return null==$&&($=a(m,"EMPTY_HASH")),s($.$fetch("fallback",!0))?(c(a(m,"I18n").$fallbacks()["$[]"](e),"each",[],((l=function(e){var $=null==l.$$s?this:l.$$s;null==e&&(e=i);try{if(!s(o($,t.find_iter_super_dispatcher($,"exists?",l.$$def||f,!1,!1),"exists?",[e,r],null)))return i;t.ret(!0)}catch(c){if(!t.rescue(c,[n(a(m,"I18n"),"InvalidLocale")]))throw c;try{return i}finally{t.pop_exception()}}}).$$s=_,l.$$arity=1,l)),!1):o(_,t.find_super_dispatcher(_,"exists?",f,!1,!0),"exists?",d,u)}catch(y){if(y===t.returner)return y.$v;throw y}},f.$$arity=-3),p.$private(),t.def(p,"$on_fallback",h=function(t,e,r,n){return i},h.$$arity=4)}(_[0],_)}(d[0],d)}(r[0],r)},Opal.modules["bcdice/randomizer"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t<=e:t["$<="](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function a(t,e){return"number"==typeof t&&"number"==typeof e?t*e:t["$*"](e)}var $=[],s=t.nil,c=t.$$$,o=t.$$,l=t.module,u=t.klass,_=t.truthy,d=t.send;return function($,f){var h=[l($,"BCDice")].concat(f);!function($,l,f){var h,p,m,y,b,g,T,v,k,R,S,D=u($,null,"Randomizer"),x=[D].concat(f);D.$$prototype.rand_results=D.$$prototype.detailed_rand_results=s,t.const_set(x[0],"UPPER_LIMIT_DICE_TIMES",200),t.const_set(x[0],"UPPER_LIMIT_DICE_SIDES",1e3),t.const_set(x[0],"UPPER_LIMIT_RANDS",1e4),t.def(D,"$initialize",h=function(){return this.rand_results=[],this.detailed_rand_results=[]},h.$$arity=0),D.$attr_reader("rand_results"),D.$attr_reader("detailed_rand_results"),t.const_set(x[0],"DetailedRandResult",o(x,"Struct").$new("kind","sides","value")),t.def(D,"$roll_barabara",p=function(t,n){var a,$;return _(e(r(this.rand_results.$size(),t),o(x,"UPPER_LIMIT_RANDS")))&&this.$raise(o(x,"TooManyRandsError")),_(_($=i(t,0))?$:e(t,o(x,"UPPER_LIMIT_DICE_TIMES")))?[]:d(o(x,"Array"),"new",[t],((a=function(){return(null==a.$$s?this:a.$$s).$roll_once(n)}).$$s=this,a.$$arity=0,a))},p.$$arity=2),t.def(D,"$roll_sum",m=function(t,e){return this.$roll_barabara(t,e).$sum()},m.$$arity=2),t.def(D,"$roll_once",y=function(t){var r,n;return _(_(n=i(t,0))?n:e(t,o(x,"UPPER_LIMIT_DICE_SIDES")))?0:(r=this.$rand_inner(t),this.$push_to_detail("normal",t,r),r)},y.$$arity=1),t.def(D,"$roll_index",b=function(t){return n(this.$roll_once(t),1)},b.$$arity=1),t.def(D,"$roll_tens_d10",g=function(){var t,e=s;return(e=this.$rand_inner(10))["$=="](10)&&(e=0),t=a(e,10),this.$push_to_detail("tens_d10",10,t),t},g.$$arity=0),t.def(D,"$roll_d9",T=function(){var t;return t=n(this.$rand_inner(10),1),this.$push_to_detail("d9",10,t),t},T.$$arity=0),t.def(D,"$roll_d66",v=function(t){var e,i,n=s;return n=d(o(x,"Array"),"new",[2],((e=function(){return(null==e.$$s?this:e.$$s).$roll_once(6)}).$$s=this,e.$$arity=0,e)),i=t,c(o(x,"D66SortType"),"ASC")["$==="](i)?n["$sort!"]():c(o(x,"D66SortType"),"DESC")["$==="](i)&&n["$sort!"]()["$reverse!"](),r(a(n["$[]"](0),10),n["$[]"](1))},v.$$arity=1),D.$private(),t.def(D,"$rand_inner",k=function(t){var e,r,i;return _((r=this.rand_results.$size(),i=o(x,"UPPER_LIMIT_RANDS"),"number"==typeof r&&"number"==typeof i?r>=i:r["$>="](i)))&&this.$raise(o(x,"TooManyRandsError")),e=this.$random(t),this.rand_results["$<<"]([e,t]),e},k.$$arity=1),t.def(D,"$random",R=function(t){return r(o(x,"Kernel").$rand(t),1)},R.$$arity=1),t.def(D,"$push_to_detail",S=function(t,e,r){var i;return i=o(x,"DetailedRandResult").$new(t,e,r),this.detailed_rand_results.$push(i)},S.$$arity=3)}(h[0],0,h),function(t,e,r){[u(t,e,"TooManyRandsError")].concat(r)}(h[0],o(h,"StandardError"),h)}($[0],$)},Opal.modules["bcdice/dice_table/roll_result"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.truthy;return function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"DiceTable")].concat(s);!function(e,n,s){var c,o,l,u,_=a(e,null,"RollResult"),d=[_].concat(s);_.$$prototype.table_name=_.$$prototype.value=_.$$prototype.body=r,t.def(_,"$initialize",c=function(t,e,r){return this.table_name=t,this.value=e,this.body=r},c.$$arity=3),_.$attr_reader("table_name"),_.$attr_reader("value"),_.$attr_reader("body"),t.def(_,"$to_s",o=function(){return this.table_name+"("+this.value+") \uff1e "+this.body},o.$$arity=0),t.def(_,"$last_body",l=function(){return $(this.body["$is_a?"](i(d,"RollResult")))?this.body.$last_body():this.body},l.$$arity=0),t.def(_,"$empty?",u=function(){return!1},u.$$arity=0)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/chain_table"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.truthy;return function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"DiceTable")].concat(s);!function(e,n,s){var c,o,l=a(e,null,"ChainTable"),u=[l].concat(s);l.$$prototype.times=l.$$prototype.sides=l.$$prototype.items=l.$$prototype.name=r,t.def(l,"$initialize",c=function(t,e,n){var a=r;return this.name=t,this.items=n.$freeze(),a=/(\d+)D(\d+)/i.$match(e),$(a)||this.$raise(i(u,"ArgumentError"),"Unexpected table type: "+e),this.times=a["$[]"](1).$to_i(),this.sides=a["$[]"](2).$to_i()},c.$$arity=3),t.def(l,"$roll",o=function(t){var e,n,a,s,c=r;return e=t.$roll_sum(this.times,this.sides),a=this.times,s="number"==typeof(n=e)&&"number"==typeof a?n-a:n["$-"](a),c=this.items["$[]"](s),$(c["$respond_to?"]("roll"))&&(c=c.$roll(t)),i(u,"RollResult").$new(this.name,e,c)},o.$$arity=1)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_grid_table"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r=[],i=t.nil,n=t.$$,a=t.module,$=t.klass,s=t.hash2;return function(r,c){var o=[a(r,"BCDice")].concat(c);!function(r,c){var o=[a(r,"DiceTable")].concat(c);!function(r,a,c){var o,l,u,_=$(r,null,"D66GridTable"),d=[_].concat(c);_.$$prototype.name=_.$$prototype.items=i,t.defs(_,"$from_i18n",o=function(t,e){var r=i;return r=n(d,"I18n").$t(t,s(["locale","raise"],{locale:e,raise:!0})),this.$new(r["$[]"]("name"),r["$[]"]("items"))},o.$$arity=2),t.def(_,"$initialize",l=function(t,e){return this.name=t,this.items=e.$freeze()},l.$$arity=2),t.def(_,"$roll",u=function(t){var r,i,a,$,s,c;return r=t.$roll_once(6),i=t.$roll_once(6),a=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}("number"==typeof(c=r)?10*c:c["$*"](10),i),$=e(r,1),s=e(i,1),n(d,"RollResult").$new(this.name,a,this.items["$[]"]($)["$[]"](s))},u.$$arity=1)}(o[0],0,o)}(o[0],o)}(r[0],r)},Opal.modules["bcdice/dice_table/d66_half_grid_table"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.hash2;return t.top.$require("bcdice/dice_table/d66_grid_table"),function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"DiceTable")].concat(s);!function(e,n,s){var c,o,l=a(e,n,"D66HalfGridTable"),u=[l].concat(s);t.defs(l,"$from_i18n",c=function(t,e){var n=r;return n=i(u,"I18n").$t(t,$(["locale","raise"],{locale:e,raise:!0})),this.$new(n["$[]"]("name"),n["$[]"]("items_1_2_3"),n["$[]"]("items_4_5_6"))},c.$$arity=2),t.def(l,"$initialize",o=function(t,e,r){return this.name=t,this.items=[e,e,e,r,r,r].$freeze()},o.$$arity=3)}(c[0],i(c,"D66GridTable"),c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_one_third_table"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.hash2;return t.top.$require("bcdice/dice_table/d66_grid_table"),function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"DiceTable")].concat(s);!function(e,n,s){var c,o,l=a(e,n,"D66OneThirdTable"),u=[l].concat(s);t.defs(l,"$from_i18n",c=function(t,e){var n=r;return n=i(u,"I18n").$t(t,$(["locale","raise"],{locale:e,raise:!0})),this.$new(n["$[]"]("name"),n["$[]"]("items_1_2"),n["$[]"]("items_3_4"),n["$[]"]("items_5_6"))},c.$$arity=2),t.def(l,"$initialize",o=function(t,e,r,i){return this.name=t,this.items=[e,e,r,r,i,i].$freeze()},o.$$arity=4)}(c[0],i(c,"D66GridTable"),c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_parity_table"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.truthy;return function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"DiceTable")].concat(s);!function(e,n,s){var c,o,l=a(e,null,"D66ParityTable"),u=[l].concat(s);l.$$prototype.odd=l.$$prototype.even=l.$$prototype.name=r,t.def(l,"$initialize",c=function(t,e,r){return this.name=t,this.odd=e.$freeze(),this.even=r.$freeze()},c.$$arity=3),t.def(l,"$roll",o=function(t){var e,n,a,s,c=r;return c=t.$roll_once(6),e=t.$roll_once(6),n=($(c["$odd?"]())?this.odd:this.even)["$[]"]("number"==typeof(s=e)?s-1:s["$-"](1)),a=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}(function(t,e){return"number"==typeof t?10*t:t["$*"](10)}(c),e),i(u,"RollResult").$new(this.name,a,n)},o.$$arity=1)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_range_table"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.send;return function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"DiceTable")].concat(s);!function(e,n,s){var c,o,l=a(e,null,"D66RangeTable"),u=[l].concat(s);l.$$prototype.items=l.$$prototype.name=r,t.def(l,"$initialize",c=function(t,e){return this.name=t,this.items=e.$freeze()},c.$$arity=2),t.def(l,"$roll",o=function(t){var e,n,a,s,c,o=r;return n=t.$roll_once(6),a=t.$roll_once(6),s=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}("number"==typeof(c=n)?10*c:c["$*"](10),a),o=$(this.items,"find",[],((e=function(t){return null==t&&(t=r),t["$[]"](0)["$include?"](s)}).$$s=this,e.$$arity=1,e)),i(u,"RollResult").$new(this.name,s,o["$[]"](1))},o.$$arity=1)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/dice_table/d66_table"]=function(t){var e=[],r=t.nil,i=t.$$$,n=t.$$,a=t.module,$=t.klass,s=t.hash2,c=t.truthy;return function(e,o){var l=[a(e,"BCDice")].concat(o);!function(e,o){var l=[a(e,"DiceTable")].concat(o);!function(e,a,o){var l,u,_,d=$(e,null,"D66Table"),f=[d].concat(o);d.$$prototype.sort_type=d.$$prototype.items=d.$$prototype.name=r,t.defs(d,"$from_i18n",l=function(t,e){var i,a=r;return a=n(f,"I18n").$t(t,s(["locale"],{locale:e})),i=n(f,"D66SortType").$const_get(a["$[]"]("d66_sort_type")),this.$new(a["$[]"]("name"),i,a["$[]"]("items"))},l.$$arity=2),t.def(d,"$initialize",u=function(t,e,r){return this.name=t,this.sort_type=e,this.items=r.$freeze()},u.$$arity=3),t.def(d,"$roll",_=function(t){var e,a,$,s=r,o=r,l=r;return s=t.$roll_barabara(2,6),e=this.sort_type,i(n(f,"D66SortType"),"ASC")["$==="](e)?s["$sort!"]():i(n(f,"D66SortType"),"DESC")["$==="](e)&&s["$sort!"]()["$reverse!"](),o=function(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}("number"==typeof(a=s["$[]"](0))?10*a:a["$*"](10),s["$[]"](1)),l=c($=this.items["$[]"](o))?$:this.items["$[]"](o.$to_s()),c(l["$respond_to?"]("roll"))&&(l=l.$roll(t)),n(f,"RollResult").$new(this.name,o,l)},_.$$arity=1)}(l[0],0,l)}(l[0],l)}(e[0],e)},Opal.modules["bcdice/dice_table/range_table"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.send,s=t.truthy;return function(e,c){var o=[n(e,"BCDice")].concat(c);!function(e,c){var o=[n(e,"DiceTable")].concat(c);!function(e,n,c){var o,l,u,_,d,f,h,p,m,y=a(e,null,"RangeTable"),b=[y].concat(c);y.$$prototype.name=y.$$prototype.items=y.$$prototype.num_of_dice=y.$$prototype.num_of_sides=y.$$prototype.formatter=r,t.const_set(b[0],"RollResult",$(i(b,"Struct"),"new",["sum","values","content","formatted"],((o=function(){return(null==o.$$s?this:o.$$s).$alias_method("to_s","formatted")}).$$s=y,o.$$arity=0,o))),t.const_set(b[0],"Item",i(b,"Struct").$new("range","content")),t.const_set(b[0],"DICE_ROLL_METHOD_RE",/^(\d+)D(\d+)$/i.$freeze()),t.const_set(b[0],"DEFAULT_FORMATTER",$(y,"lambda",[],($$2=function(t,e){return null==$$2.$$s||$$2,null==t&&(t=r),null==e&&(e=r),t.$name()+"("+e.$sum()+") \uff1e "+e.$content()},$$2.$$s=y,$$2.$$arity=2,$$2))),y.$attr_reader("name"),y.$attr_reader("num_of_dice"),y.$attr_reader("num_of_sides"),t.def(y,"$initialize",l=function(t,e,n){var a,$=l.$$p,c=$||r,o=r;return $&&(l.$$p=null),$&&(l.$$p=null),this.name=t.$freeze(),this.formatter=s(a=c)?a:i(b,"DEFAULT_FORMATTER"),o=i(b,"DICE_ROLL_METHOD_RE").$match(e),s(o)||this.$raise(i(b,"ArgumentError"),this.name+": invalid dice roll method: "+e),this.num_of_dice=o["$[]"](1).$to_i(),this.num_of_sides=o["$[]"](2).$to_i(),this.$store(n)},l.$$arity=3),t.def(y,"$fetch",u=function(t){var e,n;return n=$(this.items,"find",[],((e=function(e){return null==e&&(e=r),e.$range()["$include?"](t)}).$$s=this,e.$$arity=1,e)),s(n)||this.$raise(i(b,"RangeError"),this.name+": value is out of range: "+t),n},u.$$arity=1),t.def(y,"$roll",_=function(e){var n,a,s,c,o=r;return n=(o=e.$roll_barabara(this.num_of_dice,this.num_of_sides)).$sum(),a=i(b,"RollResult").$new(n,o,this.$fetch(n).$content()),s=[this.formatter["$[]"](this,a)],$(a,"formatted=",t.to_a(s)),"number"==typeof(c=s.length)||c["$-"](1),a},_.$$arity=1),y.$private(),t.def(y,"$store",d=function(t){var e,n,a,s,c;return s=$(t,"map",[],((e=function(t,i){return null==t&&(t=r),null==i&&(i=r),[(null==e.$$s?this:e.$$s).$coerce_to_int_range(t),i]}).$$s=this,e.$$arity=2,e)),c=$(s,"sort_by",[],((n=function(t,e){return null==t&&(t=r),null==e&&(e=r),t.$min()}).$$s=this,n.$$arity=2,n)),this.$assert_min_sum_is_covered(c),this.$assert_max_sum_is_covered(c),this.$assert_no_gap_or_overlap_in_ranges(c),this.items=$(c,"map",[],(a=function(t,e){return null==t&&(t=r),null==e&&(e=r),i(b,"Item").$new(t,e.$freeze()).$freeze()},a.$$s=this,a.$$arity=2,a)).$freeze(),this},d.$$arity=1),t.def(y,"$coerce_to_int_range",f=function(t){var e,n=r;return e=t,i(b,"Integer")["$==="](e)?i(b,"Range").$new(t,t):i(b,"Range")["$==="](e)&&s(s(n=t.$begin()["$is_a?"](i(b,"Integer")))?t.$end()["$is_a?"](i(b,"Integer")):n)?t:this.$raise(i(b,"TypeError"),this.name+": "+t+" ("+t.$class()+") must be an Integer or a Range with Integers ")},f.$$arity=1),t.def(y,"$assert_min_sum_is_covered",h=function(t){var e,n=r;return e=this.num_of_dice,n=t.$first()["$[]"](0),s(n["$include?"](e))||this.$raise(i(b,"RangeError"),this.name+": min value ("+e+") is not covered: "+n),this},h.$$arity=1),t.def(y,"$assert_max_sum_is_covered",p=function(t){var e,n,a,$=r;return n=this.num_of_sides,a="number"==typeof(e=this.num_of_dice)&&"number"==typeof n?e*n:e["$*"](n),$=t.$last()["$[]"](0),s($["$include?"](a))||this.$raise(i(b,"RangeError"),this.name+": max value ("+a+") is not covered: "+$),this},p.$$arity=1),t.def(y,"$assert_no_gap_or_overlap_in_ranges",m=function(t){var e;return $(t,"each_cons",[2],((e=function(t,n){var a,$,c,o=null==e.$$s?this:e.$$s,l=r,u=r;return null==o.name&&(o.name=r),null==t&&(t=r),null==n&&(n=r),l=t["$[]"](0),u=n["$[]"](0),c="number"==typeof($=a=l.$max())?$+1:$["$+"](1),s(u["$include?"](a))&&o.$raise(i(b,"RangeError"),o.name+": Range overlap: "+l+" and "+u),s(u["$include?"](c))?r:o.$raise(i(b,"RangeError"),o.name+": Range gap: "+l+" and "+u)}).$$s=this,e.$$arity=2,e)),this},m.$$arity=1)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/category"]=function(t){var e=[],r=t.nil,i=t.$$$,n=t.$$,a=t.module,$=t.klass,s=t.send;return function(e,c){var o=[a(e,"BCDice")].concat(c);!function(e,c){var o=[a(e,"DiceTable")].concat(c);!function(e,a,c){var o=[$(e,null,"SaiFicSkillTable")].concat(c);!function(e,a,c){var o,l,u,_=$(e,null,"Category"),d=[_].concat(c);_.$$prototype.name=r,t.def(_,"$initialize",o=function(t,e,a,$){var c;return this.name=t,this.skills=s(e.$map(),"with_index",[2],((c=function(e,s){return null==e&&(e=r),null==s&&(s=r),i(n(d,"SaiFicSkillTable"),"Skill").$new(t,e,a,s,$)}).$$s=this,c.$$arity=2,c)),this.dice=a},o.$$arity=4),t.def(_,"$roll",l=function(t){var e;return this.$skills()["$[]"]("number"==typeof(e=t.$roll_sum(2,6))?e-2:e["$-"](2))},l.$$arity=1),t.def(_,"$to_s",u=function(){return this.name},u.$$arity=0),_.$attr_reader("name","dice","skills")}(o[0],0,o)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table/sai_fic_skill_table/skill"]=function(t){var e=[],r=t.nil,i=t.module,n=t.klass,a=t.hash2;return function(e,$){var s=[i(e,"BCDice")].concat($);!function(e,$){var s=[i(e,"DiceTable")].concat($);!function(e,i,$){var s=[n(e,null,"SaiFicSkillTable")].concat($);!function(e,i,$){var s,c,o=n(e,null,"Skill");[o].concat($),o.$$prototype.s_format=o.$$prototype.category_dice=o.$$prototype.row_dice=o.$$prototype.category_name=o.$$prototype.name=r,t.def(o,"$initialize",s=function(t,e,r,i,n){return this.category_name=t,this.name=e,this.category_dice=r,this.row_dice=i,this.s_format=n},s.$$arity=5),t.def(o,"$to_s",c=function(){return this.$format(this.s_format,a(["category_dice","row_dice","category_name","skill_name"],{category_dice:this.category_dice,row_dice:this.row_dice,category_name:this.category_name,skill_name:this.name}))},c.$$arity=0),o.$attr_reader("category_name","name","category_dice","row_dice")}(s[0],0,s)}(s[0],0,s)}(s[0],s)}(e[0],e)},Opal.modules["bcdice/dice_table/sai_fic_skill_table"]=function(t){var e=t.top,r=[],i=t.nil,n=t.$$$,a=t.$$,$=t.module,s=t.klass,c=t.hash2,o=t.send,l=t.truthy;return e.$require("bcdice/dice_table/sai_fic_skill_table/category"),e.$require("bcdice/dice_table/sai_fic_skill_table/skill"),function(e,r){var u=[$(e,"BCDice")].concat(r);!function(e,r){var u=[$(e,"DiceTable")].concat(r);!function(e,r,$){var u,_,d,f,h,p,m,y=s(e,null,"SaiFicSkillTable"),b=[y].concat($);y.$$prototype.rtt=y.$$prototype.rtt_format=y.$$prototype.rct=y.$$prototype.rct_format=y.$$prototype.rttn=y.$$prototype.rttn_format=y.$$prototype.categories=i,t.defs(y,"$from_i18n",u=function(e,r,n){var $,s,l,u,_,d=i;if(null==n)n=c([],{});else if(!n.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return null==($=n.$$smap.rtt)&&($=i),null==(s=n.$$smap.rct)&&(s=i),null==(l=n.$$smap.rttn)&&(l=i),_=(d=a(b,"I18n").$t("RTT",c(["locale","raise","default"],{locale:r,raise:!1,default:c([],{})})).$merge(a(b,"I18n").$t(e,c(["locale","raise"],{locale:r,raise:!0}))))["$[]"]("items"),d=o(d,"select",[],((u=function(t,e){return null==t&&(t=i),null==e&&(e=i),["rtt_format","rttn_format","rct_format","s_format"]["$include?"](t)}).$$s=this,u.$$arity=2,u)),this.$new(_,t.to_hash(d).$merge(c(["rtt","rct","rttn"],{rtt:$,rct:s,rttn:l})))},u.$$arity=-3),t.const_set(b[0],"DEFAULT_RTT","\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<category_dice>d,%<row_dice>d) \uff1e %<text>s"),t.const_set(b[0],"DEFAULT_RCT","\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868(%<category_dice>d) \uff1e %<category_name>s"),t.const_set(b[0],"DEFAULT_RTTN","%<category_name>s\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868(%<row_dice>d) \uff1e %<text>s"),t.const_set(b[0],"DEFAULT_S","\u300a%<skill_name>s\uff0f%<category_name>s%<row_dice>d\u300b"),t.def(y,"$initialize",_=function(e,r){var $,s,l,u,_,d,f,h;if(null==r)r=c([],{});else if(!r.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return null==($=r.$$smap.rtt)&&($=i),null==(s=r.$$smap.rct)&&(s=i),null==(l=r.$$smap.rttn)&&(l=i),null==(u=r.$$smap.rtt_format)&&(u=a(b,"DEFAULT_RTT")),null==(_=r.$$smap.rct_format)&&(_=a(b,"DEFAULT_RCT")),null==(d=r.$$smap.rttn_format)&&(d=a(b,"DEFAULT_RTTN")),null==(f=r.$$smap.s_format)&&(f=a(b,"DEFAULT_S")),this.categories=o(e.$map(),"with_index",[1],((h=function(e,r){var $,s,c;return null==e&&(e=i),null==r&&(r=i),s=null==($=t.to_ary(e))[0]?i:$[0],c=null==$[1]?i:$[1],n(a(b,"SaiFicSkillTable"),"Category").$new(s,c,r,f)}).$$s=this,h.$$arity=2,h.$$has_top_level_mlhs_arg=!0,h)),this.rtt=$,this.rct=s,this.rttn=l.$to_a(),this.rtt_format=u,this.rct_format=_,this.rttn_format=d},_.$$arity=-2),t.const_set(b[0],"RTTN",["RTT1","RTT2","RTT3","RTT4","RTT5","RTT6"].$freeze()),y.$attr_reader("categories"),t.def(y,"$roll_command",d=function(t,e){var r,n=i,$=i,s=i;return l(["RTT",this.rtt]["$include?"](r=e))?this.$format_skill(this.rtt_format,this.$roll_skill(t)):l(["RCT",this.rct]["$include?"](r))?(n=this.$roll_category(t),this.$format(this.rct_format,c(["category_dice","category_name"],{category_dice:n.$dice(),category_name:n.$name()}))):l(l($=s=a(b,"RTTN").$index(r))?$:s=this.rttn.$index(r))?this.$format_skill(this.rttn_format,this.categories["$[]"](s).$roll(t)):i},d.$$arity=2),t.def(y,"$roll_category",f=function(t){var e;return this.categories["$[]"]("number"==typeof(e=t.$roll_once(6))?e-1:e["$-"](1))},f.$$arity=1),t.def(y,"$roll_skill",h=function(t){return this.$roll_category(t).$roll(t)},h.$$arity=1),t.def(y,"$prefixes",p=function(){var t,e;return(t=["RTT[1-6]?","RCT",this.rtt,this.rct],e=this.rttn,"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)).$compact()},p.$$arity=0),y.$private(),t.def(y,"$format_skill",m=function(t,e){return this.$format(t,c(["category_dice","row_dice","category_name","skill_name","text"],{category_dice:e.$category_dice(),row_dice:e.$row_dice(),category_name:e.$category_name(),skill_name:e.$name(),text:e.$to_s()}))},m.$$arity=2)}(u[0],0,u)}(u[0],u)}(r[0],r)},Opal.modules["bcdice/dice_table/table"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.hash2,s=t.truthy;return function(e,c){var o=[n(e,"BCDice")].concat(c);!function(e,c){var o=[n(e,"DiceTable")].concat(c);!function(e,n,c){var o,l,u,_,d=a(e,null,"Table"),f=[d].concat(c);d.$$prototype.times=d.$$prototype.sides=d.$$prototype.name=d.$$prototype.items=r,t.defs(d,"$from_i18n",o=function(t,e){var n=r;return n=i(f,"I18n").$t(t,$(["locale"],{locale:e})),this.$new(n["$[]"]("name"),n["$[]"]("type"),n["$[]"]("items"))},o.$$arity=2),t.def(d,"$initialize",l=function(t,e,n){var a=r;return this.name=t,this.items=n.$freeze(),a=/(\d+)D(\d+)/i.$match(e),s(a)||this.$raise(i(f,"ArgumentError"),"Unexpected table type: "+e),this.times=a["$[]"](1).$to_i(),this.sides=a["$[]"](2).$to_i()},l.$$arity=3),t.def(d,"$roll",u=function(t){var e;return e=t.$roll_sum(this.times,this.sides),this.$choice(e)},u.$$arity=1),t.def(d,"$choice",_=function(t){var e,r,n;return r=this.times,n="number"==typeof(e=t)&&"number"==typeof r?e-r:e["$-"](r),i(f,"RollResult").$new(this.name,t,this.items["$[]"](n))},_.$$arity=1)}(o[0],0,o)}(o[0],o)}(e[0],e)},Opal.modules["bcdice/dice_table"]=function(t){var e=t.top;return e.$require("bcdice/dice_table/roll_result"),e.$require("bcdice/dice_table/chain_table"),e.$require("bcdice/dice_table/d66_grid_table"),e.$require("bcdice/dice_table/d66_half_grid_table"),e.$require("bcdice/dice_table/d66_one_third_table"),e.$require("bcdice/dice_table/d66_parity_table"),e.$require("bcdice/dice_table/d66_range_table"),e.$require("bcdice/dice_table/d66_table"),e.$require("bcdice/dice_table/range_table"),e.$require("bcdice/dice_table/sai_fic_skill_table"),e.$require("bcdice/dice_table/table")},Opal.modules["bcdice/enum"]=function(t){var e=[],r=t.module;return function(e,i){var n=[r(e,"BCDice")].concat(i);!function(e,i){var n=[r(e,"D66SortType")].concat(i);t.const_set(n[0],"NO_SORT","no_sort"),t.const_set(n[0],"ASC","asc"),t.const_set(n[0],"DESC","desc")}(n[0],n),function(e,i){var n=[r(e,"RoundType")].concat(i);t.const_set(n[0],"CEIL","ceil"),t.const_set(n[0],"FLOOR","floor"),t.const_set(n[0],"ROUND","round")}(n[0],n)}(e[0],e)},Opal.modules["bcdice/translate"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.hash2;return function(e,$){var s=[n(e,"BCDice")].concat($);!function(e,$){var s,c=n(e,"Translate"),o=[c].concat($);t.def(c,"$translate",s=function(e,n){var $;if(null==this.locale&&(this.locale=r),null==n)n=a([],{});else if(!n.$$is_hash)throw t.ArgumentError.$new("expected kwargs");return $=t.kwrestargs(n,{}),i(o,"I18n").$translate(e,a(["locale","raise"],{locale:this.locale,raise:!0}).$merge(t.to_hash($)))},s.$$arity=-2)}(s[0],s)}(e[0],e)},Opal.modules["bcdice/result"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r=[],i=t.nil,n=t.module,a=t.klass,$=t.send;return function(r,s){var c=[n(r,"BCDice")].concat(s);!function(r,n,s){var c,o,l,u,_,d,f,h=a(r,null,"Result"),p=[h].concat(s);h.$$prototype.secret=h.$$prototype.success=h.$$prototype.failure=h.$$prototype.critical=h.$$prototype.fumble=i,function(r,n){var a,s,c,o,l;[r].concat(n),t.def(r,"$success",a=function(r){var n;return $(this.$new(),"tap",[],((n=function(n){var a=i;return null==n&&(n=i),$(n,"text=",t.to_a(a=[r])),e(a.length,1),$(n,"success=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,n.$$arity=1,n))},a.$$arity=1),t.def(r,"$failure",s=function(r){var n;return $(this.$new(),"tap",[],((n=function(n){var a=i;return null==n&&(n=i),$(n,"text=",t.to_a(a=[r])),e(a.length,1),$(n,"failure=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,n.$$arity=1,n))},s.$$arity=1),t.def(r,"$critical",c=function(r){var n;return $(this.$new(),"tap",[],((n=function(n){var a=i;return null==n&&(n=i),$(n,"text=",t.to_a(a=[r])),e(a.length,1),$(n,"critical=",t.to_a(a=[!0])),e(a.length,1),$(n,"success=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,n.$$arity=1,n))},c.$$arity=1),t.def(r,"$fumble",o=function(r){var n;return $(this.$new(),"tap",[],((n=function(n){var a=i;return null==n&&(n=i),$(n,"text=",t.to_a(a=[r])),e(a.length,1),$(n,"fumble=",t.to_a(a=[!0])),e(a.length,1),$(n,"failure=",t.to_a(a=[!0])),a[e(a.length,1)]}).$$s=this,n.$$arity=1,n))},o.$$arity=1),t.def(r,"$nothing",l=function(){return"nothing"},l.$$arity=0)}(t.get_singleton_class(h),p),t.def(h,"$initialize",c=function(t){return null==t&&(t=i),this.text=t,this.rands=i,this.detailed_rands=i,this.secret=!1,this.success=!1,this.failure=!1,this.critical=!1,this.fumble=!1},c.$$arity=-1),h.$attr_accessor("text","rands","detailed_rands"),h.$attr_writer("secret","success","failure","critical","fumble"),t.def(h,"$secret?",o=function(){return this.secret},o.$$arity=0),t.def(h,"$success?",l=function(){return this.success},l.$$arity=0),t.def(h,"$failure?",u=function(){return this.failure},u.$$arity=0),t.def(h,"$critical?",_=function(){return this.critical},_.$$arity=0),t.def(h,"$fumble?",d=function(){return this.fumble},d.$$arity=0),t.def(h,"$condition=",f=function(t){return this.success=t,this.failure=t["$!"]()},f.$$arity=1)}(c[0],0,c)}(r[0],r)},Opal.modules["racc/parser"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t<e:t["$<"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:t["$>="](e)}function a(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}var $=[],s=t.nil,c=t.$$$,o=t.$$,l=t.module,u=t.klass,_=t.truthy,d=t.gvars,f=t.send;return function(t,e){var r=[l(t,"Racc")].concat(e);!function(t,e,r){[u(t,e,"ParseError")].concat(r)}(r[0],o(r,"StandardError"),r)}($[0],$),_(c("::","ParseError","skip_raise")?"constant":s)||t.const_set($[0],"ParseError",c(o($,"Racc"),"ParseError")),function($,h){var p=[l($,"Racc")].concat(h);_(o(p,"Racc_No_Extensions","skip_raise")?"constant":s)||t.const_set(p[0],"Racc_No_Extensions",!1),function($,l,h){var p,m,y,b,g,T,v,k,R,S,D,x,w,E,L,M,C,A,I,P,O,z,B,N,F=u($,null,"Parser"),q=[F].concat(h);F.$$prototype.yydebug=F.$$prototype.racc_debug_out=F.$$prototype.racc_error_status=F.$$prototype.racc_t=F.$$prototype.racc_vstack=F.$$prototype.racc_val=F.$$prototype.racc_state=F.$$prototype.racc_tstack=s,t.const_set(q[0],"Racc_Runtime_Version","1.4.6"),t.const_set(q[0],"Racc_Runtime_Revision",["originalRevision:","1.8"]["$[]"](1)),t.const_set(q[0],"Racc_Runtime_Core_Version_R","1.4.6"),t.const_set(q[0],"Racc_Runtime_Core_Revision_R",["originalRevision:","1.8"]["$[]"](1)),t.const_set(q[0],"Racc_Main_Parsing_Routine","_racc_do_parse_rb"),t.const_set(q[0],"Racc_YY_Parse_Method","_racc_yyparse_rb"),t.const_set(q[0],"Racc_Runtime_Core_Version",o(q,"Racc_Runtime_Core_Version_R")),t.const_set(q[0],"Racc_Runtime_Core_Revision",o(q,"Racc_Runtime_Core_Revision_R")),t.const_set(q[0],"Racc_Runtime_Type","ruby"),t.defs(o(q,"Parser"),"$racc_runtime_type",p=function(){return o(q,"Racc_Runtime_Type")},p.$$arity=0),t.def(F,"$_racc_setup",m=function(){var i,n,a=s,$=s,o=s;return null==d.stderr&&(d.stderr=s),_(c(this.$class(),"Racc_debug_parser"))||(this.yydebug=!1),_(null!=(i=this.yydebug)&&i!==s?"instance-variable":s)||(this.yydebug=!1),_(this.yydebug)&&(_(null!=(n=this.racc_debug_out)&&n!==s?"instance-variable":s)||(this.racc_debug_out=d.stderr),this.racc_debug_out=_(a=this.racc_debug_out)?a:d.stderr),$=c(this.$class(),"Racc_arg"),_(e($.$size(),14))&&(f($,"[]=",t.to_a(o=[13,!0])),r(o.length,1)),$},m.$$arity=0),t.def(F,"$_racc_init_sysvars",y=function(){return this.racc_state=[0],this.racc_tstack=[],this.racc_vstack=[],this.racc_t=s,this.racc_val=s,this.racc_read_next=!0,this.racc_user_yyerror=!1,this.racc_error_status=0},y.$$arity=0),t.def(F,"$do_parse",b=function(){return this.$__send__(o(q,"Racc_Main_Parsing_Routine"),this.$_racc_setup(),!1)},b.$$arity=0),t.def(F,"$next_token",g=function(){return this.$raise(o(q,"NotImplementedError"),this.$class()+"#next_token is not defined")},g.$$arity=0),t.def(F,"$_racc_do_parse_rb",T=function(e,r){var a,$,c=s,o=s,l=s,u=s,d=s,h=s,p=s,m=s;return a=t.to_ary(e),c=null==a[0]?s:a[0],o=null==a[1]?s:a[1],l=null==a[2]?s:a[2],u=null==a[3]?s:a[3],d=null==a[10]?s:a[10],this.$_racc_init_sysvars(),h=p=m=s,f(this,"catch",["racc_end_parse"],(($=function(){var r,a,f=null==$.$$s?this:$.$$s,y=s,b=s,g=s;for(null==f.racc_state&&(f.racc_state=s),null==f.racc_read_next&&(f.racc_read_next=s),null==f.racc_t&&(f.racc_t=s),null==f.yydebug&&(f.yydebug=s),null==f.racc_val&&(f.racc_val=s);_(!0);)for(_(m=u["$[]"](f.racc_state["$[]"](-1)))?(_(f.racc_read_next)&&_(f.racc_t["$!="](0))&&(a=f.$next_token(),r=t.to_ary(a),h=null==r[0]?s:r[0],f.racc_val=null==r[1]?s:r[1],f.racc_t=_(h)?_(y=d["$[]"](h))?y:1:0,_(f.yydebug)&&f.$racc_read_token(f.racc_t,h,f.racc_val),f.racc_read_next=!1),m=i(m,f.racc_t),_(_(b=_(g=n(m,0))?p=c["$[]"](m):g)?o["$[]"](m)["$=="](f.racc_state["$[]"](-1)):b)||(p=l["$[]"](f.racc_state["$[]"](-1)))):p=l["$[]"](f.racc_state["$[]"](-1));_(p=f.$_racc_evalact(p,e)););}).$$s=this,$.$$arity=0,$))},T.$$arity=2),t.def(F,"$yyparse",v=function(t,e){return this.$__send__(o(q,"Racc_YY_Parse_Method"),t,e,this.$_racc_setup(),!0)},v.$$arity=2),t.def(F,"$_racc_yyparse_rb",k=function(e,r,a,$){var c,o,l=s,u=s,d=s,h=s,p=s,m=s,y=s;return c=t.to_ary(a),l=null==c[0]?s:c[0],u=null==c[1]?s:c[1],d=null==c[2]?s:c[2],h=null==c[3]?s:c[3],p=null==c[10]?s:c[10],this.$_racc_init_sysvars(),m=s,y=s,f(this,"catch",["racc_end_parse"],((o=function(){var t,$=null==o.$$s?this:o.$$s;for(null==$.racc_state&&($.racc_state=s);!_(y=h["$[]"]($.racc_state["$[]"](-1)));)for(;_(m=$.$_racc_evalact(d["$[]"]($.racc_state["$[]"](-1)),a)););return f(e,"__send__",[r],((t=function(e,r){var $,c,o=null==t.$$s?this:t.$$s,f=s,b=s,g=s,T=s,v=s,k=s,R=s;for(null==o.racc_t&&(o.racc_t=s),null==o.racc_state&&(o.racc_state=s),null==o.racc_read_next&&(o.racc_read_next=s),null==e&&(e=s),null==r&&(r=s),o.racc_t=_(e)?_(f=p["$[]"](e))?f:1:0,o.racc_val=r,o.racc_read_next=!1,y=i(y,o.racc_t),_(_($=_(c=n(y,0))?m=l["$[]"](y):c)?u["$[]"](y)["$=="](o.racc_state["$[]"](-1)):$)||(m=d["$[]"](o.racc_state["$[]"](-1)));_(m=o.$_racc_evalact(m,a)););for(;_(_(b=_(g=(y=h["$[]"](o.racc_state["$[]"](-1)))["$!"]())?g:o.racc_read_next["$!"]())?b:o.racc_t["$=="](0));)for(_(_(T=_(v=_(k=_(R=y)?y=i(y,o.racc_t):R)?n(y,0):k)?m=l["$[]"](y):v)?u["$[]"](y)["$=="](o.racc_state["$[]"](-1)):T)||(m=d["$[]"](o.racc_state["$[]"](-1)));_(m=o.$_racc_evalact(m,a)););}).$$s=$,t.$$arity=2,t))}).$$s=this,o.$$arity=0,o))},k.$$arity=4),t.def(F,"$_racc_evalact",R=function($,c){var o,l,u,d,h,p=s,m=s,y=s,b=s,g=s,T=s,v=s,k=s,R=s,S=s;if(p=null==(o=t.to_ary(c))[0]?s:o[0],m=null==o[1]?s:o[1],y=null==o[3]?s:o[3],u=null==o[11]?s:o[11],b=null==o[12]?s:o[12],_(_(h=a($,0))?e($,u):h))_(a(this.racc_error_status,0))&&(this.racc_t["$=="](1)||(this.racc_error_status=r(this.racc_error_status,1))),this.racc_vstack.$push(this.racc_val),this.racc_state.$push($),this.racc_read_next=!0,_(this.yydebug)&&(this.racc_tstack.$push(this.racc_t),this.$racc_shift(this.racc_t,this.racc_tstack,this.racc_vstack));else if(_(_(g=e($,0))?a($,b["$-@"]()):g)){if(T=f(this,"catch",["racc_jump"],((l=function(){var t=null==l.$$s?this:l.$$s;return null==t.racc_state&&(t.racc_state=s),t.racc_state.$push(t.$_racc_do_reduce(c,$)),!1}).$$s=this,l.$$arity=0,l)),_(T)){if(1["$==="](v=T))return this.racc_user_yyerror=!0,b["$-@"]();if(2["$==="](v))return u;this.$raise("[Racc Bug] unknown jump code")}}else if($["$=="](u))_(this.yydebug)&&this.$racc_accept(),this.$throw("racc_end_parse",this.racc_vstack["$[]"](0));else{if($["$=="](b["$-@"]())){for((0)["$==="](v=this.racc_error_status)?_(c["$[]"](21))||this.$on_error(this.racc_t,this.racc_val,this.racc_vstack):3["$==="](v)&&(this.racc_t["$=="](0)&&this.$throw("racc_end_parse",s),this.racc_read_next=!0),this.racc_user_yyerror=!1,this.racc_error_status=3;_(!0)&&(!_(k=y["$[]"](this.racc_state["$[]"](-1)))||(k=i(k,1),!_(_(R=_(S=n(k,0))?$=p["$[]"](k):S)?m["$[]"](k)["$=="](this.racc_state["$[]"](-1)):R)));)_("number"==typeof(d=this.racc_state.$size())?d<=1:d["$<="](1))&&this.$throw("racc_end_parse",s),this.racc_state.$pop(),this.racc_vstack.$pop(),_(this.yydebug)&&(this.racc_tstack.$pop(),this.$racc_e_pop(this.racc_state,this.racc_tstack,this.racc_vstack));return $}this.$raise("[Racc Bug] unknown action "+$.$inspect())}return _(this.yydebug)&&this.$racc_next_state(this.racc_state["$[]"](-1),this.racc_state),s},R.$$arity=2),t.def(F,"$_racc_do_reduce",S=function(e,a){var $,c,o,l,u,d,h,p,m=s,y=s,b=s,g=s,T=s,v=s,k=s,R=s,S=s,D=s,x=s,w=s,E=s,L=s,M=s,C=s;return m=null==($=t.to_ary(e))[4]?s:$[4],y=null==$[5]?s:$[5],b=null==$[6]?s:$[6],g=null==$[7]?s:$[7],c=null==$[8]?s:$[8],T=null==$[9]?s:$[9],o=null==$[13]?s:$[13],v=this.racc_state,k=this.racc_vstack,R=this.racc_tstack,S="number"==typeof(p=a)?-3*p:p["$*"](-3),D=T["$[]"](S),l=T["$[]"](i(S,1)),u=T["$[]"](i(S,2)),d=[],_(this.yydebug)&&(x=R["$[]"](D["$-@"](),D)),w=k["$[]"](D["$-@"](),D),_(this.yydebug)&&(E=[D["$-@"](),D,d],f(R,"[]=",t.to_a(E)),r(E.length,1)),E=[D["$-@"](),D,d],f(k,"[]=",t.to_a(E)),r(E.length,1),E=[D["$-@"](),D,d],f(v,"[]=",t.to_a(E)),r(E.length,1),_(o)?k.$push(this.$__send__(u,w,k,w["$[]"](0))):k.$push(this.$__send__(u,w,k)),R.$push(l),_(this.yydebug)&&this.$racc_reduce(x,l,R,k),h=r(l,c),_(S=g["$[]"](h))&&(S=i(S,v["$[]"](-1)),_(_(L=_(M=n(S,0))?C=m["$[]"](S):M)?y["$[]"](S)["$=="](h):L))?C:b["$[]"](h)},S.$$arity=2),t.def(F,"$on_error",D=function(t,e,r){var i;return this.$raise(o(q,"ParseError"),this.$sprintf("\nparse error on value %s (%s)",e.$inspect(),_(i=this.$token_to_str(t))?i:"?"))},D.$$arity=3),t.def(F,"$yyerror",x=function(){return this.$throw("racc_jump",1)},x.$$arity=0),t.def(F,"$yyaccept",w=function(){return this.$throw("racc_jump",2)},w.$$arity=0),t.def(F,"$yyerrok",E=function(){return this.racc_error_status=0},E.$$arity=0),t.def(F,"$racc_read_token",L=function(t,e,r){return this.racc_debug_out.$print("read    "),this.racc_debug_out.$print(e.$inspect(),"(",this.$racc_token2str(t),") "),this.racc_debug_out.$puts(r.$inspect()),this.racc_debug_out.$puts()},L.$$arity=3),t.def(F,"$racc_shift",M=function(t,e,r){return this.racc_debug_out.$puts("shift   "+this.$racc_token2str(t)),this.$racc_print_stacks(e,r),this.racc_debug_out.$puts()},M.$$arity=3),t.def(F,"$racc_reduce",C=function(t,e,r,i){var n,a=s;return(a=this.racc_debug_out).$print("reduce "),_(t["$empty?"]())?a.$print(" <none>"):f(t,"each",[],((n=function(t){return null==t&&(t=s),a.$print(" ",(null==n.$$s?this:n.$$s).$racc_token2str(t))}).$$s=this,n.$$arity=1,n)),a.$puts(" --\x3e "+this.$racc_token2str(e)),this.$racc_print_stacks(r,i),this.racc_debug_out.$puts()},C.$$arity=4),t.def(F,"$racc_accept",A=function(){return this.racc_debug_out.$puts("accept"),this.racc_debug_out.$puts()},A.$$arity=0),t.def(F,"$racc_e_pop",I=function(t,e,r){return this.racc_debug_out.$puts("error recovering mode: pop token"),this.$racc_print_states(t),this.$racc_print_stacks(e,r),this.racc_debug_out.$puts()},I.$$arity=3),t.def(F,"$racc_next_state",P=function(t,e){return this.racc_debug_out.$puts("goto    "+t),this.$racc_print_states(e),this.racc_debug_out.$puts()},P.$$arity=2),t.def(F,"$racc_print_stacks",O=function(t,e){var r,i=s;return(i=this.racc_debug_out).$print("        ["),f(t,"each_index",[],((r=function(n){return null==n&&(n=s),i.$print(" (",(null==r.$$s?this:r.$$s).$racc_token2str(t["$[]"](n))," ",e["$[]"](n).$inspect(),")")}).$$s=this,r.$$arity=1,r)),i.$puts(" ]")},O.$$arity=2),t.def(F,"$racc_print_states",z=function(t){var e,r=s;return(r=this.racc_debug_out).$print("        ["),f(t,"each",[],((e=function(t){return null==t&&(t=s),r.$print(" ",t)}).$$s=this,e.$$arity=1,e)),r.$puts(" ]")},z.$$arity=1),t.def(F,"$racc_token2str",B=function(t){var e;return _(e=c(this.$class(),"Racc_token_to_s_table")["$[]"](t))?e:this.$raise("[Racc Bug] can't convert token "+t+" to string")},B.$$arity=1),t.def(F,"$token_to_str",N=function(t){return c(this.$class(),"Racc_token_to_s_table")["$[]"](t)},N.$$arity=1)}(p[0],0,p)}($[0],$)},Opal.modules["bcdice/arithmetic/node"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t/e:t["$/"](e)}var r=[],i=t.nil,n=t.$$$,a=t.$$,$=t.module,s=t.klass,c=t.send2;return function(r,o){var l=[$(r,"BCDice")].concat(o);!function(r,o){var l=[$(r,"Arithmetic")].concat(o);!function(r,o){var l=[$(r,"Node")].concat(o);!function(e,r,n){var a,$,c,o,l,u=s(e,null,"BinaryOp");[u].concat(n),u.$$prototype.lhs=u.$$prototype.rhs=u.$$prototype.op=i,t.def(u,"$initialize",a=function(t,e,r){return this.lhs=t,this.op=e,this.rhs=r},a.$$arity=3),t.def(u,"$eval",$=function(t){var e,r=i;return r=this.lhs.$eval(t),e=this.rhs.$eval(t),r.$send(this.op,e)},$.$$arity=1),t.def(u,"$output",c=function(){return""+this.lhs.$output()+this.op+this.rhs.$output()},c.$$arity=0),t.def(u,"$s_exp",o=function(){return"("+this.$op_for_s_exp()+" "+this.lhs.$s_exp()+" "+this.rhs.$s_exp()+")"},o.$$arity=0),t.def(u,"$op_for_s_exp",l=function(){return this.op},l.$$arity=0)}(l[0],0,l),function(e,r,$){var o,l,u,_,d,f,h=s(e,r,"DivideBase"),p=[h].concat($);h.$$prototype.lhs=h.$$prototype.rhs=h.$$prototype.op=i,t.def(h,"$initialize",o=function(e,r){return o.$$p&&(o.$$p=null),c(this,t.find_super_dispatcher(this,"initialize",o,!1,!0),"initialize",[e,"/",r],null)},o.$$arity=2),t.def(h,"$eval",l=function(t){var e,r=i;return e=this.lhs.$eval(t),(r=this.rhs.$eval(t))["$=="](0)&&this.$raise(a(p,"ZeroDivisionError")),this.$divide_and_round(e,r,t)},l.$$arity=1),t.def(h,"$output",u=function(){var e=u.$$p,r=this,n=i,a=i,$=i;for(e&&(u.$$p=null),a=0,$=arguments.length,n=new Array($);a<$;a++)n[a]=arguments[a];return""+c(r,t.find_super_dispatcher(r,"output",u,!1,!0),"output",n,e)+r.$rounding_method()},u.$$arity=0),h.$private(),t.def(h,"$rounding_method",_=function(){return n(this.$class(),"ROUNDING_METHOD")},_.$$arity=0),t.def(h,"$op_for_s_exp",d=function(){return""+this.op+this.$rounding_method()},d.$$arity=0),t.def(h,"$divide_and_round",f=function(t,e,r){return this.$raise(a(p,"NotImplementedError"))},f.$$arity=3)}(l[0],a(l,"BinaryOp"),l),function(r,i,$){var c,o=s(r,i,"DivideWithGameSystemDefault"),l=[o].concat($);t.const_set(l[0],"ROUNDING_METHOD",""),o.$private(),t.def(o,"$divide_and_round",c=function(t,r,i){var $;return $=i,n(a(l,"RoundType"),"CEIL")["$==="]($)?e(t.$to_f(),r).$ceil():n(a(l,"RoundType"),"ROUND")["$==="]($)?e(t.$to_f(),r).$round():e(t,r).$to_i()},c.$$arity=3)}(l[0],a(l,"DivideBase"),l),function(r,i,n){var a,$=s(r,i,"DivideWithCeil"),c=[$].concat(n);t.const_set(c[0],"ROUNDING_METHOD","C"),$.$private(),t.def($,"$divide_and_round",a=function(t,r,i){return e(t.$to_f(),r).$ceil()},a.$$arity=3)}(l[0],a(l,"DivideBase"),l),function(r,i,n){var a,$=s(r,i,"DivideWithRound"),c=[$].concat(n);t.const_set(c[0],"ROUNDING_METHOD","R"),$.$private(),t.def($,"$divide_and_round",a=function(t,r,i){return e(t.$to_f(),r).$round()},a.$$arity=3)}(l[0],a(l,"DivideBase"),l),function(r,i,n){var a,$=s(r,i,"DivideWithFloor"),c=[$].concat(n);t.const_set(c[0],"ROUNDING_METHOD","F"),$.$private(),t.def($,"$divide_and_round",a=function(t,r,i){return e(t,r).$to_i()},a.$$arity=3)}(l[0],a(l,"DivideBase"),l),function(e,r,n){var a,$,c,o,l=s(e,null,"Negative");[l].concat(n),l.$$prototype.body=i,t.def(l,"$initialize",a=function(t){return this.body=t},a.$$arity=1),t.def(l,"$eval",$=function(t){return this.body.$eval(t)["$-@"]()},$.$$arity=1),t.def(l,"$output",c=function(){return"-"+this.body.$output()},c.$$arity=0),t.def(l,"$s_exp",o=function(){return"(- "+this.body.$s_exp()+")"},o.$$arity=0)}(l[0],0,l),function(e,r,n){var a,$,c,o,l=s(e,null,"Parenthesis");[l].concat(n),l.$$prototype.expr=i,t.def(l,"$initialize",a=function(t){return this.expr=t},a.$$arity=1),t.def(l,"$eval",$=function(t){return this.expr.$eval(t)},$.$$arity=1),t.def(l,"$output",c=function(){return"("+this.expr.$output()+")"},c.$$arity=0),t.def(l,"$s_exp",o=function(){return"(Parenthesis "+this.expr.$s_exp()+")"},o.$$arity=0)}(l[0],0,l),function(e,r,n){var a,$,c,o=s(e,null,"Number");[o].concat(n),o.$$prototype.value=i,t.def(o,"$initialize",a=function(t){return this.value=t},a.$$arity=1),t.def(o,"$eval",$=function(t){return this.value},$.$$arity=1),t.def(o,"$output",c=function(){return this.value.$to_s()},c.$$arity=0),t.alias(o,"s_exp","output")}(l[0],0,l)}(l[0],l)}(l[0],l)}(r[0],r)},Opal.modules.strscan=function(t){var e=[],r=t.nil,i=t.$$,n=t.klass,a=t.truthy,$=t.send;return function(e,s,c){var o,l,u,_,d,f,h,p,m,y,b,g,T,v,k,R,S,D,x,w,E,L,M,C,A,I=n(e,null,"StringScanner"),P=[I].concat(c);return I.$$prototype.pos=I.$$prototype.string=I.$$prototype.working=I.$$prototype.matched=I.$$prototype.prev_pos=I.$$prototype.match=r,I.$attr_reader("pos"),I.$attr_reader("matched"),t.def(I,"$initialize",o=function(t){return this.string=t,this.pos=0,this.matched=r,this.working=t,this.match=[]},o.$$arity=1),I.$attr_reader("string"),t.def(I,"$beginning_of_line?",l=function(){return 0===this.pos||"\n"===this.string.charAt(this.pos-1)},l.$$arity=0),t.alias(I,"bol?","beginning_of_line?"),t.def(I,"$scan",u=function(t){var e=(t=this.$anchor(t)).exec(this.working);return null==e?this.matched=r:"object"==typeof e?(this.prev_pos=this.pos,this.pos+=e[0].length,this.working=this.working.substring(e[0].length),this.matched=e[0],this.match=e,e[0]):"string"==typeof e?(this.pos+=e.length,this.working=this.working.substring(e.length),e):r},u.$$arity=1),t.def(I,"$scan_until",_=function(t){t=this.$anchor(t);for(var e,i=this.pos,n=this.working;;){if(e=t.exec(n),i+=1,n=n.substr(1),null!=e)return this.matched=this.string.substr(this.pos,i-this.pos-1+e[0].length),this.match=e,this.prev_pos=i-1,this.pos=i,this.working=n.substr(e[0].length),this.matched;if(0===n.length)return this.match=[],this.matched=r}},_.$$arity=1),t.def(I,"$[]",d=function(t){var e;if(a(this.match["$empty?"]()))return r;e=t,i(P,"Symbol")["$==="](e)?t=t.$to_s():i(P,"String")["$==="](e)||(t=i(P,"Opal")["$coerce_to!"](t,i(P,"Integer"),"to_int"));var n=this.match;return t<0&&(t+=n.length),t<0||t>=n.length||null==n[t]?r:n[t]},d.$$arity=1),t.def(I,"$check",f=function(t){var e=(t=this.$anchor(t)).exec(this.working);return this.matched=null==e?r:e[0]},f.$$arity=1),t.def(I,"$check_until",h=function(t){var e=this.prev_pos,i=this.pos,n=this.$scan_until(t);return n!==r&&(this.matched=n.substr(-1),this.working=this.string.substr(i)),this.prev_pos=e,this.pos=i,n},h.$$arity=1),t.def(I,"$peek",p=function(t){return this.working.substring(0,t)},p.$$arity=1),t.def(I,"$eos?",m=function(){return 0===this.working.length},m.$$arity=0),t.def(I,"$exist?",y=function(t){var e=t.exec(this.working);return null==e?r:0==e.index?0:e.index+1},y.$$arity=1),t.def(I,"$skip",b=function(t){var e=(t=this.$anchor(t)).exec(this.working);if(null==e)return this.match=[],this.matched=r;var i=e[0],n=i.length;return this.matched=i,this.match=e,this.prev_pos=this.pos,this.pos+=n,this.working=this.working.substring(n),n},b.$$arity=1),t.def(I,"$skip_until",g=function(t){var e=this.$scan_until(t);return e===r?r:(this.matched=e.substr(-1),e.length)},g.$$arity=1),t.def(I,"$get_byte",T=function(){var t=r;return this.pos<this.string.length?(this.prev_pos=this.pos,this.pos+=1,t=this.matched=this.working.substring(0,1),this.working=this.working.substring(1)):this.matched=r,t},T.$$arity=0),t.alias(I,"getch","get_byte"),t.def(I,"$match?",v=function(t){var e=(t=this.$anchor(t)).exec(this.working);return null==e?r:(this.prev_pos=this.pos,e[0].length)},v.$$arity=1),t.def(I,"$pos=",k=function(t){return t<0&&(t+=this.string.$length()),this.pos=t,this.working=this.string.slice(t)},k.$$arity=1),t.def(I,"$matched_size",R=function(){return this.matched===r?r:this.matched.length},R.$$arity=0),t.def(I,"$post_match",S=function(){return this.matched===r?r:this.string.substr(this.pos)},S.$$arity=0),t.def(I,"$pre_match",D=function(){return this.matched===r?r:this.string.substr(0,this.prev_pos)},D.$$arity=0),t.def(I,"$reset",x=function(){return this.working=this.string,this.matched=r,this.pos=0},x.$$arity=0),t.def(I,"$rest",w=function(){return this.working},w.$$arity=0),t.def(I,"$rest?",E=function(){return 0!==this.working.length},E.$$arity=0),t.def(I,"$rest_size",L=function(){return this.$rest().$size()},L.$$arity=0),t.def(I,"$terminate",M=function(){var e,i;return this.match=r,e=[this.string.$length()],$(this,"pos=",t.to_a(e)),e[(i=e.length,"number"==typeof i?i-1:i["$-"](1))]},M.$$arity=0),t.def(I,"$unscan",C=function(){return this.pos=this.prev_pos,this.prev_pos=r,this.match=r,this},C.$$arity=0),I.$private(),t.def(I,"$anchor",A=function(t){var e=t.toString().match(/\/([^\/]+)$/);return e=e?e[1]:void 0,new RegExp("^(?:"+t.source+")",e)},A.$$arity=1),r&&"anchor"}(e[0],0,e)},Opal.modules["bcdice/normalize"]=function(t){var e=[],r=t.nil,i=t.module;return function(e,n){var a=[i(e,"BCDice")].concat(n);!function(e,n){var a,$,s=i(e,"Normalize");[s].concat(n),s.$module_function(),t.def(s,"$comparison_operator",a=function(t){var e;return/<=|=</["$==="](e=t)?"<=":/>=|=>/["$==="](e)?">=":/<>|!=|=!/["$==="](e)?"!=":/</["$==="](e)?"<":/>/["$==="](e)?">":/=/["$==="](e)?"==":r},a.$$arity=1),t.def(s,"$target_number",$=function(t){return t["$=="]("?")?t:t.$to_i()},$.$$arity=1)}(a[0],a)}(e[0],e)},Opal.modules["bcdice/command/lexer"]=function(t){var e=t.top,r=[],i=t.nil,n=t.$$,a=t.module,$=t.klass,s=t.hash2,c=t.truthy,o=t.send;return e.$require("strscan"),e.$require("bcdice/normalize"),function(e,r){var l=[a(e,"BCDice")].concat(r);!function(e,r){var l=[a(e,"Command")].concat(r);!function(e,r,a){var l,u,_,d=$(e,null,"Lexer"),f=[d].concat(a);d.$$prototype.scanner=d.$$prototype.notations=i,t.const_set(f[0],"SYMBOLS",s(["+","-","*","/","(",")","?","@","#","$"],{"+":"PLUS","-":"MINUS","*":"ASTERISK","/":"SLASH","(":"PARENL",")":"PARENR","?":"QUESTION","@":"AT","#":"SHARP",$:"DOLLAR"}).$freeze()),t.def(d,"$initialize",l=function(t,e){var r,a,$,s;return t=c(s=(a=(r=t)===i||null==r?i:o(r,"split",[" ",2]))===i||null==a?i:o(a,"first",[]))?s:"",this.scanner=n(f,"StringScanner").$new(t),this.notations=o(e,"map",[],(($=function(t){return null==t&&(t=i),c(t["$is_a?"](n(f,"String")))?n(f,"Regexp").$new(t):t}).$$s=this,$.$$arity=1,$))},l.$$arity=2),t.def(d,"$next_token",u=function(){try{var e,r=i,a=i,$=i,s=i;return c(this.scanner["$eos?"]())?[!1,"$"]:(o(this.notations,"each",[],((e=function(r){var n,a=null==e.$$s?this:e.$$s;if(null==a.scanner&&(a.scanner=i),null==r&&(r=i),n=a.scanner.$scan(r),!c(n))return i;t.ret(["NOTATION",n])}).$$s=this,e.$$arity=1,e)),c(r=this.scanner.$scan(/\d+/))?["NUMBER",r.$to_i()]:c(a=this.scanner.$scan(/[<>!=]+/))?(a=n(f,"Normalize").$comparison_operator(a),[c(a)?"CMP_OP":"ILLEGAL",a]):($=this.scanner.$getch().$upcase(),[c(s=n(f,"SYMBOLS")["$[]"]($))?s:$.$to_sym(),$]))}catch(l){if(l===t.returner)return l.$v;throw l}},u.$$arity=0),t.def(d,"$source",_=function(){return this.scanner.$string()},_.$$arity=0)}(l[0],0,l)}(l[0],l)}(r[0],r)},Opal.modules["bcdice/command/parsed"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.klass,$=t.truthy;return function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"Command")].concat(s);!function(e,n,s){var c,o,l,u=a(e,null,"Parsed"),_=[u].concat(s);u.$$prototype.question_target=u.$$prototype.critical=u.$$prototype.fumble=u.$$prototype.dollar=u.$$prototype.modify_number=u.$$prototype.target_number=u.$$prototype.command=u.$$prototype.cmp_op=r,u.$attr_accessor("command"),u.$attr_accessor("critical"),u.$attr_accessor("fumble"),u.$attr_accessor("dollar"),u.$attr_accessor("modify_number"),u.$attr_accessor("cmp_op"),u.$attr_accessor("target_number"),u.$attr_writer("question_target"),t.def(u,"$initialize",c=function(){return this.critical=r,this.fumble=r,this.dollar=r,this.cmp_op=r,this.target_number=r,this.question_target=!1},c.$$arity=0),t.def(u,"$question_target?",o=function(){return this.question_target},o.$$arity=0),t.def(u,"$to_s",l=function(t){var e,n=r,a=r,s=r,c=r,o=r;return null==t&&(t="after_command"),n=$(this.critical)?"@"+this.critical:r,a=$(this.fumble)?"#"+this.fumble:r,s=$(this.dollar)?"$"+this.dollar:r,c=i(_,"Format").$modifier(this.modify_number),o=$(this.question_target)?"?":this.target_number,"after_command"["$==="](e=t)?[this.command,n,a,s,c,this.cmp_op,o].$join():"after_modify_number"["$==="](e)?[this.command,c,n,a,s,this.cmp_op,o].$join():"after_target_number"["$==="](e)?[this.command,c,this.cmp_op,o,n,a,s].$join():r},l.$$arity=-1)}(c[0],0,c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/command/parser"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var r,i,n,a=t.top,$=[],s=t.nil,c=t.$$$,o=t.$$,l=t.klass,u=t.module,_=t.hash2,d=t.send2,f=t.send,h=t.hash,p=t.truthy;return a.$require("racc/parser.rb"),a.$require("bcdice/arithmetic/node"),a.$require("bcdice/command/lexer"),a.$require("bcdice/command/parsed"),r=c(o($,"BCDice"),"Command"),i=c(o($,"Racc"),"Parser"),n=$,[l(r,i,"Parser")].concat(n),function(r,i){var n=[u(r,"BCDice")].concat(i);!function(r,i){var n=[u(r,"Command")].concat(i);!function(r,i,n){var a,$,u,m,y,b,g,T,v,k,R,S,D,x,w,E,L,M,C,A,I,P,O,z,B,N,F,q,W,U,G,j,H,K,X,Y,Q,V,J,Z,tt,et,rt,it,nt,at,$t,st,ct=l(r,i,"Parser"),ot=[ct].concat(n);ct.$$prototype.notations=ct.$$prototype.lexer=ct.$$prototype.modifier=ct.$$prototype.critical=ct.$$prototype.fumble=ct.$$prototype.dollar=ct.$$prototype.allowed_cmp_op=ct.$$prototype.question_target=s,t.def(ct,"$initialize",a=function(e,r){var i,n,$,c,o=a.$$p,l=this;if(o&&(a.$$p=null),i=t.slice.call(arguments,0,arguments.length),null==(n=t.extract_kwargs(i)))n=_([],{});else if(!n.$$is_hash)throw t.ArgumentError.$new("expected kwargs");if($=i,!t.hasOwnProperty.call(n.$$smap,"round_type"))throw t.ArgumentError.$new("missing keyword: round_type");return c=n.$$smap.round_type,d(l,t.find_super_dispatcher(l,"initialize",a,!1,!0),"initialize",[],null),l.notations=$,l.round_type=c,l.modifier=!0,l.critical=!1,l.fumble=!1,l.dollar=!1,l.allowed_cmp_op=[s,">=",">","<=","<","==","!="],l.question_target=!1},a.$$arity=-2),t.def(ct,"$disable_modifier",$=function(){return this.modifier=!1,this},$.$$arity=0),t.def(ct,"$enable_critical",u=function(){return this.critical=!0,this},u.$$arity=0),t.def(ct,"$enable_fumble",m=function(){return this.fumble=!0,this},m.$$arity=0),t.def(ct,"$enable_dollar",y=function(){return this.dollar=!0,this},y.$$arity=0),t.def(ct,"$restrict_cmp_op_to",b=function(e){var r,i=this;return r=t.slice.call(arguments,0,arguments.length),i.allowed_cmp_op=r,i},b.$$arity=-1),t.def(ct,"$enable_question_target",g=function(){return this.question_target=!0,this},g.$$arity=0),t.def(ct,"$parse",T=function(e){try{return this.lexer=o(ot,"Lexer").$new(e,this.notations),this.$do_parse()}catch(r){if(!t.rescue(r,[o(ot,"ParseError"),o(ot,"ZeroDivisionError")]))throw r;try{return s}finally{t.pop_exception()}}},T.$$arity=1),ct.$private(),t.def(ct,"$parsed",v=function(r,i,n,a){var $;return f(o(ot,"Parsed").$new(),"tap",[],(($=function(c){var o,l,u,_,d=null==$.$$s?this:$.$$s,h=s;return null==d.round_type&&(d.round_type=s),null==c&&(c=s),f(c,"command=",t.to_a(h=[r])),e(h.length,1),h=[(o=i["$[]"]("critical"),o===s||null==o?s:f(o,"eval",[d.round_type]))],f(c,"critical=",t.to_a(h)),e(h.length,1),h=[(l=i["$[]"]("fumble"),l===s||null==l?s:f(l,"eval",[d.round_type]))],f(c,"fumble=",t.to_a(h)),e(h.length,1),h=[(u=i["$[]"]("dollar"),u===s||null==u?s:f(u,"eval",[d.round_type]))],f(c,"dollar=",t.to_a(h)),e(h.length,1),h=[n.$eval(d.round_type)],f(c,"modify_number=",t.to_a(h)),e(h.length,1),h=[a["$[]"]("cmp_op")],f(c,"cmp_op=",t.to_a(h)),e(h.length,1),a["$[]"]("target")["$=="]("?")?(f(c,"question_target=",t.to_a(h=[!0])),e(h.length,1),f(c,"target_number=",t.to_a(h=[0])),h[e(h.length,1)]):(f(c,"question_target=",t.to_a(h=[!1])),e(h.length,1),h=[(_=a["$[]"]("target"),_===s||null==_?s:f(_,"eval",[d.round_type]))],f(c,"target_number=",t.to_a(h)),h[e(h.length,1)])}).$$s=this,$.$$arity=1,$))},v.$$arity=4),t.def(ct,"$next_token",k=function(){return this.lexer.$next_token()},k.$$arity=0),J=[24,6,7,16,17,20,21,16,17,23,6,7,14,36,37,31,11,12,13,14,24,2,24,36,37,20,21,20,21,23,24,23,24,41,42,20,21,20,21,23,24,23,24,36,37,20,21,20,21,23,24,23,24,36,37,20,21,20,21,23,24,23,24,36,37,20,21,20,21,23,24,23,24,36,37,20,21,20,21,23,24,23,24,36,37,20,21,20,21,23,3,23,41,42,8,s,s,45,11,12,13,14,51,49,50,52],Z=[14,2,2,9,9,14,14,5,5,14,4,4,9,18,18,14,4,4,4,4,6,0,7,25,25,6,6,7,7,6,11,7,12,30,30,11,11,12,12,11,13,12,16,32,32,13,13,16,16,13,17,16,20,34,34,17,17,20,20,17,21,20,23,35,35,21,21,23,23,21,36,23,37,46,46,36,36,37,37,36,41,37,42,47,47,41,41,42,42,41,1,42,40,40,3,s,s,40,15,15,15,15,44,44,44,44],tt=[3,90,-6,94,3,0,18,20,s,-4,s,28,30,38,-2,85,40,48,4,s,50,58,s,60,s,14,s,s,s,s,26,s,34,s,44,54,68,70,s,s,85,78,80,s,99,s,64,74,s,s,s,s,s],et=[-31,-31,-4,-31,-12,-4,-31,-31,53,-12,-3,-31,-31,-31,-31,-12,-31,-31,-8,-20,-31,-31,-28,-31,-30,-9,-1,-5,-6,-7,-13,-14,-17,-2,-10,-11,-31,-31,-26,-27,-31,-31,-31,-18,-21,-29,-15,-16,-19,-22,-23,-24,-25],rt=[18,25,1,27,28,29,30,48,s,10,34,35,38,39,26,40,4,s,s,15,33,5,s,9,s,s,s,s,43,44,s,s,s,s,s,46,47],it=[6,6,1,5,5,5,7,8,s,4,6,6,5,5,4,7,2,s,s,2,4,3,s,3,s,s,s,s,5,5,s,s,s,s,s,6,6],nt=[s,2,14,19,5,-8,-6,-8,-37,s],at=[s,s,s,s,s,19,32,s,s,22],$t=[0,0,"racc_error",4,20,"_reduce_1",4,20,"_reduce_2",3,20,"_reduce_3",0,21,"_reduce_4",3,21,"_reduce_5",3,21,"_reduce_6",3,21,"_reduce_7",2,22,"_reduce_8",2,22,"_reduce_9",3,22,"_reduce_10",3,22,"_reduce_11",0,23,"_reduce_12",2,23,"_reduce_13",2,23,"_reduce_14",3,26,"_reduce_15",3,26,"_reduce_16",1,26,"_reduce_none",3,25,"_reduce_18",4,25,"_reduce_19",1,25,"_reduce_none",0,27,"_reduce_21",1,27,"_reduce_22",1,27,"_reduce_23",1,27,"_reduce_24",1,27,"_reduce_25",2,24,"_reduce_26",2,24,"_reduce_27",1,24,"_reduce_none",3,28,"_reduce_29",1,28,"_reduce_30"],st=h(!1,0,"error",1,"NUMBER",2,"R",3,"U",4,"C",5,"F",6,"PLUS",7,"MINUS",8,"ASTERISK",9,"SLASH",10,"PARENL",11,"PARENR",12,"AT",13,"SHARP",14,"DOLLAR",15,"CMP_OP",16,"QUESTION",17,"NOTATION",18),t.const_set(ot[0],"Racc_arg",[J,Z,et,tt,rt,it,at,nt,19,$t,st,53,31,!0]),t.const_set(ot[0],"Racc_token_to_s_table",["$end","error","NUMBER","R","U","C","F","PLUS","MINUS","ASTERISK","SLASH","PARENL","PARENR","AT","SHARP","DOLLAR","CMP_OP","QUESTION","NOTATION","$start","expr","option","modifier","target","unary","mul","add","round_type","term"]),t.const_set(ot[0],"Racc_debug_parser",!1),t.def(ct,"$_reduce_1",R=function(e,r,i){var n;return p(this.modifier)||this.$raise(o(ot,"ParseError")),n=t.to_ary(e),this.$parsed(null==n[0]?s:n[0],null==n[1]?s:n[1],null==n[2]?s:n[2],null==n[3]?s:n[3])},R.$$arity=3),t.def(ct,"$_reduce_2",S=function(e,r,i){var n;return p(this.modifier)||this.$raise(o(ot,"ParseError")),n=t.to_ary(e),this.$parsed(null==n[0]?s:n[0],null==n[2]?s:n[2],null==n[1]?s:n[1],null==n[3]?s:n[3])},S.$$arity=3),t.def(ct,"$_reduce_3",D=function(e,r,i){var n,a;return a=null==(n=t.to_ary(e))[2]?s:n[2],this.$parsed(null==n[0]?s:n[0],null==n[1]?s:n[1],c(c(o(ot,"Arithmetic"),"Node"),"Number").$new(0),a)},D.$$arity=3),t.def(ct,"$_reduce_4",x=function(t,e,r){return _([],{})},x.$$arity=3),t.def(ct,"$_reduce_5",w=function(r,i,n){var a,$,c,l,u=s;return u=null==(a=t.to_ary(r))[0]?s:a[0],$=null==a[2]?s:a[2],p(p(l=this.critical)?u["$[]"]("critical")["$nil?"]():l)||this.$raise(o(ot,"ParseError")),f(u,"[]=",t.to_a(c=["critical",$])),e(c.length,1),u},w.$$arity=3),t.def(ct,"$_reduce_6",E=function(r,i,n){var a,$,c,l,u=s;return u=null==(a=t.to_ary(r))[0]?s:a[0],$=null==a[2]?s:a[2],p(p(l=this.fumble)?u["$[]"]("fumble")["$nil?"]():l)||this.$raise(o(ot,"ParseError")),f(u,"[]=",t.to_a(c=["fumble",$])),e(c.length,1),u},E.$$arity=3),t.def(ct,"$_reduce_7",L=function(r,i,n){var a,$,c,l,u=s;return u=null==(a=t.to_ary(r))[0]?s:a[0],$=null==a[2]?s:a[2],p(p(l=this.dollar)?u["$[]"]("dollar")["$nil?"]():l)||this.$raise(o(ot,"ParseError")),f(u,"[]=",t.to_a(c=["dollar",$])),e(c.length,1),u},L.$$arity=3),t.def(ct,"$_reduce_8",M=function(t,e,r){return t["$[]"](1)},M.$$arity=3),t.def(ct,"$_reduce_9",C=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"Negative").$new(t["$[]"](1))},C.$$arity=3),t.def(ct,"$_reduce_10",A=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"+",t["$[]"](2))},A.$$arity=3),t.def(ct,"$_reduce_11",I=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"-",t["$[]"](2))},I.$$arity=3),t.def(ct,"$_reduce_12",P=function(t,e,r){return p(this.allowed_cmp_op["$include?"](s))||this.$raise(o(ot,"ParseError")),_([],{})},P.$$arity=3),t.def(ct,"$_reduce_13",O=function(e,r,i){var n,a,$;return $=null==(n=t.to_ary(e))[1]?s:n[1],p(this.allowed_cmp_op["$include?"](a=null==n[0]?s:n[0]))||this.$raise(o(ot,"ParseError")),_(["cmp_op","target"],{cmp_op:a,target:$})},O.$$arity=3),t.def(ct,"$_reduce_14",z=function(t,e,r){var i;return i=t["$[]"](0),p(this.question_target)||this.$raise(o(ot,"ParseError")),p(this.allowed_cmp_op["$include?"](i))||this.$raise(o(ot,"ParseError")),_(["cmp_op","target"],{cmp_op:i,target:"?"})},z.$$arity=3),t.def(ct,"$_reduce_15",B=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"+",t["$[]"](2))},B.$$arity=3),t.def(ct,"$_reduce_16",N=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"-",t["$[]"](2))},N.$$arity=3),t.def(ct,"$_reduce_18",F=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"BinaryOp").$new(t["$[]"](0),"*",t["$[]"](2))},F.$$arity=3),t.def(ct,"$_reduce_19",q=function(t,e,r){return t["$[]"](3).$new(t["$[]"](0),t["$[]"](2))},q.$$arity=3),t.def(ct,"$_reduce_21",W=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"DivideWithGameSystemDefault")},W.$$arity=3),t.def(ct,"$_reduce_22",U=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"DivideWithCeil")},U.$$arity=3),t.def(ct,"$_reduce_23",G=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"DivideWithCeil")},G.$$arity=3),t.def(ct,"$_reduce_24",j=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"DivideWithRound")},j.$$arity=3),t.def(ct,"$_reduce_25",H=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"DivideWithFloor")},H.$$arity=3),t.def(ct,"$_reduce_26",K=function(t,e,r){return t["$[]"](1)},K.$$arity=3),t.def(ct,"$_reduce_27",X=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"Negative").$new(t["$[]"](1))},X.$$arity=3),t.def(ct,"$_reduce_29",Y=function(t,e,r){return t["$[]"](1)},Y.$$arity=3),t.def(ct,"$_reduce_30",Q=function(t,e,r){return c(c(o(ot,"Arithmetic"),"Node"),"Number").$new(t["$[]"](0))},Q.$$arity=3),t.def(ct,"$_reduce_none",V=function(t,e,r){return t["$[]"](0)},V.$$arity=3)}(n[0],c(o(n,"Racc"),"Parser"),n)}(n[0],n)}($[0],$)},Opal.modules["bcdice/deprecated/checker"]=function(t){var e=[],r=t.nil,i=t.$$,n=t.module,a=t.send,$=t.truthy;return function(e,s){var c=[n(e,"BCDice")].concat(s);!function(e,s){var c=[n(e,"Deprecated")].concat(s);!function(e,s){var c,o,l,u,_,d,f=n(e,"Checker"),h=[f].concat(s);f.$private(),t.def(f,"$check_result_legacy",c=function(t,e,n,s){var c,o,l=r,u=r,_=r,d=r,f=r;return l=a(e,"map",[],"sides".$to_proc()),c=(u=a(e,"map",[],"value".$to_proc())).$sum(),_=[100]["$==="](d=l)?this.$check_1D100(t,c,n,s):[20]["$==="](d)?this.$check_1D20(t,c,n,s):[6,6]["$==="](d)?this.$check_2D6(t,c,u,n,s):r,$($(o=_["$nil?"]())?o:_["$empty?"]())?(d=l.$uniq(),_=[10]["$==="](d)?this.$check_nD10(t,c,u,n,s):[6]["$==="](d)?this.$check_nD6(t,c,u,n,s):r,$($(f=_["$nil?"]())?f:_["$empty?"]())?r:i(h,"Result").$new(_.$delete_prefix(" \uff1e "))):i(h,"Result").$new(_.$delete_prefix(" \uff1e "))},c.$$arity=4),t.def(f,"$check_1D100",o=function(t,e,i,n){return r},o.$$arity=4),t.def(f,"$check_1D20",l=function(t,e,i,n){return r},l.$$arity=4),t.def(f,"$check_nD10",u=function(t,e,i,n,a){return r},u.$$arity=5),t.def(f,"$check_2D6",_=function(t,e,i,n,a){return r},_.$$arity=5),t.def(f,"$check_nD6",d=function(t,e,i,n,a){return r},d.$$arity=5)}(c[0],c)}(c[0],c)}(e[0],e)},Opal.modules["bcdice/base"]=function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var i=t.top,n=[],a=t.nil,$=t.$$$,s=t.$$,c=t.module,o=t.klass,l=t.truthy,u=t.send,_=t.range,d=a;return i.$require("i18n"),i.$require("i18n/backend/fallbacks"),i.$require("bcdice/randomizer"),i.$require("bcdice/dice_table"),i.$require("bcdice/enum"),i.$require("bcdice/translate"),i.$require("bcdice/result"),i.$require("bcdice/command/parser"),i.$require("bcdice/deprecated/checker"),function(i,n){var d=[c(i,"BCDice")].concat(n);!function(i,n,c){var d,f,h,p,m,y,b,g,T,v,k,R,S,D,x,w,E,L,M,C,A,I,P,O,z,B,N,F,q,W=o(i,null,"Base"),U=[W].concat(c);W.$$prototype.sort_add_dice=W.$$prototype.sort_barabara_dice=W.$$prototype.enabled_d9=W.$$prototype.raw_input=W.$$prototype.randomizer=W.$$prototype.enabled_upcase_input=W.$$prototype.debug=a,function(r,i){var n,c,o,_,d,f=[r].concat(i);r.$attr_reader("prefixes"),t.def(r,"$register_prefix",n=function(e){var r,i=this,n=a;return null==i.prefixes&&(i.prefixes=a),r=t.slice.call(arguments,0,arguments.length),i.prefixes=l(n=i.prefixes)?n:[],i.prefixes.$concat(r.$flatten())},n.$$arity=-1),t.def(r,"$register_prefix_from_super_class",c=function(){return this.$register_prefix(this.$superclass().$prefixes())},c.$$arity=0),t.def(r,"$prefixes_pattern",o=function(){var e,r=a;return null==this.prefixes_pattern&&(this.prefixes_pattern=a),null==this.prefixes&&(this.prefixes=a),this.prefixes_pattern=l(e=this.prefixes_pattern)?e:a,l(this.prefixes_pattern)?this.prefixes_pattern:(this.prefixes=l(r=this.prefixes)?r:[],this.prefixes.$freeze(),this.prefixes_pattern=(l(this.prefixes["$empty?"]())?/(?!)/:t.regexp(["^(S)?(",this.prefixes.$join("|"),")"],"i")).$freeze())},o.$$arity=0),t.def(r,"$command_pattern",_=function(){var r,i,n=a,c=a;return null==this.command_pattern&&(this.command_pattern=a),null==this.prefixes&&(this.prefixes=a),this.command_pattern=l(i=this.command_pattern)?i:a,l(this.command_pattern)?this.command_pattern:(this.prefixes=l(n=this.prefixes)?n:[],this.prefixes.$freeze(),c=e(u($(s(f,"CommonCommand"),"COMMANDS"),"map",[],((r=function(t){return null==t&&(t=a),$(t,"PREFIX_PATTERN").$source()}).$$s=this,r.$$arity=1,r)),this.prefixes),this.command_pattern=t.regexp(["^S?(",c.$join("|"),")"],"i").$freeze())},_.$$arity=0),t.def(r,"$eval",d=function(t){return this.$new(t).$eval()},d.$$arity=1)}(t.get_singleton_class(W),U),W.$include(s(U,"Translate")),W.$include($(s(U,"Deprecated"),"Checker")),t.def(W,"$initialize",d=function(t){return this.raw_input=t,this.sort_add_dice=!1,this.sort_barabara_dice=!1,this.d66_sort_type=$(s(U,"D66SortType"),"NO_SORT"),this.enabled_d9=!1,this.round_type=$(s(U,"RoundType"),"FLOOR"),this.sides_implicit_d=6,this.upper_dice_reroll_threshold=a,this.reroll_dice_reroll_threshold=a,this.default_cmp_op=a,this.default_target_number=a,this.enabled_upcase_input=!0,this.locale="ja_jp",this.randomizer=$(s(U,"BCDice"),"Randomizer").$new(),this.debug=!1},d.$$arity=1),W.$attr_accessor("randomizer"),W.$attr_reader("d66_sort_type"),W.$attr_reader("round_type"),W.$attr_reader("sides_implicit_d"),W.$attr_reader("upper_dice_reroll_threshold"),W.$attr_reader("reroll_dice_reroll_threshold"),W.$attr_reader("default_cmp_op"),W.$attr_reader("default_target_number"),t.def(W,"$sort_add_dice?",f=function(){return this.sort_add_dice},f.$$arity=0),t.def(W,"$sort_barabara_dice?",h=function(){return this.sort_barabara_dice},h.$$arity=0),t.def(W,"$enabled_d9?",p=function(){return this.enabled_d9},p.$$arity=0),t.def(W,"$enable_debug",m=function(){return this.debug=!0},m.$$arity=0),t.def(W,"$eval",y=function(){var e,i,n,c=a;return e=$(s(U,"BCDice"),"Preprocessor").$process(this.raw_input,this),i=l(n=this.$dice_command(e))?n:this.$eval_common_command(this.raw_input),l(i)?(c=[this.randomizer.$rand_results()],u(i,"rands=",t.to_a(c)),r(c.length,1),c=[this.randomizer.$detailed_rand_results()],u(i,"detailed_rands=",t.to_a(c)),r(c.length,1),i):a},y.$$arity=0),t.def(W,"$change_text",b=function(t){return t},b.$$arity=1),t.def(W,"$check_result",g=function(t,e,r,i){var n,$=a,c=a,o=a,_=a;return $=this.$check_result_legacy(t,e,r,i),l($)?$:(c=u(e,"map",[],"sides".$to_proc()),n=(o=u(e,"map",[],"value".$to_proc())).$sum(),($=[100]["$==="](_=c)?this.$result_1d100(t,n,r,i):[20]["$==="](_)?this.$result_1d20(t,n,r,i):[6,6]["$==="](_)?this.$result_2d6(t,n,o,r,i):a)["$=="](s(U,"Result").$nothing())?a:l($)?$:(_=c.$uniq(),($=[10]["$==="](_)?this.$result_nd10(t,n,o,r,i):[6]["$==="](_)?this.$result_nd6(t,n,o,r,i):a)["$=="](s(U,"Result").$nothing())?a:l($)?$:this.$result_ndx(t,r,i)))},g.$$arity=4),t.def(W,"$grich_text",T=function(t,e,r){return a},T.$$arity=3),W.$private(),t.def(W,"$eval_common_command",v=function(e){try{var r;return e=this.$change_text(e),u($(s(U,"CommonCommand"),"COMMANDS"),"each",[],((r=function(i){var n,$=null==r.$$s?this:r.$$s;if(null==$.randomizer&&($.randomizer=a),null==i&&(i=a),n=i.$eval(e,$,$.randomizer),!l(n))return a;t.ret(n)}).$$s=this,r.$$arity=1,r)),a}catch(i){if(i===t.returner)return i.$v;throw i}},v.$$arity=1),t.def(W,"$dice_command",k=function(e){var i,n,$=a,c=a,o=a,d=a,f=a,h=a;return l(this.enabled_upcase_input)&&(e=e.$upcase()),$=this.$class().$prefixes_pattern().$match(e),l($)?(n=$["$[]"](1)["$nil?"]()["$!"](),l(n)&&(e=e["$[]"](_(1,-1,!1))),c=this.$eval_game_system_specific_command(e),l(c["$is_a?"](s(U,"Result")))?(o=[l(d=c["$secret?"]())?d:n],u(c,"secret=",t.to_a(o)),r(o.length,1),c):l(l(f=l(h=c["$nil?"]())?h:c["$empty?"]())?f:c["$=="]("1"))?a:u(s(U,"Result").$new(),"tap",[],((i=function(e){return null==e&&(e=a),o=[c.$to_s()],u(e,"text=",t.to_a(o)),r(o.length,1),u(e,"secret=",t.to_a(o=[n])),o[r(o.length,1)]}).$$s=this,i.$$arity=1,i))):a},k.$$arity=1),t.def(W,"$eval_game_system_specific_command",R=function(t){return a},R.$$arity=1),t.def(W,"$result_ndx",S=function(t,e,r){return l(r["$is_a?"](s(U,"String")))?a:l(t.$send(e,r))?s(U,"Result").$success(this.$translate("success")):s(U,"Result").$failure(this.$translate("failure"))},S.$$arity=3),t.def(W,"$result_1d100",D=function(t,e,r,i){return a},D.$$arity=4),t.def(W,"$result_1d20",x=function(t,e,r,i){return a},x.$$arity=4),t.def(W,"$result_nd10",w=function(t,e,r,i,n){return a},w.$$arity=5),t.def(W,"$result_2d6",E=function(t,e,r,i,n){return a},E.$$arity=5),t.def(W,"$result_nd6",L=function(t,e,r,i,n){return a},L.$$arity=5),t.def(W,"$get_table_by_2d6",M=function(t){return this.$get_table_by_nD6(t,2)},M.$$arity=1),t.def(W,"$get_table_by_1d6",C=function(t){return this.$get_table_by_nD6(t,1)},C.$$arity=1),t.def(W,"$get_table_by_nD6",A=function(t,e){return this.$get_table_by_nDx(t,e,6)},A.$$arity=2),t.def(W,"$get_table_by_nDx",I=function(t,e,i){var n,$=a;return n=this.randomizer.$roll_sum(e,i),$=this.$get_table_value(t["$[]"](r(n,e))),l($["$nil?"]())?["1",0]:[$,n]},I.$$arity=3),t.def(W,"$get_table_by_1d3",P=function(t){var e,i,n,$=a;return this.$debug("get_table_by_1d3"),e=this.randomizer.$roll_sum(1,6),this.$debug("num",e),i=(n=r(e,1),"number"==typeof n?n/2:n["$/"](2)).$to_i(),this.$debug("index",i),$=t["$[]"](i),l($["$nil?"]())?["1",0]:[$,e]},P.$$arity=1),t.def(W,"$get_table_by_d66_swap",O=function(t){var e;return e=this.randomizer.$roll_d66($(s(U,"D66SortType"),"ASC")),[this.$get_table_by_number(e,t),e]},O.$$arity=1),t.def(W,"$get_table_by_d66",z=function(t){var i,n,$,s,c,o=a;return i=this.randomizer.$roll_once(6),n=this.randomizer.$roll_once(6),$=e("number"==typeof(c=r(i,1))?6*c:c["$*"](6),r(n,1)),o=t["$[]"]($),s=""+i+n,l(o["$nil?"]())?["1",s]:[o,s]},z.$$arity=1),t.def(W,"$get_table_by_number",B=function(e,r,i){try{var n;return null==i&&(i="1"),u(r,"each",[],((n=function(r){var i,$,s,c=null==n.$$s?this:n.$$s;if(null==r&&(r=a),i=r["$[]"](0),!l(($=i,s=e,"number"==typeof $&&"number"==typeof s?$>=s:$["$>="](s))))return a;t.ret(c.$get_table_value(r["$[]"](1)))}).$$s=this,n.$$arity=1,n)),this.$get_table_value(i)}catch($){if($===t.returner)return $.$v;throw $}},B.$$arity=-3),t.def(W,"$get_table_value",N=function(t){return l(t["$is_a?"](s(U,"Proc")))?t.$call():t},N.$$arity=1),t.def(W,"$roll_tables",F=function(t,e){var r=a;return r=e["$[]"](t),l(r)?r.$roll(this.randomizer).$to_s():a},F.$$arity=2),t.def(W,"$debug",q=function(e,r){var i,n,$=this,c=a,o=a;return i=t.slice.call(arguments,1,arguments.length),l($.debug)?(c=l(e["$is_a?"](s(U,"String")))?e:e.$inspect(),l(i["$empty?"]())?$.$warn(c):(o=u(i,"map",[],((n=function(t){return null==t&&(t=a),l(t["$is_a?"](s(U,"String")))?'"'+t+'"':t.$inspect()}).$$s=$,n.$$arity=1,n)),$.$warn(c+": "+o.$join(", ")))):a},q.$$arity=-2)}(d[0],0,d)}(n[0],n),$($(s(n,"I18n"),"Backend"),"Simple").$include($($(s(n,"I18n"),"Backend"),"Fallbacks")),s(n,"I18n").$load_path()["$<<"](s(n,"Dir")["$[]"](s(n,"File").$join(i.$__dir__(),"../../i18n/**/*.yml"))),d=["ja_jp"],u(s(n,"I18n"),"default_locale=",t.to_a(d)),r(d.length,1),d=[["ja_jp"]],u(s(n,"I18n").$fallbacks(),"defaults=",t.to_a(d)),d[r(d.length,1)]},function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t<=e:t["$<="](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:t["$>="](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}var a=[],$=t.nil,s=t.$$$,c=t.$$,o=t.module,l=t.klass,u=t.send2,_=t.truthy,d=t.send,f=t.hash2;t.top.$require("bcdice/base"),function(a,h){var p=[o(a,"BCDice")].concat(h);!function(a,h){var p=[o(a,"GameSystem")].concat(h);!function(a,o,h){var p,m,y,b,g=l(a,o,"MagicaLogia"),T=[g].concat(h);g.$$prototype.randomizer=$,t.const_set(T[0],"ID","MagicaLogia"),t.const_set(T[0],"NAME","\u30de\u30ae\u30ab\u30ed\u30ae\u30a2"),t.const_set(T[0],"SORT_KEY","\u307e\u304d\u304b\u308d\u304d\u3042"),t.const_set(T[0],"HELP_MESSAGE","\u30fb\u5224\u5b9a\n\u30b9\u30da\u30b7\u30e3\u30eb\uff0f\u30d5\u30a1\u30f3\u30d6\u30eb\uff0f\u6210\u529f\uff0f\u5931\u6557\u3092\u5224\u5b9a\n\u30fb\u5404\u7a2e\u8868\n\u7d4c\u6b74\u8868\u3000BGT/\u521d\u671f\u30a2\u30f3\u30ab\u30fc\u8868\u3000DAT/\u904b\u547d\u5c5e\u6027\u8868\u3000FAT\n\u9858\u3044\u8868\u3000WIT/\u30d7\u30e9\u30a4\u30ba\u8868\u3000PT\n\u6642\u306e\u6d41\u308c\u8868\u3000TPT/\u5927\u5224\u6642\u306e\u6d41\u308c\u8868\u3000TPTB\n\u4e8b\u4ef6\u8868\u3000AT\n\u30d5\u30a1\u30f3\u30d6\u30eb\u8868\u3000FT\uff0f\u5909\u8abf\u8868\u3000WT\n\u904b\u547d\u5909\u8ee2\u8868\u3000FCT\n\u3000\u5178\u578b\u7684\u707d\u5384 TCT\uff0f\u7269\u7406\u7684\u707d\u5384 PCT\uff0f\u7cbe\u795e\u7684\u707d\u5384 MCT\uff0f\u72c2\u6c17\u7684\u707d\u5384 ICT\n\u3000\u793e\u4f1a\u7684\u707d\u5384 SCT\uff0f\u8d85\u5e38\u7684\u707d\u5384 XCT\uff0f\u4e0d\u601d\u8b70\u7cfb\u707d\u5384 WCT\uff0f\u30b3\u30df\u30ab\u30eb\u7cfb\u707d\u5384 CCT\n\u3000\u9b54\u6cd5\u4f7f\u3044\u306e\u707d\u5384 MGCT\n\u30b7\u30fc\u30f3\u8868\u3000ST\uff0f\u5927\u5224\u30b7\u30fc\u30f3\u8868\u3000STB\n\u3000\u6975\u9650\u74b0\u5883 XEST\uff0f\u5185\u9762\u4e16\u754c IWST\uff0f\u9b54\u6cd5\u90fd\u5e02 MCST\n\u3000\u6b7b\u5f8c\u4e16\u754c WDST\uff0f\u8ff7\u5bae\u4e16\u754c LWST\n\u3000\u9b54\u6cd5\u66f8\u67b6 MBST\uff0f\u9b54\u6cd5\u5b66\u9662 MAST\uff0f\u30af\u30ec\u30c9\u306e\u5854 TCST\n\u3000\u4e26\u884c\u4e16\u754c PWST\uff0f\u7d42\u672b\u3000\u3000 PAST\uff0f\u7570\u4e16\u754c\u9152\u5834 GBST\n\u3000\u307b\u3057\u304b\u3052 SLST\uff0f\u65e7\u56f3\u66f8\u9928 OLST\n\u4e16\u754c\u6cd5\u5247\u8ffd\u52a0\u8868 WLAT/\u3055\u307e\u3088\u3046\u602a\u7269\u8868 WMT\n\u30e9\u30f3\u30c0\u30e0\u5206\u91ce\u8868\u3000RCT\n\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868\u3000RTT\n\u3000\u661f\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868  RTS, RTT1\n\u3000\u7363\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868  RTB, RTT2\n\u3000\u529b\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868  RTF, RTT3\n\u3000\u6b4c\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868  RTP, RTT4\n\u3000\u5922\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868  RTD, RTT5\n\u3000\u95c7\u5206\u91ce\u30e9\u30f3\u30c0\u30e0\u7279\u6280\u8868  RTN, RTT6\n\u30d6\u30e9\u30f3\u30af\u79d8\u5bc6\u8868\u3000BST/\n\u3000\u5bbf\u6575\u8868\u3000MIT/\u8b00\u7565\u8868\u3000MOT/\u56e0\u7e01\u8868\u3000MAT\n\u3000\u5947\u4eba\u8868\u3000MUT/\u529b\u5834\u8868\u3000MFT/\u540c\u76df\u8868\u3000MLT\n\u843d\u82b1\u8868\u3000FFT\n\u305d\u306e\u5f8c\u8868 FLT\n\u30fbD66\u30c0\u30a4\u30b9\u3042\u308a\n"),t.def(g,"$initialize",p=function(e){return p.$$p&&(p.$$p=null),u(this,t.find_super_dispatcher(this,"initialize",p,!1,!0),"initialize",[e],null),this.sort_add_dice=!0,this.sort_barabara_dice=!0,this.d66_sort_type=s(c(T,"D66SortType"),"ASC")},p.$$arity=1),t.def(g,"$result_2d6",m=function(a,s,o,l,u){var f,h=$;return u["$=="]("?")?$:l["$=="](">=")?(f=[i((h=_(e(s,2))?c(T,"Result").$fumble(this.$translate("fumble")):_(r(s,12))?c(T,"Result").$critical(this.$translate("MagicaLogia.special")):_(r(a,u))?c(T,"Result").$success(this.$translate("success")):c(T,"Result").$failure(this.$translate("failure"))).$text(),this.$gain_magic_element(o["$[]"](0),o["$[]"](1)))],d(h,"text=",t.to_a(f)),n(f.length,1),h):$},m.$$arity=5),t.def(g,"$eval_game_system_specific_command",y=function(t){var e;return _(e=s(this.$class(),"SKILL_TABLE").$roll_command(this.randomizer,t))?e:this.$roll_tables(t,s(this.$class(),"TABLES"))},y.$$arity=1),g.$private(),t.def(g,"$gain_magic_element",b=function(t,e){var r;return t["$=="](e)?(r=this.$translate("MagicaLogia.elements.items")["$[]"](n(t,1)),i(" \uff1e ",this.$format(this.$translate("MagicaLogia.elements.format"),f(["text"],{text:r})))):""},b.$$arity=2),function(e,r,i){var a,o,u,h,p,m=l(e,null,"SkillExpandTable"),y=[m].concat(i);m.$$prototype.times=m.$$prototype.sides=m.$$prototype.items=m.$$prototype.name=m.$$prototype.skill_table=$,t.defs(m,"$from_i18n",a=function(t,e,r){var i=$;return i=c(y,"I18n").$t(t,f(["locale","raise"],{locale:e,raise:!1})),this.$new(i["$[]"]("name"),i["$[]"]("type"),i["$[]"]("items"),r)},a.$$arity=3),t.def(m,"$initialize",o=function(t,e,r,i){var n=$;return this.name=t,this.items=r.$freeze(),this.skill_table=i,n=/(\d+)D(\d+)/i.$match(e),_(n)||this.$raise(c(y,"ArgumentError"),"Unexpected table type: "+e),this.times=n["$[]"](1).$to_i(),this.sides=n["$[]"](2).$to_i()},o.$$arity=4),t.def(m,"$roll",u=function(t){var e,r;return e=t.$roll_sum(this.times,this.sides),r=this.$expand(this.items["$[]"](n(e,this.times)),t),s(c(y,"DiceTable"),"RollResult").$new(this.name,e,r)},u.$$arity=1),m.$private(),t.def(m,"$expand",h=function(t,e){var r;return d(t,"gsub",[/%{([a-z]+)}/],((r=function(){var t,i=null==r.$$s?this:r.$$s;return t=c(y,"Regexp").$last_match()["$[]"](1).$to_sym(),i.$roll_skill(t,e)}).$$s=this,r.$$arity=0,r))},h.$$arity=2),t.const_set(y[0],"CATEGORIES",["star","beast","force","poem","dream","night"].$freeze()),t.def(m,"$roll_skill",p=function(t,e){var r;return t["$=="]("skill")?this.skill_table.$roll_skill(e):t["$=="]("element")?this.skill_table.$roll_category(e):(r=c(y,"CATEGORIES").$index(t),_(r)||this.$raise(c(y,"ArgumentError")),this.skill_table.$categories()["$[]"](r).$roll(e).$name())},p.$$arity=2)}(T[0],0,T),function(r,i,a){var s,o,u,d=l(r,null,"FallenAfterTable"),h=[d].concat(a);d.$$prototype.lower=d.$$prototype.higher=d.$$prototype.name=$,t.defs(d,"$from_i18n",s=function(t,e){var r=$;return r=c(h,"I18n").$t(t,f(["locale","raise"],{locale:e,raise:!0})),this.$new(r["$[]"]("name"),r["$[]"]("items_lower"),r["$[]"]("items_higher"))},s.$$arity=2),t.def(d,"$initialize",o=function(t,e,r){return this.name=t,this.lower=e,this.higher=r},o.$$arity=3),t.def(d,"$roll",u=function(r){var i,a,s,c,o=$;return a=r.$roll_barabara(2,6),c=null==(i=t.to_ary(a))[1]?$:i[1],o=_(e(s=null==i[0]?$:i[0],3))?this.lower:this.higher,this.name+"("+s+","+c+") \uff1e "+o["$[]"](n(c,1))},u.$$arity=1)}(T[0],0,T),function(e,r){var i,n,a=[e].concat(r);e.$private(),t.def(e,"$translate_skill_table",i=function(t){return s(c(a,"DiceTable"),"SaiFicSkillTable").$from_i18n("MagicaLogia.skill_table",t,f(["rttn"],{rttn:["RTS","RTB","RTF","RTP","RTD","RTN"]}))},i.$$arity=1),t.def(e,"$translate_tables",n=function(t,e){var r,i,n,$,o,l;return r=c(a,"SkillExpandTable").$from_i18n("MagicaLogia.inveterate_enemy_table",t,e),i=s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.conspiracy_table",t),n=s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.fate_table",t),$=s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.cueball_table",t),o=s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.force_field_table",t),l=c(a,"SkillExpandTable").$from_i18n("MagicaLogia.alliance_table",t,e),f(["TPT","ST","FT","WT","FCT","AT","BGT","DAT","FAT","WIT","TCT","PCT","MCT","ICT","SCT","XCT","WCT","CCT","MIT","MOT","MAT","MUT","MFT","MLT","BST","PT","XEST","IWST","MCST","WDST","LWST","STB","MGCT","MBST","MAST","TCST","PWST","PAST","GBST","SLST","WLAT","WMT","FFT","OLST","TPTB","FLT"],{TPT:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.TPT",t,e),ST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.ST",t,e),FT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.FT",t),WT:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.WT",t,e),FCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.FCT",t),AT:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.AT",t,e),BGT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.BGT",t),DAT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.DAT",t),FAT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.FAT",t),WIT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.WIT",t),TCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.TCT",t),PCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.PCT",t),MCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.MCT",t),ICT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.ICT",t),SCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.SCT",t),XCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.XCT",t),WCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.WCT",t),CCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.CCT",t),MIT:r,MOT:i,MAT:n,MUT:$,MFT:o,MLT:l,BST:s(c(a,"DiceTable"),"ChainTable").$new(c(a,"I18n").$translate("MagicaLogia.tables.BST.name",f(["raise","locale"],{raise:!0,locale:t})),"1D6",[r,i,n,$,o,l]),PT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.PT",t),XEST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.XEST",t,e),IWST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.IWST",t,e),MCST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.MCST",t,e),WDST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.WDST",t,e),LWST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.LWST",t,e),STB:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.STB",t,e),MGCT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.MGCT",t),MBST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.MBST",t,e),MAST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.MAST",t,e),TCST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.TCST",t,e),PWST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.PWST",t,e),PAST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.PAST",t,e),GBST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.GBST",t,e),SLST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.SLST",t,e),WLAT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.WLAT",t),WMT:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.WMT",t,e),FFT:s(c(a,"DiceTable"),"Table").$from_i18n("MagicaLogia.tables.FFT",t),OLST:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.OLST",t,e),TPTB:c(a,"SkillExpandTable").$from_i18n("MagicaLogia.tables.TPTB",t,e),FLT:c(a,"FallenAfterTable").$from_i18n("MagicaLogia.tables.FLT",t)})},n.$$arity=2)}(t.get_singleton_class(g),T),t.const_set(T[0],"SKILL_TABLE",g.$translate_skill_table("ja_jp")),t.const_set(T[0],"TABLES",g.$translate_tables("ja_jp",c(T,"SKILL_TABLE"))),g.$register_prefix(c(T,"SKILL_TABLE").$prefixes()),g.$register_prefix(c(T,"TABLES").$keys())}(p[0],c(p,"Base"),p)}(p[0],p)}(a[0],a)}(Opal)}}]);