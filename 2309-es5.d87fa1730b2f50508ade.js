(self.webpackChunkudonarium=self.webpackChunkudonarium||[]).push([[2309],{92309:function(t,e,n){n(93683),function(t){function e(t,e){return"number"==typeof t&&"number"==typeof e?t>=e:t["$>="](e)}function n(t,e){return"number"==typeof t&&"number"==typeof e?t-e:t["$-"](e)}function $(t,e){return"number"==typeof t&&"number"==typeof e?t+e:t["$+"](e)}function r(t,e){return"number"==typeof t&&"number"==typeof e?t>e:t["$>"](e)}function i(t,e){return"number"==typeof t&&"number"==typeof e?t<e:t["$<"](e)}function o(t,e){return"number"==typeof t&&"number"==typeof e?t*e:t["$*"](e)}function u(t,e){return"number"==typeof t&&"number"==typeof e?t/e:t["$/"](e)}function a(t,e){return"number"==typeof t&&"number"==typeof e?t<=e:t["$<="](e)}var s,c,d,l,_,f,p,m,y,b,h,g,v,x,S,k,B,R,z,H=[],w=t.nil,D=t.$$$,E=t.$$,A=t.module,L=t.klass,T=t.send2,j=t.truthy,C=t.send,q=t.hash2;s=H,c=z=[A(H[0],"BCDice")].concat(s),d=R=[A(z[0],"GameSystem")].concat(c),k=L(R[0],E(R,"Base"),"TunnelsAndTrolls"),B=[k].concat(d),k.$$prototype.dice_total=k.$$prototype.count_6=k.$$prototype.randomizer=k.$$prototype.dice_list=w,t.const_set(B[0],"ID","TunnelsAndTrolls"),t.const_set(B[0],"NAME","\u30c8\u30f3\u30cd\u30eb\u30ba\uff06\u30c8\u30ed\u30fc\u30eb\u30ba"),t.const_set(B[0],"SORT_KEY","\u3068\u3093\u306d\u308b\u3059\u3042\u3093\u3068\u3068\u308d\u304a\u308b\u3059"),t.const_set(B[0],"HELP_MESSAGE",'\u30fb\u884c\u70ba\u5224\u5b9a\u3000(nD6+x>=nLV)\n\u5931\u6557\u3001\u6210\u529f\u3001\u81ea\u52d5\u5931\u6557\u306e\u81ea\u52d5\u5224\u5b9a\u3068\u30be\u30ed\u76ee\u306e\u632f\u308a\u8db3\u3057\u7d4c\u9a13\u5024\u306e\u81ea\u52d5\u8a08\u7b97\u3092\u884c\u3044\u307e\u3059\u3002\nSAVE\u306e\u96e3\u6613\u5ea6\u3092\u300c\u30ec\u30d9\u30eb\u300d\u3067\u8868\u8a18\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u300c2Lv\u300d\u3068\u66f8\u304f\u3068\u300c25\u300d\u306b\u7f6e\u63db\u3055\u308c\u307e\u3059\u3002\n\u5224\u5b9a\u6642\u4ee5\u5916\u306f\u60aa\u610f\u30c0\u30e1\u30fc\u30b8\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u7528\u306b\u5c02\u7528\u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u307e\u3059\u3002\n\u4f8b\uff092D6+1>=1Lv\n\u3000 (2D6+1>=20) \uff1e 7[2,5]+1 \uff1e 8 \uff1e \u5931\u6557\n\u3000\u5224\u5b9a\u6642\u306b\u306f\u30be\u30ed\u76ee\u3092\u81ea\u52d5\u3067\u632f\u308a\u8db3\u3057\u307e\u3059\u3002\n\n\u30fb\u30d0\u30fc\u30b5\u30fc\u30af\u3068\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3000(nBS+x or nHBS+x)\n\u3000"(\u30c0\u30a4\u30b9\u6570)BS(\u4fee\u6b63\u5024)"\u3067\u30d0\u30fc\u30b5\u30fc\u30af\u3001"(\u30c0\u30a4\u30b9\u6570)HBS(\u4fee\u6b63\u5024)"\u3067\u30cf\u30a4\u30d1\u30fc\u30d0\u30fc\u30b5\u30fc\u30af\u3067\u30ed\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\u3000\u6700\u521d\u306e\u30c0\u30a4\u30b9\u306e\u8aad\u66ff\u306f\u3001\u500b\u5225\u306e\u51fa\u76ee\u306f\u305d\u306e\u307e\u307e\u3067\u8868\u793a\u3002\n\u3000\u4e0b\u304b\u3089\uff12\u756a\u76ee\u306e\u51fa\u76ee\u3092\u305a\u3089\u3057\u305f\u5206\u3060\u3051\u5408\u8a08\u306b\u30de\u30a4\u30ca\u30b9\u4fee\u6b63\u3092\u8ffd\u52a0\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\n'),k.$register_prefix("\\d+H?BS","\\d+R6","\\d+D\\d+"),t.def(k,"$initialize",l=function(e){var n=this;return l.$$p&&(l.$$p=null),T(n,t.find_super_dispatcher(n,"initialize",l,!1,!0),"initialize",[e],null),n.sort_add_dice=!0},l.$$arity=1),k.$private(),t.def(k,"$replace_text",_=function(t){var e,n,$,r,i=this;return j(/BS/i["$=~"](t))&&(t=C(t,"gsub",[/(\d+)HBS([^\d\s][+\-\d]+)/i],((e=function(){return E(B,"Regexp").$last_match(1)+"R6"+E(B,"Regexp").$last_match(2)+"[H]"}).$$s=i,e.$$arity=0,e)),t=C(t,"gsub",[/(\d+)HBS/i],((n=function(){return E(B,"Regexp").$last_match(1)+"R6[H]"}).$$s=i,n.$$arity=0,n)),t=C(t,"gsub",[/(\d+)BS([^\d\s][+\-\d]+)/i],(($=function(){return E(B,"Regexp").$last_match(1)+"R6"+E(B,"Regexp").$last_match(2)}).$$s=i,$.$$arity=0,$)),t=C(t,"gsub",[/(\d+)BS/i],((r=function(){return E(B,"Regexp").$last_match(1)+"R6"}).$$s=i,r.$$arity=0,r))),t},_.$$arity=1),t.def(k,"$eval_game_system_specific_command",f=function(o){var u,a=this,s=w,c=w,d=w,l=w,_=w,f=w,p=w,m=w,y=w,b=w,h=w,g=w,v=w;return j(/^\d+D\d+/i["$match?"](o))?a.$roll_action(o):(o=a.$replace_text(o),a.$debug("tandt_berserk string",o),s="1",j(c=/(^|\s)S?((\d+)[rR]6([+\-\d]*)(\[(\w+)\])?)(\s|$)/i.$match(o))&&(a.$debug("tandt_berserk matched"),o=c["$[]"](2),d=c["$[]"](3).$to_i(),l=0,j(c["$[]"](4))&&(l=E(B,"ArithmeticEvaluator").$eval(c["$[]"](4))),_=!1,j(j(f=c["$[]"](5))?c["$[]"](6)["$=~"](/[Hh]/):f)&&(_=!0),p=[],m=0,y="",b=!0,h=0,g=0,a.$debug("isHyperBerserk",_),p.$push(d),function(){var i=t.new_brk();try{C(a,"loop",[],((u=function(){var o,a,s,c,d,l,f=null==u.$$s?this:u.$$s,v=w,x=w,S=w,k=w,B=w,R=w,z=w,H=w;if(null==f.randomizer&&(f.randomizer=w),f.$debug("loop dice_arr",p),d=p.$shift(),f.$debug("roll dice_wk d6",d),l=(v=f.randomizer.$roll_barabara(d,6).$sort()).$sum(),x=v.$count(6),j(e(d,2))&&(S=v,B=[],C(k=6,"times",[],((o=function(t){return null==t&&(t=w),B.$push(0)}).$$s=f,o.$$arity=1,o)),C(S,"each",[],((a=function(e){var r;return null==e&&(e=w),r=[n(e,1),$(B["$[]"](n(e,1)),1)],C(B,"[]=",t.to_a(r)),r[n(r.length,1)]}).$$s=f,a.$$arity=1,a)),C(B,"each",[],((s=function(t){return null==t&&(t=w),j(e(t,2))?(j(_)&&(t=$(t,1)),p.$push(t)):w}).$$s=f,s.$$arity=1,s)),j(j(R=b)?p["$empty?"]():R)&&(z=0,H=0,C(k,"times",[],((c=function(t){var e,$=null==c.$$s?this:c.$$s;return null==t&&(t=w),e=n(n(k,t),1),$.$debug("diceType index",e),j(r(B["$[]"](e),0))?(H=z,z=e):w}).$$s=f,c.$$arity=1,c)),f.$debug("min1, min2",z,H),g=n(H,z)["$-@"](),H["$=="](5)&&(x=n(x,1)),j(_)?p.$push(3):p.$push(2))),m=$(m,l),j(y["$!="](""))&&(y=$(y,"][")),y=$(y,v.$join(",")),h=$(h,x),b=!1,f.$debug("loop last chek dice_arr",p),!j(p["$empty?"]()))return w;t.brk(w,i)}).$$s=a,u.$$brk=i,u.$$arity=0,u))}catch(o){if(o===i)return o.$v;throw o}}(),a.$debug("loop breaked"),a.$debug("dice_now, bonus, bonus2",m,l,g),v=$($(m,l),g),s=m+(y="["+y+"]"),j(i(g,0))&&(a.$debug("bonus2",g),s=$(s,g.$to_s())),a.$debug("bonus",l),j(r(l,0))?s=$(s,"+"+l):j(i(l,0))&&(s=$(s,l.$to_s())),s=j(s["$=~"](/[^\d\[\]]+/))?"("+o+") \uff1e "+s+" \uff1e "+v:"("+o+") \uff1e "+v,j(r(h,0))&&(s=$(s," \uff1e \u60aa\u610f"+h))),s)},f.$$arity=1),t.def(k,"$roll_action",p=function(t){var e,n=this,r=w,i=w,u=w,a=w;return t=C(t,"sub",[/\d+LV$/i],((e=function(t){return null==t&&(t=w),$(o(t.$to_i(),5),15)}).$$s=n,e.$$arity=1,e)),r=D(E(B,"Command"),"Parser").$new(/\d+D6/,q(["round_type"],{round_type:n.$round_type()})).$restrict_cmp_op_to(w,">=").$enable_question_target().$parse(t),j(r)?(i=r.$command().$to_i(),n.$roll_action_dice(i),u=$(n.dice_total,r.$modify_number()),a=j(r["$question_target?"]())?"?":r.$target_number(),["("+r+")",n.$interim_expr(r,n.dice_total),u.$to_s(),n.$action_result(u,n.dice_total,a),n.$additional_result(n.count_6)].$compact().$join(" \uff1e ")):w},p.$$arity=1),t.def(k,"$roll_action_dice",m=function(t){var e=this,n=w,$=w;for(n=e.randomizer.$roll_barabara(t,6).$sort(),e.dice_list=[n];j(e["$same_all_dice?"](n));)n=e.randomizer.$roll_barabara(t,6).$sort(),e.dice_list.$push(n);return $=e.dice_list.$flatten(),e.dice_total=$.$sum(),e.count_6=$.$count(6)},m.$$arity=1),t.def(k,"$same_all_dice?",y=function(t){var e;return j(e=r(t.$size(),1))?t.$uniq().$size()["$=="](1):e},y.$$arity=1),t.def(k,"$interim_expr",b=function(t,e){var n,$,r=this,i=w,o=w;return j(j($=r.dice_list.$flatten().$size()["$=="](1))?t.$modify_number()["$=="](0):$)?w:(i=C(r.dice_list,"map",[],(n=function(t){return null==t&&(t=w),"["+t.$join(",")+"]"},n.$$s=r,n.$$arity=1,n)).$join(""),o=E(B,"Format").$modifier(t.$modify_number()),[e.$to_s(),i,o].$join(""))},b.$$arity=2),t.def(k,"$action_result",h=function(t,n,$){return n["$=="](3)?"\u81ea\u52d5\u5931\u6557":j($["$nil?"]())?w:$["$=="]("?")?this.$success_level(t,n):j(e(t,$))?"\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+this.$experience_point($,n):"\u5931\u6557"},h.$$arity=3),t.def(k,"$success_level",g=function(t,e){var $;return $=u(n(t,15),5).$to_i(),j(a($,0))?"\u5931\u6557 \uff1e \u7d4c\u9a13\u5024"+e:$+"Lv\u6210\u529f \uff1e \u7d4c\u9a13\u5024"+e},g.$$arity=2),t.def(k,"$experience_point",v=function(t,e){var $=w;return $=o(u(o(1,n(t,15)),5),e),j(a($,0))?"0":j(this["$int?"]($))?$.$to_i().$to_s():this.$format("%.1f",$)},v.$$arity=2),t.def(k,"$int?",x=function(t){return t["$=="](t.$to_i())},x.$$arity=1),t.def(k,"$additional_result",S=function(t){return j(r(t,0))?"\u60aa\u610f"+t:w},S.$$arity=1)}(Opal)}}]);